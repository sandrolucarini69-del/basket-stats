<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Basket Stats â€“ App (File Unico)</title>
<style>
  *{box-sizing:border-box}
  body{margin:0;font-family:Arial,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:#111;color:#fff}
  .stage{height:100vh}
  iframe{width:100%;height:100%;border:0;background:#fff}
</style>
</head>
<body>
  <div class="stage">
    <iframe id="frame-home" title="Cruscotto"></iframe>
    <iframe id="frame-live" title="Live" style="display:none"></iframe>
    <iframe id="frame-viewer" title="Viewer" style="display:none"></iframe>
  </div>

<script>
const B64 = {
  home: "PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9Iml0Ij4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9InV0Zi04Ii8+CjxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MSIvPgo8dGl0bGU+Q3J1c2NvdHRvIEJhc2tldCBTdGF0czwvdGl0bGU+CjxzdHlsZT4KICAqe2JveC1zaXppbmc6Ym9yZGVyLWJveH0KICBib2R5ewogICAgbWFyZ2luOjA7CiAgICBtaW4taGVpZ2h0OjEwMHZoOwogICAgZGlzcGxheTpmbGV4OwogICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAganVzdGlmeS1jb250ZW50OmNlbnRlcjsKICAgIGZvbnQtZmFtaWx5OkFyaWFsLHN5c3RlbS11aSwtYXBwbGUtc3lzdGVtLFNlZ29lIFVJLFJvYm90byxzYW5zLXNlcmlmOwogICAgYmFja2dyb3VuZDpsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCMxMTEsIzJjM2U1MCk7CiAgICBjb2xvcjojZmZmOwogIH0KICAucGFuZWx7CiAgICBwb3NpdGlvbjpyZWxhdGl2ZTsKICAgIGJhY2tncm91bmQ6IzFjMWMxYzsKICAgIGJvcmRlci1yYWRpdXM6MThweDsKICAgIHBhZGRpbmc6MjhweCAyNHB4OwogICAgd2lkdGg6MTAwJTsKICAgIG1heC13aWR0aDo0MjBweDsKICAgIGJveC1zaGFkb3c6MCAyMHB4IDUwcHggcmdiYSgwLDAsMCwuNDUpOwogICAgdGV4dC1hbGlnbjpjZW50ZXI7CiAgfQogIC5jbG9zZS1idG57CiAgICBwb3NpdGlvbjphYnNvbHV0ZTsKICAgIHRvcDoxMHB4OwogICAgcmlnaHQ6MTJweDsKICAgIGJhY2tncm91bmQ6dHJhbnNwYXJlbnQ7CiAgICBib3JkZXI6bm9uZTsKICAgIGNvbG9yOiNmZmY7CiAgICBmb250LXNpemU6MTRweDsKICAgIGZvbnQtd2VpZ2h0OjkwMDsKICAgIGN1cnNvcjpwb2ludGVyOwogICAgb3BhY2l0eTouODU7CiAgfQogIC5jbG9zZS1idG46aG92ZXJ7b3BhY2l0eToxfQogIGgxewogICAgbWFyZ2luOjAgMCA2cHg7CiAgICBmb250LXNpemU6MjJweDsKICAgIGZvbnQtd2VpZ2h0OjkwMDsKICAgIGxldHRlci1zcGFjaW5nOi40cHg7CiAgfQogIC5zdWJ7CiAgICBmb250LXNpemU6MTNweDsKICAgIGNvbG9yOiNiYmI7CiAgICBtYXJnaW4tYm90dG9tOjIycHg7CiAgfQogIC5idG57CiAgICB3aWR0aDoxMDAlOwogICAgYm9yZGVyOm5vbmU7CiAgICBib3JkZXItcmFkaXVzOjE0cHg7CiAgICBwYWRkaW5nOjE4cHggMTZweDsKICAgIG1hcmdpbjoxMHB4IDA7CiAgICBmb250LXNpemU6MTdweDsKICAgIGZvbnQtd2VpZ2h0OjkwMDsKICAgIGN1cnNvcjpwb2ludGVyOwogICAgZGlzcGxheTpmbGV4OwogICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAganVzdGlmeS1jb250ZW50OmNlbnRlcjsKICAgIGdhcDoxMHB4OwogICAgdHJhbnNpdGlvbjp0cmFuc2Zvcm0gLjA4cyBlYXNlLCBmaWx0ZXIgLjA4cyBlYXNlOwogIH0KICAuYnRuOmhvdmVye2ZpbHRlcjpicmlnaHRuZXNzKDEuMDgpfQogIC5idG46YWN0aXZle3RyYW5zZm9ybTpzY2FsZSguOTgpfQogIC5saXZlewogICAgYmFja2dyb3VuZDojZTc0YzNjOwogICAgY29sb3I6I2ZmZjsKICB9CiAgLnZpZXdlcnsKICAgIGJhY2tncm91bmQ6IzM0OThkYjsKICAgIGNvbG9yOiNmZmY7CiAgfQoKICAubWFudWFsewogICAgYmFja2dyb3VuZDojMmVjYzcxOwogICAgY29sb3I6I2ZmZjsKICB9CiAgLmhpbnR7CiAgICBtYXJnaW4tdG9wOjE4cHg7CiAgICBmb250LXNpemU6MTJweDsKICAgIGNvbG9yOiNhYWE7CiAgfQoKICAuY29udGFjdHsKICAgIG1hcmdpbi10b3A6MTJweDsKICAgIGZvbnQtc2l6ZToxM3B4OwogICAgY29sb3I6I2JiYjsKICB9CiAgLmNvbnRhY3QgYXsgY29sb3I6IzRkYTNmZjsgdGV4dC1kZWNvcmF0aW9uOm5vbmU7IH0KICAuY29udGFjdCBhOmhvdmVyeyB0ZXh0LWRlY29yYXRpb246dW5kZXJsaW5lOyB9Cgo8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5PgogIDxkaXYgY2xhc3M9InBhbmVsIj4KICAgIDxidXR0b24gY2xhc3M9ImNsb3NlLWJ0biIgb25jbGljaz0iY2xvc2VBcHAoKSI+Q0hJVURJIOKclTwvYnV0dG9uPgoKICAgIDxoMT7wn4+AIEJhc2tldCBTdGF0czwvaDE+CiAgICA8ZGl2IGNsYXNzPSJzdWIiPkNydXNjb3R0byBkaSBhdnZpbzwvZGl2PgoKICAgIDxidXR0b24gY2xhc3M9ImJ0biBsaXZlIiBvbmNsaWNrPSJvcGVuTGl2ZSgpIj4KICAgICAg4o+x77iPIEJhc2tldCBTdGF0cyAocHJvZ3JhbW1hKQogICAgPC9idXR0b24+CgogICAgPGJ1dHRvbiBjbGFzcz0iYnRuIHZpZXdlciIgb25jbGljaz0ib3BlblZpZXdlcigpIj4KICAgICAg8J+TiiBCYXNrZXQgU3RhdHMg4oCTIFZpZXdlcgogICAgPC9idXR0b24+CgogICAgPGJ1dHRvbiBjbGFzcz0iYnRuIG1hbnVhbCIgb25jbGljaz0ib3Blbk1hbnVhbCgpIj4KICAgICAg8J+TmCBNYW51YWxlIChQREYpCiAgICA8L2J1dHRvbj4KCiAgICA8ZGl2IGNsYXNzPSJoaW50Ij4KICAgICAgVXNhIGlsIHByb2dyYW1tYSBwZXIgc2VnbmFyZSBsYSBnYXJhIGluIGRpcmV0dGEsPGJyLz4KICAgICAgaWwgdmlld2VyIHBlciBhbmFsaXp6YXJlIGNvbiBjYWxtYSBsZSBzdGF0aXN0aWNoZSBzYWx2YXRlLgogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0iY29udGFjdCI+CiAgICAgIFBlciBpbmZvOiA8YSBocmVmPSJtYWlsdG86c2FuZHJvQHN5c3RlbWRhdGEuaXQiPnNhbmRyb0BzeXN0ZW1kYXRhLml0PC9hPgogICAgPC9kaXY+CgogIDwvZGl2PgoKPHNjcmlwdD4KZnVuY3Rpb24gb3BlbkxpdmUoKXsgcGFyZW50LnBvc3RNZXNzYWdlKHt0eXBlOiduYXYnLHRhcmdldDonbGl2ZSd9LCAnKicpOyB9CmZ1bmN0aW9uIG9wZW5WaWV3ZXIoKXsgcGFyZW50LnBvc3RNZXNzYWdlKHt0eXBlOiduYXYnLHRhcmdldDondmlld2VyJ30sICcqJyk7IH0KCmZ1bmN0aW9uIG9wZW5NYW51YWwoKXsKICAvLyBNZXR0aSBpbCBQREYgbmVsbGEgc3Rlc3NhIGNhcnRlbGxhIGRlbCBjcnVzY290dG8gZSBhZ2dpb3JuYSBpbCBub21lIHF1aSBzb3R0byBzZSBkaXZlcnNvCiAgd2luZG93Lm9wZW4oJ01hbnVhbGUucGRmJywgJ19ibGFuaycpOwp9CmZ1bmN0aW9uIGNsb3NlQXBwKCl7CiAgd2luZG93LmNsb3NlKCk7CiAgLy8gZmFsbGJhY2sgcGVyIGJyb3dzZXIgY2hlIGJsb2NjYW5vIHdpbmRvdy5jbG9zZSgpCiAgc2V0VGltZW91dCgoKT0+eyB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICdhYm91dDpibGFuayc7IH0sIDEwMCk7Cn0KPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPgo=",
  live: "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9Iml0Ij4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9IlVURi04IiAvPgo8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEiIC8+Cjx0aXRsZT5CYXNrZXQgU3RhdHMg4oCTIEZpbGUgVW5pY288L3RpdGxlPgoKPHN0eWxlPgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09CiAgIEJBU0UKPT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoqeyBib3gtc2l6aW5nOmJvcmRlci1ib3g7IH0KYm9keXsgbWFyZ2luOjA7IGZvbnQtZmFtaWx5OkFyaWFsLCBzYW5zLXNlcmlmOyBiYWNrZ3JvdW5kOiNmMmYyZjI7IGNvbG9yOiMxMTE7IH0KYnV0dG9ueyBib3JkZXI6bm9uZTsgYm9yZGVyLXJhZGl1czo0cHg7IGN1cnNvcjpwb2ludGVyOyB9CmJ1dHRvbjpkaXNhYmxlZHsgb3BhY2l0eTouNTsgY3Vyc29yOm5vdC1hbGxvd2VkOyB9CgouZ3JlZW57YmFja2dyb3VuZDojMmVjYzcxO2NvbG9yOiNmZmY7fQoucmVke2JhY2tncm91bmQ6I2U3NGMzYztjb2xvcjojZmZmO30KLmdyYXl7YmFja2dyb3VuZDojN2Y4YzhkO2NvbG9yOiNmZmY7fQouYmx1ZXtiYWNrZ3JvdW5kOiMzNDk4ZGI7Y29sb3I6I2ZmZjt9CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09CiAgIFRPUCBCQVIKPT09PT09PT09PT09PT09PT09PT09PT09PSAqLwo6cm9vdHsKICAtLXNpZGVXOiAzMDBweDsKICAtLWNsb2NrSDogNDRweDsKfQoKLnRvcGJhcnsKICBiYWNrZ3JvdW5kOiMwMDA7IGNvbG9yOiNmZmY7IHBhZGRpbmc6NnB4IDEwcHg7CiAgZGlzcGxheTpncmlkOwogIGdyaWQtdGVtcGxhdGUtY29sdW1uczogdmFyKC0tc2lkZVcpIDFmciB2YXIoLS1zaWRlVyk7CiAgYWxpZ24taXRlbXM6c3RhcnQ7CiAgZ2FwOjEwcHg7Cn0KCi5zaWRlLXNwYWNlcnsgZGlzcGxheTpmbGV4OyBhbGlnbi1pdGVtczpmbGV4LXN0YXJ0OyBqdXN0aWZ5LWNvbnRlbnQ6ZmxleC1zdGFydDsgfQoubGVmdC1wYWNreyBkaXNwbGF5OmJsb2NrOyB9CgoucWNvbC1sZWZ0ewogIGRpc3BsYXk6ZmxleDsKICBmbGV4LWRpcmVjdGlvbjpjb2x1bW47CiAgZ2FwOjZweDsKICBwYWRkaW5nLXRvcDoycHg7CiAgYWxpZ24taXRlbXM6ZmxleC1zdGFydDsKfQoucXJvd3sKICBkaXNwbGF5OmdyaWQ7CiAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOjI4cHggMzZweCAzNnB4OwogIGdhcDoxMHB4OwogIGNvbG9yOiNmMWM0MGY7CiAgZm9udC1zaXplOjEycHg7CiAgYWxpZ24taXRlbXM6Y2VudGVyOwp9Ci5xcm93IHN0cm9uZ3sgY29sb3I6I2ZmZjsgfQoKLmNlbnRlcnsgdGV4dC1hbGlnbjpjZW50ZXI7IH0KI2Nsb2NrewogIGZvbnQtc2l6ZTozNHB4OwogIGZvbnQtd2VpZ2h0OmJvbGQ7CiAgaGVpZ2h0OiB2YXIoLS1jbG9ja0gpOwogIGxpbmUtaGVpZ2h0OiB2YXIoLS1jbG9ja0gpOwp9CgouY2xvY2stY29udHJvbHN7CiAgZGlzcGxheTpmbGV4OwogIGp1c3RpZnktY29udGVudDpjZW50ZXI7CiAgYWxpZ24taXRlbXM6Y2VudGVyOwogIGdhcDoxMHB4OwogIG1hcmdpbi10b3A6MnB4Owp9Ci5jbG9jay1jb250cm9scyBidXR0b257CiAgcGFkZGluZzo0cHggMTJweDsKICBmb250LXNpemU6MTRweDsKfQoKLnF1YXJ0ZXItbGFiZWx7CiAgZm9udC1zaXplOjE2cHg7CiAgZm9udC13ZWlnaHQ6Ym9sZDsKICBtYXJnaW4tdG9wOjZweDsKICBjdXJzb3I6cG9pbnRlcjsKfQoKLnNjb3JlLXJvd3sKICBkaXNwbGF5OmZsZXg7CiAganVzdGlmeS1jb250ZW50OmNlbnRlcjsKICBhbGlnbi1pdGVtczpmbGV4LXN0YXJ0OwogIGdhcDoxMnB4OwogIG1hcmdpbi10b3A6NnB4OwogIGZsZXgtd3JhcDp3cmFwOwp9Ci50ZWFtLWJveHsKICBkaXNwbGF5OmZsZXg7CiAgZmxleC1kaXJlY3Rpb246Y29sdW1uOwogIGFsaWduLWl0ZW1zOmNlbnRlcjsKICBnYXA6NHB4OwogIGZsZXg6IDEgMSAwOwogIG1pbi13aWR0aDowOwp9Ci50ZWFtLWJveCBpbnB1dHsKICBiYWNrZ3JvdW5kOiMwMDA7IGJvcmRlcjpub25lOyBjb2xvcjojZmZmOwogIGZvbnQtd2VpZ2h0OmJvbGQ7IHRleHQtYWxpZ246Y2VudGVyOwogIHdpZHRoOjEwMCU7CiAgZm9udC1zaXplOiBjbGFtcCgxNHB4LCAzLjR2dywgMjBweCk7CiAgd2hpdGUtc3BhY2U6bm93cmFwOyBvdmVyZmxvdzpoaWRkZW47IHRleHQtb3ZlcmZsb3c6ZWxsaXBzaXM7Cn0KLnRlYW0tZnNxewogIGZvbnQtc2l6ZTogY2xhbXAoMTJweCwgM3Z3LCAxOHB4KTsKICBjb2xvcjojZjFjNDBmOyBmb250LXdlaWdodDpib2xkOwogIGxldHRlci1zcGFjaW5nOjFweDsgbGluZS1oZWlnaHQ6MS4xOwp9Ci50ZWFtLWZvdWxzLWRhbmdlcnsgY29sb3I6I2U3NGMzYyAhaW1wb3J0YW50OyBmb250LXdlaWdodDpib2xkOyB9Cgouc2NvcmUtYmlnewogIGZsZXg6IDAgMCBhdXRvOwogIGRpc3BsYXk6aW5saW5lLWZsZXg7CiAgYWxpZ24taXRlbXM6Y2VudGVyOwogIGp1c3RpZnktY29udGVudDpjZW50ZXI7CiAgd2hpdGUtc3BhY2U6bm93cmFwOwogIGdhcDo4cHg7CiAgZm9udC13ZWlnaHQ6Ym9sZDsKICBsZXR0ZXItc3BhY2luZzowOwogIGZvbnQtc2l6ZTogY2xhbXAoMjZweCwgNy42dncsIDQycHgpOwp9CgoudW5kb3sKICBkaXNwbGF5OmZsZXg7CiAgZmxleC1kaXJlY3Rpb246Y29sdW1uOwogIGFsaWduLWl0ZW1zOmZsZXgtZW5kOwogIGdhcDo2cHg7CiAgd2lkdGg6MjgwcHg7Cn0KLnVuZG8taW5mb3sKICBjb2xvcjojZjFjNDBmOwogIG1heC13aWR0aDoyODBweDsKICBvdmVyZmxvdzpoaWRkZW47CiAgdGV4dC1vdmVyZmxvdzplbGxpcHNpczsKICBmb250LXNpemU6MThweDsKICBsaW5lLWhlaWdodDoxLjI7CiAgdGV4dC1hbGlnbjpyaWdodDsKfQoKLnJpZ2h0LWNvbnRyb2xzewogIGRpc3BsYXk6ZmxleDsKICBmbGV4LXdyYXA6d3JhcDsKICBnYXA6NnB4OwogIHdpZHRoOjEwMCU7CiAgaGVpZ2h0OiB2YXIoLS1jbG9ja0gpOwogIGFsaWduLWl0ZW1zOmNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6ZmxleC1lbmQ7CiAgb3ZlcmZsb3c6dmlzaWJsZTsKfQoucmlnaHQtY29udHJvbHMgYnV0dG9uewogIGhlaWdodDozMnB4OwogIHBhZGRpbmc6MCA4cHg7CiAgZm9udC1zaXplOjEycHg7CiAgZm9udC13ZWlnaHQ6Ym9sZDsKICBkaXNwbGF5OmlubGluZS1mbGV4OwogIGFsaWduLWl0ZW1zOmNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOwogIGxpbmUtaGVpZ2h0OjMycHg7CiAgd2hpdGUtc3BhY2U6bm93cmFwOwogIGZsZXg6MCAwIGF1dG87Cn0KCi5kYXRhLXRvZ2dsZXsKICB3aWR0aDogZml0LWNvbnRlbnQ7CiAgbWF4LXdpZHRoOiAxMDAlOwogIGhlaWdodDozMnB4OwogIHBhZGRpbmc6IDAgMTRweDsKICBmb250LXNpemU6MTJweDsKICBmb250LXdlaWdodDpib2xkOwogIGRpc3BsYXk6aW5saW5lLWZsZXg7CiAgYWxpZ24taXRlbXM6Y2VudGVyOwogIGp1c3RpZnktY29udGVudDpjZW50ZXI7CiAgd2hpdGUtc3BhY2U6bm93cmFwOwogIGFsaWduLXNlbGY6IGZsZXgtZW5kOyAvKiBzZWd1ZSBsJ2FsbGluZWFtZW50byBkZWxsYSBjb2xvbm5hIHVuZG8gKGRlc2t0b3ApICovCn0KCi5tYXRjaC1kYXRhLXBhbmVsewogIHdpZHRoOjEwMCU7CiAgYmFja2dyb3VuZDojMTExOwogIGJvcmRlcjoxcHggc29saWQgIzMzMzsKICBib3JkZXItcmFkaXVzOjhweDsKICBwYWRkaW5nOjhweDsKfQoubWF0Y2gtZGF0YS1ncmlkeyBkaXNwbGF5OmdyaWQ7IGdyaWQtdGVtcGxhdGUtY29sdW1uczoxZnI7IGdhcDo4cHg7IH0KLm1hdGNoLWRhdGEtcGFuZWwgLm1hdGNoLXJvd3sKICBkaXNwbGF5OmZsZXg7CiAgYWxpZ24taXRlbXM6Y2VudGVyOwogIGp1c3RpZnktY29udGVudDpzcGFjZS1iZXR3ZWVuOwogIGdhcDo4cHg7CiAgZm9udC1zaXplOjEycHg7CiAgY29sb3I6I2YxYzQwZjsKICB3aGl0ZS1zcGFjZTpub3dyYXA7Cn0KLm1hdGNoLWRhdGEtcGFuZWwgLm1hdGNoLXJvdyBsYWJlbHsKICBjb2xvcjojZmZmOwogIGZvbnQtd2VpZ2h0OmJvbGQ7CiAgZmxleDowIDAgYXV0bzsKfQoubWF0Y2gtZGF0YS1wYW5lbCAubWF0Y2gtcm93IGlucHV0ewogIGZsZXg6MSAxIGF1dG87CiAgd2lkdGg6YXV0bzsKICBtaW4td2lkdGg6IDEyMHB4OwogIG1heC13aWR0aDogMjIwcHg7CiAgYmFja2dyb3VuZDojMDAwOwogIGJvcmRlcjoxcHggc29saWQgIzMzMzsKICBjb2xvcjojZmZmOwogIHBhZGRpbmc6M3B4IDZweDsKICBib3JkZXItcmFkaXVzOjRweDsKICBmb250LXNpemU6MTJweDsKfQpAbWVkaWEgKG1heC13aWR0aDogNTIwcHgpewogIC5tYXRjaC1kYXRhLXBhbmVsIC5tYXRjaC1yb3d7CiAgICBmbGV4LWRpcmVjdGlvbjpjb2x1bW47CiAgICBhbGlnbi1pdGVtczpzdHJldGNoOwogICAgd2hpdGUtc3BhY2U6bm9ybWFsOwogIH0KICAubWF0Y2gtZGF0YS1wYW5lbCAubWF0Y2gtcm93IGlucHV0eyBtYXgtd2lkdGg6bm9uZTsgd2lkdGg6MTAwJTsgfQp9CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09CiAgIEhFQURFUiBTUVVBRFJFCj09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KLnNlY3Rpb24taGVhZGVyewogIGJhY2tncm91bmQ6IzAwMDsKICBjb2xvcjojZmZmOwogIHBhZGRpbmc6NnB4IDEwcHg7CiAgZGlzcGxheTpmbGV4OwogIGFsaWduLWl0ZW1zOmNlbnRlcjsKICBnYXA6MTRweDsKICBmbGV4LXdyYXA6d3JhcDsKICBwb3NpdGlvbjpyZWxhdGl2ZTsKfQouc2VjdGlvbi10aXRsZXsKICBmb250LXdlaWdodDpib2xkOwogIGxldHRlci1zcGFjaW5nOi4zcHg7CiAgd2hpdGUtc3BhY2U6bm93cmFwOwogIG92ZXJmbG93OmhpZGRlbjsKICB0ZXh0LW92ZXJmbG93OmVsbGlwc2lzOwogIG1heC13aWR0aDo0MCU7Cn0KLnNlY3Rpb24tY29udHJvbHN7CiAgZGlzcGxheTpmbGV4OwogIGFsaWduLWl0ZW1zOmNlbnRlcjsKICBnYXA6MTJweDsKICBmbGV4LXdyYXA6d3JhcDsKfQouc2VjdGlvbi1jb250cm9scyAuc3RhdHsKICBkaXNwbGF5OmZsZXg7CiAgYWxpZ24taXRlbXM6Y2VudGVyOwogIGdhcDo2cHg7CiAgd2hpdGUtc3BhY2U6bm93cmFwOwogIGZvbnQtd2VpZ2h0OmJvbGQ7Cn0KLmZ1cmJvLXB1c2h7IG1hcmdpbi1sZWZ0OmF1dG87IH0KCiNtaW51c0J0bnsgcGFkZGluZzo0cHggMTJweDsgZm9udC13ZWlnaHQ6Ym9sZDsgfQojbWludXNCdG4uYWN0aXZlewogIGJhY2tncm91bmQ6I2U2N2UyMjsgY29sb3I6I2ZmZjsKICBhbmltYXRpb246IGZ1cmJvUHVsc2UgMXMgaW5maW5pdGU7Cn0KQGtleWZyYW1lcyBmdXJib1B1bHNlewogIDAlICAgeyBib3gtc2hhZG93OiAwIDAgMCAwIHJnYmEoMjMwLDEyNiwzNCwwLjcwKTsgfQogIDcwJSAgeyBib3gtc2hhZG93OiAwIDAgMCAxMHB4IHJnYmEoMjMwLDEyNiwzNCwwKTsgfQogIDEwMCUgeyBib3gtc2hhZG93OiAwIDAgMCAwIHJnYmEoMjMwLDEyNiwzNCwwKTsgfQp9Ci5mdHMtZGFuZ2VyeyBjb2xvcjojZTc0YzNjOyBmb250LXdlaWdodDpib2xkOyB9CgouY2xvY2stc3lzdGVtLW1pZHsKICBwb3NpdGlvbjphYnNvbHV0ZTsKICBsZWZ0OjUwJTsKICB0cmFuc2Zvcm06dHJhbnNsYXRlWCgtNTAlKTsKICBkaXNwbGF5OmZsZXg7CiAgZ2FwOjZweDsKICBhbGlnbi1pdGVtczpjZW50ZXI7Cn0KLmNsb2NrLXN5c3RlbS1taWQgYnV0dG9uewogIHBhZGRpbmc6MnB4IDhweDsKICBmb250LXNpemU6MTFweDsKICBoZWlnaHQ6MjZweDsKICBib3JkZXItcmFkaXVzOjRweDsKfQoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PQogICBUQUJFTExFIOKAkyBGSVgg4oCcTk9OIEVTQ0UgQSBERVNUUkHigJ0KICAgLSBOTyBtaW4td2lkdGgKICAgLSB0YWJsZS1sYXlvdXQgZml4ZWQKICAgLSBjb2xncm91cCBhIHBlcmNlbnR1YWxpICgxMDAlKQogICAtIEZTL1JBLy4uLiB0dXR0ZSB1Z3VhbGkgKGMtc3RhdCkKPT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoud3JhcHBlcnsgcGFkZGluZzo4cHg7IGJhY2tncm91bmQ6I2ZmZjsgb3ZlcmZsb3c6aGlkZGVuOyB9IC8qIG5pZW50ZSBzY3JvbGwgb3JpenpvbnRhbGUgKi8KdGFibGV7CiAgYm9yZGVyLWNvbGxhcHNlOmNvbGxhcHNlOwogIHdpZHRoOjEwMCU7CiAgdGFibGUtbGF5b3V0OmZpeGVkOwp9CnRoLCB0ZHsKICBib3JkZXI6MXB4IHNvbGlkICNjY2M7CiAgcGFkZGluZzo0cHggMnB4OwogIHRleHQtYWxpZ246Y2VudGVyOwogIGZvbnQtc2l6ZToxMnB4OwogIHdoaXRlLXNwYWNlOm5vd3JhcDsKICBvdmVyZmxvdzpoaWRkZW47CiAgdGV4dC1vdmVyZmxvdzplbGxpcHNpczsKfQp0aGVhZCB0aHsgYmFja2dyb3VuZDojMDAwOyBjb2xvcjojZmZmOyB9CgovKiBjb2xncm91cCAoMTAwJSk6CiAgICMgMyUgfCBBdGxldGEgMjclIHwgUFRTIDMlIHwgRkYgMyUgfCBNSU4gNSUKICAgMlBUIDglIHwgM1BUIDglIHwgVEwgOCUKICAgOCBzdGF0IHVndWFsaTogMzUlIC8gOCA9IDQuMzc1JSBjaWFzY3VuYQoqLwpjb2wuYy1udW0gICB7IHdpZHRoOjMlOyB9CmNvbC5jLW5hbWUgIHsgd2lkdGg6MjMlOyB9CmNvbC5jLXB0cyAgIHsgd2lkdGg6MyU7IH0KY29sLmMtZmYgICAgeyB3aWR0aDozJTsgfQpjb2wuYy1taW4gICB7IHdpZHRoOjUlOyB9CmNvbC5jLXBtICAgIHsgd2lkdGg6NCU7IH0KY29sLmMtc2hvdCAgeyB3aWR0aDo4JTsgfQpjb2wuYy1zdGF0ICB7IHdpZHRoOjQuMzc1JTsgfQoKLyogQXRsZXRhIGNlbGw6IGlucHV0ICsgSU4vT1VUICsgRVNQIGluIHVuYSByaWdhICovCnRkLm5hbWV7CiAgdGV4dC1hbGlnbjpsZWZ0OwogIGRpc3BsYXk6ZmxleDsKICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgZ2FwOjhweDsKfQoucGxheWVyLW5hbWUtaW5wdXR7CiAgZmxleDoxIDEgYXV0bzsKICBtaW4td2lkdGg6MDsKICBib3JkZXI6bm9uZTsKICBib3JkZXItYm90dG9tOjFweCBzb2xpZCAjZGRkOwogIHBhZGRpbmc6MnB4IDRweDsKICBmb250LXdlaWdodDpib2xkOwogIGJhY2tncm91bmQ6dHJhbnNwYXJlbnQ7CiAgb3ZlcmZsb3c6aGlkZGVuOwogIHRleHQtb3ZlcmZsb3c6ZWxsaXBzaXM7CiAgd2hpdGUtc3BhY2U6bm93cmFwOwp9Ci5wbGF5ZXItbmFtZS1pbnB1dDpmb2N1c3sgb3V0bGluZTpub25lOyBib3JkZXItYm90dG9tOjFweCBzb2xpZCAjMzQ5OGRiOyB9CgoucGxheWVyLW51bS1pbnB1dHsKICB3aWR0aDoyOHB4OwogIGJvcmRlcjpub25lOwogIGJvcmRlci1ib3R0b206MXB4IHNvbGlkICNkZGQ7CiAgdGV4dC1hbGlnbjpjZW50ZXI7CiAgcGFkZGluZzoycHggMDsKICBmb250LXdlaWdodDpib2xkOwogIGJhY2tncm91bmQ6dHJhbnNwYXJlbnQ7Cn0KLnBsYXllci1udW0taW5wdXQ6Zm9jdXN7IG91dGxpbmU6bm9uZTsgYm9yZGVyLWJvdHRvbToxcHggc29saWQgIzM0OThkYjsgfQoucGxheWVyLW51bS1pbnB1dDo6LXdlYmtpdC1vdXRlci1zcGluLWJ1dHRvbiwKLnBsYXllci1udW0taW5wdXQ6Oi13ZWJraXQtaW5uZXItc3Bpbi1idXR0b257IC13ZWJraXQtYXBwZWFyYW5jZTpub25lOyBtYXJnaW46MDsgfQoucGxheWVyLW51bS1pbnB1dFt0eXBlPW51bWJlcl17IC1tb3otYXBwZWFyYW5jZTp0ZXh0ZmllbGQ7IH0KCi5zdGF0dXMtd3JhcHsKICBmbGV4OjAgMCBhdXRvOwogIGRpc3BsYXk6aW5saW5lLWZsZXg7CiAgYWxpZ24taXRlbXM6Y2VudGVyOwogIGdhcDo4cHg7CiAgd2hpdGUtc3BhY2U6bm93cmFwOwp9Ci5zdGF0dXMtd3JhcCAuaW8tYnRuewogIHdpZHRoOjQwcHg7CiAgcGFkZGluZzoycHggMDsKICBmb250LXNpemU6MTFweDsKfQouaW4geyBiYWNrZ3JvdW5kOiMyN2FlNjAgIWltcG9ydGFudDsgY29sb3I6I2ZmZjsgfQoub3V0eyBiYWNrZ3JvdW5kOiM3ZjhjOGQgIWltcG9ydGFudDsgY29sb3I6I2ZmZjsgfQoKLmZvdWwtb3V0ewogIGJhY2tncm91bmQ6I2MwMzkyYiAhaW1wb3J0YW50OwogIGNvbG9yOiNmZmYgIWltcG9ydGFudDsKICBjdXJzb3I6bm90LWFsbG93ZWQgIWltcG9ydGFudDsKfQoKLmVzcC1idG57CiAgYmFja2dyb3VuZDojYzAzOTJiOwogIGNvbG9yOiNmZmY7CiAgZm9udC13ZWlnaHQ6Ym9sZDsKICBwYWRkaW5nOjJweCA2cHg7CiAgaGVpZ2h0OjI0cHg7CiAgZm9udC1zaXplOjExcHg7CiAgYm9yZGVyLXJhZGl1czo2cHg7CiAgdG91Y2gtYWN0aW9uOiBtYW5pcHVsYXRpb247CiAgdXNlci1zZWxlY3Q6bm9uZTsKfQouZXNwLWJ0bjpkaXNhYmxlZHsgb3BhY2l0eTouNjU7IGN1cnNvcjpub3QtYWxsb3dlZDsgfQouZXNwLWJ0bi5ob2xkaW5newogIGFuaW1hdGlvbjogZXNwSG9sZFB1bHNlIC41NXMgaW5maW5pdGU7CiAgb3V0bGluZTogMnB4IHNvbGlkIHJnYmEoMCwwLDAsMC4yNSk7Cn0KQGtleWZyYW1lcyBlc3BIb2xkUHVsc2V7CiAgMCUgICB7IHRyYW5zZm9ybTogc2NhbGUoMSk7ICAgZmlsdGVyOiBicmlnaHRuZXNzKDEpOyB9CiAgNTAlICB7IHRyYW5zZm9ybTogc2NhbGUoMS4wOCk7IGZpbHRlcjogYnJpZ2h0bmVzcygxLjE1KTsgfQogIDEwMCUgeyB0cmFuc2Zvcm06IHNjYWxlKDEpOyAgIGZpbHRlcjogYnJpZ2h0bmVzcygxKTsgfQp9CgovKiBjZWxsZSDigJxzaG904oCdIGNvbXBhdHRlICovCi5zaG90eyBkaXNwbGF5OmZsZXg7IGp1c3RpZnktY29udGVudDpjZW50ZXI7IGFsaWduLWl0ZW1zOmNlbnRlcjsgZ2FwOjRweDsgfQouc2hvdCBzcGFueyBmb250LXNpemU6MTFweDsgfQouc2hvdCBidXR0b257CiAgcGFkZGluZzoycHggNnB4OwogIGZvbnQtc2l6ZToxMXB4Owp9CgovKiBib3R0b25pIG5lbGxlIGNlbGxlIHN0YXQ6IG5vbiBkZXZvbm8gYWxsYXJnYXJlICovCnRkIGJ1dHRvbi5ibHVlewogIHdpZHRoOjEwMCU7CiAgcGFkZGluZzoycHggMDsKICBmb250LXNpemU6MTFweDsKICBtaW4td2lkdGg6MDsKfQoKLyogcmlnaGUgSU4gZXZpZGVuemlhdGUgKi8KLmluLXJvdyB0ZHsgYmFja2dyb3VuZDojZmZlNDRkICFpbXBvcnRhbnQ7IGJvcmRlci1jb2xvcjojYzlhODAwICFpbXBvcnRhbnQ7IH0KLmluLXJvdyAucGxheWVyLW5hbWUtaW5wdXQsIC5pbi1yb3cgLnBsYXllci1udW0taW5wdXR7IGJhY2tncm91bmQ6dHJhbnNwYXJlbnQ7IH0KCi5mZi13YXJuaW5nIHsgY29sb3I6I2YzOWMxMjsgZm9udC13ZWlnaHQ6Ym9sZDsgfQouZmYtZGFuZ2VyICB7IGNvbG9yOiNlNzRjM2M7IGZvbnQtd2VpZ2h0OmJvbGQ7IH0KCi50ZWFtLWZvdWxzLWRhbmdlcnsgY29sb3I6I2U3NGMzYyAhaW1wb3J0YW50OyBmb250LXdlaWdodDpib2xkOyB9CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09CiAgIFJFU1BPTlNJVkUgVE9QQkFSCj09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KQG1lZGlhIChtYXgtd2lkdGg6IDk4MHB4KXsKICAudG9wYmFyewogICAgZ3JpZC10ZW1wbGF0ZS1jb2x1bW5zOiAxZnIgIWltcG9ydGFudDsKICAgIGdyaWQtYXV0by1yb3dzOiBhdXRvOwogICAgcm93LWdhcDogMTBweDsKICAgIGFsaWduLWl0ZW1zOiBzdHJldGNoOwogIH0KICAuc2lkZS1zcGFjZXJ7IGp1c3RpZnktY29udGVudDpjZW50ZXI7IH0KICAudW5kb3sgd2lkdGg6MTAwJSAhaW1wb3J0YW50OyBhbGlnbi1pdGVtczpjZW50ZXIgIWltcG9ydGFudDsgfQogIC51bmRvLWluZm97IG1heC13aWR0aDoxMDAlICFpbXBvcnRhbnQ7IHRleHQtYWxpZ246Y2VudGVyICFpbXBvcnRhbnQ7IH0KICAucmlnaHQtY29udHJvbHN7IGhlaWdodDphdXRvICFpbXBvcnRhbnQ7IGZsZXgtd3JhcDp3cmFwICFpbXBvcnRhbnQ7IGp1c3RpZnktY29udGVudDpjZW50ZXIgIWltcG9ydGFudDsgfQogIC5kYXRhLXRvZ2dsZXsgYWxpZ24tc2VsZjpjZW50ZXI7IH0KICAuY2xvY2stc3lzdGVtLW1pZHsgcG9zaXRpb246c3RhdGljOyB0cmFuc2Zvcm06bm9uZTsgb3JkZXI6IDk5OyBtYXJnaW4tbGVmdDphdXRvOyB9Cn0KCi8qID09PT09PT09PT09PT09PT09PT09PT09PT0KICAgTUlDUk8tUkVTUE9OU0lWRSBUQUJFTExBIChzZW56YSBzY3JvbGwpCj09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KQG1lZGlhIChtYXgtd2lkdGg6IDUyMHB4KXsKICB0aCwgdGR7IGZvbnQtc2l6ZToxMHB4OyBwYWRkaW5nOjNweCAxcHg7IH0KICAuc2hvdCBzcGFueyBmb250LXNpemU6MTBweDsgfQogIC5zaG90IGJ1dHRvbnsgcGFkZGluZzoxcHggNHB4OyBmb250LXNpemU6MTBweDsgfQogIHRkIGJ1dHRvbi5ibHVleyBmb250LXNpemU6MTBweDsgcGFkZGluZzoxcHggMDsgfQogIC5wbGF5ZXItbnVtLWlucHV0eyB3aWR0aDoyMnB4OyB9CiAgLnN0YXR1cy13cmFwIC5pby1idG57IHdpZHRoOjM0cHg7IGZvbnQtc2l6ZToxMHB4OyB9CiAgLmVzcC1idG57IGhlaWdodDoyMnB4OyBmb250LXNpemU6MTBweDsgcGFkZGluZzoycHggNXB4OyB9Cn0KCi8qID09PT09PT09PT09PT09PT09PT09PT09PT0KICAgT1ZFUkxBWSBTVEFUSVNUSUNIRQo9PT09PT09PT09PT09PT09PT09PT09PT09ICovCiNzdGF0c092ZXJsYXl7CiAgcG9zaXRpb246Zml4ZWQ7CiAgaW5zZXQ6MDsKICBiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsLjgyKTsKICBkaXNwbGF5Om5vbmU7CiAgei1pbmRleDo5OTk5Owp9CiNzdGF0c1BhbmVsewogIHBvc2l0aW9uOmFic29sdXRlOwogIGluc2V0OjE4cHg7CiAgYmFja2dyb3VuZDojZmZmOwogIGJvcmRlci1yYWRpdXM6MTJweDsKICBvdmVyZmxvdzpoaWRkZW47CiAgZGlzcGxheTpmbGV4OwogIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsKfQojc3RhdHNIZWFkZXJ7CiAgYmFja2dyb3VuZDojMDAwOwogIGNvbG9yOiNmZmY7CiAgcGFkZGluZzoxMHB4IDEycHg7CiAgZGlzcGxheTpmbGV4OwogIGFsaWduLWl0ZW1zOmNlbnRlcjsKICBnYXA6MTBweDsKfQojc3RhdHNIZWFkZXIgLnRpdGxleyBmb250LXdlaWdodDpib2xkOyBsZXR0ZXItc3BhY2luZzouM3B4OyB9CiNzdGF0c0hlYWRlciAuc3BhY2VyeyBtYXJnaW4tbGVmdDphdXRvOyB9CiNzdGF0c0hlYWRlciBidXR0b257IHBhZGRpbmc6NnB4IDEwcHg7IGZvbnQtd2VpZ2h0OmJvbGQ7IH0KCi5zdGF0cy1tZXRhewogIGRpc3BsYXk6ZmxleDsKICBmbGV4LWRpcmVjdGlvbjpjb2x1bW47CiAgZ2FwOjJweDsKICBtYXJnaW4tbGVmdDoxMnB4OwogIG1pbi13aWR0aDoyNjBweDsKICBtYXgtd2lkdGg6NzYwcHg7Cn0KLnN0YXRzLW1ldGEtYmxvY2t7CiAgZm9udC1zaXplOjEycHg7CiAgY29sb3I6I2YxYzQwZjsKICB3aGl0ZS1zcGFjZTpub3dyYXA7CiAgb3ZlcmZsb3c6aGlkZGVuOwogIHRleHQtb3ZlcmZsb3c6ZWxsaXBzaXM7CiAgbGluZS1oZWlnaHQ6MS4yOwp9Cgouc2NvcmUtbGluZXtmb250LXNpemU6MThweDtmb250LXdlaWdodDo5MDA7Y29sb3I6I2ZmZjt3aGl0ZS1zcGFjZTpub3dyYXA7b3ZlcmZsb3c6aGlkZGVuO3RleHQtb3ZlcmZsb3c6ZWxsaXBzaXN9CgoubWV0YS1zcGxpdHN7CiAgZGlzcGxheTpmbGV4OwogIGdhcDoxMHB4OwogIGFsaWduLWl0ZW1zOmJhc2VsaW5lOwogIGZvbnQtdmFyaWFudC1udW1lcmljOnRhYnVsYXItbnVtczsKICBmb250LWZhbWlseTogdWktbW9ub3NwYWNlLCBTRk1vbm8tUmVndWxhciwgTWVubG8sIE1vbmFjbywgQ29uc29sYXMsICJMaWJlcmF0aW9uIE1vbm8iLCAiQ291cmllciBOZXciLCBtb25vc3BhY2U7Cn0KLm1ldGEtc3BsaXRzIC5sYmx7CiAgbWluLXdpZHRoOjEyMHB4OwogIGNvbG9yOiNmMWM0MGY7CiAgZm9udC13ZWlnaHQ6OTAwOwp9Ci5tZXRhLXNwbGl0cyAudmFsc3sKICBjb2xvcjojZjFjNDBmOwogIGZvbnQtd2VpZ2h0OjgwMDsKfQoKLyogemVicmEgU09MTyBvdmVybGF5IHN0YXRzICsgbGlicmVyaWEgSlNPTiAqLwouc3RhdHMtdGFibGUgdGJvZHkgdHI6bnRoLWNoaWxkKG9kZCl7IGJhY2tncm91bmQ6I2ZmZjsgfQouc3RhdHMtdGFibGUgdGJvZHkgdHI6bnRoLWNoaWxkKGV2ZW4peyBiYWNrZ3JvdW5kOiNlMGUwZTA7IH0KLnN0YXRzLXRhYmxlIHRmb290IHRkeyBiYWNrZ3JvdW5kOiNjZmU4ZmY7IGZvbnQtd2VpZ2h0OjkwMDsgfQoKLmxpYi10YWJsZSB0Ym9keSB0cjpudGgtY2hpbGQob2RkKXsgYmFja2dyb3VuZDojZmZmOyB9Ci5saWItdGFibGUgdGJvZHkgdHI6bnRoLWNoaWxkKGV2ZW4peyBiYWNrZ3JvdW5kOiNlMGUwZTA7IH0KCiNzdGF0c0JvZHl7IHBhZGRpbmc6MTBweDsgb3ZlcmZsb3c6YXV0bzsgfQoKLnN0YXRzLWJsb2NreyBtYXJnaW4tYm90dG9tOjE0cHg7IH0KLnN0YXRzLWJsb2NrIGgzeyBtYXJnaW46OHB4IDAgNnB4OyBmb250LXNpemU6MTRweDsgfQouc3RhdHMtdGFibGV7CiAgd2lkdGg6MTAwJTsKICBib3JkZXItY29sbGFwc2U6Y29sbGFwc2U7CiAgdGFibGUtbGF5b3V0OmF1dG87CiAgZm9udC1zaXplOjEycHg7Cn0KLnN0YXRzLXRhYmxlIHRoLCAuc3RhdHMtdGFibGUgdGR7CiAgYm9yZGVyOjFweCBzb2xpZCAjZGRkOwogIHBhZGRpbmc6NnB4OwogIHRleHQtYWxpZ246Y2VudGVyOwogIHdoaXRlLXNwYWNlOm5vd3JhcDsKfQouc3RhdHMtdGFibGUgdGhlYWQgdGh7IGJhY2tncm91bmQ6IzExMTsgY29sb3I6I2ZmZjsgfQouc3RhdHMtdGFibGUgdGQubmFtZXsgdGV4dC1hbGlnbjpsZWZ0OyBmb250LXdlaWdodDpib2xkOyB9CnRmb290IHRkeyBiYWNrZ3JvdW5kOiNmNmY2ZjY7IGZvbnQtd2VpZ2h0OmJvbGQ7IH0KLnBpci1jb2x7IGZvbnQtd2VpZ2h0OmJvbGQ7IH0KLnBtLXBvc3sgY29sb3I6IzJlY2M3MTsgZm9udC13ZWlnaHQ6Ym9sZDsgfQoucG0tbmVneyBjb2xvcjojZTc0YzNjOyBmb250LXdlaWdodDpib2xkOyB9CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09CiAgIE9WRVJMQVkgTElCUkVSSUEgUEFSVElURQo9PT09PT09PT09PT09PT09PT09PT09PT09ICovCiNnYW1lc092ZXJsYXl7CiAgcG9zaXRpb246Zml4ZWQ7CiAgaW5zZXQ6MDsKICBiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsLjgyKTsKICBkaXNwbGF5Om5vbmU7CiAgei1pbmRleDoxMDAwMDsKfQojZ2FtZXNQYW5lbHsKICBwb3NpdGlvbjphYnNvbHV0ZTsKICBpbnNldDoxOHB4OwogIGJhY2tncm91bmQ6I2ZmZjsKICBib3JkZXItcmFkaXVzOjEycHg7CiAgb3ZlcmZsb3c6aGlkZGVuOwogIGRpc3BsYXk6ZmxleDsKICBmbGV4LWRpcmVjdGlvbjpjb2x1bW47Cn0KI2dhbWVzSGVhZGVyewogIGJhY2tncm91bmQ6IzAwMDsKICBjb2xvcjojZmZmOwogIHBhZGRpbmc6MTBweCAxMnB4OwogIGRpc3BsYXk6ZmxleDsKICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgZ2FwOjEwcHg7Cn0KI2dhbWVzSGVhZGVyIC50aXRsZXsgZm9udC13ZWlnaHQ6Ym9sZDsgbGV0dGVyLXNwYWNpbmc6LjNweDsgfQojZ2FtZXNIZWFkZXIgLnNwYWNlcnsgbWFyZ2luLWxlZnQ6YXV0bzsgfQojZ2FtZXNIZWFkZXIgYnV0dG9ueyBwYWRkaW5nOjZweCAxMHB4OyBmb250LXdlaWdodDpib2xkOyB9CiNnYW1lc0JvZHl7IHBhZGRpbmc6MTBweDsgb3ZlcmZsb3c6YXV0bzsgfQoKLmxpYi1hY3Rpb25zewogIGRpc3BsYXk6ZmxleDsKICBnYXA6OHB4OwogIGZsZXgtd3JhcDp3cmFwOwogIGFsaWduLWl0ZW1zOmNlbnRlcjsKICBtYXJnaW4tYm90dG9tOjEwcHg7Cn0KI2xpYkluZm97CiAgbWFyZ2luLWxlZnQ6YXV0bzsKICBmb250LXdlaWdodDpib2xkOwogIGNvbG9yOiM3ZjhjOGQ7Cn0KLmxpYi10YWJsZXsKICB3aWR0aDoxMDAlOwogIGJvcmRlci1jb2xsYXBzZTpjb2xsYXBzZTsKICB0YWJsZS1sYXlvdXQ6Zml4ZWQ7CiAgZm9udC1zaXplOjEzcHg7Cn0KLmxpYi10YWJsZSB0aCwgLmxpYi10YWJsZSB0ZHsKICBib3JkZXI6MXB4IHNvbGlkICNjY2M7CiAgcGFkZGluZzo2cHg7Cn0KLmxpYi10YWJsZSB0aGVhZCB0aHsKICBiYWNrZ3JvdW5kOiMxMTE7CiAgY29sb3I6I2ZmZjsKfQoubGliLWVsbGlwc2lzewogIG92ZXJmbG93OmhpZGRlbjsKICB0ZXh0LW92ZXJmbG93OmVsbGlwc2lzOwogIHdoaXRlLXNwYWNlOm5vd3JhcDsKfQoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PQogICBCT05VUyBGQUxMSSAoRlRTPj00KSDigJMgb3B6aW9uYWxlIHN1IHRhYmVsbGEKPT09PT09PT09PT09PT09PT09PT09PT09PSAqLwouc2VjdGlvbi1jb250cm9scyAubWluaS1idG57CiAgaGVpZ2h0OjIycHg7CiAgcGFkZGluZzowIDhweDsKICBmb250LXNpemU6MTFweDsKICBmb250LXdlaWdodDpib2xkOwogIGJvcmRlci1yYWRpdXM6NnB4OwogIGxpbmUtaGVpZ2h0OjIycHg7Cn0KLndyYXBwZXIuYm9udXMtYWN0aXZlewogIG91dGxpbmU6MnB4IHNvbGlkIHJnYmEoMjMxLDc2LDYwLC43NSk7CiAgb3V0bGluZS1vZmZzZXQ6LTJweDsKfQoud3JhcHBlci5ib251cy1hY3RpdmUgdGhlYWQgdGh7CiAgYmFja2dyb3VuZDojOGUxYjEyOwp9Ci5ib251cy1iYW5uZXJ7CiAgZGlzcGxheTpub25lOwogIGJhY2tncm91bmQ6IzhlMWIxMjsKICBjb2xvcjojZmZmOwogIGZvbnQtd2VpZ2h0OmJvbGQ7CiAgcGFkZGluZzo2cHggMTBweDsKICBmb250LXNpemU6MTJweDsKICBsZXR0ZXItc3BhY2luZzouM3B4Owp9CgoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PQogICBQVU5USSBHTE9CQUxJIFJBUElESSAoKzEvKzIvKzMpIGNvbiB0b2dnbGUgwrEKPT09PT09PT09PT09PT09PT09PT09PT09PSAqLwouc2NvcmUtcXVpY2t7CiAgZGlzcGxheTpmbGV4OwogIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsKICBnYXA6NHB4OwogIGFsaWduLWl0ZW1zOmNlbnRlcjsKICBqdXN0aWZ5LWNvbnRlbnQ6ZmxleC1zdGFydDsKICBtaW4td2lkdGg6MDsKfQouc2NvcmUtcXVpY2sgLnJvd3sKICBkaXNwbGF5OmZsZXg7CiAgZ2FwOjRweDsKICBmbGV4LXdyYXA6d3JhcDsKfQouc2NvcmUtcXVpY2sgYnV0dG9uewogIGhlaWdodDoyNHB4OwogIHBhZGRpbmc6MCA3cHg7CiAgZm9udC1zaXplOjExcHg7CiAgZm9udC13ZWlnaHQ6Ym9sZDsKICBib3JkZXItcmFkaXVzOjZweDsKICBsaW5lLWhlaWdodDoyNHB4Owp9CgoKCi8qIEZJWDogRGF0aSBwYXJ0aXRhIHNvdHRvL2FjY2FudG8gYSBTYWx2YSBzZW56YSBzb3ZyYXBwb3NpemlvbmkgKi8KLnJpZ2h0LWNvbnRyb2xzewogIGhlaWdodDphdXRvICFpbXBvcnRhbnQ7CiAgZmxleC13cmFwOndyYXAgIWltcG9ydGFudDsKICBnYXA6NnB4ICFpbXBvcnRhbnQ7Cn0KCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09CiAgIEhFQURFUiBGSVNTTyAoU0NST0xMIFBBR0lOQSkKPT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoudG9wYmFyewogIHBvc2l0aW9uOiBzdGlja3k7CiAgdG9wOiAwOwogIHotaW5kZXg6IDEwMDA7Cn0KCmJvZHl7CiAgc2Nyb2xsLXBhZGRpbmctdG9wOiAxMjBweDsgLyogYWx0ZXp6YSBtZWRpYSB0b3BiYXIgKi8KfQoKCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09CiAgIFNUSUNLWSBTVEFDSyAoY29tZSBzY3JlZW5zaG90KQogICAtIFRvcGJhcjogZ2nDoCBzdGlja3kKICAgLSBIZWFkZXIgU3F1YWRyYSBBOiBzdGlja3kgc290dG8gdG9wYmFyCiAgIC0gSW50ZXN0YXppb25lIHRhYmVsbGEgQTogc3RpY2t5IG1lbnRyZSBzY29ycm9ubyBTT0xPIGdsaSBhdGxldGkgKHNjcm9sbCBuZWwgd3JhcHBlciBBKQo9PT09PT09PT09PT09PT09PT09PT09PT09ICovCjpyb290ewogIC0tdG9wYmFySDogMTIwcHg7ICAgIC8qIGZhbGxiYWNrOiB2aWVuZSBhZ2dpb3JuYXRvIHZpYSBKUyAqLwogIC0tc2VjdGlvbkFIOiA1MnB4OyAgIC8qIGZhbGxiYWNrOiB2aWVuZSBhZ2dpb3JuYXRvIHZpYSBKUyAqLwp9Cgojc2VjdGlvbkhlYWRlckF7CiAgcG9zaXRpb246IHN0aWNreTsKICB0b3A6IHZhcigtLXRvcGJhckgpOwogIHotaW5kZXg6IDk1MDsKfQoKLyogU29sbyBsYSB0YWJlbGxhIEEgZGl2ZW50YSBhcmVhIHNjcm9sbCAqLwojd3JhcEF7CiAgb3ZlcmZsb3cteTogYXV0byAhaW1wb3J0YW50OwogIG92ZXJmbG93LXg6IGhpZGRlbiAhaW1wb3J0YW50OwogIG1heC1oZWlnaHQ6IGNhbGMoMTAwdmggLSB2YXIoLS10b3BiYXJIKSAtIHZhcigtLXNlY3Rpb25BSCkpOwogIG92ZXJzY3JvbGwtYmVoYXZpb3I6IGNvbnRhaW47CiAgLXdlYmtpdC1vdmVyZmxvdy1zY3JvbGxpbmc6IHRvdWNoOwogIGJhY2tncm91bmQ6I2ZmZjsKfQoKLyogSW50ZXN0YXppb25lIGNvbG9ubmUgdGFiZWxsYSBBIGZpc3NhIGRlbnRybyBsbyBzY3JvbGwgZGVsIHdyYXBwZXIgKi8KI3RhYmxlQSB0aGVhZCB0aHsKICBwb3NpdGlvbjogc3RpY2t5OwogIHRvcDogMDsKICB6LWluZGV4OiAxMDsKfQoKLyogUGljY29sbyBzdGFjY28gdmlzaXZvIHF1YW5kbyBhcHBpY2NpY2F0byAqLwojc2VjdGlvbkhlYWRlckF7CiAgYm94LXNoYWRvdzogMCAycHggMCByZ2JhKDAsMCwwLDAuMTUpOwp9CiN0YWJsZUEgdGhlYWQgdGh7CiAgYm94LXNoYWRvdzogMCAycHggMCByZ2JhKDAsMCwwLDAuMTIpOwp9CgoKLyogPT09IEZJWCBERUZJTklUSVZPIFNQQVpJTyBCSUFOQ08gU09QUkEgSEVBREVSIFRBQkVMTEEgQSA9PT0gKi8KCi8qIGlsIHdyYXBwZXIgQSBkaXZlbnRhIG5lcm8gKMOoIHF1ZWxsbyBjaGUgImJ1Y2F2YSIpICovCiN3cmFwQXsKICBiYWNrZ3JvdW5kOiMwMDAgIWltcG9ydGFudDsKICBwYWRkaW5nLXRvcDowICFpbXBvcnRhbnQ7Cn0KCi8qIGxhIHRhYmVsbGEgcmVzdGEgYmlhbmNhIHNvbG8gbmVsIGNvcnBvICovCiN0YWJsZUF7CiAgYmFja2dyb3VuZDojZmZmOwp9CgovKiB0YXBwbyBuZXJvIGNvbXBsZXRvIHBlciBpbnRlc3RhemlvbmUgKi8KI3RhYmxlQSB0aGVhZCwKI3RhYmxlQSB0aGVhZCB0ciwKI3RhYmxlQSB0aGVhZCB0aHsKICBiYWNrZ3JvdW5kOiMwMDAgIWltcG9ydGFudDsKfQoKCi8qID09PSBTQ1JPTEwgU09MTyBBVExFVEkgKyBIRUFERVIgRklTU08gUEVSIFRBQkVMTEEgQiA9PT0gKi8KI3dyYXBCewogIG92ZXJmbG93LXk6IGF1dG8gIWltcG9ydGFudDsKICBvdmVyZmxvdy14OiBoaWRkZW4gIWltcG9ydGFudDsKICBtYXgtaGVpZ2h0OiBjYWxjKDEwMHZoIC0gdmFyKC0tdG9wYmFySCkgLSB2YXIoLS1zZWN0aW9uQkgpKTsKICBvdmVyc2Nyb2xsLWJlaGF2aW9yOiBjb250YWluOwogIC13ZWJraXQtb3ZlcmZsb3ctc2Nyb2xsaW5nOiB0b3VjaDsKICBiYWNrZ3JvdW5kOiMwMDAgIWltcG9ydGFudDsgLyogdGFwcG8gZGlldHJvIGhlYWRlciAqLwogIHBhZGRpbmctdG9wOjAgIWltcG9ydGFudDsKfQojdGFibGVCeyBiYWNrZ3JvdW5kOiNmZmY7IH0KI3RhYmxlQiB0aGVhZCwgI3RhYmxlQiB0aGVhZCB0ciwgI3RhYmxlQiB0aGVhZCB0aHsgYmFja2dyb3VuZDojMDAwICFpbXBvcnRhbnQ7IH0KI3RhYmxlQiB0aGVhZCB0aHsKICBwb3NpdGlvbjogc3RpY2t5OwogIHRvcDogMDsKICB6LWluZGV4OiAxMDsKfQoKCi8qID09PSBESVNUQUNDTyBWSVNJVk8gQkxVIFRSQSBIRUFERVIgRklTU08gRSBUQUJFTExFIChBICsgQikgPT09ICovCjpyb290ewogIC0tc3RpY2t5LXNlcC1ibHVlOiAjMGIzYzVkOyAvKiBibHUgc2N1cm8gZWxlZ2FudGUgKi8KfQoKLyogYXJlYSBzb3ByYSBsZSBpbnRlc3RhemlvbmkgKGV4IG5lcmEpICovCiN3cmFwQSwKI3dyYXBCewogIGJhY2tncm91bmQ6IHZhcigtLXN0aWNreS1zZXAtYmx1ZSkgIWltcG9ydGFudDsKfQoKLyogaW50ZXN0YXppb25pIHRhYmVsbGUgKi8KI3RhYmxlQSB0aGVhZCwKI3RhYmxlQSB0aGVhZCB0ciwKI3RhYmxlQSB0aGVhZCB0aCwKI3RhYmxlQiB0aGVhZCwKI3RhYmxlQiB0aGVhZCB0ciwKI3RhYmxlQiB0aGVhZCB0aHsKICBiYWNrZ3JvdW5kOiB2YXIoLS1zdGlja3ktc2VwLWJsdWUpICFpbXBvcnRhbnQ7CiAgY29sb3I6I2ZmZjsKfQoKCi8qID09PSBVWDogY29sb25uYSAjIGNsaWNjYWJpbGUgKG1hbm8pID09PSAqLwp0aC5zb3J0YWJsZS1udW17CiAgY3Vyc29yOiBwb2ludGVyOwogIHVzZXItc2VsZWN0OiBub25lOwp9CnRoLnNvcnRhYmxlLW51bTpob3ZlcnsKICBiYWNrZ3JvdW5kOiByZ2JhKDI1NSwyNTUsMjU1LDAuMTUpOwp9CgoKLyogPT09IEhPTUUgQlVUVE9OID09PSAqLwoudG9wYmFyeyBwYWRkaW5nLXJpZ2h0OjU0cHg7IH0KLmhvbWUtdG9wYmFyewogIHBvc2l0aW9uOmFic29sdXRlOwogIHRvcDo2cHg7CiAgcmlnaHQ6OHB4OwogIGhlaWdodDozMnB4OwogIGxpbmUtaGVpZ2h0OjMycHg7CiAgcGFkZGluZzowIDEwcHg7CiAgZm9udC1zaXplOjE1cHg7CiAgZm9udC13ZWlnaHQ6OTAwOwogIGJvcmRlcjpub25lOwogIGJvcmRlci1yYWRpdXM6NnB4OwogIGJhY2tncm91bmQ6I2U3NGMzYzsKICBjb2xvcjojZmZmOwogIGN1cnNvcjpwb2ludGVyOwogIHotaW5kZXg6MTIwMDsKfQouaG9tZS10b3BiYXI6aG92ZXJ7IGZpbHRlcjpicmlnaHRuZXNzKDEuMSk7IH0KLmhvbWUtdG9wYmFyOmFjdGl2ZXsgdHJhbnNmb3JtOnNjYWxlKC45Nik7IH0KCgovKiA9PT0gVE9QQkFSIERFU1RSQTogc2Vjb25kYSByaWdhIHR1dHRhIGEgZGVzdHJhIChzdGFiaWxlKSA9PT0gKi8KLnJjLWJvdHRvbXsKICBmbGV4LWJhc2lzOiAxMDAlOyAgICAgICAgLyogZm9yemEgbnVvdmEgcmlnYSAqLwogIGRpc3BsYXk6ZmxleDsKICBnYXA6NnB4OwogIGp1c3RpZnktY29udGVudDpmbGV4LWVuZDsgLyogdHV0dGEgYSBkZXN0cmEgKi8KICBmbGV4LXdyYXA6d3JhcDsgICAgICAgICAgIC8qIHNlIG5vbiBlbnRyYSwgdmEgYSBjYXBvIG1hIHJlc3RhIGEgZGVzdHJhICovCn0KQG1lZGlhIChtYXgtd2lkdGg6IDk4MHB4KXsKICAucmMtYm90dG9teyBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOyB9Cn0KCgouc3VidGl0bGV7CiAgZGlzcGxheTpibG9jayAhaW1wb3J0YW50OwogIHRleHQtYWxpZ246Y2VudGVyOwogIGZvbnQtc2l6ZToxNHB4OwogIG1hcmdpbi10b3A6NHB4OwogIGNvbG9yOiM1NTU7Cn0KCi8qID09PT09PT09PT09PT09PT09PT09PT09PT0KICAgTU9EQUxFIFNFTEVaSU9ORSBQRVJJT0RPIFNUQVRTIChubyBwcm9tcHQpCj09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KI3BlcmlvZFBpY2tPdmVybGF5ewogIGRpc3BsYXk6bm9uZTsKICBwb3NpdGlvbjpmaXhlZDsKICBpbnNldDowOwogIGJhY2tncm91bmQ6cmdiYSgwLDAsMCwuNTUpOwogIHotaW5kZXg6MTEwMDA7CiAgYWxpZ24taXRlbXM6Y2VudGVyOwogIGp1c3RpZnktY29udGVudDpjZW50ZXI7CiAgcGFkZGluZzoxNnB4Owp9CiNwZXJpb2RQaWNrT3ZlcmxheSAuYm94ewogIHdpZHRoOm1pbig1MjBweCwgMTAwJSk7CiAgYmFja2dyb3VuZDojZmZmOwogIGJvcmRlci1yYWRpdXM6MTRweDsKICBib3gtc2hhZG93OjAgMTBweCA0MHB4IHJnYmEoMCwwLDAsLjI1KTsKICBvdmVyZmxvdzpoaWRkZW47CiAgYm9yZGVyOjFweCBzb2xpZCAjZWVlOwp9CiNwZXJpb2RQaWNrT3ZlcmxheSAuaGRyewogIHBhZGRpbmc6MTJweCAxNHB4OwogIGZvbnQtd2VpZ2h0OjkwMDsKICBib3JkZXItYm90dG9tOjFweCBzb2xpZCAjZWVlOwogIGJhY2tncm91bmQ6IzAwMDsKICBjb2xvcjojZmZmOwp9CiNwZXJpb2RQaWNrT3ZlcmxheSAuYm9keXsKICBwYWRkaW5nOjE0cHg7CiAgZGlzcGxheTpmbGV4OwogIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsKICBnYXA6MTBweDsKfQojcGVyaW9kUGlja092ZXJsYXkgbGFiZWx7CiAgZm9udC1zaXplOjEzcHg7CiAgZm9udC13ZWlnaHQ6ODAwOwp9CiNwZXJpb2RQaWNrT3ZlcmxheSBzZWxlY3R7CiAgaGVpZ2h0OjQwcHg7CiAgcGFkZGluZzowIDEwcHg7CiAgYm9yZGVyOjFweCBzb2xpZCAjZGRkOwogIGJvcmRlci1yYWRpdXM6MTBweDsKICBmb250LXNpemU6MTRweDsKICBmb250LXdlaWdodDo4MDA7CiAgYmFja2dyb3VuZDojZmZmOwp9CiNwZXJpb2RQaWNrT3ZlcmxheSAuaGludHsKICBmb250LXNpemU6MTJweDsKICBvcGFjaXR5Oi43NTsKICBsaW5lLWhlaWdodDoxLjM1Owp9CiNwZXJpb2RQaWNrT3ZlcmxheSAuYWN0aW9uc3sKICBkaXNwbGF5OmZsZXg7CiAganVzdGlmeS1jb250ZW50OmZsZXgtZW5kOwogIGdhcDo4cHg7CiAgcGFkZGluZzoxMnB4IDE0cHg7CiAgYm9yZGVyLXRvcDoxcHggc29saWQgI2VlZTsKICBiYWNrZ3JvdW5kOiNmYWZhZmE7Cn0KCjwvc3R5bGU+Cgo8L2hlYWQ+Cgo8Ym9keT4KPGRpdiBjbGFzcz0ic3VidGl0bGUiIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjttYXJnaW4tYm90dG9tOjZweDsiPnNhbmRyb0BzeXN0ZW1kYXRhLml0PC9kaXY+Cgo8ZGl2IGNsYXNzPSJ0b3BiYXIiPgogIDxidXR0b24gY2xhc3M9ImhvbWUtdG9wYmFyIiBvbmNsaWNrPSJnb0hvbWUoKSIgdGl0bGU9IlRvcm5hIGFsIGNydXNjb3R0byI+8J+PoDwvYnV0dG9uPgoKICA8IS0tIFNJTklTVFJBIChxdWFydGkpIC0tPgogIDxkaXYgY2xhc3M9InNpZGUtc3BhY2VyIj4KICAgIDxkaXYgY2xhc3M9ImxlZnQtcGFjayI+CiAgICAgIDxkaXYgY2xhc3M9InFjb2wtbGVmdCI+CiAgICAgICAgPGRpdiBjbGFzcz0icXJvdyI+PHN0cm9uZz5RMTwvc3Ryb25nPjxzcGFuIGlkPSJxMWEiPuKAlDwvc3Bhbj48c3BhbiBpZD0icTFiIj7igJQ8L3NwYW4+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0icXJvdyI+PHN0cm9uZz5RMjwvc3Ryb25nPjxzcGFuIGlkPSJxMmEiPuKAlDwvc3Bhbj48c3BhbiBpZD0icTJiIj7igJQ8L3NwYW4+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0icXJvdyI+PHN0cm9uZz5RMzwvc3Ryb25nPjxzcGFuIGlkPSJxM2EiPuKAlDwvc3Bhbj48c3BhbiBpZD0icTNiIj7igJQ8L3NwYW4+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0icXJvdyI+PHN0cm9uZz5RNDwvc3Ryb25nPjxzcGFuIGlkPSJxNGEiPuKAlDwvc3Bhbj48c3BhbiBpZD0icTRiIj7igJQ8L3NwYW4+PC9kaXY+CiAgICAgICAgPGRpdiBpZD0ib3RSb3dzIj48L2Rpdj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICA8L2Rpdj4KCiAgPCEtLSBDRU5UUk8gLS0+CiAgPGRpdiBjbGFzcz0iY2VudGVyIj4KICAgIDxkaXYgaWQ9ImNsb2NrIj4xMDowMDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9ImNsb2NrLWNvbnRyb2xzIj4KICAgICAgPGJ1dHRvbiBjbGFzcz0iZ3JlZW4iIG9uY2xpY2s9InN0YXJ0Q2xvY2soKSI+4pa2IFN0YXJ0PC9idXR0b24+CiAgICAgIDxidXR0b24gY2xhc3M9ImdyYXkiIG9uY2xpY2s9InN0b3BDbG9jaygpIj7ij7ggU3RvcDwvYnV0dG9uPgogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0icXVhcnRlci1sYWJlbCIgb25jbGljaz0ibmV4dFF1YXJ0ZXIoKSI+CiAgICAgIFBlcmlvZG86IDxzcGFuIGlkPSJxTnVtIj4xPC9zcGFuPgogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0ic2NvcmUtcm93Ij4KICAgICAgPGRpdiBjbGFzcz0idGVhbS1ib3giPgogICAgICAgIDxpbnB1dCBpZD0ibmFtZUEiIHZhbHVlPSJTcXVhZHJhIEEiIGF1dG9jb21wbGV0ZT0ib2ZmIiAvPgogICAgICAgIDxkaXYgY2xhc3M9InRlYW0tZnNxIj48c3BhbiBpZD0idGVhbUZvdWxzQSI+MDwvc3Bhbj48L2Rpdj4KPGRpdiBjbGFzcz0ic2NvcmUtcXVpY2siIGFyaWEtbGFiZWw9IlB1bnRpIHJhcGlkaSBTcXVhZHJhIEEiPgogICAgICAgICAgPGRpdiBjbGFzcz0icm93Ij4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYmx1ZSIgb25jbGljaz0iYWRqUHRzKCdBJywxKSI+KzE8L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYmx1ZSIgb25jbGljaz0iYWRqUHRzKCdBJywyKSI+KzI8L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYmx1ZSIgb25jbGljaz0iYWRqUHRzKCdBJywzKSI+KzM8L2J1dHRvbj4KICAgICAgICAgIAogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJyZWQiIG9uY2xpY2s9ImFkalRlYW1Gb3VscygnQScsMSkiPitGPC9idXR0b24+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IGNsYXNzPSJzY29yZS1iaWciPgogICAgICAgIDxzcGFuIGlkPSJzY29yZUEiPjA8L3NwYW4+IOKAkyA8c3BhbiBpZD0ic2NvcmVCIj4wPC9zcGFuPgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgY2xhc3M9InRlYW0tYm94Ij4KICAgICAgICA8aW5wdXQgaWQ9Im5hbWVCIiB2YWx1ZT0iU3F1YWRyYSBCIiBhdXRvY29tcGxldGU9Im9mZiIgLz4KICAgICAgICA8ZGl2IGNsYXNzPSJ0ZWFtLWZzcSI+PHNwYW4gaWQ9InRlYW1Gb3Vsc0IiPjA8L3NwYW4+PC9kaXY+CjxkaXYgY2xhc3M9InNjb3JlLXF1aWNrIiBhcmlhLWxhYmVsPSJQdW50aSByYXBpZGkgU3F1YWRyYSBCIj4KICAgICAgICAgIDxkaXYgY2xhc3M9InJvdyI+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJsdWUiIG9uY2xpY2s9ImFkalB0cygnQicsMSkiPisxPC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJsdWUiIG9uY2xpY2s9ImFkalB0cygnQicsMikiPisyPC9idXR0b24+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJsdWUiIG9uY2xpY2s9ImFkalB0cygnQicsMykiPiszPC9idXR0b24+CiAgICAgICAgICAKICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0icmVkIiBvbmNsaWNrPSJhZGpUZWFtRm91bHMoJ0InLDEpIj4rRjwvYnV0dG9uPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgPC9kaXY+CgogIDwhLS0gREVTVFJBIC0tPgogIDxkaXYgY2xhc3M9InVuZG8iIGlkPSJ1bmRvQm94Ij4KICAgIDxkaXYgY2xhc3M9InJpZ2h0LWNvbnRyb2xzIj4KCiAgICAgIDxidXR0b24gY2xhc3M9ImJsdWUiIG9uY2xpY2s9InNhdmVHYW1lKCkiPvCfkr4gU2FsdmE8L2J1dHRvbj4KICAgICAgPGJ1dHRvbiBjbGFzcz0iYmx1ZSBkYXRhLXRvZ2dsZSIgaWQ9Im1hdGNoRGF0YUJ0biIgb25jbGljaz0idG9nZ2xlTWF0Y2hEYXRhKCkiPvCfk50gRGF0aSBwYXJ0aXRhPC9idXR0b24+CiAgICAgIDxidXR0b24gY2xhc3M9ImdyYXkiIG9uY2xpY2s9ImxvYWRHYW1lRnJvbUZpbGUoKSIgdGl0bGU9IkNhcmljYSBkYSBmaWxlIEpTT04iPvCfk4IgQ2FyaWNhPC9idXR0b24+CiAgICAgIDxkaXYgY2xhc3M9InJjLWJvdHRvbSI+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZ3JheSIgb25jbGljaz0ib3BlbkdhbWVzTGlicmFyeSgpIiB0aXRsZT0iTGlicmVyaWEgcGFydGl0ZSI+8J+TmiBQYXJ0aXRlPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZ3JheSIgb25jbGljaz0ibmV3R2FtZSgpIj7wn4aVIE51b3ZvPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZ3JheSIgb25jbGljaz0ib3BlblN0YXRzKCkiIHRpdGxlPSJTdGF0aXN0aWNoZSI+8J+TiiBTdGF0czwvYnV0dG9uPgogICAgICA8L2Rpdj4KCjwvZGl2Pgo8ZGl2IGlkPSJtYXRjaERhdGFQYW5lbCIgY2xhc3M9Im1hdGNoLWRhdGEtcGFuZWwiIHN0eWxlPSJkaXNwbGF5Om5vbmU7Ij4KICAgICAgPGRpdiBjbGFzcz0ibWF0Y2gtZGF0YS1ncmlkIj4KICAgICAgICA8ZGl2IGNsYXNzPSJtYXRjaC1yb3ciPjxsYWJlbD5DQVRFR09SSUE6PC9sYWJlbD48aW5wdXQgaWQ9ImNhbXBpb25hdG8iIGF1dG9jb21wbGV0ZT0ib2ZmIiBwbGFjZWhvbGRlcj0iRXMuIFUxNCIgLz48L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJtYXRjaC1yb3ciPjxsYWJlbD5HSVJPTkU6PC9sYWJlbD48aW5wdXQgaWQ9Imdpcm9uZSIgYXV0b2NvbXBsZXRlPSJvZmYiIHBsYWNlaG9sZGVyPSJFcy4gQSIgLz48L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJtYXRjaC1yb3ciPjxsYWJlbD5EQVRBOjwvbGFiZWw+PGlucHV0IGlkPSJkYXRhR2FyYSIgYXV0b2NvbXBsZXRlPSJvZmYiIHBsYWNlaG9sZGVyPSJHRy9NTS9BQUFBIiBpbnB1dG1vZGU9Im51bWVyaWMiIC8+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ibWF0Y2gtcm93Ij48bGFiZWw+R0lPUk5BVEE6PC9sYWJlbD48aW5wdXQgaWQ9Imdpb3JuYXRhIiB0eXBlPSJudW1iZXIiIG1pbj0iMSIgc3RlcD0iMSIgYXV0b2NvbXBsZXRlPSJvZmYiIHBsYWNlaG9sZGVyPSIxIiAvPjwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9Im1hdGNoLXJvdyI+PGxhYmVsPkEvUjo8L2xhYmVsPjxpbnB1dCBpZD0iYW5kYXRhUml0b3JubyIgbWF4bGVuZ3RoPSIxIiBhdXRvY29tcGxldGU9Im9mZiIgcGxhY2Vob2xkZXI9IkEgbyBSIiAvPjwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9Im1hdGNoLXJvdyI+PGxhYmVsPkNBU0EvRlVPUkk6PC9sYWJlbD48aW5wdXQgaWQ9ImNhc2FGdW9yaSIgbWF4bGVuZ3RoPSIxIiBhdXRvY29tcGxldGU9Im9mZiIgcGxhY2Vob2xkZXI9IkMgbyBGIiAvPjwvZGl2PgogICAgICAgIDxkaXYgY2xhc3M9Im1hdGNoLXJvdyI+PGxhYmVsPkFSQklUUk8gMTo8L2xhYmVsPjxpbnB1dCBpZD0iYXJiaXRybzEiIGF1dG9jb21wbGV0ZT0ib2ZmIiBwbGFjZWhvbGRlcj0iTm9tZSIgLz48L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJtYXRjaC1yb3ciPjxsYWJlbD5BUkJJVFJPIDI6PC9sYWJlbD48aW5wdXQgaWQ9ImFyYml0cm8yIiBhdXRvY29tcGxldGU9Im9mZiIgcGxhY2Vob2xkZXI9Ik5vbWUiIC8+PC9kaXY+CiAgICAgICAgPGRpdiBjbGFzcz0ibWF0Y2gtcm93Ij4KICAgICAgICAgIDxsYWJlbD5MT0dISTo8L2xhYmVsPgogICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4OyBnYXA6OHB4OyBhbGlnbi1pdGVtczpjZW50ZXI7IGp1c3RpZnktY29udGVudDpmbGV4LWVuZDsgZmxleC13cmFwOndyYXA7IHdpZHRoOjEwMCU7Ij4KICAgICAgICAgICAgPGlucHV0IGlkPSJsb2dvQUlucHV0IiB0eXBlPSJmaWxlIiBhY2NlcHQ9ImltYWdlLyoiIHN0eWxlPSJkaXNwbGF5Om5vbmUiIC8+CiAgICAgICAgICAgIDxpbnB1dCBpZD0ibG9nb0JJbnB1dCIgdHlwZT0iZmlsZSIgYWNjZXB0PSJpbWFnZS8qIiBzdHlsZT0iZGlzcGxheTpub25lIiAvPgoKICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYmx1ZSIgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJwaWNrTG9nbygnQScpIiB0aXRsZT0iQ2FyaWNhIGxvZ28gU3F1YWRyYSBBIj7wn5OOIExvZ28gQTwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJncmF5IiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImNsZWFyTG9nbygnQScpIiB0aXRsZT0iUmltdW92aSBsb2dvIFNxdWFkcmEgQSI+4pyWIEE8L2J1dHRvbj4KICAgICAgICAgICAgPGltZyBpZD0ibG9nb0FQcmV2IiBhbHQ9IkxvZ28gQSIgc3R5bGU9IndpZHRoOjI4cHg7aGVpZ2h0OjI4cHg7b2JqZWN0LWZpdDpjb250YWluO2JvcmRlcjoxcHggc29saWQgIzMzMztib3JkZXItcmFkaXVzOjZweDtiYWNrZ3JvdW5kOiMwMDA7ZGlzcGxheTpub25lOyIgLz4KCiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJsdWUiIHR5cGU9ImJ1dHRvbiIgb25jbGljaz0icGlja0xvZ28oJ0InKSIgdGl0bGU9IkNhcmljYSBsb2dvIFNxdWFkcmEgQiI+8J+TjiBMb2dvIEI8L2J1dHRvbj4KICAgICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZ3JheSIgdHlwZT0iYnV0dG9uIiBvbmNsaWNrPSJjbGVhckxvZ28oJ0InKSIgdGl0bGU9IlJpbXVvdmkgbG9nbyBTcXVhZHJhIEIiPuKcliBCPC9idXR0b24+CiAgICAgICAgICAgIDxpbWcgaWQ9ImxvZ29CUHJldiIgYWx0PSJMb2dvIEIiIHN0eWxlPSJ3aWR0aDoyOHB4O2hlaWdodDoyOHB4O29iamVjdC1maXQ6Y29udGFpbjtib3JkZXI6MXB4IHNvbGlkICMzMzM7Ym9yZGVyLXJhZGl1czo2cHg7YmFja2dyb3VuZDojMDAwO2Rpc3BsYXk6bm9uZTsiIC8+CgogICAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJncmF5IiB0eXBlPSJidXR0b24iIG9uY2xpY2s9ImNsZWFyTG9nbygnQUxMJykiIHRpdGxlPSJSaW11b3ZpIGVudHJhbWJpIGkgbG9naGkiPvCfp7kgUmVzZXQ8L2J1dHRvbj4KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgoKICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8YnV0dG9uIGNsYXNzPSJncmF5IiBvbmNsaWNrPSJ1bmRvKCkiPuKGqSBVbmRvPC9idXR0b24+CiAgICA8ZGl2IGlkPSJ1bmRvSW5mbyIgY2xhc3M9InVuZG8taW5mbyI+4oCUPC9kaXY+CiAgPC9kaXY+CjwvZGl2PgoKPCEtLSA9PT09PSBIRUFERVIgU1FVQURSQSBBID09PT09IC0tPgo8ZGl2IGNsYXNzPSJzZWN0aW9uLWhlYWRlciIgaWQ9InNlY3Rpb25IZWFkZXJBIj4KICA8ZGl2IGNsYXNzPSJzZWN0aW9uLXRpdGxlIiBpZD0ic2VjdGlvblRpdGxlQSI+U3F1YWRyYSBBPC9kaXY+CgogIDxkaXYgY2xhc3M9ImNsb2NrLXN5c3RlbS1taWQiIGFyaWEtbGFiZWw9IlNpc3RlbWEgY3Jvbm9tZXRybyI+CiAgICA8YnV0dG9uIGNsYXNzPSJibHVlIiBvbmNsaWNrPSJudWRnZUNsb2NrKDEpIiB0aXRsZT0iKzFzIj4rMTwvYnV0dG9uPgogICAgPGJ1dHRvbiBjbGFzcz0iZ3JheSIgb25jbGljaz0ibnVkZ2VDbG9jaygtMSkiIHRpdGxlPSItMXMiPi0xPC9idXR0b24+CiAgICA8YnV0dG9uIGNsYXNzPSJibHVlIiBvbmNsaWNrPSJudWRnZUNsb2NrKDYwKSIgdGl0bGU9Iis2MHMiPis2MDwvYnV0dG9uPgogICAgPGJ1dHRvbiBjbGFzcz0iZ3JheSIgb25jbGljaz0ibnVkZ2VDbG9jaygtNjApIiB0aXRsZT0iLTYwcyI+LTYwPC9idXR0b24+CiAgPC9kaXY+CgogIDxkaXYgY2xhc3M9InNlY3Rpb24tY29udHJvbHMiPgogICAgPGRpdiBjbGFzcz0ic3RhdCI+UFBTIDxzcGFuIGlkPSJ0ZWFtQVBQIj4wPC9zcGFuPiA8YnV0dG9uIGNsYXNzPSJyZWQiIG9uY2xpY2s9InRlYW1TdGF0KCdBJywncHAnKSI+KzwvYnV0dG9uPjwvZGl2PgogICAgPGRpdiBjbGFzcz0ic3RhdCI+UFJTIDxzcGFuIGlkPSJ0ZWFtQVBSIj4wPC9zcGFuPiA8YnV0dG9uIGNsYXNzPSJncmVlbiIgb25jbGljaz0idGVhbVN0YXQoJ0EnLCdwcicpIj4rPC9idXR0b24+PC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJzdGF0Ij5UTyA8c3BhbiBpZD0idGVhbUFUTyI+MDwvc3Bhbj4vPHNwYW4gaWQ9InRlYW1BVE9NYXgiPjI8L3NwYW4+IDxidXR0b24gY2xhc3M9ImJsdWUiIG9uY2xpY2s9InRlYW1UaW1lb3V0KCdBJykiPis8L2J1dHRvbj48L2Rpdj4KICAgIDxkaXYgY2xhc3M9InN0YXQiPkZUUyA8c3BhbiBpZD0idGVhbUFGVFMiPjA8L3NwYW4+PC9kaXY+ICA8L2Rpdj4KCiAgPGJ1dHRvbiBjbGFzcz0iZ3JheSBmdXJiby1wdXNoIiBpZD0ibWludXNCdG4iIG9uY2xpY2s9InRvZ2dsZU1pbnVzKCkiIHRpdGxlPSJGdXJibyA9IGNvcnJlZ2dpIGlsIHByb3NzaW1vICsiPvCfm6DvuI8gRnVyYm88L2J1dHRvbj4KPC9kaXY+Cgo8IS0tIFRBQkVMTEEgQSAtLT4KPGRpdiBjbGFzcz0id3JhcHBlciB0YWJsZS1zY3JvbGwiIGlkPSJ3cmFwQSI+CiAgPHRhYmxlIGlkPSJ0YWJsZUEiPgogICAgPGNvbGdyb3VwPgogICAgICA8Y29sIGNsYXNzPSJjLW51bSI+CiAgICAgIDxjb2wgY2xhc3M9ImMtbmFtZSI+CiAgICAgIDxjb2wgY2xhc3M9ImMtcHRzIj4KICAgICAgPGNvbCBjbGFzcz0iYy1mZiI+CiAgICAgIDxjb2wgY2xhc3M9ImMtbWluIj4KICAgICAgPGNvbCBjbGFzcz0iYy1wbSI+CiAgICAgIDxjb2wgY2xhc3M9ImMtc2hvdCI+CiAgICAgIDxjb2wgY2xhc3M9ImMtc2hvdCI+CiAgICAgIDxjb2wgY2xhc3M9ImMtc2hvdCI+CiAgICAgIDxjb2wgY2xhc3M9ImMtc3RhdCI+PGNvbCBjbGFzcz0iYy1zdGF0Ij48Y29sIGNsYXNzPSJjLXN0YXQiPjxjb2wgY2xhc3M9ImMtc3RhdCI+CiAgICAgIDxjb2wgY2xhc3M9ImMtc3RhdCI+PGNvbCBjbGFzcz0iYy1zdGF0Ij48Y29sIGNsYXNzPSJjLXN0YXQiPjxjb2wgY2xhc3M9ImMtc3RhdCI+CiAgICA8L2NvbGdyb3VwPgogICAgPHRoZWFkPgogICAgICA8dHI+CiAgICAgICAgPHRoIGNsYXNzPSJzb3J0YWJsZS1udW0iIGRhdGEtZGlyPSJhc2MiPiM8L3RoPjx0aD5BdGxldGE8L3RoPjx0aD5QVFM8L3RoPjx0aD5GRjwvdGg+PHRoPk1JTjwvdGg+PHRoPlAvTTwvdGg+CiAgICAgICAgPHRoPjJQVDwvdGg+PHRoPjNQVDwvdGg+PHRoPlRMPC90aD4KICAgICAgICA8dGg+RlM8L3RoPjx0aD5SQTwvdGg+PHRoPlJEPC90aD48dGg+QTwvdGg+CiAgICAgICAgPHRoPlBQPC90aD48dGg+UFI8L3RoPjx0aD5TVGY8L3RoPjx0aD5TVHM8L3RoPgogICAgICA8L3RyPgogICAgPC90aGVhZD4KICAgIDx0Ym9keSBpZD0idGJvZHlBIj48L3Rib2R5PgogIDwvdGFibGU+CjwvZGl2PgoKPCEtLSA9PT09PSBIRUFERVIgU1FVQURSQSBCID09PT09IC0tPgo8ZGl2IGNsYXNzPSJzZWN0aW9uLWhlYWRlciIgaWQ9InNlY3Rpb25IZWFkZXJCIj4KICA8ZGl2IGNsYXNzPSJzZWN0aW9uLXRpdGxlIiBpZD0ic2VjdGlvblRpdGxlQiI+U3F1YWRyYSBCPC9kaXY+CgogIDxkaXYgY2xhc3M9InNlY3Rpb24tY29udHJvbHMiPgogICAgPGRpdiBjbGFzcz0ic3RhdCI+UFBTIDxzcGFuIGlkPSJ0ZWFtQlBQIj4wPC9zcGFuPiA8YnV0dG9uIGNsYXNzPSJyZWQiIG9uY2xpY2s9InRlYW1TdGF0KCdCJywncHAnKSI+KzwvYnV0dG9uPjwvZGl2PgogICAgPGRpdiBjbGFzcz0ic3RhdCI+UFJTIDxzcGFuIGlkPSJ0ZWFtQlBSIj4wPC9zcGFuPiA8YnV0dG9uIGNsYXNzPSJncmVlbiIgb25jbGljaz0idGVhbVN0YXQoJ0InLCdwcicpIj4rPC9idXR0b24+PC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJzdGF0Ij5UTyA8c3BhbiBpZD0idGVhbUJUTyI+MDwvc3Bhbj4vPHNwYW4gaWQ9InRlYW1CVE9NYXgiPjI8L3NwYW4+IDxidXR0b24gY2xhc3M9ImJsdWUiIG9uY2xpY2s9InRlYW1UaW1lb3V0KCdCJykiPis8L2J1dHRvbj48L2Rpdj4KICAgIDxkaXYgY2xhc3M9InN0YXQiPkZUUyA8c3BhbiBpZD0idGVhbUJGVFMiPjA8L3NwYW4+PC9kaXY+ICA8L2Rpdj4KPC9kaXY+Cgo8IS0tIFRBQkVMTEEgQiAtLT4KPGRpdiBjbGFzcz0id3JhcHBlciIgaWQ9IndyYXBCIj4KICA8dGFibGUgaWQ9InRhYmxlQiI+CiAgICA8Y29sZ3JvdXA+CiAgICAgIDxjb2wgY2xhc3M9ImMtbnVtIj4KICAgICAgPGNvbCBjbGFzcz0iYy1uYW1lIj4KICAgICAgPGNvbCBjbGFzcz0iYy1wdHMiPgogICAgICA8Y29sIGNsYXNzPSJjLWZmIj4KICAgICAgPGNvbCBjbGFzcz0iYy1taW4iPgogICAgICA8Y29sIGNsYXNzPSJjLXBtIj4KICAgICAgPGNvbCBjbGFzcz0iYy1zaG90Ij4KICAgICAgPGNvbCBjbGFzcz0iYy1zaG90Ij4KICAgICAgPGNvbCBjbGFzcz0iYy1zaG90Ij4KICAgICAgPGNvbCBjbGFzcz0iYy1zdGF0Ij48Y29sIGNsYXNzPSJjLXN0YXQiPjxjb2wgY2xhc3M9ImMtc3RhdCI+PGNvbCBjbGFzcz0iYy1zdGF0Ij4KICAgICAgPGNvbCBjbGFzcz0iYy1zdGF0Ij48Y29sIGNsYXNzPSJjLXN0YXQiPjxjb2wgY2xhc3M9ImMtc3RhdCI+PGNvbCBjbGFzcz0iYy1zdGF0Ij4KICAgIDwvY29sZ3JvdXA+CiAgICA8dGhlYWQ+CiAgICAgIDx0cj4KICAgICAgICA8dGggY2xhc3M9InNvcnRhYmxlLW51bSIgZGF0YS1kaXI9ImFzYyI+IzwvdGg+PHRoPkF0bGV0YTwvdGg+PHRoPlBUUzwvdGg+PHRoPkZGPC90aD48dGg+TUlOPC90aD48dGg+UC9NPC90aD4KICAgICAgICA8dGg+MlBUPC90aD48dGg+M1BUPC90aD48dGg+VEw8L3RoPgogICAgICAgIDx0aD5GUzwvdGg+PHRoPlJBPC90aD48dGg+UkQ8L3RoPjx0aD5BPC90aD4KICAgICAgICA8dGg+UFA8L3RoPjx0aD5QUjwvdGg+PHRoPlNUZjwvdGg+PHRoPlNUczwvdGg+CiAgICAgIDwvdHI+CiAgICA8L3RoZWFkPgogICAgPHRib2R5IGlkPSJ0Ym9keUIiPjwvdGJvZHk+CiAgPC90YWJsZT4KPC9kaXY+Cgo8IS0tID09PT09IE9WRVJMQVkgU1RBVElTVElDSEUgPT09PT0gLS0+CjxkaXYgaWQ9InN0YXRzT3ZlcmxheSIgb25jbGljaz0ib3ZlcmxheUNsaWNrQ2xvc2UoZXZlbnQpIj4KICA8ZGl2IGlkPSJzdGF0c1BhbmVsIiBvbmNsaWNrPSJldmVudC5zdG9wUHJvcGFnYXRpb24oKSI+CiAgICA8ZGl2IGlkPSJzdGF0c0hlYWRlciI+CiAgICAgIDxkaXYgaWQ9InN0YXRzU2NvcmVMaW5lIiBjbGFzcz0ic2NvcmUtbGluZSI+4oCUPC9kaXY+CgogICAgICA8ZGl2IGNsYXNzPSJzdGF0cy1tZXRhIj4KICAgICAgICA8ZGl2IGlkPSJzdGF0c01ldGFJbmZvIiBjbGFzcz0ic3RhdHMtbWV0YS1ibG9jayI+4oCUPC9kaXY+CiAgICAgICAgPGRpdiBpZD0ic3RhdHNNZXRhUXVhcnRlcnMiIGNsYXNzPSJzdGF0cy1tZXRhLWJsb2NrIj7igJQ8L2Rpdj4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IGNsYXNzPSJzcGFjZXIiPjwvZGl2PgogICAgICA8YnV0dG9uIGNsYXNzPSJncmF5IiBvbmNsaWNrPSJzaG93UXVhcnRlclN0YXRzKCkiPvCflZIgUXVhcnRvPC9idXR0b24+CiAgICAgIDxidXR0b24gY2xhc3M9ImdyYXkiIG9uY2xpY2s9InNob3dUb3RhbFN0YXRzKCkiPs6jIFRvdGFsZTwvYnV0dG9uPgogICAgICA8YnV0dG9uIGNsYXNzPSJibHVlIiBvbmNsaWNrPSJzaGFyZUdhbWUoKSI+8J+TpCBDb25kaXZpZGk8L2J1dHRvbj4KICAgICAgPGJ1dHRvbiBjbGFzcz0iZ3JheSIgb25jbGljaz0ic2hhcmVSZXN1bHRDYXJkKCkiIHRpdGxlPSJDb25kaXZpZGkgc29sbyByaXN1bHRhdG8gZSBwYXJ6aWFsaSI+8J+WvO+4jyBTb2xvIHJpc3VsdGF0bzwvYnV0dG9uPgogICAgICA8YnV0dG9uIGNsYXNzPSJyZWQiIG9uY2xpY2s9ImV4cG9ydFN0YXRzUERGKCkiPuKsh++4jyBQREY8L2J1dHRvbj4KICAgICAgPGJ1dHRvbiBjbGFzcz0iZ3JheSIgb25jbGljaz0iY2xvc2VTdGF0cygpIj7inJYgQ2hpdWRpPC9idXR0b24+CiAgICA8L2Rpdj4KICAgIDxkaXYgaWQ9InN0YXRzQm9keSI+PC9kaXY+CiAgPC9kaXY+CjwvZGl2PgoKPCEtLSA9PT09PSBPVkVSTEFZIExJQlJFUklBIFBBUlRJVEUgPT09PT0gLS0+CjxkaXYgaWQ9ImdhbWVzT3ZlcmxheSIgb25jbGljaz0iY2xvc2VHYW1lc0xpYnJhcnkoKSI+CiAgPGRpdiBpZD0iZ2FtZXNQYW5lbCIgb25jbGljaz0iZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCkiPgogICAgPGRpdiBpZD0iZ2FtZXNIZWFkZXIiPgogICAgICA8ZGl2IGNsYXNzPSJ0aXRsZSI+TGlicmVyaWEgUGFydGl0ZTwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJzcGFjZXIiPjwvZGl2PgogICAgICA8YnV0dG9uIGNsYXNzPSJibHVlIiBvbmNsaWNrPSJleHBvcnRMaWJyYXJ5QnVuZGxlKCkiPuKsh++4jyBFeHBvcnQ8L2J1dHRvbj4KICAgICAgPGJ1dHRvbiBjbGFzcz0iYmx1ZSIgb25jbGljaz0iaW1wb3J0TGlicmFyeUJ1bmRsZSgpIj7irIbvuI8gSW1wb3J0PC9idXR0b24+CiAgICAgIDxidXR0b24gY2xhc3M9ImdyYXkiIG9uY2xpY2s9ImNsb3NlR2FtZXNMaWJyYXJ5KCkiPuKcliBDaGl1ZGk8L2J1dHRvbj4KICAgIDwvZGl2PgoKICAgIDxkaXYgaWQ9ImdhbWVzQm9keSI+CiAgICAgIDxkaXYgY2xhc3M9ImxpYi1hY3Rpb25zIj4KICAgICAgICA8YnV0dG9uIGNsYXNzPSJibHVlIiBvbmNsaWNrPSJpbXBvcnRNYW55R2FtZXMoKSI+4qyG77iPIEltcG9ydCBtdWx0aXBsbyAoLmpzb24pPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZ3JheSIgb25jbGljaz0iY2xlYXJMaWJyYXJ5Q29uZmlybSgpIj7wn5eR77iPIFN2dW90YSBsaWJyZXJpYTwvYnV0dG9uPgogICAgICAgIDxkaXYgaWQ9ImxpYkluZm8iPuKAlDwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDx0YWJsZSBjbGFzcz0ibGliLXRhYmxlIj4KICAgICAgICA8dGhlYWQ+CiAgICAgICAgICA8dHI+CiAgICAgICAgICAgIDx0aCBzdHlsZT0id2lkdGg6MjQwcHg7Ij5Ob21lPC90aD4KICAgICAgICAgICAgPHRoIHN0eWxlPSJ3aWR0aDoxMTBweDsgdGV4dC1hbGlnbjpjZW50ZXI7Ij5EYXRhPC90aD4KICAgICAgICAgICAgPHRoPkF2dmVyc2FyaW88L3RoPgogICAgICAgICAgICA8dGggc3R5bGU9IndpZHRoOjI1MHB4OyB0ZXh0LWFsaWduOmNlbnRlcjsiPkF6aW9uaTwvdGg+CiAgICAgICAgICA8L3RyPgogICAgICAgIDwvdGhlYWQ+CiAgICAgICAgPHRib2R5IGlkPSJnYW1lc1Rib2R5Ij48L3Rib2R5PgogICAgICA8L3RhYmxlPgogICAgPC9kaXY+CiAgPC9kaXY+CjwvZGl2PgoKPHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vanNwZGZAMi41LjEvZGlzdC9qc3BkZi51bWQubWluLmpzIj4KLyogPT09IFNPUlQgUEVSIENPTE9OTkEgIyAobnVtZXJvIG1hZ2xpYSkgPT09ICovCmZ1bmN0aW9uIHNvcnRCeU51bWJlcihzaWRlKXsKICBjb25zdCBhcnIgPSAoc2lkZSA9PT0gJ0EnKSA/IHBsYXllcnNBIDogcGxheWVyc0I7CiAgY29uc3QgdGggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjdGFibGUke3NpZGV9IHRoZWFkIHRoLnNvcnRhYmxlLW51bWApOwogIGNvbnN0IGRpciA9IHRoLmdldEF0dHJpYnV0ZSgnZGF0YS1kaXInKSA9PT0gJ2FzYycgPyAxIDogLTE7CgogIGNvbnN0IGhhc0luID0gYXJyLnNvbWUocCA9PiAhIXAuaW4pOwoKICBhcnIuc29ydCgoYSxiKT0+ewogICAgLy8gc2UgZXNpc3Rvbm8gZ2lvY2F0b3JpIElOLCBwb3J0YWxpIGluIGFsdG8KICAgIGlmKGhhc0luICYmIGEuaW4gIT09IGIuaW4pewogICAgICByZXR1cm4gYS5pbiA/IC0xIDogMTsKICAgIH0KICAgIC8vIHBvaSBvcmRpbmEgc2VtcHJlIHBlciBudW1lcm8gbWFnbGlhCiAgICByZXR1cm4gKE51bWJlcihhLm51bXx8MCkgLSBOdW1iZXIoYi5udW18fDApKSAqIGRpcjsKICB9KTsKCiAgdGguc2V0QXR0cmlidXRlKCdkYXRhLWRpcicsIGRpciA9PT0gMSA/ICdkZXNjJyA6ICdhc2MnKTsKICByZW5kZXIoKTsKfQoKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSk9PnsKICBjb25zdCB0aCA9IGUudGFyZ2V0LmNsb3Nlc3QoJ3RoLnNvcnRhYmxlLW51bScpOwogIGlmKCF0aCkgcmV0dXJuOwogIGNvbnN0IHRhYmxlID0gdGguY2xvc2VzdCgndGFibGUnKTsKICBpZih0YWJsZT8uaWQgPT09ICd0YWJsZUEnKSBzb3J0QnlOdW1iZXIoJ0EnKTsKICBpZih0YWJsZT8uaWQgPT09ICd0YWJsZUInKSBzb3J0QnlOdW1iZXIoJ0InKTsKfSk7CgoKLyogPT09IFNUQVRTOiBvcmRpbmFtZW50byBjbGljY2FiaWxlIChzb2xvIG92ZXJsYXksIG5vbiBjYW1iaWEgbGUgdGFiZWxsZSBsaXZlKSA9PT0gKi8KY29uc3Qgc3RhdHNTb3J0ID0gewogIEE6IHsga2V5OiAnbnVtJywgZGlyOiAxIH0sCiAgQjogeyBrZXk6ICdudW0nLCBkaXI6IDEgfSwKfTsKY29uc3QgU1RBVFNfS0VZUyA9IG5ldyBTZXQoWydudW0nLCduYW1lJywncHRzJywnZmYnLCdtaW4nLCdwbXInLCd0MicsJ3QycCcsJ3QzJywndDNwJywndGwnLCd0bHAnLCdmcycsJ3JhJywncmQnLCdhJywncHAnLCdwcicsJ3N0ZicsJ3N0cycsJ3BpcicsJ29lcicsJ3BtJ10pOyAvLyBwbXIgPSBQL00gKHB0cy9taW4pCgpmdW5jdGlvbiBnZXRTdGF0VmFsdWUocCwga2V5KXsKICBzd2l0Y2goa2V5KXsKICAgIGNhc2UgJ251bSc6IHJldHVybiBOdW1iZXIocC5udW18fDApOwogICAgY2FzZSAnbmFtZSc6IHJldHVybiBTdHJpbmcocC5uYW1lfHwnJykudG9Mb3dlckNhc2UoKTsKICAgIGNhc2UgJ3B0cyc6IHJldHVybiBOdW1iZXIocC5wdHN8fDApOwogICAgY2FzZSAnZmYnOiByZXR1cm4gTnVtYmVyKHAuZmZ8fDApOwogICAgY2FzZSAnbWluJzogcmV0dXJuIE51bWJlcihwLm1pbnx8MCk7CiAgICBjYXNlICdwbXInOiB7CiAgICAgIGNvbnN0IHNlY1BsYXllZCA9IE1hdGgubWF4KDAsIE51bWJlcihwPy5taW4pIHx8IDApOwogICAgICBjb25zdCBtaW5QbGF5ZWQgPSBzZWNQbGF5ZWQgLyA2MDsKICAgICAgaWYobWluUGxheWVkIDw9IDApIHJldHVybiAtSW5maW5pdHk7CiAgICAgIHJldHVybiAoTnVtYmVyKHA/LnB0cyl8fDApIC8gbWluUGxheWVkOwogICAgfQogICAgY2FzZSAncGlyJzogcmV0dXJuIE51bWJlcihjYWxjUElSKHApfHwwKTsKICAgIGNhc2UgJ29lcic6IHJldHVybiBOdW1iZXIoY2FsY09FUihwKXx8MCk7CiAgICBjYXNlICdwbSc6ICByZXR1cm4gTnVtYmVyKHAucG18fDApOwogICAgCiAgICBjYXNlICd0Mic6ICByZXR1cm4gbnVtUGN0KHBbJzJwdCddPy5tYWRlfHwwLCBwWycycHQnXT8uYXR0fHwwKTsKICAgIGNhc2UgJ3QycCc6IHJldHVybiBudW1QY3QocFsnMnB0J10/Lm1hZGV8fDAsIHBbJzJwdCddPy5hdHR8fDApOwogICAgY2FzZSAndDMnOiAgcmV0dXJuIG51bVBjdChwWyczcHQnXT8ubWFkZXx8MCwgcFsnM3B0J10/LmF0dHx8MCk7CiAgICBjYXNlICd0M3AnOiByZXR1cm4gbnVtUGN0KHBbJzNwdCddPy5tYWRlfHwwLCBwWyczcHQnXT8uYXR0fHwwKTsKICAgIGNhc2UgJ3RsJzogIHJldHVybiBudW1QY3QocC50bD8ubWFkZXx8MCwgcC50bD8uYXR0fHwwKTsKICAgIGNhc2UgJ3RscCc6IHJldHVybiBudW1QY3QocC50bD8ubWFkZXx8MCwgcC50bD8uYXR0fHwwKTsKICAgIGNhc2UgJ2ZzJzogIHJldHVybiBOdW1iZXIocC5mc3x8MCk7CiAgICBjYXNlICdyYSc6ICByZXR1cm4gTnVtYmVyKHAucmF8fDApOwogICAgY2FzZSAncmQnOiAgcmV0dXJuIE51bWJlcihwLnJkfHwwKTsKICAgIGNhc2UgJ2EnOiAgIHJldHVybiBOdW1iZXIocC5hfHwwKTsKICAgIGNhc2UgJ3BwJzogIHJldHVybiBOdW1iZXIocC5wcHx8MCk7CiAgICBjYXNlICdwcic6ICByZXR1cm4gTnVtYmVyKHAucHJ8fDApOwogICAgY2FzZSAnc3RmJzogcmV0dXJuIE51bWJlcihwLnN0Znx8MCk7CiAgICBjYXNlICdzdHMnOiByZXR1cm4gTnVtYmVyKHAuc3RzfHwwKTsKICAgIGRlZmF1bHQ6IHJldHVybiAwOwogIH0KfQoKZnVuY3Rpb24gc29ydEZvclN0YXRzKHNpZGUsIGFycil7CiAgY29uc3QgcyA9IHN0YXRzU29ydFtzaWRlXSB8fCB7a2V5OidudW0nLCBkaXI6MX07CiAgY29uc3Qga2V5ID0gcy5rZXksIGRpciA9IHMuZGlyOwogIGNvbnN0IGNvcHkgPSBbLi4uYXJyXTsKICBjb3B5LnNvcnQoKGEsYik9PnsKICAgIGNvbnN0IHZhID0gZ2V0U3RhdFZhbHVlKGEsIGtleSk7CiAgICBjb25zdCB2YiA9IGdldFN0YXRWYWx1ZShiLCBrZXkpOwogICAgaWYodHlwZW9mIHZhID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgdmIgPT09ICdzdHJpbmcnKXsKICAgICAgcmV0dXJuIFN0cmluZyh2YSkubG9jYWxlQ29tcGFyZShTdHJpbmcodmIpKSAqIGRpcjsKICAgIH0KICAgIHJldHVybiAodmEgLSB2YikgKiBkaXI7CiAgfSk7CiAgcmV0dXJuIGNvcHk7Cn0KCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpPT57CiAgY29uc3QgdGggPSBlLnRhcmdldC5jbG9zZXN0Py4oJ3RoW2RhdGEtc3RhdHMta2V5XScpOwogIGlmKCF0aCkgcmV0dXJuOwogIGNvbnN0IHNpZGUgPSB0aC5nZXRBdHRyaWJ1dGUoJ2RhdGEtc2lkZScpOwogIGNvbnN0IGtleSA9IHRoLmdldEF0dHJpYnV0ZSgnZGF0YS1zdGF0cy1rZXknKTsKICBpZighc2lkZSB8fCAhU1RBVFNfS0VZUy5oYXMoa2V5KSkgcmV0dXJuOwoKICBjb25zdCBjdXIgPSBzdGF0c1NvcnRbc2lkZV0gfHwge2tleTonbnVtJywgZGlyOjF9OwogIGlmKGN1ci5rZXkgPT09IGtleSl7CiAgICBjdXIuZGlyID0gY3VyLmRpciAqIC0xOwogIH0gZWxzZSB7CiAgICBjdXIua2V5ID0ga2V5OwogICAgY3VyLmRpciA9IDE7CiAgfQogIHN0YXRzU29ydFtzaWRlXSA9IGN1cjsKCiAgaWYoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXRzT3ZlcmxheScpLnN0eWxlLmRpc3BsYXkgPT09ICdibG9jaycpewogICAgcmVuZGVyU3RhdHMoKTsKICB9Cn0pOwoKCmZ1bmN0aW9uIGdldFBlcmlvZFNwbGl0cyhzaWRlKXsKICBjb25zdCBvdXQgPSBbXTsKICBmb3IobGV0IHE9MTtxPD00O3ErKyl7CiAgICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBxJHtxfSR7c2lkZS50b0xvd2VyQ2FzZSgpfWApOwogICAgaWYoZWwpIG91dC5wdXNoKHtsYWJlbDpgUSR7cX1gLCB2YWw6IGVsLnRleHRDb250ZW50fSk7CiAgfQogIGNvbnN0IG90SG9zdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdFJvd3MnKTsKICBpZihvdEhvc3QpewogICAgY29uc3Qgc3BhbnMgPSBvdEhvc3QucXVlcnlTZWxlY3RvckFsbChgc3BhbltpZF49Im90Il1baWQkPSIke3NpZGUudG9Mb3dlckNhc2UoKX0iXWApOwogICAgY29uc3QgaXRlbXMgPSBbLi4uc3BhbnNdLm1hcChzcD0+ewogICAgICBjb25zdCBtID0gc3AuaWQubWF0Y2goL15vdChcZCspW2FiXSQvKTsKICAgICAgcmV0dXJuIHtuOiBtP051bWJlcihtWzFdKTo5OTksIGVsOiBzcH07CiAgICB9KS5zb3J0KChhLGIpPT5hLm4tYi5uKTsKICAgIGl0ZW1zLmZvckVhY2goaXQ9PiBvdXQucHVzaCh7bGFiZWw6YE9UJHtpdC5ufWAsIHZhbDogaXQuZWwudGV4dENvbnRlbnR9KSk7CiAgfQogIHJldHVybiBvdXQ7Cn0KCmZ1bmN0aW9uIHJlbmRlclNwbGl0c0xpbmUoc2lkZSl7CiAgY29uc3Qgc3BsaXRzID0gZ2V0UGVyaW9kU3BsaXRzKHNpZGUpLmZpbHRlcih4PT4gKHgudmFsID8/ICfigJQnKSAhPT0gJ+KAlCcpOwogIGlmKCFzcGxpdHMubGVuZ3RoKSByZXR1cm4gJzxzcGFuIGNsYXNzPSJsaWItZWxsaXBzaXMiPlBhcnppYWxpOiDigJQ8L3NwYW4+JzsKICBjb25zdCB0eHQgPSBzcGxpdHMubWFwKHM9PmAke3MubGFiZWx9OiR7cy52YWx9YCkuam9pbignICDigKIgICcpOwogIHJldHVybiBgPHNwYW4gY2xhc3M9ImxpYi1lbGxpcHNpcyI+UGFyemlhbGk6ICR7ZXNjSHRtbCh0eHQpfTwvc3Bhbj5gOwp9Cgo8L3NjcmlwdD4KPHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuLmpzZGVsaXZyLm5ldC9ucG0vanNwZGYtYXV0b3RhYmxlQDMuOC4yL2Rpc3QvanNwZGYucGx1Z2luLmF1dG90YWJsZS5taW4uanMiPgovKiA9PT0gU09SVCBQRVIgQ09MT05OQSAjIChudW1lcm8gbWFnbGlhKSA9PT0gKi8KZnVuY3Rpb24gc29ydEJ5TnVtYmVyKHNpZGUpewogIGNvbnN0IGFyciA9IChzaWRlID09PSAnQScpID8gcGxheWVyc0EgOiBwbGF5ZXJzQjsKICBjb25zdCB0aCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYCN0YWJsZSR7c2lkZX0gdGhlYWQgdGguc29ydGFibGUtbnVtYCk7CiAgY29uc3QgZGlyID0gdGguZ2V0QXR0cmlidXRlKCdkYXRhLWRpcicpID09PSAnYXNjJyA/IDEgOiAtMTsKCiAgY29uc3QgaGFzSW4gPSBhcnIuc29tZShwID0+ICEhcC5pbik7CgogIGFyci5zb3J0KChhLGIpPT57CiAgICAvLyBzZSBlc2lzdG9ubyBnaW9jYXRvcmkgSU4sIHBvcnRhbGkgaW4gYWx0bwogICAgaWYoaGFzSW4gJiYgYS5pbiAhPT0gYi5pbil7CiAgICAgIHJldHVybiBhLmluID8gLTEgOiAxOwogICAgfQogICAgLy8gcG9pIG9yZGluYSBzZW1wcmUgcGVyIG51bWVybyBtYWdsaWEKICAgIHJldHVybiAoTnVtYmVyKGEubnVtfHwwKSAtIE51bWJlcihiLm51bXx8MCkpICogZGlyOwogIH0pOwoKICB0aC5zZXRBdHRyaWJ1dGUoJ2RhdGEtZGlyJywgZGlyID09PSAxID8gJ2Rlc2MnIDogJ2FzYycpOwogIHJlbmRlcigpOwp9Cgpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKT0+ewogIGNvbnN0IHRoID0gZS50YXJnZXQuY2xvc2VzdCgndGguc29ydGFibGUtbnVtJyk7CiAgaWYoIXRoKSByZXR1cm47CiAgY29uc3QgdGFibGUgPSB0aC5jbG9zZXN0KCd0YWJsZScpOwogIGlmKHRhYmxlPy5pZCA9PT0gJ3RhYmxlQScpIHNvcnRCeU51bWJlcignQScpOwogIGlmKHRhYmxlPy5pZCA9PT0gJ3RhYmxlQicpIHNvcnRCeU51bWJlcignQicpOwp9KTsKCjwvc2NyaXB0Pgo8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG4uanNkZWxpdnIubmV0L25wbS94bHN4QDAuMTguNS9kaXN0L3hsc3guZnVsbC5taW4uanMiPjwvc2NyaXB0PgoKPHNjcmlwdD4KLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgIFVUSUwKPT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgU1RBVFMgU09SVCAoRklYIFJPQlVTVE8pCiAgIE5vdGE6IGluIEhUTUwgYWxjdW5pIDxzY3JpcHQgc3JjPSIuLi4iPiBjb250ZW5ldmFubyBjb2RpY2UgaW5saW5lIChjaGUgaWwgYnJvd3NlciBJR05PUkEpLgogICBRdWkgbWV0dGlhbW8gbCdvcmRpbmFtZW50byBpbiB1biBibG9jY28gSlMgc2ljdXJvLCB1bmljbywgZSB2YWxpZG8gcGVyIFRVVFRFIGxlIGNvbG9ubmUgU3RhdHMuCj09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwp3aW5kb3cuX19zdGF0c1NvcnRJbml0ID0gd2luZG93Ll9fc3RhdHNTb3J0SW5pdCB8fCAoZnVuY3Rpb24oKXsKICAvLyBzdGF0byBvcmRpbmFtZW50byBwZXIgc3F1YWRyYQogIHdpbmRvdy5zdGF0c1NvcnQgPSB3aW5kb3cuc3RhdHNTb3J0IHx8IHsgQTp7a2V5OidudW0nLGRpcjoxfSwgQjp7a2V5OidudW0nLGRpcjoxfSB9OwoKICAvLyBoZWxwZXJzIHBlcmNlbnR1YWxpIChwZXIgb3JkaW5hcmUgc3UgJSBlIG5vbiBzdWwgdGVzdG8pCiAgd2luZG93Lm51bVBjdCA9IHdpbmRvdy5udW1QY3QgfHwgZnVuY3Rpb24obWFkZSwgYXR0KXsKICAgIGF0dCA9IE51bWJlcihhdHR8fDApOyBtYWRlID0gTnVtYmVyKG1hZGV8fDApOwogICAgaWYoYXR0IDw9IDApIHJldHVybiAtSW5maW5pdHk7IC8vIGNvc8OsIGNoaSBoYSAwIHRlbnRhdGl2aSB2YSBpbiBmb25kbyBxdWFuZG8gb3JkaW5pIGRlc2MKICAgIHJldHVybiAobWFkZS9hdHQpKjEwMDsKICB9OwoKICAvLyB2YWxvcmUgbnVtZXJpY28vc3RyaW5nYSBwZXIgY29sb25uYQogIHdpbmRvdy5nZXRTdGF0VmFsdWUgPSBmdW5jdGlvbihwLCBrZXkpewogICAgc3dpdGNoKFN0cmluZyhrZXl8fCcnKSl7CiAgICAgIGNhc2UgJ251bSc6IHJldHVybiBOdW1iZXIocD8ubnVtfHwwKTsKICAgICAgY2FzZSAnbmFtZSc6IHJldHVybiBTdHJpbmcocD8ubmFtZXx8JycpLnRvTG93ZXJDYXNlKCk7CiAgICAgIGNhc2UgJ3B0cyc6IHJldHVybiBOdW1iZXIocD8ucHRzfHwwKTsKICAgICAgY2FzZSAnZmYnOiAgcmV0dXJuIE51bWJlcihwPy5mZnx8MCk7CiAgICAgIGNhc2UgJ21pbic6IHJldHVybiBOdW1iZXIocD8ubWlufHwwKTsKICAgICAgY2FzZSAncG1yJzogewogICAgICAgIGNvbnN0IG0gPSAoTnVtYmVyKHA/Lm1pbil8fDApLzYwOwogICAgICAgIHJldHVybiBtPjAgPyAoTnVtYmVyKHA/LnB0cyl8fDApL20gOiAtSW5maW5pdHk7CiAgICAgIH0KICAgICAgY2FzZSAncGlyJzogcmV0dXJuIE51bWJlcigod2luZG93LmNhbGNQSVIgPyBjYWxjUElSKHApIDogMCkgfHwgMCk7CiAgICAgIGNhc2UgJ29lcic6IHJldHVybiBOdW1iZXIoKHdpbmRvdy5jYWxjT0VSID8gY2FsY09FUihwKSA6IDApIHx8IDApOwogICAgICBjYXNlICdwbSc6ICByZXR1cm4gTnVtYmVyKHA/LnBtfHwwKTsKCiAgICAgIC8vIGNvbG9ubmUgdGlyaSAvICUgKFN0YXRzKQogICAgICBjYXNlICd0Mic6ICByZXR1cm4gd2luZG93Lm51bVBjdChwPy5bJzJwdCddPy5tYWRlfHwwLCBwPy5bJzJwdCddPy5hdHR8fDApOwogICAgICBjYXNlICd0MnAnOiByZXR1cm4gd2luZG93Lm51bVBjdChwPy5bJzJwdCddPy5tYWRlfHwwLCBwPy5bJzJwdCddPy5hdHR8fDApOwogICAgICBjYXNlICd0Myc6ICByZXR1cm4gd2luZG93Lm51bVBjdChwPy5bJzNwdCddPy5tYWRlfHwwLCBwPy5bJzNwdCddPy5hdHR8fDApOwogICAgICBjYXNlICd0M3AnOiByZXR1cm4gd2luZG93Lm51bVBjdChwPy5bJzNwdCddPy5tYWRlfHwwLCBwPy5bJzNwdCddPy5hdHR8fDApOwogICAgICBjYXNlICd0bCc6ICByZXR1cm4gd2luZG93Lm51bVBjdChwPy50bD8ubWFkZXx8MCwgcD8udGw/LmF0dHx8MCk7CiAgICAgIGNhc2UgJ3RscCc6IHJldHVybiB3aW5kb3cubnVtUGN0KHA/LnRsPy5tYWRlfHwwLCBwPy50bD8uYXR0fHwwKTsKCiAgICAgIC8vIGFsdHJlIHN0YXRzCiAgICAgIGNhc2UgJ2ZzJzogIHJldHVybiBOdW1iZXIocD8uZnN8fDApOwogICAgICBjYXNlICdyYSc6ICByZXR1cm4gTnVtYmVyKHA/LnJhfHwwKTsKICAgICAgY2FzZSAncmQnOiAgcmV0dXJuIE51bWJlcihwPy5yZHx8MCk7CiAgICAgIGNhc2UgJ2EnOiAgIHJldHVybiBOdW1iZXIocD8uYXx8MCk7CiAgICAgIGNhc2UgJ3BwJzogIHJldHVybiBOdW1iZXIocD8ucHB8fDApOwogICAgICBjYXNlICdwcic6ICByZXR1cm4gTnVtYmVyKHA/LnByfHwwKTsKICAgICAgY2FzZSAnc3RmJzogcmV0dXJuIE51bWJlcihwPy5zdGZ8fDApOwogICAgICBjYXNlICdzdHMnOiByZXR1cm4gTnVtYmVyKHA/LnN0c3x8MCk7CiAgICAgIGRlZmF1bHQ6IHJldHVybiAwOwogICAgfQogIH07CgogIHdpbmRvdy5zb3J0Rm9yU3RhdHMgPSBmdW5jdGlvbihzaWRlLCBhcnIpewogICAgY29uc3QgcyA9IHdpbmRvdy5zdGF0c1NvcnQ/LltzaWRlXSB8fCB7a2V5OidudW0nLGRpcjoxfTsKICAgIGNvbnN0IG91dCA9IEFycmF5LmlzQXJyYXkoYXJyKSA/IFsuLi5hcnJdIDogW107CiAgICBjb25zdCBrZXkgPSBzLmtleSwgZGlyID0gcy5kaXI7CgogICAgb3V0LnNvcnQoKGEsYik9PnsKICAgICAgY29uc3QgdmEgPSB3aW5kb3cuZ2V0U3RhdFZhbHVlKGEsIGtleSk7CiAgICAgIGNvbnN0IHZiID0gd2luZG93LmdldFN0YXRWYWx1ZShiLCBrZXkpOwogICAgICAvLyBzdHJpbmdoZQogICAgICBpZih0eXBlb2YgdmEgPT09ICdzdHJpbmcnIHx8IHR5cGVvZiB2YiA9PT0gJ3N0cmluZycpewogICAgICAgIHJldHVybiBTdHJpbmcodmEpLmxvY2FsZUNvbXBhcmUoU3RyaW5nKHZiKSkgKiBkaXI7CiAgICAgIH0KICAgICAgcmV0dXJuICh2YSAtIHZiKSAqIGRpcjsKICAgIH0pOwogICAgcmV0dXJuIG91dDsKICB9OwoKICAvLyBsaXN0ZW5lciB1bmljbzogb3JkaW5hIFNPTE8gcXVhbmRvIG92ZXJsYXkgc3RhdHMgw6ggYXBlcnRvCiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSk9PnsKICAgIGNvbnN0IHRoID0gZS50YXJnZXQ/LmNsb3Nlc3Q/LigndGhbZGF0YS1zdGF0cy1rZXldJyk7CiAgICBpZighdGgpIHJldHVybjsKCiAgICBjb25zdCBvdmVybGF5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXRzT3ZlcmxheScpOwogICAgaWYoIW92ZXJsYXkgfHwgb3ZlcmxheS5zdHlsZS5kaXNwbGF5ICE9PSAnYmxvY2snKSByZXR1cm47CgogICAgY29uc3Qgc2lkZSA9IHRoLmdldEF0dHJpYnV0ZSgnZGF0YS1zaWRlJyk7CiAgICBjb25zdCBrZXkgID0gdGguZ2V0QXR0cmlidXRlKCdkYXRhLXN0YXRzLWtleScpOwogICAgaWYoIXNpZGUgfHwgIWtleSkgcmV0dXJuOwoKICAgIGNvbnN0IGN1ciA9IHdpbmRvdy5zdGF0c1NvcnQ/LltzaWRlXSB8fCB7a2V5OidudW0nLGRpcjoxfTsKICAgIGlmKGN1ci5rZXkgPT09IGtleSl7IGN1ci5kaXIgKj0gLTE7IH0gZWxzZSB7IGN1ci5rZXkgPSBrZXk7IGN1ci5kaXIgPSAxOyB9CiAgICB3aW5kb3cuc3RhdHNTb3J0W3NpZGVdID0gY3VyOwoKICAgIHRyeXsgd2luZG93LnJlbmRlclN0YXRzICYmIHJlbmRlclN0YXRzKCk7IH1jYXRjaChfKXt9CiAgfSwgdHJ1ZSk7CgogIHJldHVybiB0cnVlOwp9KSgpOwoKCi8qID09PSBTVEFUUyBTT1JUIEhFTFBFUlMgKEdMT0JBTCkgPT09ICovCi8qID09PSBTVEFUUyBTUExJVFMgSEVMUEVSUyAoR0xPQkFMKSA9PT0gKi8Kd2luZG93LmdldFBlcmlvZFNwbGl0cyA9IHdpbmRvdy5nZXRQZXJpb2RTcGxpdHMgfHwgZnVuY3Rpb24oc2lkZSl7CiAgY29uc3Qgb3V0ID0gW107CiAgZm9yKGxldCBxPTE7cTw9NDtxKyspewogICAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgcSR7cX0ke3NpZGUudG9Mb3dlckNhc2UoKX1gKTsKICAgIGlmKGVsKSBvdXQucHVzaCh7bGFiZWw6YFEke3F9YCwgdmFsOiBlbC50ZXh0Q29udGVudH0pOwogIH0KICBjb25zdCBvdEhvc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3RSb3dzJyk7CiAgaWYob3RIb3N0KXsKICAgIGNvbnN0IHNwYW5zID0gb3RIb3N0LnF1ZXJ5U2VsZWN0b3JBbGwoYHNwYW5baWRePSJvdCJdW2lkJD0iJHtzaWRlLnRvTG93ZXJDYXNlKCl9Il1gKTsKICAgIGNvbnN0IGl0ZW1zID0gWy4uLnNwYW5zXS5tYXAoc3A9PnsKICAgICAgY29uc3QgbSA9IHNwLmlkLm1hdGNoKC9eb3QoXGQrKVthYl0kLyk7CiAgICAgIHJldHVybiB7bjogbT9OdW1iZXIobVsxXSk6OTk5LCBlbDogc3B9OwogICAgfSkuc29ydCgoYSxiKT0+YS5uLWIubik7CiAgICBpdGVtcy5mb3JFYWNoKGl0PT4gb3V0LnB1c2goe2xhYmVsOmBPVCR7aXQubn1gLCB2YWw6IGl0LmVsLnRleHRDb250ZW50fSkpOwogIH0KICByZXR1cm4gb3V0Owp9OwoKd2luZG93LnJlbmRlclNwbGl0c0xpbmUgPSB3aW5kb3cucmVuZGVyU3BsaXRzTGluZSB8fCBmdW5jdGlvbihzaWRlKXsKICBjb25zdCBzcGxpdHMgPSB3aW5kb3cuZ2V0UGVyaW9kU3BsaXRzKHNpZGUpLmZpbHRlcih4PT4gKHgudmFsID8/ICfigJQnKSAhPT0gJ+KAlCcpOwogIGlmKCFzcGxpdHMubGVuZ3RoKSByZXR1cm4gJzxzcGFuIGNsYXNzPSJsaWItZWxsaXBzaXMiPlBhcnppYWxpOiDigJQ8L3NwYW4+JzsKICBjb25zdCB0eHQgPSBzcGxpdHMubWFwKHM9PmAke3MubGFiZWx9OiR7cy52YWx9YCkuam9pbignICDigKIgICcpOwogIC8vIGVzY0h0bWwgZXNpc3RlIGdpw6AgbmVsIGZpbGUKICByZXR1cm4gYDxzcGFuIGNsYXNzPSJsaWItZWxsaXBzaXMiPlBhcnppYWxpOiAke2VzY0h0bWwodHh0KX08L3NwYW4+YDsKfTsKCndpbmRvdy5zdGF0c1NvcnQgPSB3aW5kb3cuc3RhdHNTb3J0IHx8IHsgQTp7a2V5OidudW0nLGRpcjoxfSwgQjp7a2V5OidudW0nLGRpcjoxfSB9OwoKd2luZG93LmdldFN0YXRWYWx1ZSA9IHdpbmRvdy5nZXRTdGF0VmFsdWUgfHwgZnVuY3Rpb24ocCwga2V5KXsKICBzd2l0Y2goa2V5KXsKICAgIGNhc2UgJ251bSc6IHJldHVybiBOdW1iZXIocD8ubnVtfHwwKTsKICAgIGNhc2UgJ25hbWUnOiByZXR1cm4gU3RyaW5nKHA/Lm5hbWV8fCcnKS50b0xvd2VyQ2FzZSgpOwogICAgY2FzZSAncHRzJzogcmV0dXJuIE51bWJlcihwPy5wdHN8fDApOwogICAgY2FzZSAnZmYnOiByZXR1cm4gTnVtYmVyKHA/LmZmfHwwKTsKICAgIGNhc2UgJ21pbic6IHJldHVybiBOdW1iZXIocD8ubWlufHwwKTsKICAgIGNhc2UgJ3Btcic6IHsKICAgICAgY29uc3QgbSA9IChOdW1iZXIocD8ubWluKXx8MCkvNjA7CiAgICAgIHJldHVybiBtPjAgPyAoTnVtYmVyKHA/LnB0cyl8fDApL20gOiAtSW5maW5pdHk7CiAgICB9CiAgICBjYXNlICdwaXInOiByZXR1cm4gTnVtYmVyKGNhbGNQSVIocCl8fDApOwogICAgY2FzZSAnb2VyJzogcmV0dXJuIE51bWJlcihjYWxjT0VSKHApfHwwKTsKICAgIGNhc2UgJ3BtJzogIHJldHVybiBOdW1iZXIocD8ucG18fDApOwogICAgCiAgICBjYXNlICd0Mic6ICByZXR1cm4gbnVtUGN0KHBbJzJwdCddPy5tYWRlfHwwLCBwWycycHQnXT8uYXR0fHwwKTsKICAgIGNhc2UgJ3QycCc6IHJldHVybiBudW1QY3QocFsnMnB0J10/Lm1hZGV8fDAsIHBbJzJwdCddPy5hdHR8fDApOwogICAgY2FzZSAndDMnOiAgcmV0dXJuIG51bVBjdChwWyczcHQnXT8ubWFkZXx8MCwgcFsnM3B0J10/LmF0dHx8MCk7CiAgICBjYXNlICd0M3AnOiByZXR1cm4gbnVtUGN0KHBbJzNwdCddPy5tYWRlfHwwLCBwWyczcHQnXT8uYXR0fHwwKTsKICAgIGNhc2UgJ3RsJzogIHJldHVybiBudW1QY3QocC50bD8ubWFkZXx8MCwgcC50bD8uYXR0fHwwKTsKICAgIGNhc2UgJ3RscCc6IHJldHVybiBudW1QY3QocC50bD8ubWFkZXx8MCwgcC50bD8uYXR0fHwwKTsKICAgIGNhc2UgJ2ZzJzogIHJldHVybiBOdW1iZXIocC5mc3x8MCk7CiAgICBjYXNlICdyYSc6ICByZXR1cm4gTnVtYmVyKHAucmF8fDApOwogICAgY2FzZSAncmQnOiAgcmV0dXJuIE51bWJlcihwLnJkfHwwKTsKICAgIGNhc2UgJ2EnOiAgIHJldHVybiBOdW1iZXIocC5hfHwwKTsKICAgIGNhc2UgJ3BwJzogIHJldHVybiBOdW1iZXIocC5wcHx8MCk7CiAgICBjYXNlICdwcic6ICByZXR1cm4gTnVtYmVyKHAucHJ8fDApOwogICAgY2FzZSAnc3RmJzogcmV0dXJuIE51bWJlcihwLnN0Znx8MCk7CiAgICBjYXNlICdzdHMnOiByZXR1cm4gTnVtYmVyKHAuc3RzfHwwKTsKICAgIGRlZmF1bHQ6IHJldHVybiAwOwogIH0KfTsKCndpbmRvdy5zb3J0Rm9yU3RhdHMgPSB3aW5kb3cuc29ydEZvclN0YXRzIHx8IGZ1bmN0aW9uKHNpZGUsIGFycil7CiAgY29uc3QgcyA9IHdpbmRvdy5zdGF0c1NvcnQ/LltzaWRlXSB8fCB7a2V5OidudW0nLGRpcjoxfTsKICBjb25zdCBvdXQgPSBBcnJheS5pc0FycmF5KGFycikgPyBbLi4uYXJyXSA6IFtdOwogIG91dC5zb3J0KChhLGIpPT57CiAgICBjb25zdCB2YSA9IHdpbmRvdy5nZXRTdGF0VmFsdWUoYSxzLmtleSk7CiAgICBjb25zdCB2YiA9IHdpbmRvdy5nZXRTdGF0VmFsdWUoYixzLmtleSk7CiAgICBpZih0eXBlb2YgdmEgPT09ICdzdHJpbmcnIHx8IHR5cGVvZiB2YiA9PT0gJ3N0cmluZycpewogICAgICByZXR1cm4gU3RyaW5nKHZhKS5sb2NhbGVDb21wYXJlKFN0cmluZyh2YikpICogcy5kaXI7CiAgICB9CiAgICByZXR1cm4gKHZhIC0gdmIpICogcy5kaXI7CiAgfSk7CiAgcmV0dXJuIG91dDsKfTsKCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywoZSk9PnsKICBjb25zdCB0aCA9IGUudGFyZ2V0LmNsb3Nlc3Q/LigndGhbZGF0YS1zdGF0cy1rZXldJyk7CiAgaWYoIXRoKSByZXR1cm47CiAgY29uc3Qgc2lkZSA9IHRoLmdldEF0dHJpYnV0ZSgnZGF0YS1zaWRlJyk7CiAgY29uc3Qga2V5ICA9IHRoLmdldEF0dHJpYnV0ZSgnZGF0YS1zdGF0cy1rZXknKTsKICBpZighc2lkZSB8fCAha2V5KSByZXR1cm47CgogIGNvbnN0IGN1ciA9IHdpbmRvdy5zdGF0c1NvcnQ/LltzaWRlXSB8fCB7a2V5OidudW0nLGRpcjoxfTsKICBpZihjdXIua2V5ID09PSBrZXkpeyBjdXIuZGlyICo9IC0xOyB9IGVsc2UgeyBjdXIua2V5ID0ga2V5OyBjdXIuZGlyID0gMTsgfQogIHdpbmRvdy5zdGF0c1NvcnRbc2lkZV0gPSBjdXI7CgogIGlmKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGF0c092ZXJsYXknKT8uc3R5bGUuZGlzcGxheSA9PT0gJ2Jsb2NrJyl7CiAgICB0cnl7IHJlbmRlclN0YXRzKCk7IH1jYXRjaChfKXt9CiAgfQp9KTsKCmZ1bmN0aW9uICRpZChpZCl7IHJldHVybiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7IH0KCmZ1bmN0aW9uIHVwZGF0ZVNpZGVXaWR0aCgpewogIGNvbnN0IHVuZG9Cb3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndW5kb0JveCcpOwogIGlmKCF1bmRvQm94KSByZXR1cm47CiAgY29uc3QgdyA9IE1hdGguY2VpbCh1bmRvQm94LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLndpZHRoKTsKICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tc2lkZVcnLCB3ICsgJ3B4Jyk7CiAgdXBkYXRlU3RpY2t5T2Zmc2V0cygpOwp9CgpmdW5jdGlvbiB1cGRhdGVTdGlja3lPZmZzZXRzKCl7CiAgY29uc3QgdG9wYmFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRvcGJhcicpOwogIGNvbnN0IGhlYWRlckEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VjdGlvbkhlYWRlckEnKTsKICBjb25zdCBoZWFkZXJCID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlY3Rpb25IZWFkZXJCJyk7CgogIGNvbnN0IHRvcEggPSB0b3BiYXIgPyBNYXRoLmNlaWwodG9wYmFyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLmhlaWdodCkgOiAwOwogIGNvbnN0IGhlYWRBSCA9IGhlYWRlckEgPyBNYXRoLmNlaWwoaGVhZGVyQS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS5oZWlnaHQpIDogMDsKICBjb25zdCBoZWFkQkggPSBoZWFkZXJCID8gTWF0aC5jZWlsKGhlYWRlckIuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkuaGVpZ2h0KSA6IDA7CgogIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS10b3BiYXJIJywgdG9wSCArICdweCcpOwogIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zdHlsZS5zZXRQcm9wZXJ0eSgnLS1zZWN0aW9uQUgnLCBoZWFkQUggKyAncHgnKTsKICBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc3R5bGUuc2V0UHJvcGVydHkoJy0tc2VjdGlvbkJIJywgaGVhZEJIICsgJ3B4Jyk7Cn0KCndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCB1cGRhdGVTaWRlV2lkdGgpOwoKZnVuY3Rpb24gZm9ybWF0VGltZShzZWMpewogIHNlYyA9IE1hdGgubWF4KDAsIE1hdGguZmxvb3IoTnVtYmVyKHNlYykgfHwgMCkpOwogIGNvbnN0IG0gPSBNYXRoLmZsb29yKHNlYyAvIDYwKTsKICBjb25zdCBzID0gc2VjICUgNjA7CiAgcmV0dXJuIFN0cmluZyhtKS5wYWRTdGFydCgyLCcwJykgKyAnOicgKyBTdHJpbmcocykucGFkU3RhcnQoMiwnMCcpOwp9CgpmdW5jdGlvbiBwb2ludHNQZXJNaW51dGUocCl7CiAgY29uc3Qgc2VjUGxheWVkID0gTWF0aC5tYXgoMCwgTnVtYmVyKHA/Lm1pbikgfHwgMCk7CiAgY29uc3QgbWludXRlcyA9IHNlY1BsYXllZCAvIDYwOwogIGNvbnN0IHB0cyA9IE51bWJlcihwPy5wdHMpIHx8IDA7CiAgaWYobWludXRlcyA8PSAwKSByZXR1cm4gJ+KAlCc7CiAgY29uc3QgdiA9IHB0cyAvIG1pbnV0ZXM7CiAgLy8gMiBkZWNpbWFsaSwgc3RpbGUgaXRhbGlhbm8gY29uIHB1bnRvIChwacO5IGNvbXBhdHRvKQogIHJldHVybiB2LnRvRml4ZWQoMik7Cn0KCmZ1bmN0aW9uIHN0YXRzUE0ocCl7CiAgY29uc3Qgc2VjUGxheWVkID0gTWF0aC5tYXgoMCwgTnVtYmVyKHA/Lm1pbikgfHwgMCk7CiAgY29uc3QgbWluUGxheWVkID0gc2VjUGxheWVkIC8gNjA7CiAgY29uc3QgcHRzID0gTnVtYmVyKHA/LnB0cykgfHwgMDsKICBpZihtaW5QbGF5ZWQgPD0gMCkgcmV0dXJuICfigJQnOwogIHJldHVybiAocHRzIC8gbWluUGxheWVkKS50b0ZpeGVkKDIpOwp9CgpmdW5jdGlvbiBwY3QobWFkZSwgYXR0KXsKICBhdHQgPSBOdW1iZXIoYXR0fHwwKTsKICBtYWRlID0gTnVtYmVyKG1hZGV8fDApOwogIGlmKGF0dCA8PSAwKSByZXR1cm4gJ+KAlCc7CiAgY29uc3QgdiA9IChtYWRlL2F0dCkqMTAwOwogIHJldHVybiB2LnRvRml4ZWQoMSkucmVwbGFjZSgnLicsICcsJykgKyAnJSc7Cn0KCmZ1bmN0aW9uIG51bVBjdChtYWRlLCBhdHQpewogIGF0dCA9IE51bWJlcihhdHR8fDApOwogIG1hZGUgPSBOdW1iZXIobWFkZXx8MCk7CiAgaWYoYXR0IDw9IDApIHJldHVybiAtSW5maW5pdHk7CiAgcmV0dXJuIChtYWRlL2F0dCkqMTAwOwp9CgoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgIExPR0hJIChPRkZMSU5FKSDigJMgZW1iZWRkZWQgaW4gbG9jYWxTdG9yYWdlIGFzIERhdGFVUkwgKGJhc2U2NCkKICAgLSBwaWNrTG9nbygnQScvJ0InKTogc2VsZXppb25hIGltbWFnaW5lIGxvY2FsZSBlIHNhbHZhCiAgIC0gY2xlYXJMb2dvKCdBJy8nQicvJ0FMTCcpOiByaW11b3ZlCiAgIC0gdXNhdGkgaW4gIlNvbG8gcmlzdWx0YXRvIiAoc2hhcmVSZXN1bHRDYXJkKSBwZXIgaWwgSlBHCj09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwpjb25zdCBMT0dPX0tFWV9BID0gJ2JzX2xvZ29BX2RhdGF1cmwnOwpjb25zdCBMT0dPX0tFWV9CID0gJ2JzX2xvZ29CX2RhdGF1cmwnOwoKZnVuY3Rpb24gZ2V0TG9nb0RhdGEoc2lkZSl7CiAgY29uc3Qga2V5ID0gKHNpZGUgPT09ICdBJykgPyBMT0dPX0tFWV9BIDogTE9HT19LRVlfQjsKICByZXR1cm4gKGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSkgfHwgJycpLnRyaW0oKTsKfQoKZnVuY3Rpb24gc2V0TG9nb0RhdGEoc2lkZSwgZGF0YVVybCl7CiAgY29uc3Qga2V5ID0gKHNpZGUgPT09ICdBJykgPyBMT0dPX0tFWV9BIDogTE9HT19LRVlfQjsKICBpZihkYXRhVXJsKSBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShrZXksIGRhdGFVcmwpOwogIGVsc2UgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTsKICB1cGRhdGVMb2dvUHJldmlld3MoKTsKfQoKZnVuY3Rpb24gdXBkYXRlTG9nb1ByZXZpZXdzKCl7CiAgY29uc3QgYSA9IGdldExvZ29EYXRhKCdBJyk7CiAgY29uc3QgYiA9IGdldExvZ29EYXRhKCdCJyk7CgogIGNvbnN0IGltZ0EgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9nb0FQcmV2Jyk7CiAgY29uc3QgaW1nQiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsb2dvQlByZXYnKTsKCiAgaWYoaW1nQSl7CiAgICBpZihhKXsgaW1nQS5zcmMgPSBhOyBpbWdBLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lLWJsb2NrJzsgfQogICAgZWxzZSB7IGltZ0EucmVtb3ZlQXR0cmlidXRlKCdzcmMnKTsgaW1nQS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOyB9CiAgfQogIGlmKGltZ0IpewogICAgaWYoYil7IGltZ0Iuc3JjID0gYjsgaW1nQi5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZS1ibG9jayc7IH0KICAgIGVsc2UgeyBpbWdCLnJlbW92ZUF0dHJpYnV0ZSgnc3JjJyk7IGltZ0Iuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgfQogIH0KfQoKZnVuY3Rpb24gcGlja0xvZ28oc2lkZSl7CiAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChzaWRlID09PSAnQScgPyAnbG9nb0FJbnB1dCcgOiAnbG9nb0JJbnB1dCcpOwogIGlmKCFpbnB1dCkgcmV0dXJuOwogIGlucHV0LnZhbHVlID0gJyc7CiAgaW5wdXQub25jaGFuZ2UgPSAoKSA9PiB7CiAgICBjb25zdCBmaWxlID0gaW5wdXQuZmlsZXMgJiYgaW5wdXQuZmlsZXNbMF07CiAgICBpZighZmlsZSkgcmV0dXJuOwogICAgaWYoIWZpbGUudHlwZSB8fCAhZmlsZS50eXBlLnN0YXJ0c1dpdGgoJ2ltYWdlLycpKXsKICAgICAgYWxlcnQoJ1NlbGV6aW9uYSB1biBmaWxlIGltbWFnaW5lIChQTkcvSlBHL1dlYlApLicpOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHsKICAgICAgY29uc3QgZGF0YVVybCA9IFN0cmluZyhyZWFkZXIucmVzdWx0IHx8ICcnKS50cmltKCk7CiAgICAgIGlmKCFkYXRhVXJsLnN0YXJ0c1dpdGgoJ2RhdGE6aW1hZ2UvJykpewogICAgICAgIGFsZXJ0KCdJbW1hZ2luZSBub24gdmFsaWRhLicpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBzZXRMb2dvRGF0YShzaWRlLCBkYXRhVXJsKTsKICAgIH07CiAgICByZWFkZXIub25lcnJvciA9ICgpID0+IGFsZXJ0KCdFcnJvcmUgZHVyYW50ZSBsYSBsZXR0dXJhIGRlbCBmaWxlLicpOwogICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CiAgfTsKICBpbnB1dC5jbGljaygpOwp9CgpmdW5jdGlvbiBjbGVhckxvZ28oc2lkZSl7CiAgaWYoc2lkZSA9PT0gJ0FMTCcpewogICAgc2V0TG9nb0RhdGEoJ0EnLCcnKTsKICAgIHNldExvZ29EYXRhKCdCJywnJyk7CiAgICByZXR1cm47CiAgfQogIHNldExvZ29EYXRhKHNpZGUsJycpOwp9CgovLyBBZ2dpb3JuYSBwcmV2aWV3IGFsbCdhdnZpbwp3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbG9hZCcsICgpPT57IHRyeXsgdXBkYXRlTG9nb1ByZXZpZXdzKCk7IH1jYXRjaChlKXt9IH0pOwoKCgoKZnVuY3Rpb24gZXNjQXR0cihzKXsKICByZXR1cm4gU3RyaW5nKHMgPz8gJycpCiAgICAucmVwbGFjZUFsbCgnJicsJyZhbXA7JykKICAgIC5yZXBsYWNlQWxsKCciJywnJnF1b3Q7JykKICAgIC5yZXBsYWNlQWxsKCc8JywnJmx0OycpCiAgICAucmVwbGFjZUFsbCgnPicsJyZndDsnKTsKfQpmdW5jdGlvbiBlc2NIdG1sKHMpewogIHJldHVybiBTdHJpbmcocyA/PyAnJykKICAgIC5yZXBsYWNlQWxsKCcmJywnJmFtcDsnKQogICAgLnJlcGxhY2VBbGwoJzwnLCcmbHQ7JykKICAgIC5yZXBsYWNlQWxsKCc+JywnJmd0OycpCiAgICAucmVwbGFjZUFsbCgnIicsJyZxdW90OycpOwp9CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgVElNRVIg4oCcU0lDVVJP4oCdCiAgIC0gV2FrZSBMb2NrIChhbnRpLXNsZWVwIHNjaGVybW8pIHNlIHN1cHBvcnRhdG8KICAgLSBCZWVwIGEgMDowMCAoV2ViQXVkaW8pCj09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwpsZXQgd2FrZUxvY2tTZW50aW5lbCA9IG51bGw7Cgphc3luYyBmdW5jdGlvbiByZXF1ZXN0V2FrZUxvY2soKXsKICB0cnl7CiAgICBpZighKCd3YWtlTG9jaycgaW4gbmF2aWdhdG9yKSkgcmV0dXJuOwogICAgLy8gZXZpdGEgZG9wcGlhIHJpY2hpZXN0YQogICAgaWYod2FrZUxvY2tTZW50aW5lbCAmJiAhd2FrZUxvY2tTZW50aW5lbC5yZWxlYXNlZCkgcmV0dXJuOwogICAgd2FrZUxvY2tTZW50aW5lbCA9IGF3YWl0IG5hdmlnYXRvci53YWtlTG9jay5yZXF1ZXN0KCdzY3JlZW4nKTsKICAgIHdha2VMb2NrU2VudGluZWwuYWRkRXZlbnRMaXN0ZW5lcigncmVsZWFzZScsICgpPT57CiAgICAgIC8vIHJpbGFzY2lvIGdlc3RpdG8gKHN0b3AvdmlzaWJpbGl0w6ApLCBvawogICAgfSk7CiAgfWNhdGNoKGUpewogICAgLy8gc2lsZW56aW9zbzogYWxjdW5pIGJyb3dzZXIgYmxvY2Nhbm8gc2VuemEgaW50ZXJhemlvbmUgbyBpbiBsb3ctcG93ZXIgbW9kZQogIH0KfQoKYXN5bmMgZnVuY3Rpb24gcmVsZWFzZVdha2VMb2NrKCl7CiAgdHJ5ewogICAgaWYod2FrZUxvY2tTZW50aW5lbCAmJiAhd2FrZUxvY2tTZW50aW5lbC5yZWxlYXNlZCl7CiAgICAgIGF3YWl0IHdha2VMb2NrU2VudGluZWwucmVsZWFzZSgpOwogICAgfQogIH1jYXRjaChlKXt9CiAgd2FrZUxvY2tTZW50aW5lbCA9IG51bGw7Cn0KCi8vIFNlIGxhIHBhZ2luYSB0b3JuYSB2aXNpYmlsZSBkdXJhbnRlIGlsIHRpbWVyLCByaXByb3ZhIGEgcHJlbmRlcmUgaWwgV2FrZSBMb2NrCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Zpc2liaWxpdHljaGFuZ2UnLCAoKT0+ewogIGlmKGRvY3VtZW50LnZpc2liaWxpdHlTdGF0ZSA9PT0gJ3Zpc2libGUnICYmIHRpbWVyKXsKICAgIHJlcXVlc3RXYWtlTG9jaygpOwogIH0KfSk7CgpsZXQgYXVkaW9DdHggPSBudWxsOwoKZnVuY3Rpb24gZW5zdXJlQXVkaW8oKXsKICB0cnl7CiAgICBpZighYXVkaW9DdHgpewogICAgICBhdWRpb0N0eCA9IG5ldyAod2luZG93LkF1ZGlvQ29udGV4dCB8fCB3aW5kb3cud2Via2l0QXVkaW9Db250ZXh0KSgpOwogICAgfQogICAgaWYoYXVkaW9DdHguc3RhdGUgPT09ICdzdXNwZW5kZWQnKXsKICAgICAgYXVkaW9DdHgucmVzdW1lKCk7CiAgICB9CiAgfWNhdGNoKGUpe30KfQoKZnVuY3Rpb24gYmVlcCgpewogIHRyeXsKICAgIGVuc3VyZUF1ZGlvKCk7CiAgICBpZighYXVkaW9DdHgpIHJldHVybjsKICAgIGNvbnN0IG8gPSBhdWRpb0N0eC5jcmVhdGVPc2NpbGxhdG9yKCk7CiAgICBjb25zdCBnID0gYXVkaW9DdHguY3JlYXRlR2FpbigpOwoKICAgIG8udHlwZSA9ICdzaW5lJzsKICAgIG8uZnJlcXVlbmN5LnZhbHVlID0gODgwOyAvLyBIegogICAgZy5nYWluLnZhbHVlID0gMC4wMDAxOwoKICAgIG8uY29ubmVjdChnKTsKICAgIGcuY29ubmVjdChhdWRpb0N0eC5kZXN0aW5hdGlvbik7CgogICAgY29uc3QgdCA9IGF1ZGlvQ3R4LmN1cnJlbnRUaW1lOwogICAgZy5nYWluLnNldFZhbHVlQXRUaW1lKDAuMDAwMSwgdCk7CiAgICBnLmdhaW4uZXhwb25lbnRpYWxSYW1wVG9WYWx1ZUF0VGltZSgwLjI1LCB0ICsgMC4wMSk7CiAgICBnLmdhaW4uZXhwb25lbnRpYWxSYW1wVG9WYWx1ZUF0VGltZSgwLjAwMDEsIHQgKyAwLjIyKTsKCiAgICBvLnN0YXJ0KHQpOwogICAgby5zdG9wKHQgKyAwLjI0KTsKICB9Y2F0Y2goZSl7fQp9CgoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgIE1PREVMCj09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwpmdW5jdGlvbiBtYWtlUGxheWVyKG5hbWUsIG51bSl7CiAgcmV0dXJuIHsKICAgIG51bTogTnVtYmVyLmlzRmluaXRlKE51bWJlcihudW0pKSA/IE51bWJlcihudW0pIDogMCwKICAgIG5hbWUsCiAgICBpbjpmYWxzZSwKICAgIGV4cGVsbGVkOmZhbHNlLAogICAgcHRzOjAsIGZmOjAsIG1pbjowLAogICAgJzJwdCc6e21hZGU6MCxhdHQ6MH0sCiAgICAnM3B0Jzp7bWFkZTowLGF0dDowfSwKICAgIHRsOnttYWRlOjAsYXR0OjB9LAogICAgZnM6MCxyYTowLHJkOjAsYTowLHBwOjAscHI6MCxzdGY6MCxzdHM6MCwKICAgIHBtOjAKICB9Owp9CmZ1bmN0aW9uIG5vcm1hbGl6ZVBsYXllcnMobGlzdCwgbj0xMiwgcHJlZml4PSJHaW9jYXRvcmUiKXsKICBpZighQXJyYXkuaXNBcnJheShsaXN0KSkgbGlzdCA9IFtdOwogIGxpc3QgPSBsaXN0Lm1hcCgocCwgaWR4KT0+ewogICAgY29uc3QgYmFzZSA9IG1ha2VQbGF5ZXIocD8ubmFtZSB8fCBgJHtwcmVmaXh9ICR7aWR4KzF9YCwgKHA/Lm51bSA/PyAoaWR4KzEpKSk7CiAgICBjb25zdCBvdXQgPSB7Li4uYmFzZSwgLi4ucH07CiAgICBvdXRbJzJwdCddID0gb3V0WycycHQnXSB8fCB7bWFkZTowLGF0dDowfTsKICAgIG91dFsnM3B0J10gPSBvdXRbJzNwdCddIHx8IHttYWRlOjAsYXR0OjB9OwogICAgb3V0LnRsID0gb3V0LnRsIHx8IHttYWRlOjAsYXR0OjB9OwogICAgaWYodHlwZW9mIG91dC5taW4gIT09ICdudW1iZXInKSBvdXQubWluID0gMDsKICAgIGlmKCFOdW1iZXIuaXNGaW5pdGUoTnVtYmVyKG91dC5udW0pKSkgb3V0Lm51bSA9IGlkeCsxOwogICAgb3V0Lm51bSA9IE1hdGgubWF4KDAsIE1hdGgubWluKDk5LCBNYXRoLmZsb29yKE51bWJlcihvdXQubnVtKSkpKTsKICAgIGlmKHR5cGVvZiBvdXQucG0gIT09ICdudW1iZXInKSBvdXQucG0gPSAwOwogICAgaWYodHlwZW9mIG91dC5leHBlbGxlZCAhPT0gJ2Jvb2xlYW4nKSBvdXQuZXhwZWxsZWQgPSBmYWxzZTsKICAgIGlmKHR5cGVvZiBvdXQuaW4gIT09ICdib29sZWFuJykgb3V0LmluID0gZmFsc2U7CiAgICBpZih0eXBlb2Ygb3V0LmZmICE9PSAnbnVtYmVyJykgb3V0LmZmID0gMDsKICAgIHJldHVybiBvdXQ7CiAgfSk7CiAgd2hpbGUobGlzdC5sZW5ndGggPCBuKSBsaXN0LnB1c2gobWFrZVBsYXllcihgJHtwcmVmaXh9ICR7bGlzdC5sZW5ndGgrMX1gLCBsaXN0Lmxlbmd0aCsxKSk7CiAgaWYobGlzdC5sZW5ndGggPiBuKSBsaXN0ID0gbGlzdC5zbGljZSgwLG4pOwogIHJldHVybiBsaXN0Owp9Cgpjb25zdCBTVE9SQUdFX0tFWSA9ICdiYXNrZXRfc3RhdHNfc3RhdGVfZmlsZV91bmljb192MSc7CmNvbnN0IFFVQVJURVJfTEVOID0gNjAwOyAvLyAxMDowMApjb25zdCBPVF9MRU4gPSAzMDA7ICAgICAgLy8gNTowMAoKbGV0IHRlYW1BID0geyBwcDowLCBwcjowLCB0bzowLCBmdHM6MCB9OwpsZXQgdGVhbUIgPSB7IHBwOjAsIHByOjAsIHRvOjAsIGZ0czowIH07CgpsZXQgcGxheWVyc0EgPSBub3JtYWxpemVQbGF5ZXJzKFsgbWFrZVBsYXllcignTWFyY28gRGUgUm9zYScsMSksIG1ha2VQbGF5ZXIoJ0x1Y2EgQmlhbmNoaScsMikgXSwgMTIsICdBJyk7CmxldCBwbGF5ZXJzQiA9IG5vcm1hbGl6ZVBsYXllcnMoW10sIDEyLCAnQicpOwpwbGF5ZXJzQVswXS5pbiA9IHRydWU7CgpsZXQgdW5kb1N0YWNrID0gW107CmxldCBjdXJyZW50UXVhcnRlcj0xLCBsYXN0U2NvcmVBPTAsIGxhc3RTY29yZUI9MDsKbGV0IHNlYz1RVUFSVEVSX0xFTiwgdGltZXI9bnVsbDsKbGV0IG1pbnVzTW9kZSA9IGZhbHNlOwpsZXQgZ2FtZUNsb3NlZCA9IGZhbHNlOyAvLyB0cnVlIHF1YW5kbyBmaW5pc2NlIFE0IHNlbnphIHBhcml0w6AKLy8gPT09PT0gU05BUFNIT1QgUEVSIFFVQVJUTyAocGVyIHN0YXRzICdzb2xvIHBlcmlvZG8nKQpsZXQgcGVyaW9kU25hcHNob3RzID0ge307IC8vIGVzOiB7IFExOntwbGF5ZXJzQSxwbGF5ZXJzQn0sIFEyOnsuLi59LCBPVDE6ey4uLn0gfQpsZXQgc3RhdHNWaWV3ID0geyBtb2RlOid0b3RhbCcsIGxhYmVsOm51bGwsIEE6bnVsbCwgQjpudWxsIH07Ci8vIFB1bnRpIGdsb2JhbGkgKCsxLysyLyszKSB1c2EgbW9kYWxpdMOgIEZ1cmJvIChtaW51c01vZGUpCgpmdW5jdGlvbiBhZGpQdHMoc2lkZSwgcHRzKXsKICBpZihnYW1lQ2xvc2VkKSByZXR1cm47CiAgcHRzID0gTWF0aC50cnVuYyhOdW1iZXIocHRzKXx8MCk7CiAgaWYoIShwdHM9PT0xIHx8IHB0cz09PTIgfHwgcHRzPT09MykpIHJldHVybjsKCiAgY29uc3QgZGVsdGEgPSBtaW51c01vZGUgPyAtcHRzIDogcHRzOwoKICAvLyBub24gcGVybWV0dGVyZSBwdW50ZWdnaW8gbmVnYXRpdm8KICBjb25zdCBjdXJyZW50ID0gKHN1bVRlYW0oZ2V0UGxheWVycyhzaWRlKSkucHRzIHx8IDApICsgKHNjb3JlQWRqW3NpZGVdfHwwKTsKICBpZihjdXJyZW50ICsgZGVsdGEgPCAwKSByZXR1cm47CgogIGNvbnN0IG9sZEFkaiA9IHNjb3JlQWRqW3NpZGVdIHx8IDA7CiAgY29uc3QgcG1BID0gcGxheWVyc0EubWFwKHg9PngucG18fDApOwogIGNvbnN0IHBtQiA9IHBsYXllcnNCLm1hcCh4PT54LnBtfHwwKTsKCiAgc2F2ZShgUHVudGkgJHtzaWRlfSAke2RlbHRhPjA/JysnOicnfSR7ZGVsdGF9YCwgKCk9PnsKICAgIHNjb3JlQWRqW3NpZGVdID0gb2xkQWRqOwogICAgcGxheWVyc0EuZm9yRWFjaCgoeCwgaWR4KT0+IHgucG0gPSBwbUFbaWR4XSB8fCAwKTsKICAgIHBsYXllcnNCLmZvckVhY2goKHgsIGlkeCk9PiB4LnBtID0gcG1CW2lkeF0gfHwgMCk7CiAgfSk7CgogIHNjb3JlQWRqW3NpZGVdID0gb2xkQWRqICsgZGVsdGE7CiAgYXBwbHlQbHVzTWludXMoc2lkZSwgZGVsdGEpOwoKICByZW5kZXIoKTsKfQoKCgoKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PQogICBQRVJJT0RJIC8gT1QgUk9XUwo9PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KZnVuY3Rpb24gcGVyaW9kTGFiZWwocSl7CiAgaWYocSA8PSA0KSByZXR1cm4gU3RyaW5nKHEpOwogIHJldHVybiBgT1QgJHtxLTR9YDsKfQpmdW5jdGlvbiBlbnN1cmVPdFJvdyhvdEluZGV4KXsKICBjb25zdCBpZEEgPSBgb3Qke290SW5kZXh9YWA7CiAgY29uc3QgaWRCID0gYG90JHtvdEluZGV4fWJgOwogIGlmKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkQSkgJiYgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWRCKSkgcmV0dXJuOwoKICBjb25zdCBob3N0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ290Um93cycpOwogIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogIHJvdy5jbGFzc05hbWUgPSAncXJvdyc7CiAgcm93LmlubmVySFRNTCA9IGA8c3Ryb25nPk9UJHtvdEluZGV4fTwvc3Ryb25nPjxzcGFuIGlkPSIke2lkQX0iPuKAlDwvc3Bhbj48c3BhbiBpZD0iJHtpZEJ9Ij7igJQ8L3NwYW4+YDsKICBob3N0LmFwcGVuZENoaWxkKHJvdyk7Cn0KZnVuY3Rpb24gcmVidWlsZE90Um93c0Zyb21TdGF0ZShxdWFydGVyc09iail7CiAgY29uc3QgaG9zdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdFJvd3MnKTsKICBob3N0LmlubmVySFRNTCA9ICcnOwogIGlmKCFxdWFydGVyc09iaikgcmV0dXJuOwogIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhxdWFydGVyc09iaikuZmlsdGVyKGs9Pi9eb3RcXGQrW2FiXSQvLnRlc3QoaykpOwogIGxldCBtYXhPdCA9IDA7CiAga2V5cy5mb3JFYWNoKGs9PnsKICAgIGNvbnN0IG0gPSBrLm1hdGNoKC9eb3QoXFxkKylbYWJdJC8pOwogICAgaWYobSkgbWF4T3QgPSBNYXRoLm1heChtYXhPdCwgTnVtYmVyKG1bMV0pKTsKICB9KTsKICBmb3IobGV0IGk9MTtpPD1tYXhPdDtpKyspewogICAgZW5zdXJlT3RSb3coaSk7CiAgICBjb25zdCBhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYG90JHtpfWFgKTsKICAgIGNvbnN0IGIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgb3Qke2l9YmApOwogICAgaWYoYSAmJiB0eXBlb2YgcXVhcnRlcnNPYmpbYG90JHtpfWFgXSA9PT0gJ3N0cmluZycpIGEudGV4dENvbnRlbnQgPSBxdWFydGVyc09ialtgb3Qke2l9YWBdOwogICAgaWYoYiAmJiB0eXBlb2YgcXVhcnRlcnNPYmpbYG90JHtpfWJgXSA9PT0gJ3N0cmluZycpIGIudGV4dENvbnRlbnQgPSBxdWFydGVyc09ialtgb3Qke2l9YmBdOwogIH0KfQoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgIFNUQVRFIFNBVkUvTE9BRAo9PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KZnVuY3Rpb24gc25hcHNob3RTdGF0ZSgpewogIGNvbnN0IHF1YXJ0ZXJzID0gewogICAgcTFhOnExYS50ZXh0Q29udGVudCwgcTFiOnExYi50ZXh0Q29udGVudCwKICAgIHEyYTpxMmEudGV4dENvbnRlbnQsIHEyYjpxMmIudGV4dENvbnRlbnQsCiAgICBxM2E6cTNhLnRleHRDb250ZW50LCBxM2I6cTNiLnRleHRDb250ZW50LAogICAgcTRhOnE0YS50ZXh0Q29udGVudCwgcTRiOnE0Yi50ZXh0Q29udGVudAogIH07CiAgY29uc3Qgb3RIb3N0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ290Um93cycpOwogIGlmKG90SG9zdCl7CiAgICBjb25zdCBzcGFucyA9IG90SG9zdC5xdWVyeVNlbGVjdG9yQWxsKCdzcGFuW2lkXj0ib3QiXScpOwogICAgc3BhbnMuZm9yRWFjaChzcD0+eyBxdWFydGVyc1tzcC5pZF0gPSBzcC50ZXh0Q29udGVudDsgfSk7CiAgfQoKICByZXR1cm4gewogICAgdGVhbUEsIHRlYW1CLCBwbGF5ZXJzQSwgcGxheWVyc0IsCiAgICBjdXJyZW50UXVhcnRlciwgbGFzdFNjb3JlQSwgbGFzdFNjb3JlQiwKICAgIHNlYywKICAgIHNjb3JlQWRqLAogICAgcGVyaW9kU25hcHNob3RzLAogICAgdWk6ewogICAgICBuYW1lQTogbmFtZUEudmFsdWUgPz8gJycsCiAgICAgIG5hbWVCOiBuYW1lQi52YWx1ZSA/PyAnJywKICAgICAgY2FtcGlvbmF0bzogY2FtcGlvbmF0by52YWx1ZSA/PyAnJywKICAgICAgZ2lyb25lOiBnaXJvbmUudmFsdWUgPz8gJycsCiAgICAgIGRhdGFHYXJhOiBkYXRhR2FyYS52YWx1ZSA/PyAnJywKICAgICAgZ2lvcm5hdGE6IGdpb3JuYXRhLnZhbHVlID8/ICcnLAogICAgICBhbmRhdGFSaXRvcm5vOiBhbmRhdGFSaXRvcm5vLnZhbHVlID8/ICcnLAogICAgICBjYXNhRnVvcmk6IGNhc2FGdW9yaS52YWx1ZSA/PyAnJywKICAgICAgYXJiaXRybzE6IGFyYml0cm8xLnZhbHVlID8/ICcnLAogICAgICBhcmJpdHJvMjogYXJiaXRybzIudmFsdWUgPz8gJycKICAgIH0sCiAgICBxdWFydGVycwogIH07Cn0KZnVuY3Rpb24gc2F2ZVN0YXRlKCl7IHRyeXsgbG9jYWxTdG9yYWdlLnNldEl0ZW0oU1RPUkFHRV9LRVksIEpTT04uc3RyaW5naWZ5KHNuYXBzaG90U3RhdGUoKSkpOyB9Y2F0Y2goZSl7fSB9CgpmdW5jdGlvbiBsb2FkU3RhdGUoKXsKICB0cnl7CiAgICBjb25zdCByYXcgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShTVE9SQUdFX0tFWSk7CiAgICBpZighcmF3KSByZXR1cm4gZmFsc2U7CiAgICBjb25zdCBzID0gSlNPTi5wYXJzZShyYXcpOwoKICAgIGlmKHM/LnRlYW1BKSB0ZWFtQSA9IHMudGVhbUE7CiAgICBpZihzPy50ZWFtQikgdGVhbUIgPSBzLnRlYW1COwogICAgaWYoQXJyYXkuaXNBcnJheShzPy5wbGF5ZXJzQSkpIHBsYXllcnNBID0gcy5wbGF5ZXJzQTsKICAgIGlmKEFycmF5LmlzQXJyYXkocz8ucGxheWVyc0IpKSBwbGF5ZXJzQiA9IHMucGxheWVyc0I7CgogICAgaWYodHlwZW9mIHM/LmN1cnJlbnRRdWFydGVyID09PSAnbnVtYmVyJykgY3VycmVudFF1YXJ0ZXIgPSBzLmN1cnJlbnRRdWFydGVyOwogICAgaWYodHlwZW9mIHM/Lmxhc3RTY29yZUEgPT09ICdudW1iZXInKSBsYXN0U2NvcmVBID0gcy5sYXN0U2NvcmVBOwogICAgaWYodHlwZW9mIHM/Lmxhc3RTY29yZUIgPT09ICdudW1iZXInKSBsYXN0U2NvcmVCID0gcy5sYXN0U2NvcmVCOwogICAgaWYodHlwZW9mIHM/LnNlYyA9PT0gJ251bWJlcicpIHNlYyA9IHMuc2VjOwoKICBpZihzPy5zY29yZUFkail7IHNjb3JlQWRqID0geyBBOiBOdW1iZXIocy5zY29yZUFkai5BfHwwKSwgQjogTnVtYmVyKHMuc2NvcmVBZGouQnx8MCkgfTsgfSBlbHNlIHsgc2NvcmVBZGogPSB7QTowLEI6MH07IH0KICBpZihzPy5wZXJpb2RTbmFwc2hvdHMgJiYgdHlwZW9mIHMucGVyaW9kU25hcHNob3RzID09PSAnb2JqZWN0JykgcGVyaW9kU25hcHNob3RzID0gcy5wZXJpb2RTbmFwc2hvdHM7IGVsc2UgcGVyaW9kU25hcHNob3RzID0ge307CgoKCiAgaWYocz8uc2NvcmVBZGopeyBzY29yZUFkaiA9IHsgQTogTnVtYmVyKHMuc2NvcmVBZGouQXx8MCksIEI6IE51bWJlcihzLnNjb3JlQWRqLkJ8fDApIH07IH0gZWxzZSB7IHNjb3JlQWRqID0ge0E6MCxCOjB9OyB9CiAgICAKICAgIGlmKHM/LnBlcmlvZFNuYXBzaG90cyAmJiB0eXBlb2Ygcy5wZXJpb2RTbmFwc2hvdHMgPT09ICdvYmplY3QnKXsKICAgICAgcGVyaW9kU25hcHNob3RzID0gcy5wZXJpb2RTbmFwc2hvdHM7CiAgICB9ZWxzZXsKICAgICAgcGVyaW9kU25hcHNob3RzID0ge307CiAgICB9CmlmKHM/LnVpKXsKICAgICAgaWYodHlwZW9mIHMudWkubmFtZUEgPT09ICdzdHJpbmcnKSBuYW1lQS52YWx1ZSA9IHMudWkubmFtZUE7CiAgICAgIGlmKHR5cGVvZiBzLnVpLm5hbWVCID09PSAnc3RyaW5nJykgbmFtZUIudmFsdWUgPSBzLnVpLm5hbWVCOwoKICAgICAgaWYodHlwZW9mIHMudWkuY2FtcGlvbmF0byA9PT0gJ3N0cmluZycpIGNhbXBpb25hdG8udmFsdWUgPSBzLnVpLmNhbXBpb25hdG87CiAgICAgIGlmKHR5cGVvZiBzLnVpLmdpcm9uZSA9PT0gJ3N0cmluZycpIGdpcm9uZS52YWx1ZSA9IHMudWkuZ2lyb25lOwogICAgICBpZih0eXBlb2Ygcy51aS5kYXRhR2FyYSA9PT0gJ3N0cmluZycpIGRhdGFHYXJhLnZhbHVlID0gcy51aS5kYXRhR2FyYTsKICAgICAgaWYodHlwZW9mIHMudWkuZ2lvcm5hdGEgPT09ICdzdHJpbmcnKSBnaW9ybmF0YS52YWx1ZSA9IHMudWkuZ2lvcm5hdGE7CiAgICAgIGlmKHR5cGVvZiBzLnVpLmFuZGF0YVJpdG9ybm8gPT09ICdzdHJpbmcnKSBhbmRhdGFSaXRvcm5vLnZhbHVlID0gcy51aS5hbmRhdGFSaXRvcm5vOwogICAgICBpZih0eXBlb2Ygcy51aS5jYXNhRnVvcmkgPT09ICdzdHJpbmcnKSBjYXNhRnVvcmkudmFsdWUgPSBzLnVpLmNhc2FGdW9yaTsKICAgICAgaWYodHlwZW9mIHMudWkuYXJiaXRybzEgPT09ICdzdHJpbmcnKSBhcmJpdHJvMS52YWx1ZSA9IHMudWkuYXJiaXRybzE7CiAgICAgIGlmKHR5cGVvZiBzLnVpLmFyYml0cm8yID09PSAnc3RyaW5nJykgYXJiaXRybzIudmFsdWUgPSBzLnVpLmFyYml0cm8yOwogICAgfQoKICAgIGlmKHM/LnF1YXJ0ZXJzKXsKICAgICAgZm9yKGNvbnN0IGsgb2YgWydxMWEnLCdxMWInLCdxMmEnLCdxMmInLCdxM2EnLCdxM2InLCdxNGEnLCdxNGInXSl7CiAgICAgICAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChrKTsKICAgICAgICBpZihlbCAmJiB0eXBlb2Ygcy5xdWFydGVyc1trXSA9PT0gJ3N0cmluZycpIGVsLnRleHRDb250ZW50ID0gcy5xdWFydGVyc1trXTsKICAgICAgfQogICAgICByZWJ1aWxkT3RSb3dzRnJvbVN0YXRlKHMucXVhcnRlcnMpOwogICAgfQoKICAgIHBsYXllcnNBID0gbm9ybWFsaXplUGxheWVycyhwbGF5ZXJzQSwgMTIsICdBJyk7CiAgICBwbGF5ZXJzQiA9IG5vcm1hbGl6ZVBsYXllcnMocGxheWVyc0IsIDEyLCAnQicpOwoKICAgIGNvbnN0IGZpeE1pbiA9IChhcnIpPT57CiAgICAgIHNvcnRlZC5mb3JFYWNoKHA9PnsKICAgICAgICBjb25zdCB2ID0gTnVtYmVyKHAubWluKTsKICAgICAgICBpZiAoIU51bWJlci5pc0Zpbml0ZSh2KSkgeyBwLm1pbiA9IDA7IHJldHVybjsgfQogICAgICAgIGlmICghTnVtYmVyLmlzSW50ZWdlcih2KSkgcC5taW4gPSBNYXRoLnJvdW5kKHYgKiA2MCk7CiAgICAgICAgZWxzZSBwLm1pbiA9IHY7CiAgICAgIH0pOwogICAgfTsKICAgIGZpeE1pbihwbGF5ZXJzQSk7IGZpeE1pbihwbGF5ZXJzQik7CgogICAgdGVhbUEudG8gPSBOdW1iZXIodGVhbUEudG98fDApOyB0ZWFtQi50byA9IE51bWJlcih0ZWFtQi50b3x8MCk7CiAgICB0ZWFtQS5mdHMgPSBOdW1iZXIodGVhbUEuZnRzfHwwKTsgdGVhbUIuZnRzID0gTnVtYmVyKHRlYW1CLmZ0c3x8MCk7CgogICAgcGxheWVyc0EuZm9yRWFjaChwPT57CiAgICAgIGlmKHR5cGVvZiBwLnBtICE9PSAnbnVtYmVyJykgcC5wbSA9IDA7CiAgICAgIGlmKHR5cGVvZiBwLmV4cGVsbGVkICE9PSAnYm9vbGVhbicpIHAuZXhwZWxsZWQgPSBmYWxzZTsKICAgICAgaWYodHlwZW9mIHAuaW4gIT09ICdib29sZWFuJykgcC5pbiA9IGZhbHNlOwogICAgfSk7CiAgICBwbGF5ZXJzQi5mb3JFYWNoKHA9PnsKICAgICAgaWYodHlwZW9mIHAucG0gIT09ICdudW1iZXInKSBwLnBtID0gMDsKICAgICAgaWYodHlwZW9mIHAuZXhwZWxsZWQgIT09ICdib29sZWFuJykgcC5leHBlbGxlZCA9IGZhbHNlOwogICAgICBpZih0eXBlb2YgcC5pbiAhPT0gJ2Jvb2xlYW4nKSBwLmluID0gZmFsc2U7CiAgICB9KTsKCiAgICByZXR1cm4gdHJ1ZTsKICB9Y2F0Y2goZSl7IHJldHVybiBmYWxzZTsgfQp9CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgSEVMUEVSUwo9PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCmNvbnN0IE1BWF9PTl9DT1VSVCA9IDU7CmZ1bmN0aW9uIGNvdW50SW4oc2lkZSl7CiAgcmV0dXJuIGdldFBsYXllcnMoc2lkZSkucmVkdWNlKChjLHApPT4gYyArIChwLmluID8gMSA6IDApLCAwKTsKfQpmdW5jdGlvbiB3YXJuTWF4SW4oc2lkZSl7CiAgYWxlcnQoYEJsb2NjbyDigJw1IGluIGNhbXBv4oCdOiBtYXNzaW1vICR7TUFYX09OX0NPVVJUfSBnaW9jYXRvcmkgSU4gcGVyIHNxdWFkcmEuYCk7Cn0KZnVuY3Rpb24gY2xhbXBNYXhJbihzaWRlKXsKICBjb25zdCBhcnIgPSBnZXRQbGF5ZXJzKHNpZGUpOwogIGNvbnN0IGluSWR4ID0gW107CiAgZm9yKGxldCBpPTA7aTxhcnIubGVuZ3RoO2krKyl7IGlmKGFycltpXT8uaW4pIGluSWR4LnB1c2goaSk7IH0KICBpZihpbklkeC5sZW5ndGggPD0gTUFYX09OX0NPVVJUKSByZXR1cm47CiAgZm9yKGxldCBrPU1BWF9PTl9DT1VSVDtrPGluSWR4Lmxlbmd0aDtrKyspIGFycltpbklkeFtrXV0uaW49ZmFsc2U7Cn0KCmZ1bmN0aW9uIGdldFBsYXllcnMoc2lkZSl7IHJldHVybiBzaWRlPT09J0EnID8gcGxheWVyc0EgOiBwbGF5ZXJzQjsgfQpmdW5jdGlvbiBnZXRUZWFtKHNpZGUpeyByZXR1cm4gc2lkZT09PSdBJyA/IHRlYW1BIDogdGVhbUI7IH0KZnVuY3Rpb24gbWF4VGltZW91dHMoKXsgcmV0dXJuIChjdXJyZW50UXVhcnRlciA+PSA0KSA/IDMgOiAyOyB9IC8vIFE0IGUgT1QgLT4gMwpmdW5jdGlvbiBpc0xvY2tlZChwKXsgcmV0dXJuICEhcC5leHBlbGxlZCB8fCAoTnVtYmVyKHAuZmZ8fDApID49IDUpOyB9CmZ1bmN0aW9uIGNhbihzaWRlLCBpKXsKICBjb25zdCBwID0gZ2V0UGxheWVycyhzaWRlKVtpXTsKICByZXR1cm4gKHAgJiYgKHAuaW4gfHwgbWludXNNb2RlKSk7Cn0KCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PQogICBVTkRPCj09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwpmdW5jdGlvbiBzYXZlKGxhYmVsLCBjYil7CiAgdW5kb1N0YWNrLnB1c2goe2xhYmVsLCBjYn0pOwogIHVuZG9JbmZvLnRleHRDb250ZW50ID0gJ1VsdGltYSBhemlvbmU6ICcgKyBsYWJlbDsKICB1cGRhdGVTaWRlV2lkdGgoKTsKfQpmdW5jdGlvbiB1bmRvKCl7CiAgaWYoIXVuZG9TdGFjay5sZW5ndGgpIHJldHVybjsKICB1bmRvU3RhY2sucG9wKCkuY2IoKTsKICB1bmRvSW5mby50ZXh0Q29udGVudCA9IHVuZG9TdGFjay5hdCgtMSk/LmxhYmVsIHx8ICfigJQnOwogIHJlbmRlcigpOwp9CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgREFUSSBQQVJUSVRBIFRPR0dMRQo9PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KZnVuY3Rpb24gdG9nZ2xlTWF0Y2hEYXRhKCl7CiAgY29uc3QgcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXRjaERhdGFQYW5lbCcpOwogIGNvbnN0IGIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWF0Y2hEYXRhQnRuJyk7CiAgaWYoIXAgfHwgIWIpIHJldHVybjsKCiAgY29uc3QgaXNPcGVuID0gKHAuc3R5bGUuZGlzcGxheSAhPT0gJ25vbmUnKTsKICBwLnN0eWxlLmRpc3BsYXkgPSBpc09wZW4gPyAnbm9uZScgOiAnYmxvY2snOwoKICBiLmNsYXNzTGlzdC50b2dnbGUoJ2dyYXknLCAhaXNPcGVuKTsKICBiLmNsYXNzTGlzdC50b2dnbGUoJ2JsdWUnLCBpc09wZW4pOwoKICB1cGRhdGVTaWRlV2lkdGgoKTsKfQoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgIEZVUkJPCj09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwpmdW5jdGlvbiB0b2dnbGVNaW51cygpewogIG1pbnVzTW9kZSA9ICFtaW51c01vZGU7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21pbnVzQnRuJykuY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJywgbWludXNNb2RlKTsKfQpmdW5jdGlvbiBjbGVhck1pbnVzKCl7CiAgaWYoIW1pbnVzTW9kZSkgcmV0dXJuOwogIG1pbnVzTW9kZSA9IGZhbHNlOwogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtaW51c0J0bicpLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwp9CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgRVNQVUxTSU9ORQo9PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KZnVuY3Rpb24gZXhwZWxQbGF5ZXIoc2lkZSwgaSl7CiAgY29uc3QgYXJyID0gZ2V0UGxheWVycyhzaWRlKTsKICBjb25zdCBwID0gYXJyW2ldOwogIGlmKCFwKSByZXR1cm47CiAgaWYoaXNMb2NrZWQocCkpIHJldHVybjsKCiAgY29uc3Qgb2xkRXhwID0gISFwLmV4cGVsbGVkOwogIGNvbnN0IG9sZEluICA9ICEhcC5pbjsKCiAgc2F2ZShgJHtzaWRlfSAke3AubmFtZX0gRVNQYCwgKCk9PnsKICAgIHAuZXhwZWxsZWQgPSBvbGRFeHA7CiAgICBwLmluID0gb2xkSW47CiAgfSk7CgogIHAuZXhwZWxsZWQgPSB0cnVlOwogIHAuaW4gPSBmYWxzZTsKCiAgY2xlYXJNaW51cygpOwogIHJlbmRlcigpOwp9CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgU0FWRSBHQU1FIC8gTkVXIEdBTUUKPT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCmZ1bmN0aW9uIHNhZmVGaWxlbmFtZUJhc2Uocyl7CiAgY29uc3QgdCA9IFN0cmluZyhzIHx8ICcnKS50cmltKCk7CiAgY29uc3QgY2xlYW5lZCA9IHQKICAgIC5yZXBsYWNlQWxsKCcgJywnXycpCiAgICAucmVwbGFjZUFsbCgvW15hLXpBLVowLTlfXFwtXS9nLCcnKQogICAgLnNsaWNlKDAsNTApOwogIHJldHVybiBjbGVhbmVkIHx8ICdwYXJ0aXRhJzsKfQoKLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09Ci8vIEdBTUUgSUQgKHBlciBhc3NvY2lhcmUgUTEvUTIvUTMvUTQvT1QuLi4vRklOQUwpCi8vIC0gcmltYW5lIHN0YWJpbGUgcGVyIHR1dHRhIGxhIHBhcnRpdGEKLy8gLSB2aWVuZSBzY3JpdHRvIG5laSBKU09OIChtZXRhLmdhbWVJZCkgY29zw6wgaWwgVmlld2VyIHB1w7IgcmFnZ3J1cHBhcmUgaSBmaWxlCi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PQpsZXQgQ1VSUkVOVF9HQU1FX0lEID0gJyc7CmxldCBTTkFQU0hPVF9TVE9SRSA9IHsgZ2FtZUlkOicnLCBiYXNlTWV0YTp7fSwgc25hcHM6e30gfTsKCmZ1bmN0aW9uIG5vcm1Ub2tlbihzKXsKICByZXR1cm4gU3RyaW5nKHN8fCcnKQogICAgLnRyaW0oKQogICAgLnRvVXBwZXJDYXNlKCkKICAgIC5yZXBsYWNlQWxsKCfDgCcsJ0EnKS5yZXBsYWNlQWxsKCfDiCcsJ0UnKS5yZXBsYWNlQWxsKCfDiScsJ0UnKS5yZXBsYWNlQWxsKCfDjCcsJ0knKS5yZXBsYWNlQWxsKCfDkicsJ08nKS5yZXBsYWNlQWxsKCfDmScsJ1UnKQogICAgLnJlcGxhY2VBbGwoL1teQS1aMC05XSsvZywnXycpCiAgICAucmVwbGFjZUFsbCgvXysvZywnXycpCiAgICAucmVwbGFjZUFsbCgvXl8rfF8rJC9nLCcnKTsKfQoKZnVuY3Rpb24gbm9ybURhdGVJc29Gcm9tVUkoKXsKICAvLyBkYXRhR2FyYSDDqCBHRy9NTS9BQUFBIChjb21lIGRhIHBsYWNlaG9sZGVyKQogIGNvbnN0IHJhdyA9IFN0cmluZyhkYXRhR2FyYT8udmFsdWV8fCcnKS50cmltKCk7CiAgY29uc3QgbSA9IHJhdy5tYXRjaCgvXihcZHsxLDJ9KVtcLy1dKFxkezEsMn0pW1wvLV0oXGR7NH0pJC8pOwogIGlmKG0pewogICAgY29uc3QgZGQgPSBTdHJpbmcobVsxXSkucGFkU3RhcnQoMiwnMCcpOwogICAgY29uc3QgbW0gPSBTdHJpbmcobVsyXSkucGFkU3RhcnQoMiwnMCcpOwogICAgY29uc3QgeXl5eSA9IG1bM107CiAgICByZXR1cm4gYCR7eXl5eX0tJHttbX0tJHtkZH1gOwogIH0KICAvLyBmYWxsYmFjazogc2UgZ2nDoCBpbiBJU08gbyBhbHRybywgbG8gbm9ybWFsaXp6aWFtbyAiZ3JlenpvIgogIHJldHVybiByYXcgPyByYXcucmVwbGFjZUFsbCgnLycsJy0nKSA6ICcnOwp9CgpmdW5jdGlvbiBjb21wdXRlR2FtZUlkKCl7CiAgY29uc3QgY2FtcCA9IG5vcm1Ub2tlbihjYW1waW9uYXRvPy52YWx1ZXx8JycpOyAgIC8vIGVzOiBEUjIgLyBVMTQKICBjb25zdCBnaXIgID0gbm9ybVRva2VuKGdpcm9uZT8udmFsdWV8fCcnKTsgICAgICAgLy8gZXM6IEMKICBjb25zdCBpc28gID0gbm9ybURhdGVJc29Gcm9tVUkoKTsgICAgICAgICAgICAgICAgLy8gZXM6IDIwMjYtMDItMDYKICBjb25zdCBhTiAgID0gbm9ybVRva2VuKG5hbWVBPy52YWx1ZXx8J1NRVUFEUkFfQScpOwogIGNvbnN0IGJOICAgPSBub3JtVG9rZW4obmFtZUI/LnZhbHVlfHwnU1FVQURSQV9CJyk7CgogIC8vIGZvcm1hOiBDQU1QX0dJUl9ZWVlZLU1NLUREX1RFQU1fQV92c19URUFNX0IgKGdpcm9uZSBvcHppb25hbGUpCiAgY29uc3QgaGVhZCA9IFtjYW1wLCBnaXJdLmZpbHRlcihCb29sZWFuKS5qb2luKCdfJyk7CiAgY29uc3QgY29yZSA9IFtpc28sIGFOLCAnVlMnLCBiTl0uZmlsdGVyKEJvb2xlYW4pLmpvaW4oJ18nKTsKICByZXR1cm4gbm9ybVRva2VuKFtoZWFkLCBjb3JlXS5maWx0ZXIoQm9vbGVhbikuam9pbignXycpKTsKfQoKZnVuY3Rpb24gZW5zdXJlR2FtZUlkKCl7CiAgaWYoQ1VSUkVOVF9HQU1FX0lEKSByZXR1cm4gQ1VSUkVOVF9HQU1FX0lEOwogIENVUlJFTlRfR0FNRV9JRCA9IGNvbXB1dGVHYW1lSWQoKTsKICBTTkFQU0hPVF9TVE9SRSA9IHsgZ2FtZUlkOiBDVVJSRU5UX0dBTUVfSUQsIGJhc2VNZXRhOiAoZ2V0TWV0YUZyb21VST9nZXRNZXRhRnJvbVVJKCk6e30pLCBzbmFwczoge30gfTsKICByZXR1cm4gQ1VSUkVOVF9HQU1FX0lEOwp9CgpmdW5jdGlvbiByZXNldEdhbWVJZCgpewogIENVUlJFTlRfR0FNRV9JRCA9ICcnOwogIFNOQVBTSE9UX1NUT1JFID0geyBnYW1lSWQ6JycsIGJhc2VNZXRhOnt9LCBzbmFwczp7fSB9Owp9CgpmdW5jdGlvbiBtYWtlU3RhbmRhcmRGaWxlbmFtZShnYW1lSWQsIHNuYXBzaG90KXsKICBjb25zdCBzdGFtcCA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zbGljZSgwLDE5KS5yZXBsYWNlQWxsKCc6JywnLScpOwogIHJldHVybiBgJHtnYW1lSWR9X18ke1N0cmluZyhzbmFwc2hvdHx8J0ZJTkFMJykudG9VcHBlckNhc2UoKX1fXyR7c3RhbXB9Lmpzb25gOwp9CgpmdW5jdGlvbiBnZXRNZXRhRnJvbVVJKCl7CiAgY29uc3QgYU5hbWUgPSAobmFtZUEudmFsdWUgfHwgJ1NxdWFkcmEgQScpLnRyaW0oKTsKICBjb25zdCBiTmFtZSA9IChuYW1lQi52YWx1ZSB8fCAnU3F1YWRyYSBCJykudHJpbSgpOwogIGNvbnN0IGRhdGUgPSAoZGF0YUdhcmEudmFsdWUgfHwgJycpLnRyaW0oKTsKICBjb25zdCBjYW1wID0gKGNhbXBpb25hdG8udmFsdWUgfHwgJycpLnRyaW0oKTsKICBjb25zdCBvcHBvbmVudCA9IGJOYW1lOwogIGNvbnN0IGJhc2VOYW1lID0gW2NhbXAsIGRhdGUsIGAke2FOYW1lfSB2cyAke2JOYW1lfWBdLmZpbHRlcihCb29sZWFuKS5qb2luKCcg4oCiICcpOwogIHJldHVybiB7IGFOYW1lLCBiTmFtZSwgZGF0ZSwgb3Bwb25lbnQsIGRlZmF1bHROYW1lOiBiYXNlTmFtZSB8fCBgJHthTmFtZX0gdnMgJHtiTmFtZX1gIH07Cn0KZnVuY3Rpb24gcHJvbXB0R2FtZU5hbWUoZGVmYXVsdE5hbWUpewogIGNvbnN0IHJhdyA9IHByb21wdCgnTm9tZSBwYXJ0aXRhIGRhIHNhbHZhcmU6JywgZGVmYXVsdE5hbWUpOwogIGlmKHJhdyA9PT0gbnVsbCkgcmV0dXJuIG51bGw7CiAgY29uc3QgbmFtZSA9IHJhdy50cmltKCk7CiAgcmV0dXJuIG5hbWUubGVuZ3RoID8gbmFtZSA6IGRlZmF1bHROYW1lOwp9CgpmdW5jdGlvbiBzYXZlR2FtZSgpewogIGNvbnN0IGZpbmFsU2NvcmVBID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Njb3JlQScpPy50ZXh0Q29udGVudCA/PyAnMCc7CiAgY29uc3QgZmluYWxTY29yZUIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NvcmVCJyk/LnRleHRDb250ZW50ID8/ICcwJzsKCiAgc2F2ZVN0YXRlKCk7CgogIGNvbnN0IG1ldGEgPSBnZXRNZXRhRnJvbVVJKCk7CiAgY29uc3QgZ2FtZUlkID0gZW5zdXJlR2FtZUlkKCk7CiAgLy8gSW4gYWxjdW5pIHdyYXBwZXIgLmV4ZSAoV2ViVmlldy9FbGVjdHJvbikgcHJvbXB0KCkgcHXDsiBub24gZnVuemlvbmFyZTogdXNpYW1vIHVuIG5vbWUgYXV0b21hdGljbyBjb21lIHBlciBRMS9RMi9RMy9RNAogIGNvbnN0IGdhbWVOYW1lID0gbWV0YS5kZWZhdWx0TmFtZTsKCiAgc2F2ZUdhbWVUb0xpYnJhcnkoZ2FtZU5hbWUpOwoKICBjb25zdCBzdGF0ZSA9IHNuYXBzaG90U3RhdGUoKTsKICBjb25zdCBwYXlsb2FkID0gewogICAgX190eXBlOiAnYmFza2V0X3N0YXRzX2dhbWUnLAogICAgX192ZXJzaW9uOiAxLAogICAgbWV0YTogewogICAgICBpZDogbnVsbCwKICAgICAgZ2FtZUlkOiBnYW1lSWQsCiAgICAgIHNuYXBzaG90OiAnRklOQUwnLAogICAgICBuYW1lOiBnYW1lTmFtZSwKICAgICAgZGF0ZTogbWV0YS5kYXRlLAogICAgICBhTmFtZTogbWV0YS5hTmFtZSwKICAgICAgYk5hbWU6IG1ldGEuYk5hbWUsCiAgICAgIG9wcG9uZW50OiBtZXRhLm9wcG9uZW50LAogICAgICBzYXZlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgIHNjb3JlQU5hbWU6IG1ldGEuYU5hbWUsCiAgICAgIHNjb3JlQTogU3RyaW5nKGZpbmFsU2NvcmVBKSwKICAgICAgc2NvcmVCTmFtZTogbWV0YS5iTmFtZSwKICAgICAgc2NvcmVCOiBTdHJpbmcoZmluYWxTY29yZUIpLAogICAgICBzY29yZTogYCR7bWV0YS5hTmFtZX0gJHtmaW5hbFNjb3JlQX0gLSAke2ZpbmFsU2NvcmVCfSAke21ldGEuYk5hbWV9YCwKICAgICAgZmluYWxTY29yZUE6IFN0cmluZyhmaW5hbFNjb3JlQSksCiAgICAgIGZpbmFsU2NvcmVCOiBTdHJpbmcoZmluYWxTY29yZUIpLAogICAgICBmaW5hbFNjb3JlOiBgJHtmaW5hbFNjb3JlQX0tJHtmaW5hbFNjb3JlQn1gCiAgICB9LAogICAgc3RhdGUKICB9OwogIC8vIEFnZ2lvcm5hIHN0b3JlIGUgY3JlYSBGSUxFIFVOSUNPIE1BVENICiAgU05BUFNIT1RfU1RPUkUuZ2FtZUlkID0gZ2FtZUlkOwogIFNOQVBTSE9UX1NUT1JFLmJhc2VNZXRhID0gbWV0YSB8fCAoZ2V0TWV0YUZyb21VST9nZXRNZXRhRnJvbVVJKCk6e30pOwogIFNOQVBTSE9UX1NUT1JFLnNuYXBzWydGSU5BTCddID0gcGF5bG9hZDsKCiAgY29uc3QgYnVuZGxlID0gewogICAgX190eXBlOiAnYmFza2V0X3N0YXRzX21hdGNoJywKICAgIF9fdmVyc2lvbjogMSwKICAgIG1ldGE6IHsKICAgICAgZ2FtZUlkOiBnYW1lSWQsCiAgICAgIGFOYW1lOiBtZXRhLmFOYW1lLAogICAgICBiTmFtZTogbWV0YS5iTmFtZSwKICAgICAgc2NvcmVBOiBTdHJpbmcoZmluYWxTY29yZUEpLAogICAgICBzY29yZUI6IFN0cmluZyhmaW5hbFNjb3JlQiksCiAgICAgIHRpdGxlOiBgJHttZXRhLmFOYW1lIHx8ICdTcXVhZHJhIEEnfSB2cyAke21ldGEuYk5hbWUgfHwgJ1NxdWFkcmEgQid9YCwKICAgICAgZGF0ZTogbWV0YS5kYXRlIHx8IG1ldGEuZGF0YSB8fCAnJywKICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkKICAgIH0sCiAgICBzbmFwc2hvdHM6IFNOQVBTSE9UX1NUT1JFLnNuYXBzCiAgfTsKCiAgY29uc3QganNvbiA9IEpTT04uc3RyaW5naWZ5KGJ1bmRsZSwgbnVsbCwgMik7CiAgY29uc3QgZmlsZW5hbWUgPSBtYWtlU3RhbmRhcmRGaWxlbmFtZShnYW1lSWQsICdNQVRDSCcpOwoKICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2pzb25dLCB7IHR5cGU6ICdhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnIH0pOwogIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7CgogIGNvbnN0IGxpbmsgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgbGluay5ocmVmID0gdXJsOwogIGxpbmsuZG93bmxvYWQgPSBmaWxlbmFtZTsKICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGxpbmspOwogIGxpbmsuY2xpY2soKTsKICBsaW5rLnJlbW92ZSgpOwogIFVSTC5yZXZva2VPYmplY3RVUkwodXJsKTsKCiAgdW5kb0luZm8udGV4dENvbnRlbnQgPSAnU2FsdmF0byBmaWxlIHVuaWNvOiAnICsgZmlsZW5hbWU7CiAgdXBkYXRlU2lkZVdpZHRoKCk7Cn0KCmZ1bmN0aW9uIG5ld0dhbWUoKXsKICBzdG9wQ2xvY2soKTsKICByZXNldEdhbWVJZCgpOwogIGdhbWVDbG9zZWQgPSBmYWxzZTsKc2NvcmVBZGogPSB7QTowLEI6MH07CgogIHBlcmlvZFNuYXBzaG90cyA9IHt9OwogIHN0YXRzVmlldyA9IHsgbW9kZTondG90YWwnLCBsYWJlbDpudWxsLCBBOm51bGwsIEI6bnVsbCB9OwoKICBjb25zdCBrZWVwTmFtZUEgPSBuYW1lQS52YWx1ZTsKICBjb25zdCBrZWVwUm9zdGVyQSA9IHBsYXllcnNBLm1hcChwID0+ICh7IG5hbWU6IHAubmFtZSwgbnVtOiBwLm51bSB9KSk7CgogIGN1cnJlbnRRdWFydGVyID0gMTsKICBsYXN0U2NvcmVBID0gMDsKICBsYXN0U2NvcmVCID0gMDsKICBzZWMgPSBRVUFSVEVSX0xFTjsKCiAgZm9yKGNvbnN0IGsgb2YgWydxMWEnLCdxMWInLCdxMmEnLCdxMmInLCdxM2EnLCdxM2InLCdxNGEnLCdxNGInXSl7CiAgICBjb25zdCBlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGspOwogICAgaWYoZWwpIGVsLnRleHRDb250ZW50ID0gJ+KAlCc7CiAgfQogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdFJvd3MnKS5pbm5lckhUTUwgPSAnJzsKCiAgdGVhbUEgPSB7IHBwOjAsIHByOjAsIHRvOjAsIGZ0czowIH07CiAgdGVhbUIgPSB7IHBwOjAsIHByOjAsIHRvOjAsIGZ0czowIH07CgogIHBsYXllcnNBID0gbm9ybWFsaXplUGxheWVycygKICAgIGtlZXBSb3N0ZXJBLm1hcCgocCk9PiBtYWtlUGxheWVyKHAubmFtZSB8fCAnQScsIHAubnVtKSksCiAgICAxMiwKICAgICdBJwogICk7CiAgcGxheWVyc0EuZm9yRWFjaChwPT4geyBwLmluID0gZmFsc2U7IHAuZXhwZWxsZWQgPSBmYWxzZTsgcC5mZiA9IDA7IH0pOwogIHBsYXllcnNBWzBdLmluID0gdHJ1ZTsKCiAgbmFtZUIudmFsdWUgPSAnU3F1YWRyYSBCJzsKICBwbGF5ZXJzQiA9IG5vcm1hbGl6ZVBsYXllcnMoW10sIDEyLCAnQicpOwogIHBsYXllcnNCLmZvckVhY2gocD0+IHsgcC5pbiA9IGZhbHNlOyBwLmV4cGVsbGVkID0gZmFsc2U7IHAuZmYgPSAwOyB9KTsKCiAgbmFtZUEudmFsdWUgPSBrZWVwTmFtZUE7CgogIHVuZG9TdGFjayA9IFtdOwogIHVuZG9JbmZvLnRleHRDb250ZW50ID0gJ+KAlCc7CgogIHJlbmRlcigpOwp9CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgUExVUy9NSU5VUwo9PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KZnVuY3Rpb24gYXBwbHlQbHVzTWludXMoc2NvcmluZ1NpZGUsIHB0c0RlbHRhKXsKICBpZihzY29yaW5nU2lkZSA9PT0gJ0EnKXsKICAgIHBsYXllcnNBLmZvckVhY2gocD0+eyBpZihwLmluKSBwLnBtID0gKHAucG18fDApICsgcHRzRGVsdGE7IH0pOwogICAgcGxheWVyc0IuZm9yRWFjaChwPT57IGlmKHAuaW4pIHAucG0gPSAocC5wbXx8MCkgLSBwdHNEZWx0YTsgfSk7CiAgfSBlbHNlIHsKICAgIHBsYXllcnNCLmZvckVhY2gocD0+eyBpZihwLmluKSBwLnBtID0gKHAucG18fDApICsgcHRzRGVsdGE7IH0pOwogICAgcGxheWVyc0EuZm9yRWFjaChwPT57IGlmKHAuaW4pIHAucG0gPSAocC5wbXx8MCkgLSBwdHNEZWx0YTsgfSk7CiAgfQp9CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgRURJVAo9PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KZnVuY3Rpb24gc2V0UGxheWVyTmFtZShzaWRlLCBpLCB2YWwpewogIGNvbnN0IHAgPSBnZXRQbGF5ZXJzKHNpZGUpW2ldOyBpZighcCkgcmV0dXJuOwogIHAubmFtZSA9ICh2YWwgPz8gJycpLnRvU3RyaW5nKCk7CiAgc2F2ZVN0YXRlKCk7Cn0KZnVuY3Rpb24gc2V0UGxheWVyTnVtKHNpZGUsIGksIHZhbCl7CiAgY29uc3QgcCA9IGdldFBsYXllcnMoc2lkZSlbaV07IGlmKCFwKSByZXR1cm47CiAgbGV0IG4gPSBOdW1iZXIodmFsKTsKICBpZighTnVtYmVyLmlzRmluaXRlKG4pKSBuID0gMDsKICBuID0gTWF0aC5tYXgoMCwgTWF0aC5taW4oOTksIE1hdGguZmxvb3IoTnVtYmVyKG4pKSkpOwogIHAubnVtID0gbjsKICBzYXZlU3RhdGUoKTsKfQpmdW5jdGlvbiB0b2dnbGVJbihzaWRlLCBpKXsKICBjb25zdCBwID0gZ2V0UGxheWVycyhzaWRlKVtpXTsgaWYoIXApIHJldHVybjsKICBpZihpc0xvY2tlZChwKSkgcmV0dXJuOwogIGlmKCFwLmluICYmIGNvdW50SW4oc2lkZSkgPj0gTUFYX09OX0NPVVJUKXsKICAgIHdhcm5NYXhJbihzaWRlKTsKICAgIHJldHVybjsKICB9CiAgcC5pbiA9ICFwLmluOwogIHJlbmRlcigpOwp9CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgVEVBTSBTVEFUUwo9PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KCi8vIEZhbGxpIGRpIHNxdWFkcmEgcmFwaWRpICgrLy0pIHVzYW5kbyBGdXJibwpmdW5jdGlvbiBhZGpUZWFtRm91bHMoc2lkZSwgZGVsdGEpewogIGlmKGdhbWVDbG9zZWQpIHJldHVybjsKICBjb25zdCB0ID0gZ2V0VGVhbShzaWRlKTsKICBjb25zdCBvbGQgPSB0LmZ0cyB8fCAwOwogIGNvbnN0IGQgPSAobWludXNNb2RlID8gLWRlbHRhIDogZGVsdGEpOwogIGlmKG9sZCArIGQgPCAwKSByZXR1cm47CgogIHNhdmUoYEZhbGxpIHNxdWFkcmEgJHtzaWRlfSAke2Q+MD8nKyc6Jyd9JHtkfWAsICgpPT57CiAgICB0LmZ0cyA9IG9sZDsKICB9KTsKICB0LmZ0cyA9IG9sZCArIGQ7CiAgcmVuZGVyKCk7Cn0KCmZ1bmN0aW9uIHRlYW1TdGF0KHNpZGUsIGtleSl7CiAgY29uc3QgdCA9IGdldFRlYW0oc2lkZSk7CiAgY29uc3QgZGVsdGEgPSBtaW51c01vZGUgPyAtMSA6IDE7CiAgY29uc3Qgb2xkID0gdFtrZXldIHx8IDA7CiAgaWYob2xkICsgZGVsdGEgPCAwKSByZXR1cm47CgogIHNhdmUoYFNxdWFkcmEgJHtzaWRlfSAke2tleX1gLCAoKT0+IHRba2V5XSA9IG9sZCk7CiAgdFtrZXldID0gb2xkICsgZGVsdGE7CgogIGNsZWFyTWludXMoKTsKICByZW5kZXIoKTsKfQpmdW5jdGlvbiB0ZWFtVGltZW91dChzaWRlKXsKICBjb25zdCB0ID0gZ2V0VGVhbShzaWRlKTsKICBjb25zdCBtYXggPSBtYXhUaW1lb3V0cygpOwogIGNvbnN0IGRlbHRhID0gbWludXNNb2RlID8gLTEgOiAxOwogIGNvbnN0IG9sZCA9IHQudG8gfHwgMDsKCiAgaWYob2xkICsgZGVsdGEgPCAwKSByZXR1cm47CiAgaWYoZGVsdGEgPiAwICYmIG9sZCA+PSBtYXgpIHJldHVybjsKCiAgc2F2ZShgVGltZW91dCBzcXVhZHJhICR7c2lkZX1gLCAoKT0+IHQudG8gPSBvbGQpOwogIHQudG8gPSBvbGQgKyBkZWx0YTsKCiAgY2xlYXJNaW51cygpOwogIHJlbmRlcigpOwp9CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgUExBWUVSIFNUQVRTCj09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwpmdW5jdGlvbiBhZGRTdGF0KHNpZGUsIGksIHMsIHYpewogIGlmKCFjYW4oc2lkZSxpKSkgcmV0dXJuOwoKICBjb25zdCBhcnIgPSBnZXRQbGF5ZXJzKHNpZGUpOwogIGNvbnN0IHQgPSBnZXRUZWFtKHNpZGUpOwogIGNvbnN0IHAgPSBhcnJbaV07CgogIGNvbnN0IGRlbHRhID0gbWludXNNb2RlID8gLXYgOiB2OwogIGlmKChwW3NdID8/IDApICsgZGVsdGEgPCAwKSByZXR1cm47CgogIGlmKHMgPT09ICdmZicpewogICAgY29uc3Qgb2xkRkYgPSBwLmZmOwogICAgY29uc3Qgb2xkRlRTID0gdC5mdHMgfHwgMDsKICAgIGNvbnN0IG9sZEluID0gISFwLmluOwoKICAgIGlmKGRlbHRhIDwgMCAmJiBvbGRGRiA8PSAwKSByZXR1cm47CgogICAgc2F2ZShgJHtzaWRlfSAke3AubmFtZX0gZmZgLCAoKT0+ewogICAgICBwLmZmID0gb2xkRkY7CiAgICAgIHQuZnRzID0gb2xkRlRTOwogICAgICBwLmluID0gb2xkSW47CiAgICB9KTsKCiAgICBwLmZmID0gb2xkRkYgKyBkZWx0YTsKICAgIHQuZnRzID0gTWF0aC5tYXgoMCwgb2xkRlRTICsgZGVsdGEpOwoKICAgIGlmKHAuZmYgPj0gNSkgcC5pbiA9IGZhbHNlOwoKICAgIGNsZWFyTWludXMoKTsKICAgIHJlbmRlcigpOwogICAgcmV0dXJuOwogIH0KCiAgY29uc3Qgb2xkID0gcFtzXTsKICBzYXZlKGAke3NpZGV9ICR7cC5uYW1lfSAke3N9YCwgKCk9PiBwW3NdID0gb2xkKTsKICBwW3NdID0gb2xkICsgZGVsdGE7CgogIGNsZWFyTWludXMoKTsKICByZW5kZXIoKTsKfQoKZnVuY3Rpb24gZG9TaG90KHNpZGUsIGksIHRLZXksIHB0cywgb2spewogIGlmKCFjYW4oc2lkZSxpKSkgcmV0dXJuOwogIGNvbnN0IHAgPSBnZXRQbGF5ZXJzKHNpZGUpW2ldOwoKICBjb25zdCBzbmFwU2hvb3RlciA9IEpTT04uc3RyaW5naWZ5KHApOwogIGNvbnN0IHBtQSA9IHBsYXllcnNBLm1hcCh4PT54LnBtfHwwKTsKICBjb25zdCBwbUIgPSBwbGF5ZXJzQi5tYXAoeD0+eC5wbXx8MCk7CgogIHNhdmUoYCR7c2lkZX0gJHtwLm5hbWV9ICR7dEtleX1gLCAoKT0+ewogICAgZ2V0UGxheWVycyhzaWRlKVtpXSA9IEpTT04ucGFyc2Uoc25hcFNob290ZXIpOwogICAgcGxheWVyc0EuZm9yRWFjaCgoeCwgaWR4KT0+IHgucG0gPSBwbUFbaWR4XSB8fCAwKTsKICAgIHBsYXllcnNCLmZvckVhY2goKHgsIGlkeCk9PiB4LnBtID0gcG1CW2lkeF0gfHwgMCk7CiAgfSk7CgogIGlmKCFtaW51c01vZGUpewogICAgcFt0S2V5XS5hdHQrKzsKICAgIGlmKG9rKXsKICAgICAgcFt0S2V5XS5tYWRlKys7CiAgICAgIHAucHRzICs9IHB0czsKICAgICAgYXBwbHlQbHVzTWludXMoc2lkZSwgcHRzKTsKICAgIH0KICAgIHJlbmRlcigpOwogICAgcmV0dXJuOwogIH0KCiAgaWYocFt0S2V5XS5hdHQgPD0gMCkgcmV0dXJuOwoKICBpZihvayl7CiAgICBpZihwW3RLZXldLm1hZGUgPD0gMCkgcmV0dXJuOwogICAgaWYocC5wdHMgLSBwdHMgPCAwKSByZXR1cm47CiAgICBwW3RLZXldLm1hZGUtLTsKICAgIHAucHRzIC09IHB0czsKICAgIGFwcGx5UGx1c01pbnVzKHNpZGUsIC1wdHMpOwogIH0KICBwW3RLZXldLmF0dC0tOwoKICBjbGVhck1pbnVzKCk7CiAgcmVuZGVyKCk7Cn0KCmZ1bmN0aW9uIHNob3Qoc2lkZSwgaSwgdEtleSwgcHRzKXsKICBjb25zdCBwID0gZ2V0UGxheWVycyhzaWRlKVtpXTsKICByZXR1cm4gYDxkaXYgY2xhc3M9InNob3QiPgogICAgPHNwYW4+JHtwW3RLZXldLm1hZGV9LyR7cFt0S2V5XS5hdHR9PC9zcGFuPgogICAgPGJ1dHRvbiBjbGFzcz0iZ3JlZW4iIG9uY2xpY2s9ImRvU2hvdCgnJHtzaWRlfScsJHtpfSwnJHt0S2V5fScsJHtwdHN9LDEpIj4rPC9idXR0b24+CiAgICA8YnV0dG9uIGNsYXNzPSJyZWQiIG9uY2xpY2s9ImRvU2hvdCgnJHtzaWRlfScsJHtpfSwnJHt0S2V5fScsJHtwdHN9LDApIj4tPC9idXR0b24+CiAgPC9kaXY+YDsKfQoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgIFNUQVRTIFNPTE8gUEVSSU9ETyAoRGVsdGEpCj09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwpmdW5jdGlvbiBkZWVwQ29weShvYmopewogIHRyeXsgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob2JqKSk7IH1jYXRjaChlKXsgcmV0dXJuIG9iajsgfQp9CmZ1bmN0aW9uIHBlcmlvZEtleUZyb21OdW1iZXIocSl7CiAgaWYocSA8PSA0KSByZXR1cm4gYFEke3F9YDsKICByZXR1cm4gYE9UJHtxLTR9YDsKfQpmdW5jdGlvbiBzdG9yZVBlcmlvZFNuYXBzaG90KGVuZGVkUXVhcnRlcil7CiAgY29uc3QgcSA9ICh0eXBlb2YgZW5kZWRRdWFydGVyID09PSAnbnVtYmVyJyAmJiBlbmRlZFF1YXJ0ZXIgPiAwKSA/IGVuZGVkUXVhcnRlciA6IGN1cnJlbnRRdWFydGVyOwogIGNvbnN0IGtleSA9IHBlcmlvZEtleUZyb21OdW1iZXIocSk7CiAgLy8gc25hcHNob3QgQ1VNVUxBVElWTyBhIGZpbmUgcGVyaW9kbwogIHBlcmlvZFNuYXBzaG90c1trZXldID0gewogICAgcGxheWVyc0E6IGRlZXBDb3B5KHBsYXllcnNBKSwKICAgIHBsYXllcnNCOiBkZWVwQ29weShwbGF5ZXJzQikKICB9OwogIC8vIHB1bGl6aWEgZXZlbnR1YWxpIGNoaWF2aSBzdHJhbmUKICB0cnl7CiAgICBPYmplY3Qua2V5cyhwZXJpb2RTbmFwc2hvdHMpLmZvckVhY2goaz0+ewogICAgICBpZighL15RWzEtNF0kLy50ZXN0KGspICYmICEvXk9UXGQrJC8udGVzdChrKSkgZGVsZXRlIHBlcmlvZFNuYXBzaG90c1trXTsKICAgIH0pOwogIH1jYXRjaChlKXt9CiAgc2F2ZVN0YXRlKCk7Cn0KCmZ1bmN0aW9uIGVtcHR5UGxheWVyc0xpa2UoYXJyKXsKICByZXR1cm4gKGFycnx8W10pLm1hcChwPT57CiAgICByZXR1cm4gewogICAgICBuYW1lOiBwPy5uYW1lIHx8ICcnLAogICAgICBudW06IE51bWJlcihwPy5udW18fDApLAogICAgICBwdHM6MCwgZmY6MCwgbWluOjAsIHBtOjAsCiAgICAgICcycHQnOnttYWRlOjAsYXR0OjB9LAogICAgICAnM3B0Jzp7bWFkZTowLGF0dDowfSwKICAgICAgdGw6e21hZGU6MCxhdHQ6MH0sCiAgICAgIGZzOjAsIHJhOjAsIHJkOjAsIGE6MCwgcHA6MCwgcHI6MCwgc3RmOjAsIHN0czowLAogICAgICBpbjpmYWxzZSwgZXhwZWxsZWQ6ZmFsc2UKICAgIH07CiAgfSk7Cn0KZnVuY3Rpb24gZGlmZlBsYXllcnMoZW5kQXJyLCBwcmV2QXJyKXsKICBjb25zdCBvdXQgPSBbXTsKICBjb25zdCBhID0gQXJyYXkuaXNBcnJheShlbmRBcnIpID8gZW5kQXJyIDogW107CiAgY29uc3QgYiA9IEFycmF5LmlzQXJyYXkocHJldkFycikgPyBwcmV2QXJyIDogW107CiAgY29uc3QgbiA9IE1hdGgubWF4KGEubGVuZ3RoLCBiLmxlbmd0aCk7CgogIGZvcihsZXQgaT0wO2k8bjtpKyspewogICAgY29uc3QgZSA9IGFbaV0gfHwge307CiAgICBjb25zdCBwID0gYltpXSB8fCB7fTsKCiAgICBjb25zdCBkcCA9IHsKICAgICAgbmFtZTogZS5uYW1lIHx8IHAubmFtZSB8fCAnJywKICAgICAgbnVtOiBOdW1iZXIoZS5udW0gPz8gcC5udW0gPz8gMCksCiAgICAgIHB0czogTWF0aC5tYXgoMCwgKE51bWJlcihlLnB0cyl8fDApIC0gKE51bWJlcihwLnB0cyl8fDApKSwKICAgICAgZmY6ICBNYXRoLm1heCgwLCAoTnVtYmVyKGUuZmYpfHwwKSAgLSAoTnVtYmVyKHAuZmYpfHwwKSksCiAgICAgIG1pbjogTWF0aC5tYXgoMCwgKE51bWJlcihlLm1pbil8fDApIC0gKE51bWJlcihwLm1pbil8fDApKSwKICAgICAgcG06ICAoTnVtYmVyKGUucG0pfHwwKSAgLSAoTnVtYmVyKHAucG0pfHwwKSwKCiAgICAgICcycHQnOnsKICAgICAgICBtYWRlOiBNYXRoLm1heCgwLCAoTnVtYmVyKGVbJzJwdCddPy5tYWRlKXx8MCkgLSAoTnVtYmVyKHBbJzJwdCddPy5tYWRlKXx8MCkpLAogICAgICAgIGF0dDogIE1hdGgubWF4KDAsIChOdW1iZXIoZVsnMnB0J10/LmF0dCl8fDApICAtIChOdW1iZXIocFsnMnB0J10/LmF0dCl8fDApKQogICAgICB9LAogICAgICAnM3B0Jzp7CiAgICAgICAgbWFkZTogTWF0aC5tYXgoMCwgKE51bWJlcihlWyczcHQnXT8ubWFkZSl8fDApIC0gKE51bWJlcihwWyczcHQnXT8ubWFkZSl8fDApKSwKICAgICAgICBhdHQ6ICBNYXRoLm1heCgwLCAoTnVtYmVyKGVbJzNwdCddPy5hdHQpfHwwKSAgLSAoTnVtYmVyKHBbJzNwdCddPy5hdHQpfHwwKSkKICAgICAgfSwKICAgICAgdGw6ewogICAgICAgIG1hZGU6IE1hdGgubWF4KDAsIChOdW1iZXIoZS50bD8ubWFkZSl8fDApIC0gKE51bWJlcihwLnRsPy5tYWRlKXx8MCkpLAogICAgICAgIGF0dDogIE1hdGgubWF4KDAsIChOdW1iZXIoZS50bD8uYXR0KXx8MCkgIC0gKE51bWJlcihwLnRsPy5hdHQpfHwwKSkKICAgICAgfSwKCiAgICAgIGZzOiAgTWF0aC5tYXgoMCwgKE51bWJlcihlLmZzKXx8MCkgIC0gKE51bWJlcihwLmZzKXx8MCkpLAogICAgICByYTogIE1hdGgubWF4KDAsIChOdW1iZXIoZS5yYSl8fDApICAtIChOdW1iZXIocC5yYSl8fDApKSwKICAgICAgcmQ6ICBNYXRoLm1heCgwLCAoTnVtYmVyKGUucmQpfHwwKSAgLSAoTnVtYmVyKHAucmQpfHwwKSksCiAgICAgIGE6ICAgTWF0aC5tYXgoMCwgKE51bWJlcihlLmEpfHwwKSAgIC0gKE51bWJlcihwLmEpfHwwKSksCiAgICAgIHBwOiAgTWF0aC5tYXgoMCwgKE51bWJlcihlLnBwKXx8MCkgIC0gKE51bWJlcihwLnBwKXx8MCkpLAogICAgICBwcjogIE1hdGgubWF4KDAsIChOdW1iZXIoZS5wcil8fDApICAtIChOdW1iZXIocC5wcil8fDApKSwKICAgICAgc3RmOiBNYXRoLm1heCgwLCAoTnVtYmVyKGUuc3RmKXx8MCkgLSAoTnVtYmVyKHAuc3RmKXx8MCkpLAogICAgICBzdHM6IE1hdGgubWF4KDAsIChOdW1iZXIoZS5zdHMpfHwwKSAtIChOdW1iZXIocC5zdHMpfHwwKSksCiAgICAgIGluOmZhbHNlLCBleHBlbGxlZDpmYWxzZQogICAgfTsKICAgIG91dC5wdXNoKGRwKTsKICB9CiAgcmV0dXJuIG91dDsKfQoKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PQogICBNT0RBTEUgU1RBVFM6IHNjZWdsaSBwZXJpb2RvIChubyBwcm9tcHQpCj09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwpmdW5jdGlvbiBhc2tTdGF0c1BlcmlvZChhdmFpbCwgZGVmYXVsdEtleSl7CiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKT0+ewogICAgY29uc3Qgb3YgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGVyaW9kUGlja092ZXJsYXknKTsKICAgIGNvbnN0IHNlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwZXJpb2RQaWNrU2VsZWN0Jyk7CiAgICBjb25zdCBvayAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGVyaW9kUGlja09rJyk7CiAgICBjb25zdCBjYyAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGVyaW9kUGlja0NhbmNlbCcpOwoKICAgIGlmKCFvdiB8fCAhc2VsIHx8ICFvayB8fCAhY2MpewogICAgICByZXNvbHZlKG51bGwpOwogICAgICByZXR1cm47CiAgICB9CgogICAgbGV0IGRvbmUgPSBmYWxzZTsKCiAgICBjb25zdCBjbGVhbnVwID0gKCk9PnsKICAgICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIG9uS2V5KTsKICAgICAgb2sucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbk9rKTsKICAgICAgY2MucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNhbmNlbCk7CiAgICAgIG92LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25CYWNrZHJvcCk7CiAgICB9OwoKICAgIGNvbnN0IGNsb3NlID0gKHZhbCk9PnsKICAgICAgaWYoZG9uZSkgcmV0dXJuOwogICAgICBkb25lID0gdHJ1ZTsKICAgICAgY2xlYW51cCgpOwogICAgICBvdi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICByZXNvbHZlKHZhbCk7CiAgICB9OwoKICAgIGNvbnN0IG9uT2sgPSAoKT0+IGNsb3NlKHNlbC52YWx1ZSB8fCBudWxsKTsKICAgIGNvbnN0IG9uQ2FuY2VsID0gKCk9PiBjbG9zZShudWxsKTsKICAgIGNvbnN0IG9uQmFja2Ryb3AgPSAoZSk9PnsgaWYoZS50YXJnZXQgPT09IG92KSBjbG9zZShudWxsKTsgfTsKICAgIGNvbnN0IG9uS2V5ID0gKGUpPT57CiAgICAgIGlmKGUua2V5ID09PSAnRXNjYXBlJykgY2xvc2UobnVsbCk7CiAgICAgIGlmKGUua2V5ID09PSAnRW50ZXInKXsgZS5wcmV2ZW50RGVmYXVsdCgpOyBvbk9rKCk7IH0KICAgIH07CgogICAgc2VsLmlubmVySFRNTCA9ICcnOwogICAgKGF2YWlsIHx8IFtdKS5mb3JFYWNoKGs9PnsKICAgICAgY29uc3Qgb3B0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7CiAgICAgIG9wdC52YWx1ZSA9IGs7CiAgICAgIG9wdC50ZXh0Q29udGVudCA9IGs7CiAgICAgIHNlbC5hcHBlbmRDaGlsZChvcHQpOwogICAgfSk7CgogICAgY29uc3QgcGljayA9IChkZWZhdWx0S2V5ICYmIGF2YWlsLmluY2x1ZGVzKGRlZmF1bHRLZXkpKSA/IGRlZmF1bHRLZXkgOiAoYXZhaWxbYXZhaWwubGVuZ3RoLTFdIHx8ICcnKTsKICAgIHNlbC52YWx1ZSA9IHBpY2s7CgogICAgb3Yuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgIHNldFRpbWVvdXQoKCk9PnsgdHJ5eyBzZWwuZm9jdXMoKTsgfWNhdGNoKGUpe30gfSwgMCk7CgogICAgb2suYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbk9rKTsKICAgIGNjLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25DYW5jZWwpOwogICAgb3YuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkJhY2tkcm9wKTsKICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBvbktleSk7CiAgfSk7Cn0KCmZ1bmN0aW9uIGxpc3RBdmFpbGFibGVQZXJpb2RzKCl7CgogIGNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyhwZXJpb2RTbmFwc2hvdHMgfHwge30pOwogIGNvbnN0IHNvcnRlciA9IChrKT0+ewogICAgaWYoL15RWzEtNF0kLy50ZXN0KGspKSByZXR1cm4gMTAwICsgTnVtYmVyKGsuc2xpY2UoMSkpOwogICAgaWYoL15PVFxkKyQvLnRlc3QoaykpIHJldHVybiAyMDAgKyBOdW1iZXIoay5zbGljZSgyKSk7CiAgICByZXR1cm4gOTk5OTsKICB9OwogIHJldHVybiBrZXlzLnNvcnQoKHgseSk9PiBzb3J0ZXIoeCktc29ydGVyKHkpKTsKfQoKZnVuY3Rpb24gbm9ybWFsaXplUGVyaW9kSW5wdXQocmF3KXsKICBjb25zdCBzID0gU3RyaW5nKHJhd3x8JycpLnRyaW0oKS50b1VwcGVyQ2FzZSgpLnJlcGxhY2VBbGwoJyAnLCcnKTsKICBpZighcykgcmV0dXJuIG51bGw7CiAgaWYoL15RWzEtNF0kLy50ZXN0KHMpKSByZXR1cm4gczsKICBpZigvXlsxLTRdJC8udGVzdChzKSkgcmV0dXJuIGBRJHtzfWA7CiAgY29uc3QgbSA9IHMubWF0Y2goL15PVChcZCspJC8pOwogIGlmKG0pIHJldHVybiBgT1Qke051bWJlcihtWzFdKX1gOwogIHJldHVybiBudWxsOwp9CgpmdW5jdGlvbiBwcmV2UGVyaW9kS2V5KGtleSl7CiAgaWYoIWtleSkgcmV0dXJuIG51bGw7CiAgaWYoL15RWzItNF0kLy50ZXN0KGtleSkpIHJldHVybiBgUSR7TnVtYmVyKGtleS5zbGljZSgxKSktMX1gOwogIGlmKGtleSA9PT0gJ1ExJykgcmV0dXJuIG51bGw7CiAgaWYoL15PVFxkKyQvLnRlc3Qoa2V5KSl7CiAgICBjb25zdCBuID0gTnVtYmVyKGtleS5zbGljZSgyKSk7CiAgICBpZihuIDw9IDEpIHJldHVybiAnUTQnOwogICAgcmV0dXJuIGBPVCR7bi0xfWA7CiAgfQogIHJldHVybiBudWxsOwp9Cgphc3luYyBmdW5jdGlvbiBzaG93UXVhcnRlclN0YXRzKCl7CiAgY29uc3QgYXZhaWwgPSBsaXN0QXZhaWxhYmxlUGVyaW9kcygpOwogIGlmKCFhdmFpbC5sZW5ndGgpewogICAgYWxlcnQoJ05lc3N1biBwZXJpb2RvIHNhbHZhdG8gYW5jb3JhLlxuXG5Ob3RhOiBpIGRlbHRhIHZlbmdvbm8gbWVtb3JpenphdGkgYXV0b21hdGljYW1lbnRlIGEgZmluZSBwZXJpb2RvIChxdWFuZG8gaWwgdGVtcG8gYXJyaXZhIGEgMCBvIHF1YW5kbyBwYXNzaSBwZXJpb2RvKS4nKTsKICAgIHJldHVybjsKICB9CgogIGNvbnN0IGhpbnQgPSBhdmFpbC5qb2luKCcsICcpOwogIGNvbnN0IHBpY2tlZCA9IGF3YWl0IGFza1N0YXRzUGVyaW9kKGF2YWlsLCBhdmFpbFthdmFpbC5sZW5ndGgtMV0pOwogIGlmKHBpY2tlZCA9PT0gbnVsbCkgcmV0dXJuOwoKICBjb25zdCBrZXlSYXcgPSBTdHJpbmcocGlja2VkfHwnJykudHJpbSgpLnRvVXBwZXJDYXNlKCk7CiAgY29uc3Qga2V5ID0gbm9ybWFsaXplUGVyaW9kSW5wdXQoa2V5UmF3KSB8fCAoKC9eUVsxLTRdJC8udGVzdChrZXlSYXcpIHx8IC9eT1RcZCskLy50ZXN0KGtleVJhdykpID8ga2V5UmF3IDogbnVsbCk7CiAgaWYoIWtleSl7CiAgICBhbGVydCgnUGVyaW9kbyBub24gdmFsaWRvLiBVc2EgUTEuLlE0IG9wcHVyZSBPVDEsIE9UMi4uLicpOwogICAgcmV0dXJuOwogIH0KICBjb25zdCBzbmFwRW5kID0gcGVyaW9kU25hcHNob3RzPy5ba2V5XTsKICBpZighc25hcEVuZCl7CiAgICBhbGVydChgTm9uIGhvIGxvIHNuYXBzaG90IHBlciAke2tleX0uIERpc3BvbmliaWxpOiAke2hpbnR9YCk7CiAgICByZXR1cm47CiAgfQogIGNvbnN0IHByZXZLZXkgPSBwcmV2UGVyaW9kS2V5KGtleSk7CiAgY29uc3Qgc25hcFByZXYgPSBwcmV2S2V5ID8gcGVyaW9kU25hcHNob3RzPy5bcHJldktleV0gOiBudWxsOwoKICBjb25zdCBlbmRBID0gc25hcEVuZC5wbGF5ZXJzQTsKICBjb25zdCBlbmRCID0gc25hcEVuZC5wbGF5ZXJzQjsKICBjb25zdCBwcmV2QSA9IHNuYXBQcmV2Py5wbGF5ZXJzQSB8fCBlbXB0eVBsYXllcnNMaWtlKGVuZEEpOwogIGNvbnN0IHByZXZCID0gc25hcFByZXY/LnBsYXllcnNCIHx8IGVtcHR5UGxheWVyc0xpa2UoZW5kQik7CgogIHN0YXRzVmlldyA9IHsKICAgIG1vZGU6J3BlcmlvZCcsCiAgICBsYWJlbDprZXksCiAgICBBOiBkaWZmUGxheWVycyhlbmRBLCBwcmV2QSksCiAgICBCOiBkaWZmUGxheWVycyhlbmRCLCBwcmV2QikKICB9OwoKICB0cnl7IHJlbmRlclN0YXRzKCk7IH1jYXRjaChlKXsgY29uc29sZS5lcnJvcihlKTsgfQp9CgpmdW5jdGlvbiBzaG93VG90YWxTdGF0cygpewogIHN0YXRzVmlldyA9IHsgbW9kZTondG90YWwnLCBsYWJlbDpudWxsLCBBOm51bGwsIEI6bnVsbCB9OwogIHRyeXsgcmVuZGVyU3RhdHMoKTsgfWNhdGNoKGUpeyBjb25zb2xlLmVycm9yKGUpOyB9Cn0KCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PQogICBRVUFSVE8gLyBPVAo9PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KZnVuY3Rpb24gZmluYWxpemVQZXJpb2RBbmRBZHZhbmNlKCl7CiAgLy8gU2FsdmEgcGFyemlhbGUgZGVsIHBlcmlvZG8gY29ycmVudGUgKFExLi5RNCAvIE9UKSBlIHByZXBhcmEgaWwgcHJvc3NpbW8gcGVyaW9kbwogIGNvbnN0IGEgPSBOdW1iZXIoc2NvcmVBLnRleHRDb250ZW50KSAtIGxhc3RTY29yZUE7CiAgY29uc3QgYiA9IE51bWJlcihzY29yZUIudGV4dENvbnRlbnQpIC0gbGFzdFNjb3JlQjsKCiAgaWYoY3VycmVudFF1YXJ0ZXIgPD0gNCl7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgcSR7Y3VycmVudFF1YXJ0ZXJ9YWApLnRleHRDb250ZW50ID0gYTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBxJHtjdXJyZW50UXVhcnRlcn1iYCkudGV4dENvbnRlbnQgPSBiOwogIH0gZWxzZSB7CiAgICBjb25zdCBvdEluZGV4ID0gY3VycmVudFF1YXJ0ZXIgLSA0OwogICAgZW5zdXJlT3RSb3cob3RJbmRleCk7CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgb3Qke290SW5kZXh9YWApLnRleHRDb250ZW50ID0gYTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGBvdCR7b3RJbmRleH1iYCkudGV4dENvbnRlbnQgPSBiOwogIH0KCiAgbGFzdFNjb3JlQSArPSBhOwogIGxhc3RTY29yZUIgKz0gYjsKCiAgLy8gbWVtb3JpenphIHNuYXBzaG90IGN1bXVsYXRpdm8gZGkgZmluZSBwZXJpb2RvIChwZXIgdmVkZXJlIGxlIHN0YXRzICdzb2xvIHF1YXJ0bycpCiAgdHJ5eyBzdG9yZVBlcmlvZFNuYXBzaG90KGN1cnJlbnRRdWFydGVyKTsgfWNhdGNoKGUpe30KCiAgLy8gRmluZSBwYXJ0aXRhOiBzZSB0ZXJtaW5hIFE0IG8gdW4gT1QgZSBOT04gYyfDqCBwYXJpdMOgLCBjaGl1ZGkgbGEgcGFydGl0YS4KICBpZihjdXJyZW50UXVhcnRlciA+PSA0ICYmIGxhc3RTY29yZUEgIT09IGxhc3RTY29yZUIpewogICAgZ2FtZUNsb3NlZCA9IHRydWU7CiAgICBzZWMgPSAwOwogICAgLy8gcmVzZXQgc3RhdHMgZGkgc3F1YWRyYSBwZXIgY29lcmVuemEKICAgIHRlYW1BLnRvID0gMDsgdGVhbUIudG8gPSAwOwogICAgdGVhbUEuZnRzID0gMDsgdGVhbUIuZnRzID0gMDsKICAgIHVuZG9JbmZvLnRleHRDb250ZW50ID0gJ+KchSBGaW5lIHBhcnRpdGEnOwogICAgdXBkYXRlU2lkZVdpZHRoKCk7CiAgICByZXR1cm47CiAgfQoKICAvLyByZXNldCBzdGF0cyBkaSBzcXVhZHJhIHBlciBwZXJpb2RvCiAgdGVhbUEudG8gPSAwOwogIHRlYW1CLnRvID0gMDsKICB0ZWFtQS5mdHMgPSAwOwogIHRlYW1CLmZ0cyA9IDA7CgogIC8vIGF2YW56YSBwZXJpb2RvIGUgcmljYXJpY2EgY3Jvbm9tZXRybwogIGN1cnJlbnRRdWFydGVyICs9IDE7CiAgc2VjID0gKGN1cnJlbnRRdWFydGVyIDw9IDQpID8gUVVBUlRFUl9MRU4gOiBPVF9MRU47Cn0KCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PQogICBBVVRPU0FWRSBTTkFQU0hPVCAoQ0xJQ0sgU1Ug4oCcUGVyaW9kb+KAnSkKICAgLSBzYWx2YSB1biBKU09OIGNvbiBsbyBzdGF0byBDT01QTEVUTywgZG9wbyBhdmVyIHNjcml0dG8gaSBwYXJ6aWFsaSBkZWwgcGVyaW9kbyBjaGl1c28KICAgLSBOT04gY2FtYmlhIGlsIGZsdXNzbzogcGVyaW9kbyBlIGNyb25vbWV0cm8gYXZhbnphbm8gY29tZSBzZW1wcmUKPT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCmZ1bmN0aW9uIGF1dG9TYXZlUGVyaW9kU25hcHNob3QoZW5kZWRRdWFydGVyKXsKICBjb25zdCBnYW1lSWQgPSBlbnN1cmVHYW1lSWQoKTsKICB0cnl7IHNhdmVTdGF0ZSgpOyB9Y2F0Y2goZSl7fQoKICBjb25zdCBxID0gKHR5cGVvZiBlbmRlZFF1YXJ0ZXIgPT09ICdudW1iZXInICYmIGVuZGVkUXVhcnRlciA+IDApID8gZW5kZWRRdWFydGVyIDogY3VycmVudFF1YXJ0ZXI7CiAgY29uc3QgbGFiZWwgPSAocSA8PSA0KSA/IGBRJHtxfWAgOiBgT1Qke3EtNH1gOwoKICAvLyBub21lIGJhc2UgZmlsZSAoY29tZSBzYXZlR2FtZSkKICBjb25zdCBhTmFtZSA9IChuYW1lQS52YWx1ZSB8fCAnU3F1YWRyYSBBJykudHJpbSgpOwogIGNvbnN0IGJOYW1lID0gKG5hbWVCLnZhbHVlIHx8ICdTcXVhZHJhIEInKS50cmltKCk7CiAgY29uc3QgZGF0ZSAgPSAoZGF0YUdhcmEudmFsdWUgfHwgJycpLnRyaW0oKTsKCiAgY29uc3QgYmFzZU5hbWUgPSBgJHthTmFtZX0gdnMgJHtiTmFtZX0ke2RhdGUgPyAnICcgKyBkYXRlIDogJyd9IOKAoiAke2xhYmVsfWA7CgogIC8vIHNuYXBzaG90IHN0YXRvIChpbmNsdWRlIHF1YXJ0ZXJzIGRhbCBET006IFExLi5RNC9PVCkKICBjb25zdCBzdGF0ZSA9IHNuYXBzaG90U3RhdGUoKTsKCiAgLy8gc2NvcmUgYXR0dWFsZSAoZG9wbyBmaW5hbGl6ZSkKICBjb25zdCBzY0EgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NvcmVBJyk/LnRleHRDb250ZW50ID8/ICcwJzsKICBjb25zdCBzY0IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NvcmVCJyk/LnRleHRDb250ZW50ID8/ICcwJzsKCiAgY29uc3QgcGF5bG9hZCA9IHsKICAgIF9fdHlwZTogJ2Jhc2tldF9zdGF0c19zbmFwc2hvdCcsCiAgICBfX3ZlcnNpb246IDEsCiAgICBtZXRhOiB7CiAgICAgIGdhbWVJZDogZ2FtZUlkLAogICAgICBzbmFwc2hvdDogbGFiZWwsCiAgICAgIG5hbWU6IGJhc2VOYW1lLAogICAgICBwZXJpb2Q6IGxhYmVsLAogICAgICBkYXRlOiBkYXRlIHx8ICcnLAogICAgICBhTmFtZSwgYk5hbWUsCiAgICAgIHNjb3JlQTogU3RyaW5nKHNjQSksCiAgICAgIHNjb3JlQjogU3RyaW5nKHNjQiksCiAgICAgIHNjb3JlOiBgJHtzY0F9LSR7c2NCfWAsCiAgICAgIHNhdmVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKQogICAgfSwKICAgIHN0YXRlCiAgfTsKICAvLyBTYWx2YSBuZWxsbyBzdG9yZSBwZXIgaWwgRklMRSBVTklDTyAobmllbnRlIGRvd25sb2FkIHBlciBxdWFydG8pCiAgU05BUFNIT1RfU1RPUkUuZ2FtZUlkID0gZ2FtZUlkOwogIFNOQVBTSE9UX1NUT1JFLmJhc2VNZXRhID0gKGdldE1ldGFGcm9tVUk/Z2V0TWV0YUZyb21VSSgpOiAoU05BUFNIT1RfU1RPUkUuYmFzZU1ldGF8fHt9KSk7CiAgU05BUFNIT1RfU1RPUkUuc25hcHNbbGFiZWxdID0gcGF5bG9hZDsKCiAgdW5kb0luZm8udGV4dENvbnRlbnQgPSAnQXV0b3NhdmUgbWVtb3JpenphdG86ICcgKyBsYWJlbDsKICB1cGRhdGVTaWRlV2lkdGgoKTsKfQoKCmZ1bmN0aW9uIG5leHRRdWFydGVyKCl7CiAgLy8gbWFudWFsZSAodGFwIHN1ICJQZXJpb2RvIikgc29sbyBhIGNyb25vbWV0cm8gZmVybW8gZSBhIDAKICBpZih0aW1lciB8fCBzZWMhPT0wKSByZXR1cm47CiAgaWYoZ2FtZUNsb3NlZCkgcmV0dXJuOwoKICBjb25zdCBlbmRlZFEgPSBjdXJyZW50UXVhcnRlcjsgLy8gcGVyaW9kbyBjaGUgc3RhaSBjaGl1ZGVuZG8KICBmaW5hbGl6ZVBlcmlvZEFuZEFkdmFuY2UoKTsgICAgLy8gcXVpIHNjcml2ZSBpbCBwYXJ6aWFsZSBlIHByZXBhcmEgaWwgcHJvc3NpbW8gcGVyaW9kbwoKICAvLyBhdXRvc2F2ZSBET1BPIGxhIGZpbmFsaXplOiBjb3PDrCBRMSBmaW5pc2NlIG5lbCBmaWxlIFExIChub24gbmVsIFEyKQogIHRyeXsgYXV0b1NhdmVQZXJpb2RTbmFwc2hvdChlbmRlZFEpOyB9Y2F0Y2goZSl7fQoKICByZW5kZXIoKTsKfQoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgIENMT0NLCj09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwpmdW5jdGlvbiBzdGFydENsb2NrKCl7CiAgLy8gQXZ2aW8gcm9idXN0byBwZXIgV2ViVmlldy8uZXhlOiBuaWVudGUgZGlwZW5kZW56YSBkYSBzZXRJbnRlcnZhbCAicHVybyIKICBpZih0aW1lcikgcmV0dXJuOwogIGlmKGdhbWVDbG9zZWQpewogICAgYWxlcnQoJ1BhcnRpdGEgdGVybWluYXRhLicpOwogICAgcmV0dXJuOwogIH0KCiAgLy8gYW50aS1zbGVlcCArIGF1ZGlvIChzZXJ2ZSBnZXN0byB1dGVudGUpCiAgcmVxdWVzdFdha2VMb2NrKCk7CiAgZW5zdXJlQXVkaW8oKTsKCiAgbGV0IGxhc3QgPSAodHlwZW9mIHBlcmZvcm1hbmNlICE9PSAndW5kZWZpbmVkJyAmJiBwZXJmb3JtYW5jZS5ub3cpID8gcGVyZm9ybWFuY2Uubm93KCkgOiBEYXRlLm5vdygpOwogIGxldCBjYXJyeSA9IDA7CgogIGNvbnN0IHN0ZXAgPSAoKT0+ewogICAgaWYoIXRpbWVyKSByZXR1cm47IC8vIHN0b3AgcmljaGllc3RvCiAgICBjb25zdCBub3cgPSAodHlwZW9mIHBlcmZvcm1hbmNlICE9PSAndW5kZWZpbmVkJyAmJiBwZXJmb3JtYW5jZS5ub3cpID8gcGVyZm9ybWFuY2Uubm93KCkgOiBEYXRlLm5vdygpOwogICAgbGV0IGR0ID0gbm93IC0gbGFzdDsKICAgIGlmKCFOdW1iZXIuaXNGaW5pdGUoZHQpIHx8IGR0IDwgMCkgZHQgPSAwOwogICAgbGFzdCA9IG5vdzsKCiAgICBjYXJyeSArPSBkdDsKCiAgICAvLyBDb25zdW1hIGkgc2Vjb25kaSBhY2N1bXVsYXRpIChzZSBpbCBXZWJWaWV3ICJwYXVzYSIgZSBwb2kgcmlwcmVuZGUsIHJlY3VwZXJhKQogICAgbGV0IG4gPSBNYXRoLmZsb29yKGNhcnJ5IC8gMTAwMCk7CiAgICBpZihuID4gMCl7CiAgICAgIGNhcnJ5IC09IG4gKiAxMDAwOwoKICAgICAgd2hpbGUobi0tID4gMCl7CiAgICAgICAgaWYoc2VjPD0wKXsKICAgICAgICAgIHNlYyA9IDA7CiAgICAgICAgICBzdG9wQ2xvY2soKTsKICAgICAgICAgIHJlbmRlcigpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgc2VjLS07CgogICAgICAgIGlmKHNlYyA8PSAwKXsKICAgICAgICAgIHNlYyA9IDA7CiAgICAgICAgICBiZWVwKCk7CiAgICAgICAgICBzdG9wQ2xvY2soKTsKICAgICAgICAgIGZpbmFsaXplUGVyaW9kQW5kQWR2YW5jZSgpOwogICAgICAgICAgcmVuZGVyKCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBwbGF5ZXJzQS5mb3JFYWNoKHA9PnsgaWYocC5pbikgcC5taW4gKz0gMTsgfSk7CiAgICAgICAgcGxheWVyc0IuZm9yRWFjaChwPT57IGlmKHAuaW4pIHAubWluICs9IDE7IH0pOwogICAgICB9CiAgICAgIHJlbmRlcigpOwogICAgfQoKICAgIC8vIFRpY2sgZnJlcXVlbnRlIG1hIGxlZ2dlcm87IHF1YW5kbyBsYSBmaW5lc3RyYSDDqCBhdHRpdmEsIMOoIG1vbHRvIHN0YWJpbGUKICAgIHRpbWVyID0gc2V0VGltZW91dChzdGVwLCAxNTApOwogIH07CgogIHRpbWVyID0gc2V0VGltZW91dChzdGVwLCAwKTsKfQoKZnVuY3Rpb24gc3RvcENsb2NrKCl7CiAgaWYodGltZXIpewogICAgY2xlYXJUaW1lb3V0KHRpbWVyKTsKICAgIHRpbWVyID0gbnVsbDsKICB9CiAgcmVsZWFzZVdha2VMb2NrKCk7CiAgc2F2ZVN0YXRlKCk7CiAgdXBkYXRlU2lkZVdpZHRoKCk7Cn0KCmZ1bmN0aW9uIG51ZGdlQ2xvY2soZGVsdGFTZWMpewogIGRlbHRhU2VjID0gTWF0aC50cnVuYyhOdW1iZXIoZGVsdGFTZWMpIHx8IDApOwogIGlmKGRlbHRhU2VjID09PSAwKSByZXR1cm47CgogIGNvbnN0IHBlcmlvZExlbiA9IChjdXJyZW50UXVhcnRlciA8PSA0KSA/IFFVQVJURVJfTEVOIDogT1RfTEVOOwoKICBpZihkZWx0YVNlYyA+IDApewogICAgY29uc3QgYWN0dWFsID0gTWF0aC5taW4oZGVsdGFTZWMsIHNlYyk7CiAgICBpZihhY3R1YWwgPD0gMCkgcmV0dXJuOwoKICAgIGNvbnN0IG9sZFNlYyA9IHNlYzsKICAgIGNvbnN0IG1pbnNBID0gcGxheWVyc0EubWFwKHA9PnAubWlufHwwKTsKICAgIGNvbnN0IG1pbnNCID0gcGxheWVyc0IubWFwKHA9PnAubWlufHwwKTsKCiAgICBzYXZlKGBUZW1wbyArJHthY3R1YWx9c2AsICgpPT57CiAgICAgIHNlYyA9IG9sZFNlYzsKICAgICAgcGxheWVyc0EuZm9yRWFjaCgocCxpKT0+IHAubWluID0gbWluc0FbaV0gfHwgMCk7CiAgICAgIHBsYXllcnNCLmZvckVhY2goKHAsaSk9PiBwLm1pbiA9IG1pbnNCW2ldIHx8IDApOwogICAgfSk7CgogICAgc2VjIC09IGFjdHVhbDsKICAgIHBsYXllcnNBLmZvckVhY2gocD0+eyBpZihwLmluKSBwLm1pbiArPSBhY3R1YWw7IH0pOwogICAgcGxheWVyc0IuZm9yRWFjaChwPT57IGlmKHAuaW4pIHAubWluICs9IGFjdHVhbDsgfSk7CgogICAgcmVuZGVyKCk7CiAgICByZXR1cm47CiAgfQoKICBjb25zdCByZXFCYWNrID0gTWF0aC5hYnMoZGVsdGFTZWMpOwogIGNvbnN0IG1heEJ5Q2xvY2sgPSBNYXRoLm1heCgwLCBwZXJpb2RMZW4gLSBzZWMpOwoKICBjb25zdCBpbk1pbnMgPSBbXTsKICBwbGF5ZXJzQS5mb3JFYWNoKHA9PnsgaWYocC5pbikgaW5NaW5zLnB1c2gocC5taW58fDApOyB9KTsKICBwbGF5ZXJzQi5mb3JFYWNoKHA9PnsgaWYocC5pbikgaW5NaW5zLnB1c2gocC5taW58fDApOyB9KTsKCiAgY29uc3QgbWF4QnlQbGF5ZXJzID0gaW5NaW5zLmxlbmd0aCA/IE1hdGgubWluKC4uLmluTWlucykgOiBtYXhCeUNsb2NrOwogIGNvbnN0IGFjdHVhbCA9IE1hdGgubWluKHJlcUJhY2ssIG1heEJ5Q2xvY2ssIG1heEJ5UGxheWVycyk7CiAgaWYoYWN0dWFsIDw9IDApIHJldHVybjsKCiAgY29uc3Qgb2xkU2VjID0gc2VjOwogIGNvbnN0IG1pbnNBID0gcGxheWVyc0EubWFwKHA9PnAubWlufHwwKTsKICBjb25zdCBtaW5zQiA9IHBsYXllcnNCLm1hcChwPT5wLm1pbnx8MCk7CgogIHNhdmUoYFRlbXBvIC0ke2FjdHVhbH1zYCwgKCk9PnsKICAgIHNlYyA9IG9sZFNlYzsKICAgIHBsYXllcnNBLmZvckVhY2goKHAsaSk9PiBwLm1pbiA9IG1pbnNBW2ldIHx8IDApOwogICAgcGxheWVyc0IuZm9yRWFjaCgocCxpKT0+IHAubWluID0gbWluc0JbaV0gfHwgMCk7CiAgfSk7CgogIHNlYyArPSBhY3R1YWw7CiAgcGxheWVyc0EuZm9yRWFjaChwPT57IGlmKHAuaW4pIHAubWluID0gTWF0aC5tYXgoMCwgKHAubWlufHwwKSAtIGFjdHVhbCk7IH0pOwogIHBsYXllcnNCLmZvckVhY2gocD0+eyBpZihwLmluKSBwLm1pbiA9IE1hdGgubWF4KDAsIChwLm1pbnx8MCkgLSBhY3R1YWwpOyB9KTsKCiAgcmVuZGVyKCk7Cn0KCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PQogICBSRU5ERVIKPT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCmZ1bmN0aW9uIHJlbmRlclRlYW1UYWJsZShzaWRlLCB0Ym9keUlkKXsKICBjb25zdCBhcnIgPSBnZXRQbGF5ZXJzKHNpZGUpOwogIGNvbnN0IHRiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGJvZHlJZCk7CiAgdGIuaW5uZXJIVE1MID0gJyc7CgogIGFyci5mb3JFYWNoKChwLGkpPT57CiAgICBpZihpc0xvY2tlZChwKSAmJiBwLmluKSBwLmluID0gZmFsc2U7CgogICAgbGV0IGZmQ2xhc3MgPSAnJzsKICAgIGlmIChwLmZmID49IDUpIGZmQ2xhc3MgPSAnZmYtZGFuZ2VyJzsKICAgIGVsc2UgaWYgKHAuZmYgPT09IDQpIGZmQ2xhc3MgPSAnZmYtd2FybmluZyc7CgogICAgY29uc3QgaW5Sb3dDbGFzcyA9IHAuaW4gPyAnaW4tcm93JyA6ICcnOwoKICAgIGNvbnN0IGxvY2tlZCA9IGlzTG9ja2VkKHApOwogICAgY29uc3QgaW9DbGFzcyA9IGxvY2tlZCA/ICdmb3VsLW91dCcgOiAocC5pbiA/ICdpbicgOiAnb3V0Jyk7CiAgICBjb25zdCBpb0xhYmVsID0gbG9ja2VkID8gJ09VVCcgOiAocC5pbiA/ICdJTicgOiAnT1VUJyk7CgogICAgdGIuaW5uZXJIVE1MICs9IGAKPHRyIGNsYXNzPSIke2luUm93Q2xhc3N9Ij4KICA8dGQ+CiAgICA8aW5wdXQgY2xhc3M9InBsYXllci1udW0taW5wdXQiIHR5cGU9Im51bWJlciIgbWluPSIwIiBtYXg9Ijk5IgogICAgICB2YWx1ZT0iJHtlc2NBdHRyKHAubnVtKX0iCiAgICAgIG9uaW5wdXQ9InNldFBsYXllck51bSgnJHtzaWRlfScsICR7aX0sIHRoaXMudmFsdWUpIgogICAgLz4KICA8L3RkPgogIDx0ZCBjbGFzcz0ibmFtZSI+CiAgICA8aW5wdXQgY2xhc3M9InBsYXllci1uYW1lLWlucHV0IgogICAgICB2YWx1ZT0iJHtlc2NBdHRyKHAubmFtZSl9IgogICAgICBvbmlucHV0PSJzZXRQbGF5ZXJOYW1lKCcke3NpZGV9JywgJHtpfSwgdGhpcy52YWx1ZSkiCiAgICAvPgogICAgPHNwYW4gY2xhc3M9InN0YXR1cy13cmFwIj4KICAgICAgPGJ1dHRvbiBjbGFzcz0iJHtpb0NsYXNzfSBpby1idG4iICR7bG9ja2VkID8gJ2Rpc2FibGVkJyA6ICcnfSBvbmNsaWNrPSIke2xvY2tlZCA/ICcnIDogYHRvZ2dsZUluKCcke3NpZGV9JywgJHtpfSlgfSI+JHtpb0xhYmVsfTwvYnV0dG9uPgogICAgICA8YnV0dG9uIGNsYXNzPSJlc3AtYnRuIiAke2xvY2tlZCA/ICdkaXNhYmxlZCcgOiAnJ30gZGF0YS1zaWRlPSIke3NpZGV9IiBkYXRhLWlkeD0iJHtpfSIgdGl0bGU9IlRpZW5pIHByZW11dG8gcGVyIEVTUCAoNzAwbXMpIj5FU1A8L2J1dHRvbj4KICAgIDwvc3Bhbj4KICA8L3RkPgogIDx0ZD4ke3AucHRzfTwvdGQ+CiAgPHRkPgogICAgPHNwYW4gY2xhc3M9IiR7ZmZDbGFzc30iPiR7cC5mZn08L3NwYW4+CiAgICA8YnV0dG9uIGNsYXNzPSJyZWQiIG9uY2xpY2s9ImFkZFN0YXQoJyR7c2lkZX0nLCR7aX0sJ2ZmJywxKSI+KzwvYnV0dG9uPgogIDwvdGQ+CiAgPHRkPiR7Zm9ybWF0VGltZShwLm1pbil9PC90ZD4KICA8dGQ+JHtwb2ludHNQZXJNaW51dGUocCl9PC90ZD4KICA8dGQ+JHtzaG90KHNpZGUsaSwnMnB0JywyKX08L3RkPgogIDx0ZD4ke3Nob3Qoc2lkZSxpLCczcHQnLDMpfTwvdGQ+CiAgPHRkPiR7c2hvdChzaWRlLGksJ3RsJywxKX08L3RkPgogICR7WydmcycsJ3JhJywncmQnLCdhJywncHAnLCdwcicsJ3N0ZicsJ3N0cyddCiAgICAubWFwKHM9PmA8dGQ+PGJ1dHRvbiBjbGFzcz0iYmx1ZSIgb25jbGljaz0iYWRkU3RhdCgnJHtzaWRlfScsJHtpfSwnJHtzfScsMSkiPiR7cFtzXX08L2J1dHRvbj48L3RkPmApCiAgICAuam9pbignJyl9CjwvdHI+YDsKICB9KTsKfQoKZnVuY3Rpb24gc3VtVGVhbShhcnIsIHNpZGUpewogIGxldCBwdHM9MDsKICBhcnIuZm9yRWFjaChwPT57IHB0cyArPSAocC5wdHN8fDApOyB9KTsKICBpZihzaWRlPT09J0EnIHx8IHNpZGU9PT0nQicpewogICAgcHRzICs9IChzY29yZUFkaj8uW3NpZGVdIHx8IDApOwogIH0KICByZXR1cm4ge3B0c307Cn0KCmZ1bmN0aW9uIHJlbmRlcigpewogIHJlbmRlclRlYW1UYWJsZSgnQScsICd0Ym9keUEnKTsKICByZW5kZXJUZWFtVGFibGUoJ0InLCAndGJvZHlCJyk7CgogIGNvbnN0IGEgPSBzdW1UZWFtKHBsYXllcnNBLCdBJyk7CiAgY29uc3QgYiA9IHN1bVRlYW0ocGxheWVyc0IsJ0InKTsKCiAgc2NvcmVBLnRleHRDb250ZW50ID0gYS5wdHM7CiAgc2NvcmVCLnRleHRDb250ZW50ID0gYi5wdHM7CgogIHRlYW1Gb3Vsc0EudGV4dENvbnRlbnQgPSB0ZWFtQS5mdHMgfHwgMDsKICB0ZWFtRm91bHNCLnRleHRDb250ZW50ID0gdGVhbUIuZnRzIHx8IDA7CgogIHRlYW1Gb3Vsc0EuY2xhc3NMaXN0LnRvZ2dsZSgndGVhbS1mb3Vscy1kYW5nZXInLCAodGVhbUEuZnRzfHwwKSA+PSA0KTsKICB0ZWFtRm91bHNCLmNsYXNzTGlzdC50b2dnbGUoJ3RlYW0tZm91bHMtZGFuZ2VyJywgKHRlYW1CLmZ0c3x8MCkgPj0gNCk7CgogIHNlY3Rpb25UaXRsZUEudGV4dENvbnRlbnQgPSAobmFtZUEudmFsdWUgfHwgJ1NxdWFkcmEgQScpOwogIHNlY3Rpb25UaXRsZUIudGV4dENvbnRlbnQgPSAobmFtZUIudmFsdWUgfHwgJ1NxdWFkcmEgQicpOwoKICB0ZWFtQVBQLnRleHRDb250ZW50ID0gdGVhbUEucHA7CiAgdGVhbUFQUi50ZXh0Q29udGVudCA9IHRlYW1BLnByOwogIHRlYW1BVE8udGV4dENvbnRlbnQgPSB0ZWFtQS50bzsKICB0ZWFtQVRPTWF4LnRleHRDb250ZW50ID0gbWF4VGltZW91dHMoKTsKCiAgdGVhbUFGVFMudGV4dENvbnRlbnQgPSB0ZWFtQS5mdHMgfHwgMDsKICB0ZWFtQUZUUy5jbGFzc0xpc3QudG9nZ2xlKCdmdHMtZGFuZ2VyJywgKHRlYW1BLmZ0cyB8fCAwKSA+PSA0KTsKdGVhbUJQUC50ZXh0Q29udGVudCA9IHRlYW1CLnBwOwogIHRlYW1CUFIudGV4dENvbnRlbnQgPSB0ZWFtQi5wcjsKICB0ZWFtQlRPLnRleHRDb250ZW50ID0gdGVhbUIudG87CiAgdGVhbUJUT01heC50ZXh0Q29udGVudCA9IG1heFRpbWVvdXRzKCk7CgogIHRlYW1CRlRTLnRleHRDb250ZW50ID0gdGVhbUIuZnRzIHx8IDA7CiAgdGVhbUJGVFMuY2xhc3NMaXN0LnRvZ2dsZSgnZnRzLWRhbmdlcicsICh0ZWFtQi5mdHMgfHwgMCkgPj0gNCk7CgogIGNsb2NrLnRleHRDb250ZW50ID0gZm9ybWF0VGltZShzZWMpOwogIHFOdW0udGV4dENvbnRlbnQgPSBnYW1lQ2xvc2VkID8gJ0ZJTkUnIDogcGVyaW9kTGFiZWwoY3VycmVudFF1YXJ0ZXIpOwoKICBzYXZlU3RhdGUoKTsKICB1cGRhdGVTaWRlV2lkdGgoKTsKCiAgaWYoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0YXRzT3ZlcmxheScpLnN0eWxlLmRpc3BsYXkgPT09ICdibG9jaycpewogICAgcmVuZGVyU3RhdHMoKTsKICB9CiAgaWYoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbWVzT3ZlcmxheScpLnN0eWxlLmRpc3BsYXkgPT09ICdibG9jaycpewogICAgcmVuZGVyTGlicmFyeSgpOwogIH0KfQoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgIExPTkctUFJFU1MgRVNQCj09PT09PT09PT09PT09PT09PT09PT09PT09PSAqLwpjb25zdCBFU1BfSE9MRF9NUyA9IDcwMDsKbGV0IGhvbGRUaW1lciA9IG51bGw7CmxldCBob2xkQnRuID0gbnVsbDsKbGV0IGhvbGRTaWRlID0gbnVsbDsKbGV0IGhvbGRJZHggPSBudWxsOwoKZnVuY3Rpb24gaG9sZFN0YXJ0KGJ0bil7CiAgaWYoIWJ0biB8fCBidG4uZGlzYWJsZWQpIHJldHVybjsKICBob2xkQ2FuY2VsKCk7CgogIGhvbGRCdG4gPSBidG47CiAgaG9sZFNpZGUgPSBidG4uZ2V0QXR0cmlidXRlKCdkYXRhLXNpZGUnKTsKICBob2xkSWR4ICA9IE51bWJlcihidG4uZ2V0QXR0cmlidXRlKCdkYXRhLWlkeCcpKTsKCiAgaG9sZEJ0bi5jbGFzc0xpc3QuYWRkKCdob2xkaW5nJyk7CgogIGhvbGRUaW1lciA9IHNldFRpbWVvdXQoKCk9PnsKICAgIGV4cGVsUGxheWVyKGhvbGRTaWRlLCBob2xkSWR4KTsKICAgIGhvbGRDYW5jZWwoKTsKICB9LCBFU1BfSE9MRF9NUyk7Cn0KCmZ1bmN0aW9uIGhvbGRDYW5jZWwoKXsKICBpZihob2xkVGltZXIpeyBjbGVhclRpbWVvdXQoaG9sZFRpbWVyKTsgaG9sZFRpbWVyID0gbnVsbDsgfQogIGlmKGhvbGRCdG4peyBob2xkQnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2hvbGRpbmcnKTsgfQogIGhvbGRCdG4gPSBudWxsOyBob2xkU2lkZSA9IG51bGw7IGhvbGRJZHggPSBudWxsOwp9Cgpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgKGUpPT57CiAgY29uc3QgYnRuID0gZS50YXJnZXQuY2xvc2VzdD8uKCcuZXNwLWJ0bicpOwogIGlmKCFidG4pIHJldHVybjsKICBlLnByZXZlbnREZWZhdWx0KCk7CiAgaG9sZFN0YXJ0KGJ0bik7Cn0sIHtwYXNzaXZlOmZhbHNlfSk7Cgpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIChlKT0+ewogIGNvbnN0IGJ0biA9IGUudGFyZ2V0LmNsb3Nlc3Q/LignLmVzcC1idG4nKTsKICBpZihidG4pIGUucHJldmVudERlZmF1bHQoKTsKICBob2xkQ2FuY2VsKCk7Cn0sIHtwYXNzaXZlOmZhbHNlfSk7CmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoY2FuY2VsJywgaG9sZENhbmNlbCwge3Bhc3NpdmU6dHJ1ZX0pOwoKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vkb3duJywgKGUpPT57CiAgY29uc3QgYnRuID0gZS50YXJnZXQuY2xvc2VzdD8uKCcuZXNwLWJ0bicpOwogIGlmKCFidG4pIHJldHVybjsKICBlLnByZXZlbnREZWZhdWx0KCk7CiAgaG9sZFN0YXJ0KGJ0bik7Cn0pOwpkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgaG9sZENhbmNlbCk7CmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCBob2xkQ2FuY2VsKTsKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgaG9sZENhbmNlbCwgdHJ1ZSk7CgovKiA9PT0gRklYIFNUQVRTOiBvdmVybGF5IHNlbXByZSB2aXNpYmlsZSArIHJlbmRlciBwcm90ZXR0byA9PT0gKi8KZnVuY3Rpb24gc2hvd1N0YXRzRXJyb3IoZXJyKXsKICB0cnl7CiAgICBjb25zdCBib2R5ID0gJGlkKCdzdGF0c0JvZHknKTsKICAgIGlmKGJvZHkpewogICAgICBib2R5LmlubmVySFRNTCA9IGA8ZGl2IHN0eWxlPSJwYWRkaW5nOjEycHg7IGZvbnQtZmFtaWx5Om1vbm9zcGFjZTsgY29sb3I6I2MwMzkyYjsgZm9udC13ZWlnaHQ6Ym9sZDsiPgogICAgICAgIEVSUk9SRSBTVEFUUzo8YnI+JHtlc2NIdG1sKGVycj8uc3RhY2sgfHwgZXJyKX0KICAgICAgPC9kaXY+YDsKICAgIH0KICB9Y2F0Y2goZSl7fQp9CgpmdW5jdGlvbiBvcGVuU3RhdHMoKXsKICBjb25zdCBvdiA9ICRpZCgnc3RhdHNPdmVybGF5Jyk7CiAgY29uc3QgYm9keSA9ICRpZCgnc3RhdHNCb2R5Jyk7CiAgb3Yuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgaWYoYm9keSl7CiAgICBib2R5LmlubmVySFRNTCA9ICc8ZGl2IHN0eWxlPSJwYWRkaW5nOjEycHg7IGNvbG9yOiM3ZjhjOGQ7IGZvbnQtd2VpZ2h0OmJvbGQ7Ij5DYXJpY2FtZW50byBzdGF0aXN0aWNoZeKApjwvZGl2Pic7CiAgfQogIC8vIGxhc2NpYSByZXNwaXJhcmUgaWwgcmVwYWludCwgcG9pIHJlbmRlcml6emEKICBzZXRUaW1lb3V0KCgpPT57CiAgICB0cnl7CiAgICAgIHJlbmRlclN0YXRzKCk7CiAgICB9Y2F0Y2goZSl7CiAgICAgIHNob3dTdGF0c0Vycm9yKGUpOwogICAgfQogIH0sIDApOwp9CgpmdW5jdGlvbiBjbG9zZVN0YXRzKCl7CiAgJGlkKCdzdGF0c092ZXJsYXknKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwp9CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgU1RBVElTVElDSEUgKFBJUi9PRVIvKy8tKQo9PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KZnVuY3Rpb24gY2FsY1BJUihwKXsKICAvKgogICAgUElSIOKAnHN0aWxlIEZJQkHigJ0gYWRhdHRhdG8gYWkgZGF0aSBkaXNwb25pYmlsaSAoZ2lvdmFuaWxpL21pbmliYXNrZXQgZnJpZW5kbHkpCiAgICBGb3JtdWxhIGJhc2U6IChwb3NpdGl2aSkgLSAobmVnYXRpdmkpCgogICAgUG9zaXRpdmk6CiAgICAgIFBUUyArIFJFQiAoUkErUkQpICsgQSArIFBSICsgU1RmICsgRlMKICAgIE5lZ2F0aXZpOgogICAgICB0aXJpIHNiYWdsaWF0aSAoRkdBLUZHTSkgKyBsaWJlcmkgc2JhZ2xpYXRpIChGVEEtRlRNKSArIFBQICsgRkYgKyBTVHMKCiAgICBOb3RhOgogICAgICAtIHF1aSB1c28gRkdBID0gMlBUIGF0dCArIDNQVCBhdHQsIEZHTSA9IDJQVCBtYWRlICsgM1BUIG1hZGUKICAgICAgLSBTVGYvU1RzOiBuZWwgdHVvIGZpbGUgc29ubyBnacOgIHVzYXRpIGNvbWUg4oCcc3RvcHBhdGUgZmF0dGUvc3ViaXRl4oCdIChvIHNpbWlsaSkKICAqLwogIGNvbnN0IGZnbSA9IChwWycycHQnXT8ubWFkZXx8MCkgKyAocFsnM3B0J10/Lm1hZGV8fDApOwogIGNvbnN0IGZnYSA9IChwWycycHQnXT8uYXR0fHwwKSAgKyAocFsnM3B0J10/LmF0dHx8MCk7CiAgY29uc3QgZnRtID0gKHAudGw/Lm1hZGV8fDApOwogIGNvbnN0IGZ0YSA9IChwLnRsPy5hdHR8fDApOwoKICBjb25zdCBtaXNzZWRGRyA9IE1hdGgubWF4KDAsIGZnYSAtIGZnbSk7CiAgY29uc3QgbWlzc2VkRlQgPSBNYXRoLm1heCgwLCBmdGEgLSBmdG0pOwoKICBjb25zdCByZWIgPSAocC5yYXx8MCkgKyAocC5yZHx8MCk7CgogIHJldHVybiAocC5wdHN8fDApCiAgICArIHJlYgogICAgKyAocC5hfHwwKQogICAgKyAocC5wcnx8MCkKICAgICsgKHAuc3RmfHwwKQogICAgKyAocC5mc3x8MCkKICAgIC0gbWlzc2VkRkcKICAgIC0gbWlzc2VkRlQKICAgIC0gKHAucHB8fDApCiAgICAtIChwLmZmfHwwKQogICAgLSAocC5zdHN8fDApOwp9CmZ1bmN0aW9uIGNhbGNPRVIocCl7CiAgLyoKICAgIE9FUiA9IHB1bnRpIHBlciAxMDAgcG9zc2Vzc2kgc3RpbWF0aS4KICAgIFBvc3Nlc3NpIHN0aW1hdGkg4omIIEZHQSAtIE9SQiArIFRPICsgMC40NCpGVEEKICAgIChzdGltYSDigJxzdGFuZGFyZOKAnTsgc3VpIGdpb3ZhbmlsaSBldml0YSBkaSBpbXBhenppcmUgc3UgZGF0aSBpbmNvbXBsZXRpKQoKICAgIFBlciByZW5kZXJlIHBpw7kgc3RhYmlsZSBzdSBjYW1waW9uaSBwaWNjb2xpOgogICAgICAtIHNlIGkgcG9zc2Vzc2kgc3RpbWF0aSBzb25vIDwgMyByaXRvcm5vIDAKICAgICAgICAoZXZpdGEgbnVtZXJpIOKAnHNwYXJhdGnigJ0gY29uIHBvY2hlIGF6aW9uaSkKICAqLwogIGNvbnN0IGZnYSA9IChwWycycHQnXT8uYXR0fHwwKSArIChwWyczcHQnXT8uYXR0fHwwKTsKICBjb25zdCBmdGEgPSAocC50bD8uYXR0fHwwKTsKICBjb25zdCB0byAgPSAocC5wcHx8MCk7CiAgY29uc3Qgb3JiID0gKHAucmF8fDApOyAvLyBSQSA9IHJpbWJhbHppIGluIGF0dGFjY28KCiAgY29uc3QgZGVub20gPSBmZ2EgLSBvcmIgKyAwLjQ0KmZ0YSArIHRvOwoKICBpZihkZW5vbSA8IDMpIHJldHVybiAwOwogIHJldHVybiAoMTAwICogKHAucHRzfHwwKSAvIGRlbm9tKTsKfQpmdW5jdGlvbiBvdmVybGF5Q2xpY2tDbG9zZSgpeyBjbG9zZVN0YXRzKCk7IH0KZnVuY3Rpb24gZm10T0VSKHgpeyByZXR1cm4gTnVtYmVyLmlzRmluaXRlKHgpID8geC50b0ZpeGVkKDEpIDogJzAuMCc7IH0KZnVuY3Rpb24gZm10UE0odil7IGNvbnN0IG4gPSBOdW1iZXIodnx8MCk7IHJldHVybiBuPjAgPyBgKyR7bn1gIDogYCR7bn1gOyB9CmZ1bmN0aW9uIHBtQ2xhc3Modil7CiAgY29uc3QgbiA9IE51bWJlcih2fHwwKTsKICBpZihuID4gMCkgcmV0dXJuICdwbS1wb3MnOwogIGlmKG4gPCAwKSByZXR1cm4gJ3BtLW5lZyc7CiAgcmV0dXJuICcnOwp9CgpmdW5jdGlvbiB1cGRhdGVTdGF0c01ldGEoKXsKICAvLyBTY29yZSBsaW5lIGNlbnRyYWxlCiAgY29uc3QgYU5hbWUgPSAobmFtZUE/LnZhbHVlIHx8ICdTcXVhZHJhIEEnKS50cmltKCk7CiAgY29uc3QgYk5hbWUgPSAobmFtZUI/LnZhbHVlIHx8ICdTcXVhZHJhIEInKS50cmltKCk7CiAgY29uc3Qgc2NBID0gJGlkKCdzY29yZUEnKT8udGV4dENvbnRlbnQgPz8gJzAnOwogIGNvbnN0IHNjQiA9ICRpZCgnc2NvcmVCJyk/LnRleHRDb250ZW50ID8/ICcwJzsKICBsZXQgc2NvcmVMaW5lID0gYCR7YU5hbWV9ICAke3NjQX0gLSAke3NjQn0gICR7Yk5hbWV9YDsKICBpZihzdGF0c1ZpZXc/Lm1vZGUgPT09ICdwZXJpb2QnICYmIHN0YXRzVmlldy5sYWJlbCl7IHNjb3JlTGluZSArPSBgICAg4oCiICAgU09MTyAke3N0YXRzVmlldy5sYWJlbH1gOyB9CiAgY29uc3Qgc2NvcmVFbCA9ICRpZCgnc3RhdHNTY29yZUxpbmUnKTsKICBpZihzY29yZUVsKSBzY29yZUVsLnRleHRDb250ZW50ID0gc2NvcmVMaW5lOwoKICAvLyBNZXRhIGNvbXBhdHRhIHN1IFVOQSByaWdhCiAgY29uc3QgY2FtcCA9IChjYW1waW9uYXRvPy52YWx1ZSB8fCAnJykudHJpbSgpOwogIGNvbnN0IGdpciAgPSAoZ2lyb25lPy52YWx1ZSB8fCAnJykudHJpbSgpOwogIGNvbnN0IGRhdGUgPSAoZGF0YUdhcmE/LnZhbHVlIHx8ICcnKS50cmltKCk7CiAgY29uc3QgZyAgICA9IChnaW9ybmF0YT8udmFsdWUgfHwgJycpLnRyaW0oKTsKICBjb25zdCBhciAgID0gKChhbmRhdGFSaXRvcm5vPy52YWx1ZSB8fCAnJykudHJpbSgpLnRvVXBwZXJDYXNlKCkpOwogIGNvbnN0IGNmICAgPSAoKGNhc2FGdW9yaT8udmFsdWUgfHwgJycpLnRyaW0oKS50b1VwcGVyQ2FzZSgpKTsKICBjb25zdCBhcmIxID0gKGFyYml0cm8xPy52YWx1ZSB8fCAnJykudHJpbSgpOwogIGNvbnN0IGFyYjIgPSAoYXJiaXRybzI/LnZhbHVlIHx8ICcnKS50cmltKCk7CgogIGNvbnN0IGluZm9UZXh0ID0gWwogICAgY2FtcCA/IGBDYXQ6ICR7Y2FtcH1gIDogbnVsbCwKICAgIGdpciAgPyBgR2lyOiAke2dpcn1gICA6IG51bGwsCiAgICBkYXRlID8gYERhdGE6ICR7ZGF0ZX1gOiBudWxsLAogICAgZyAgICA/IGBHaW9ybmF0YTogJHtnfWAgOiBudWxsLAogICAgYXIgICA/IGBBL1I6ICR7YXJ9YCAgIDogbnVsbCwKICAgIGNmICAgPyBgQy9GOiAke2NmfWAgICA6IG51bGwsCiAgICBhcmIxID8gYEFyYjE6ICR7YXJiMX1gOiBudWxsLAogICAgYXJiMiA/IGBBcmIyOiAke2FyYjJ9YDogbnVsbCwKICBdLmZpbHRlcihCb29sZWFuKS5qb2luKCcgICDigKIgICAnKSB8fCAn4oCUJzsKCiAgJGlkKCdzdGF0c01ldGFJbmZvJykudGV4dENvbnRlbnQgPSBpbmZvVGV4dDsKCiAgLy8gUGFyemlhbGkgY29tcGF0dGk6ICBhLWIgLyBhLWIgLyBhLWIgLyBhLWIgIChPVCBzZSBwcmVzZW50aSkKICAvLyBOb3RhOiBwZXIgaSBwcm9ncmVzc2l2aSBOT04gZGltb3N0cmFyZSB2YWxvcmkg4oCcY29waWF0aeKAnSBzdWkgcXVhcnRpIG5vbiBhbmNvcmEgZ2lvY2F0aS4KICAvLyBTZSB1biBxdWFydG8gbm9uIMOoIHN0YXRvIGFuY29yYSBpbnNlcml0byAoY2VsbCAn4oCUJyBvIHZ1b3RhKSwgbmVpIHByb2dyZXNzaXZpIG1vc3RyaWFtbyAn4oCUJy4KICBjb25zdCB0b051bSA9ICh2KT0+ewogICAgY29uc3QgcyA9IFN0cmluZyh2ID8/ICcnKS50cmltKCk7CiAgICBjb25zdCBuID0gcGFyc2VJbnQocywgMTApOwogICAgcmV0dXJuIE51bWJlci5pc0Zpbml0ZShuKSA/IG4gOiAwOwogIH07CiAgY29uc3QgZ2V0UU9iaiA9IChuLCBzaWRlKT0+ewogICAgY29uc3QgcmF3ID0gU3RyaW5nKCRpZChgcSR7bn0ke3NpZGV9YCk/LnRleHRDb250ZW50ID8/ICfigJQnKS50cmltKCk7CiAgICBjb25zdCBwbGF5ZWQgPSAocmF3ICE9PSAn4oCUJyAmJiByYXcgIT09ICcnKTsKICAgIHJldHVybiB7IHJhdywgbjogdG9OdW0ocmF3KSwgcGxheWVkIH07CiAgfTsKCiAgY29uc3Qgc3BsaXRzID0gW107IC8vIFt7YSxiLHBsYXllZCxsYWJlbH1dCiAgLy8gUTEuLlE0CiAgZm9yKGxldCBxPTE7cTw9NDtxKyspewogICAgY29uc3QgQSA9IGdldFFPYmoocSwnYScpOwogICAgY29uc3QgQiA9IGdldFFPYmoocSwnYicpOwogICAgY29uc3QgcGxheWVkID0gQS5wbGF5ZWQgfHwgQi5wbGF5ZWQ7CiAgICBzcGxpdHMucHVzaCh7IGxhYmVsOmBRJHtxfWAsIGE6QS5uLCBiOkIubiwgcGxheWVkIH0pOwogIH0KCiAgLy8gT1QgZGluYW1pY2kgKE9UMSwgT1QyLCAuLi4pCiAgY29uc3Qgb3RIb3N0ID0gJGlkKCdvdFJvd3MnKTsKICBpZihvdEhvc3QpewogICAgY29uc3Qgcm93cyA9IFsuLi5vdEhvc3QucXVlcnlTZWxlY3RvckFsbCgnZGl2LnFyb3cnKV07CiAgICByb3dzLmZvckVhY2gocj0+ewogICAgICBjb25zdCBsYWJlbCA9IChyLnF1ZXJ5U2VsZWN0b3IoJ3N0cm9uZycpPy50ZXh0Q29udGVudCB8fCAnJykudHJpbSgpOyAvLyBPVDEKICAgICAgaWYoIWxhYmVsKSByZXR1cm47CiAgICAgIGNvbnN0IHNwYW5zID0gci5xdWVyeVNlbGVjdG9yQWxsKCdzcGFuJyk7CiAgICAgIGNvbnN0IHJhd0EgPSBTdHJpbmcoc3BhbnNbMF0/LnRleHRDb250ZW50ID8/ICfigJQnKS50cmltKCk7CiAgICAgIGNvbnN0IHJhd0IgPSBTdHJpbmcoc3BhbnNbMV0/LnRleHRDb250ZW50ID8/ICfigJQnKS50cmltKCk7CiAgICAgIGNvbnN0IGEgPSB0b051bShyYXdBKTsKICAgICAgY29uc3QgYiA9IHRvTnVtKHJhd0IpOwogICAgICBjb25zdCBwbGF5ZWQgPSAoKHJhd0EgIT09ICfigJQnICYmIHJhd0EgIT09ICcnKSB8fCAocmF3QiAhPT0gJ+KAlCcgJiYgcmF3QiAhPT0gJycpKTsKICAgICAgLy8gaW5jbHVkaSBzb2xvIE9UIGNvbXBpbGF0aSAoYWxtZW5vIHVubyBub24gemVybyBvIGNvbXVucXVlIGluc2VyaXRvKQogICAgICBpZihwbGF5ZWQgJiYgKGEhPT0wIHx8IGIhPT0wKSkgewogICAgICAgIHNwbGl0cy5wdXNoKHsgbGFiZWwsIGEsIGIsIHBsYXllZDp0cnVlIH0pOwogICAgICB9CiAgICB9KTsKICB9CgogIGNvbnN0IGZtdFBhaXIgPSAoYSxiKT0+IGAke2F9LSR7Yn1gOwoKICAvLyBQYXJ6aWFsaTogc2Ugbm9uIGdpb2NhdG8gbW9zdHJpYW1vIDAtMCAoY29tZSByaWNoaWVzdG8pCiAgY29uc3QgcGFyemlhbGkgPSBzcGxpdHMubWFwKHM9PiBmbXRQYWlyKHMuYSwgcy5iKSkuam9pbignIC8gJyk7CgogIC8vIFByb2dyZXNzaXZpOiBtb3N0cmEgc29sbyBmaW5vIGFsbCd1bHRpbW8gcXVhcnRvL09UIGVmZmV0dGl2YW1lbnRlIGluc2VyaXRvCiAgbGV0IGNhPTAsIGNiPTA7CiAgY29uc3QgcHJvZyA9IHNwbGl0cy5tYXAocz0+ewogICAgaWYoIXMucGxheWVkKSByZXR1cm4gJ+KAlCc7CiAgICBjYSArPSBzLmE7IGNiICs9IHMuYjsKICAgIHJldHVybiBmbXRQYWlyKGNhLCBjYik7CiAgfSkuam9pbignIC8gJyk7CiAgY29uc3QgcXVhcnRlcnNIVE1MID0gYAogICAgPGRpdiBjbGFzcz0ibWV0YS1zcGxpdHMiPjxzcGFuIGNsYXNzPSJsYmwiPlBhcnppYWxpOjwvc3Bhbj48c3BhbiBjbGFzcz0idmFscyI+JHtlc2NIdG1sKHBhcnppYWxpKX08L3NwYW4+PC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJtZXRhLXNwbGl0cyI+PHNwYW4gY2xhc3M9ImxibCI+UHJvZ3Jlc3Npdmk6PC9zcGFuPjxzcGFuIGNsYXNzPSJ2YWxzIj4ke2VzY0h0bWwocHJvZyl9PC9zcGFuPjwvZGl2PgogIGA7CiAgJGlkKCdzdGF0c01ldGFRdWFydGVycycpLmlubmVySFRNTCA9IHF1YXJ0ZXJzSFRNTDsKfQoKCmZ1bmN0aW9uIHRlYW1Ub3RhbHMoYXJyKXsKICBjb25zdCB0ID0gewogICAgcHRzOjAsIGZmOjAsIG1pbjowLAogICAgJzJwdCc6e21hZGU6MCxhdHQ6MH0sCiAgICAnM3B0Jzp7bWFkZTowLGF0dDowfSwKICAgIHRsOnttYWRlOjAsYXR0OjB9LAogICAgZnM6MCxyYTowLHJkOjAsYTowLHBwOjAscHI6MCxzdGY6MCxzdHM6MCwKICAgIHBtOjAKICB9OwogIGFyci5mb3JFYWNoKHA9PnsKICAgIHQucHRzICs9IChwLnB0c3x8MCk7CiAgICB0LmZmICs9IChwLmZmfHwwKTsKICAgIHQubWluICs9IChwLm1pbnx8MCk7CiAgICB0WycycHQnXS5tYWRlICs9IChwWycycHQnXT8ubWFkZXx8MCk7CiAgICB0WycycHQnXS5hdHQgICs9IChwWycycHQnXT8uYXR0fHwwKTsKICAgIHRbJzNwdCddLm1hZGUgKz0gKHBbJzNwdCddPy5tYWRlfHwwKTsKICAgIHRbJzNwdCddLmF0dCAgKz0gKHBbJzNwdCddPy5hdHR8fDApOwogICAgdC50bC5tYWRlICs9IChwLnRsPy5tYWRlfHwwKTsKICAgIHQudGwuYXR0ICArPSAocC50bD8uYXR0fHwwKTsKICAgIFsnZnMnLCdyYScsJ3JkJywnYScsJ3BwJywncHInLCdzdGYnLCdzdHMnXS5mb3JFYWNoKGs9PiB0W2tdICs9IChwW2tdfHwwKSk7CiAgICB0LnBtICs9IChwLnBtfHwwKTsKICB9KTsKICByZXR1cm4gdDsKfQoKZnVuY3Rpb24gcmVuZGVyU3RhdHNUZWFtKHNpZGUsIHRpdGxlLCBhcnIpewogIGNvbnN0IHZpZXcgPSBzb3J0Rm9yU3RhdHMoc2lkZSwgYXJyKTsKCiAgY29uc3QgdG90YWxzID0gdGVhbVRvdGFscyhhcnIpOwogIGNvbnN0IG9lclRvdCA9IGNhbGNPRVIodG90YWxzKTsKICBjb25zdCBwaXJUb3QgPSBhcnIucmVkdWNlKChzdW0scCk9PiBzdW0gKyBjYWxjUElSKHApLCAwKTsKCiAgY29uc3QgaGVhZCA9IGAKICAgIDxkaXYgY2xhc3M9InN0YXRzLWJsb2NrIj4KICAgICAgPGgzPiR7ZXNjQXR0cih0aXRsZSl9PC9oMz4KICAgICAgPGRpdiBjbGFzcz0ic3RhdHMtbWV0YS1ibG9jayIgc3R5bGU9Im1hcmdpbjoycHggMCA4cHg7IGNvbG9yOiM3ZjhjOGQ7IGZvbnQtd2VpZ2h0OmJvbGQ7Ij4KICAgICAgICAke3JlbmRlclNwbGl0c0xpbmUoc2lkZSl9CiAgICAgIDwvZGl2PgogICAgICA8dGFibGUgY2xhc3M9InN0YXRzLXRhYmxlIj4KICAgICAgICA8dGhlYWQ+CiAgICAgICAgICA8dHI+CiAgICAgICAgICAgIDx0aCBzdHlsZT0id2lkdGg6MzhweDsgY3Vyc29yOnBvaW50ZXI7IiBkYXRhLXNpZGU9IiR7c2lkZX0iIGRhdGEtc3RhdHMta2V5PSJudW0iPiM8L3RoPgogICAgICAgICAgICA8dGggc3R5bGU9IndpZHRoOjE4MHB4OyBjdXJzb3I6cG9pbnRlcjsiIGRhdGEtc2lkZT0iJHtzaWRlfSIgZGF0YS1zdGF0cy1rZXk9Im5hbWUiPkF0bGV0YTwvdGg+CiAgICAgICAgICAgIDx0aCBzdHlsZT0iY3Vyc29yOnBvaW50ZXI7IiBkYXRhLXNpZGU9IiR7c2lkZX0iIGRhdGEtc3RhdHMta2V5PSJwdHMiPlBUUzwvdGg+CiAgICAgICAgICAgIDx0aCBzdHlsZT0iY3Vyc29yOnBvaW50ZXI7IiBkYXRhLXNpZGU9IiR7c2lkZX0iIGRhdGEtc3RhdHMta2V5PSJmZiI+RkY8L3RoPgogICAgICAgICAgICA8dGggc3R5bGU9ImN1cnNvcjpwb2ludGVyOyIgZGF0YS1zaWRlPSIke3NpZGV9IiBkYXRhLXN0YXRzLWtleT0ibWluIj5NSU48L3RoPgogICAgICAgICAgICA8dGggc3R5bGU9ImN1cnNvcjpwb2ludGVyOyIgZGF0YS1zaWRlPSIke3NpZGV9IiBkYXRhLXN0YXRzLWtleT0icG1yIj5QL008L3RoPgogICAgICAgICAgICA8dGggc3R5bGU9ImN1cnNvcjpwb2ludGVyOyIgZGF0YS1zaWRlPSIke3NpZGV9IiBkYXRhLXN0YXRzLWtleT0idDIiPjJQVDwvdGg+PHRoIHN0eWxlPSJjdXJzb3I6cG9pbnRlcjsiIGRhdGEtc2lkZT0iJHtzaWRlfSIgZGF0YS1zdGF0cy1rZXk9InQycCI+VDIgJTwvdGg+PHRoIHN0eWxlPSJjdXJzb3I6cG9pbnRlcjsiIGRhdGEtc2lkZT0iJHtzaWRlfSIgZGF0YS1zdGF0cy1rZXk9InQzIj4zUFQ8L3RoPjx0aCBzdHlsZT0iY3Vyc29yOnBvaW50ZXI7IiBkYXRhLXNpZGU9IiR7c2lkZX0iIGRhdGEtc3RhdHMta2V5PSJ0M3AiPlQzICU8L3RoPjx0aCBzdHlsZT0iY3Vyc29yOnBvaW50ZXI7IiBkYXRhLXNpZGU9IiR7c2lkZX0iIGRhdGEtc3RhdHMta2V5PSJ0bCI+VEw8L3RoPjx0aCBzdHlsZT0iY3Vyc29yOnBvaW50ZXI7IiBkYXRhLXNpZGU9IiR7c2lkZX0iIGRhdGEtc3RhdHMta2V5PSJ0bHAiPlRMICU8L3RoPgogICAgICAgICAgICA8dGggc3R5bGU9ImN1cnNvcjpwb2ludGVyOyIgZGF0YS1zaWRlPSIke3NpZGV9IiBkYXRhLXN0YXRzLWtleT0iZnMiPkZTPC90aD48dGggc3R5bGU9ImN1cnNvcjpwb2ludGVyOyIgZGF0YS1zaWRlPSIke3NpZGV9IiBkYXRhLXN0YXRzLWtleT0icmEiPlJBPC90aD48dGggc3R5bGU9ImN1cnNvcjpwb2ludGVyOyIgZGF0YS1zaWRlPSIke3NpZGV9IiBkYXRhLXN0YXRzLWtleT0icmQiPlJEPC90aD48dGggc3R5bGU9ImN1cnNvcjpwb2ludGVyOyIgZGF0YS1zaWRlPSIke3NpZGV9IiBkYXRhLXN0YXRzLWtleT0iYSI+QTwvdGg+CiAgICAgICAgICAgIDx0aCBzdHlsZT0iY3Vyc29yOnBvaW50ZXI7IiBkYXRhLXNpZGU9IiR7c2lkZX0iIGRhdGEtc3RhdHMta2V5PSJwcCI+UFA8L3RoPjx0aCBzdHlsZT0iY3Vyc29yOnBvaW50ZXI7IiBkYXRhLXNpZGU9IiR7c2lkZX0iIGRhdGEtc3RhdHMta2V5PSJwciI+UFI8L3RoPjx0aCBzdHlsZT0iY3Vyc29yOnBvaW50ZXI7IiBkYXRhLXNpZGU9IiR7c2lkZX0iIGRhdGEtc3RhdHMta2V5PSJzdGYiPlNUZjwvdGg+PHRoIHN0eWxlPSJjdXJzb3I6cG9pbnRlcjsiIGRhdGEtc2lkZT0iJHtzaWRlfSIgZGF0YS1zdGF0cy1rZXk9InN0cyI+U1RzPC90aD4KICAgICAgICAgICAgPHRoIGNsYXNzPSJwaXItY29sIiBzdHlsZT0iY3Vyc29yOnBvaW50ZXI7IiBkYXRhLXNpZGU9IiR7c2lkZX0iIGRhdGEtc3RhdHMta2V5PSJwaXIiPlBJUjwvdGg+CiAgICAgICAgICAgIDx0aCBzdHlsZT0iY3Vyc29yOnBvaW50ZXI7IiBkYXRhLXNpZGU9IiR7c2lkZX0iIGRhdGEtc3RhdHMta2V5PSJvZXIiPk9FUjwvdGg+CiAgICAgICAgICAgIDx0aCBzdHlsZT0iY3Vyc29yOnBvaW50ZXI7IiBkYXRhLXNpZGU9IiR7c2lkZX0iIGRhdGEtc3RhdHMta2V5PSJwbSI+Ky8tPC90aD4KICAgICAgICAgIDwvdHI+CiAgICAgICAgPC90aGVhZD4KICAgICAgICA8dGJvZHk+CiAgYDsKCiAgY29uc3Qgcm93cyA9IHZpZXcubWFwKHA9PnsKICAgIGNvbnN0IHBpciA9IGNhbGNQSVIocCk7CiAgICBjb25zdCBvZXIgPSBjYWxjT0VSKHApOwogICAgY29uc3QgcG0gID0gcC5wbXx8MDsKICAgIHJldHVybiBgCiAgICAgIDx0cj4KICAgICAgICA8dGQ+JHtwLm51bSA/PyAnJ308L3RkPgogICAgICAgIDx0ZCBjbGFzcz0ibmFtZSI+JHtlc2NBdHRyKHAubmFtZSl9PC90ZD4KICAgICAgICA8dGQ+JHtwLnB0c3x8MH08L3RkPgogICAgICAgIDx0ZD4ke3AuZmZ8fDB9PC90ZD4KICAgICAgICA8dGQ+JHtmb3JtYXRUaW1lKHAubWlufHwwKX08L3RkPgogICAgICAgIDx0ZD4ke3N0YXRzUE0ocCl9PC90ZD4KICAgICAgICA8dGQ+JHsocFsnMnB0J10/Lm1hZGV8fDApfS8keyhwWycycHQnXT8uYXR0fHwwKX08L3RkPgogICAgICAgIDx0ZD4ke3BjdChwWycycHQnXT8ubWFkZXx8MCwgcFsnMnB0J10/LmF0dHx8MCl9PC90ZD4KICAgICAgICA8dGQ+JHsocFsnM3B0J10/Lm1hZGV8fDApfS8keyhwWyczcHQnXT8uYXR0fHwwKX08L3RkPgogICAgICAgIDx0ZD4ke3BjdChwWyczcHQnXT8ubWFkZXx8MCwgcFsnM3B0J10/LmF0dHx8MCl9PC90ZD4KICAgICAgICA8dGQ+JHsocC50bD8ubWFkZXx8MCl9LyR7KHAudGw/LmF0dHx8MCl9PC90ZD4KICAgICAgICA8dGQ+JHtwY3QocC50bD8ubWFkZXx8MCwgcC50bD8uYXR0fHwwKX08L3RkPgogICAgICAgIDx0ZD4ke3AuZnN8fDB9PC90ZD4KICAgICAgICA8dGQ+JHtwLnJhfHwwfTwvdGQ+CiAgICAgICAgPHRkPiR7cC5yZHx8MH08L3RkPgogICAgICAgIDx0ZD4ke3AuYXx8MH08L3RkPgogICAgICAgIDx0ZD4ke3AucHB8fDB9PC90ZD4KICAgICAgICA8dGQ+JHtwLnByfHwwfTwvdGQ+CiAgICAgICAgPHRkPiR7cC5zdGZ8fDB9PC90ZD4KICAgICAgICA8dGQ+JHtwLnN0c3x8MH08L3RkPgogICAgICAgIDx0ZCBjbGFzcz0icGlyLWNvbCI+JHtwaXJ9PC90ZD4KICAgICAgICA8dGQ+JHtmbXRPRVIob2VyKX08L3RkPgogICAgICAgIDx0ZCBjbGFzcz0iJHtwbUNsYXNzKHBtKX0iPiR7Zm10UE0ocG0pfTwvdGQ+CiAgICAgIDwvdHI+CiAgICBgOwogIH0pLmpvaW4oJycpOwoKICBjb25zdCBmb290ID0gYAogICAgICAgIDwvdGJvZHk+CiAgICAgICAgPHRmb290PgogICAgICAgICAgPHRyPgogICAgICAgICAgICA8dGQgY29sc3Bhbj0iMiI+VE9UPC90ZD4KICAgICAgICAgICAgPHRkPiR7dG90YWxzLnB0c308L3RkPgogICAgICAgICAgICA8dGQ+JHt0b3RhbHMuZmZ9PC90ZD4KICAgICAgICAgICAgPHRkPiR7Zm9ybWF0VGltZSh0b3RhbHMubWluKX08L3RkPgogICAgICAgICAgICA8dGQ+JHtzdGF0c1BNKHRvdGFscyl9PC90ZD4KICAgICAgICAgICAgPHRkPiR7dG90YWxzWycycHQnXS5tYWRlfS8ke3RvdGFsc1snMnB0J10uYXR0fTwvdGQ+CiAgICAgICAgICAgIDx0ZD4ke3BjdCh0b3RhbHNbJzJwdCddLm1hZGUsIHRvdGFsc1snMnB0J10uYXR0KX08L3RkPgogICAgICAgICAgICA8dGQ+JHt0b3RhbHNbJzNwdCddLm1hZGV9LyR7dG90YWxzWyczcHQnXS5hdHR9PC90ZD4KICAgICAgICAgICAgPHRkPiR7cGN0KHRvdGFsc1snM3B0J10ubWFkZSwgdG90YWxzWyczcHQnXS5hdHQpfTwvdGQ+CiAgICAgICAgICAgIDx0ZD4ke3RvdGFscy50bC5tYWRlfS8ke3RvdGFscy50bC5hdHR9PC90ZD4KICAgICAgICAgICAgPHRkPiR7cGN0KHRvdGFscy50bC5tYWRlLCB0b3RhbHMudGwuYXR0KX08L3RkPgogICAgICAgICAgICA8dGQ+JHt0b3RhbHMuZnN9PC90ZD4KICAgICAgICAgICAgPHRkPiR7dG90YWxzLnJhfTwvdGQ+CiAgICAgICAgICAgIDx0ZD4ke3RvdGFscy5yZH08L3RkPgogICAgICAgICAgICA8dGQ+JHt0b3RhbHMuYX08L3RkPgogICAgICAgICAgICA8dGQ+JHt0b3RhbHMucHB9PC90ZD4KICAgICAgICAgICAgPHRkPiR7dG90YWxzLnByfTwvdGQ+CiAgICAgICAgICAgIDx0ZD4ke3RvdGFscy5zdGZ9PC90ZD4KICAgICAgICAgICAgPHRkPiR7dG90YWxzLnN0c308L3RkPgogICAgICAgICAgICA8dGQgY2xhc3M9InBpci1jb2wiPiR7cGlyVG90fTwvdGQ+CiAgICAgICAgICAgIDx0ZD4ke2ZtdE9FUihvZXJUb3QpfTwvdGQ+CiAgICAgICAgICAgIDx0ZCBjbGFzcz0iJHtwbUNsYXNzKHRvdGFscy5wbSl9Ij4ke2ZtdFBNKHRvdGFscy5wbSl9PC90ZD4KICAgICAgICAgIDwvdHI+CiAgICAgICAgPC90Zm9vdD4KICAgICAgPC90YWJsZT4KICAgIDwvZGl2PgogIGA7CiAgcmV0dXJuIGhlYWQgKyByb3dzICsgZm9vdDsKfQoKCmZ1bmN0aW9uIHJlbmRlclN0YXRzKCl7CiAgY29uc3QgYU5hbWUgPSAobmFtZUEudmFsdWUgfHwgJ1NxdWFkcmEgQScpOwogIGNvbnN0IGJOYW1lID0gKG5hbWVCLnZhbHVlIHx8ICdTcXVhZHJhIEInKTsKCiAgY29uc3QgYXJyQSA9IChzdGF0c1ZpZXc/Lm1vZGUgPT09ICdwZXJpb2QnICYmIEFycmF5LmlzQXJyYXkoc3RhdHNWaWV3LkEpKSA/IHN0YXRzVmlldy5BIDogcGxheWVyc0E7CiAgY29uc3QgYXJyQiA9IChzdGF0c1ZpZXc/Lm1vZGUgPT09ICdwZXJpb2QnICYmIEFycmF5LmlzQXJyYXkoc3RhdHNWaWV3LkIpKSA/IHN0YXRzVmlldy5CIDogcGxheWVyc0I7CgogICRpZCgnc3RhdHNCb2R5JykuaW5uZXJIVE1MID0gcmVuZGVyU3RhdHNUZWFtKCdBJywgYU5hbWUsIGFyckEpICsgcmVuZGVyU3RhdHNUZWFtKCdCJywgYk5hbWUsIGFyckIpOwogIHVwZGF0ZVN0YXRzTWV0YSgpOwp9CgovKiA9PT09PSBFWFBPUlQgQ1NWID09PT09ICovCmZ1bmN0aW9uIGRvd25sb2FkQmxvYihmaWxlbmFtZSwgYmxvYil7CiAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogIGEuaHJlZiA9IHVybDsKICBhLmRvd25sb2FkID0gZmlsZW5hbWU7CiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsKICBhLmNsaWNrKCk7CiAgYS5yZW1vdmUoKTsKICBVUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7Cn0KZnVuY3Rpb24gY3N2Q2VsbCh2KXsKICBjb25zdCBzID0gU3RyaW5nKHYgPz8gJycpOwogIGlmIChzLmluY2x1ZGVzKCc7JykgfHwgcy5pbmNsdWRlcygnIicpIHx8IHMuaW5jbHVkZXMoJ1xcbicpIHx8IHMuaW5jbHVkZXMoJ1xccicpKSB7CiAgICByZXR1cm4gYCIke3MucmVwbGFjZUFsbCgnIicsJyIiJyl9ImA7CiAgfQogIHJldHVybiBzOwp9CmZ1bmN0aW9uIGJ1aWxkU3RhdHNNZXRhTGluZXMoKXsKICBjb25zdCBhTiA9IChuYW1lQS52YWx1ZSB8fCAnU3F1YWRyYSBBJykudHJpbSgpOwogIGNvbnN0IGJOID0gKG5hbWVCLnZhbHVlIHx8ICdTcXVhZHJhIEInKS50cmltKCk7CgogIGNvbnN0IHNjb3JlQSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY29yZUEnKT8udGV4dENvbnRlbnQgPz8gJzAnOwogIGNvbnN0IHNjb3JlQiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY29yZUInKT8udGV4dENvbnRlbnQgPz8gJzAnOwogIGNvbnN0IHBlcmlvZG8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncU51bScpPy50ZXh0Q29udGVudCA/PyBTdHJpbmcoY3VycmVudFF1YXJ0ZXJ8fDEpOwoKICBjb25zdCBleHRyYSA9IFsKICAgIFsnQ0FURUdPUklBJywgKGNhbXBpb25hdG8udmFsdWV8fCcnKS50cmltKCldLAogICAgWydHSVJPTkUnLCAoZ2lyb25lLnZhbHVlfHwnJykudHJpbSgpXSwKICAgIFsnREFUQScsIChkYXRhR2FyYS52YWx1ZXx8JycpLnRyaW0oKV0sCiAgICBbJ0dJT1JOQVRBJywgKGdpb3JuYXRhLnZhbHVlfHwnJykudHJpbSgpXSwKICAgIFsnQS9SJywgKGFuZGF0YVJpdG9ybm8udmFsdWV8fCcnKS50cmltKCldLAogICAgWydDQVNBL0ZVT1JJJywgKGNhc2FGdW9yaS52YWx1ZXx8JycpLnRyaW0oKV0sCiAgICBbJ0FSQklUUk8gMScsIChhcmJpdHJvMS52YWx1ZXx8JycpLnRyaW0oKV0sCiAgICBbJ0FSQklUUk8gMicsIChhcmJpdHJvMi52YWx1ZXx8JycpLnRyaW0oKV0sCiAgXTsKCiAgY29uc3QgbGluZXMgPSBbXTsKICBsaW5lcy5wdXNoKFtgJHthTn0gdnMgJHtiTn1gXS5tYXAoY3N2Q2VsbCkuam9pbignOycpKTsKICBsaW5lcy5wdXNoKFsnUklTVUxUQVRPJywgYCR7c2NvcmVBfS0ke3Njb3JlQn1gXS5tYXAoY3N2Q2VsbCkuam9pbignOycpKTsKICBsaW5lcy5wdXNoKFsnUEVSSU9ETycsIGBRJHtwZXJpb2RvfWBdLm1hcChjc3ZDZWxsKS5qb2luKCc7JykpOwoKICBleHRyYS5mb3JFYWNoKChbayx2XSk9PnsgaWYodikgbGluZXMucHVzaChbaywgdl0ubWFwKGNzdkNlbGwpLmpvaW4oJzsnKSk7IH0pOwoKICAvLyBQYXJ6aWFsaSAoUS9PVCkKICBjb25zdCBzYSA9IGdldFBlcmlvZFNwbGl0cygnQScpLmZpbHRlcih4PT4gKHgudmFsID8/ICfigJQnKSAhPT0gJ+KAlCcpLm1hcCh4PT5gJHt4LmxhYmVsfToke3gudmFsfWApLmpvaW4oJyDigKIgJyk7CiAgY29uc3Qgc2IgPSBnZXRQZXJpb2RTcGxpdHMoJ0InKS5maWx0ZXIoeD0+ICh4LnZhbCA/PyAn4oCUJykgIT09ICfigJQnKS5tYXAoeD0+YCR7eC5sYWJlbH06JHt4LnZhbH1gKS5qb2luKCcg4oCiICcpOwogIGlmKHNhKSBsaW5lcy5wdXNoKFsnUEFSWklBTEkgQScsIHNhXS5tYXAoY3N2Q2VsbCkuam9pbignOycpKTsKICBpZihzYikgbGluZXMucHVzaChbJ1BBUlpJQUxJIEInLCBzYl0ubWFwKGNzdkNlbGwpLmpvaW4oJzsnKSk7CgogIGxpbmVzLnB1c2goJycpOwogIHJldHVybiBsaW5lcy5qb2luKCdcbicpOwp9CgpmdW5jdGlvbiBzdGF0c1Jvd3NGb3JDU1YodGVhbU5hbWUsIGFycil7CiAgY29uc3Qgc29ydGVkID0gQXJyYXkuaXNBcnJheShhcnIpID8gWy4uLmFycl0uc29ydCgoYSxiKT0+IChOdW1iZXIoYS5udW18fDApIC0gTnVtYmVyKGIubnVtfHwwKSkpIDogW107CgogIGNvbnN0IGhlYWRlciA9IFsnIycsJ0F0bGV0YScsJ1BUUycsJ0ZGJywnTUlOJywnUC9NJywnMlBUJywnM1BUJywnVEwnLCdGUycsJ1JBJywnUkQnLCdBJywnUFAnLCdQUicsJ1NUZicsJ1NUcycsJ1BJUicsJ09FUicsJysvLSddOwogIGNvbnN0IGxpbmVzID0gW107CiAgbGluZXMucHVzaChbdGVhbU5hbWVdLm1hcChjc3ZDZWxsKS5qb2luKCc7JykpOwogIGxpbmVzLnB1c2goaGVhZGVyLm1hcChjc3ZDZWxsKS5qb2luKCc7JykpOwoKICBhcnIuZm9yRWFjaChwPT57CiAgICBjb25zdCByb3cgPSBbCiAgICAgIHAubnVtID8/ICcnLCBwLm5hbWUgPz8gJycsIHAucHRzfHwwLCBwLmZmfHwwLCBmb3JtYXRUaW1lKHAubWlufHwwKSwKICAgICAgc3RhdHNQTShwKSwKICAgICAgYCR7KHBbJzJwdCddPy5tYWRlfHwwKX0vJHsocFsnMnB0J10/LmF0dHx8MCl9YCwKICAgICAgYCR7KHBbJzNwdCddPy5tYWRlfHwwKX0vJHsocFsnM3B0J10/LmF0dHx8MCl9YCwKICAgICAgYCR7KHAudGw/Lm1hZGV8fDApfS8keyhwLnRsPy5hdHR8fDApfWAsCiAgICAgIHAuZnN8fDAsIHAucmF8fDAsIHAucmR8fDAsIHAuYXx8MCwgcC5wcHx8MCwgcC5wcnx8MCwgcC5zdGZ8fDAsIHAuc3RzfHwwLAogICAgICBjYWxjUElSKHApLCBmbXRPRVIoY2FsY09FUihwKSksIGZtdFBNKHAucG18fDApLAogICAgXTsKICAgIGxpbmVzLnB1c2gocm93Lm1hcChjc3ZDZWxsKS5qb2luKCc7JykpOwogIH0pOwoKICBjb25zdCB0b3RhbHMgPSB0ZWFtVG90YWxzKGFycik7CiAgY29uc3Qgb2VyVG90ID0gZm10T0VSKGNhbGNPRVIodG90YWxzKSk7CiAgY29uc3QgcGlyVG90ID0gYXJyLnJlZHVjZSgoc3VtLHApPT4gc3VtICsgY2FsY1BJUihwKSwgMCk7CgogIGNvbnN0IHRvdFJvdyA9IFsKICAgICcnLCAnVE9UJywKICAgIHRvdGFscy5wdHMsIHRvdGFscy5mZiwgZm9ybWF0VGltZSh0b3RhbHMubWluKSwKICAgIHN0YXRzUE0odG90YWxzKSwKICAgIGAke3RvdGFsc1snMnB0J10ubWFkZX0vJHt0b3RhbHNbJzJwdCddLmF0dH1gLAogICAgYCR7dG90YWxzWyczcHQnXS5tYWRlfS8ke3RvdGFsc1snM3B0J10uYXR0fWAsCiAgICBgJHt0b3RhbHMudGwubWFkZX0vJHt0b3RhbHMudGwuYXR0fWAsCiAgICB0b3RhbHMuZnMsIHRvdGFscy5yYSwgdG90YWxzLnJkLCB0b3RhbHMuYSwgdG90YWxzLnBwLCB0b3RhbHMucHIsIHRvdGFscy5zdGYsIHRvdGFscy5zdHMsCiAgICBwaXJUb3QsIG9lclRvdCwgZm10UE0odG90YWxzLnBtfHwwKSwKICBdOwogIGxpbmVzLnB1c2godG90Um93Lm1hcChjc3ZDZWxsKS5qb2luKCc7JykpOwogIGxpbmVzLnB1c2goJycpOwogIHJldHVybiBsaW5lcy5qb2luKCdcXG4nKTsKfQpmdW5jdGlvbiBleHBvcnRTdGF0c0V4Y2VsKCl7CiAgLy8gRXhwb3J0IEV4Y2VsIOKAnHZlcm/igJ0gKC54bHN4KSB0cmFtaXRlIFNoZWV0SlMgKFhMU1gpCiAgLy8gTm90YTogaWwgZmlsZSB2aWVuZSBjcmVhdG8gbG9jYWxtZW50ZSBuZWwgYnJvd3NlciwgY29tZSBpbCBQREYuCiAgaWYodHlwZW9mIFhMU1ggPT09ICd1bmRlZmluZWQnKXsKICAgIGFsZXJ0KCdMaWJyZXJpYSBFeGNlbCBub24gY2FyaWNhdGEgKFhMU1gpLiBDb250cm9sbGEgbGEgY29ubmVzc2lvbmUgbyByaWNhcmljYSBsYSBwYWdpbmEuJyk7CiAgICByZXR1cm47CiAgfQoKICBjb25zdCBhTmFtZSA9IChuYW1lQS52YWx1ZSB8fCAnU3F1YWRyYSBBJykudHJpbSgpOwogIGNvbnN0IGJOYW1lID0gKG5hbWVCLnZhbHVlIHx8ICdTcXVhZHJhIEInKS50cmltKCk7CiAgY29uc3QgZGF0ZSA9IChkYXRhR2FyYS52YWx1ZSB8fCAnJykudHJpbSgpOwoKICBjb25zdCBzY29yZUEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NvcmVBJyk/LnRleHRDb250ZW50ID8/ICcwJzsKICBjb25zdCBzY29yZUIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NvcmVCJyk/LnRleHRDb250ZW50ID8/ICcwJzsKICBjb25zdCBwZXJpb2RvID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3FOdW0nKT8udGV4dENvbnRlbnQgPz8gU3RyaW5nKGN1cnJlbnRRdWFydGVyfHwxKTsKCiAgY29uc3QgY2FtcCA9IChjYW1waW9uYXRvLnZhbHVlIHx8ICcnKS50cmltKCkgfHwgJyc7CiAgY29uc3QgZ2lyICA9IChnaXJvbmUudmFsdWUgfHwgJycpLnRyaW0oKSB8fCAnJzsKICBjb25zdCBnaW9yID0gKGdpb3JuYXRhLnZhbHVlIHx8ICcnKS50cmltKCkgfHwgJyc7CiAgY29uc3QgYXIgICA9ICgoYW5kYXRhUml0b3Juby52YWx1ZSB8fCAnJykudHJpbSgpLnRvVXBwZXJDYXNlKCkpIHx8ICcnOwogIGNvbnN0IGNmICAgPSAoKGNhc2FGdW9yaS52YWx1ZSB8fCAnJykudHJpbSgpLnRvVXBwZXJDYXNlKCkpIHx8ICcnOwogIGNvbnN0IGFyYjEgPSAoYXJiaXRybzEudmFsdWUgfHwgJycpLnRyaW0oKSB8fCAnJzsKICBjb25zdCBhcmIyID0gKGFyYml0cm8yLnZhbHVlIHx8ICcnKS50cmltKCkgfHwgJyc7CgogIC8vIFBhcnppYWxpIFEvT1QKICBjb25zdCBxTGluZUJhc2UgPSBgJHtxMWEudGV4dENvbnRlbnR9LSR7cTFiLnRleHRDb250ZW50fSAvICR7cTJhLnRleHRDb250ZW50fS0ke3EyYi50ZXh0Q29udGVudH0gLyAke3EzYS50ZXh0Q29udGVudH0tJHtxM2IudGV4dENvbnRlbnR9IC8gJHtxNGEudGV4dENvbnRlbnR9LSR7cTRiLnRleHRDb250ZW50fWA7CiAgY29uc3Qgb3RIb3N0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ290Um93cycpOwogIGNvbnN0IG90UGFydHMgPSBbXTsKICBpZihvdEhvc3QpewogICAgY29uc3Qgcm93cyA9IG90SG9zdC5xdWVyeVNlbGVjdG9yQWxsKCcucXJvdycpOwogICAgcm93cy5mb3JFYWNoKChyKT0+ewogICAgICBjb25zdCBzdHJvbmcgPSByLnF1ZXJ5U2VsZWN0b3IoJ3N0cm9uZycpPy50ZXh0Q29udGVudCB8fCAnJzsKICAgICAgY29uc3Qgc3BhbnMgPSByLnF1ZXJ5U2VsZWN0b3JBbGwoJ3NwYW4nKTsKICAgICAgY29uc3QgYSA9IHNwYW5zWzBdPy50ZXh0Q29udGVudCA/PyAn4oCUJzsKICAgICAgY29uc3QgYiA9IHNwYW5zWzFdPy50ZXh0Q29udGVudCA/PyAn4oCUJzsKICAgICAgaWYoc3Ryb25nKSBvdFBhcnRzLnB1c2goYCR7YX0tJHtifWApOwogICAgfSk7CiAgfQogIGNvbnN0IHFMaW5lID0gcUxpbmVCYXNlICsgKG90UGFydHMubGVuZ3RoID8gKCcgLyAnICsgb3RQYXJ0cy5qb2luKCcgLyAnKSkgOiAnJyk7CgogIC8vIE1ldGEgKHJpZ2EgMSkgc3RpbGUg4oCcc2NyZWVu4oCdCiAgY29uc3QgaW5mb1RleHQgPSBbCiAgICBjYW1wICE9PSAn4oCUJyA/IGBDYXQ6ICR7Y2FtcH1gIDogbnVsbCwKICAgIGdpciAgIT09ICfigJQnID8gYEdpcjogJHtnaXJ9YCA6IG51bGwsCiAgICBkYXRhICE9PSAn4oCUJyA/IGBEYXRhOiAke2RhdGF9YDogbnVsbCwKICAgIGdpb3IgIT09ICfigJQnID8gYEdpb3JuYXRhOiAke2dpb3J9YCA6IG51bGwsCiAgICBhciAgICE9PSAn4oCUJyA/IGBBL1I6ICR7YXJ9YCAgIDogbnVsbCwKICAgIGNmICAgIT09ICfigJQnID8gYEMvRjogJHtjZn1gICAgOiBudWxsLAogICAgYXJiMSAhPT0gJ+KAlCcgPyBgQXJiMTogJHthcmIxfWA6IG51bGwsCiAgICBhcmIyICE9PSAn4oCUJyA/IGBBcmIyOiAke2FyYjJ9YDogbnVsbCwKICBdLmZpbHRlcihCb29sZWFuKS5qb2luKCcgICDigKIgICAnKSB8fCAn4oCUJzsKCiAgY29uc3QgbWV0YUxpbmUxID0gaW5mb1RleHQ7CiAgY29uc3QgbWV0YUxpbmUyID0gYFBhcnppYWxpOiAke3FMaW5lfWA7CgoKICAvLyBIZWxwZXJzOiByaWdoZSBnaW9jYXRvcmkgKyBUT1QgKG9yZGluYXRlIHBlciBudW1lcm8pCiAgY29uc3QgaGVhZGVyID0gWycjJywnQXRsZXRhJywnUFRTJywnRkYnLCdNSU4nLCdQL00nLCcyUFQnLCczUFQnLCdUTCcsJ0ZTJywnUkEnLCdSRCcsJ0EnLCdQUCcsJ1BSJywnU1RmJywnU1RzJywnUElSJywnT0VSJywnKy8tJ107CgogIGZ1bmN0aW9uIHJvd3NGb3JYTFNYKGFycil7CiAgICBjb25zdCBzb3J0ZWQgPSBbLi4uYXJyXS5zb3J0KChhLGIpPT4gKE51bWJlcihhLm51bXx8MCkgLSBOdW1iZXIoYi5udW18fDApKSk7CiAgICBjb25zdCByb3dzID0gc29ydGVkLm1hcChwID0+IChbCiAgICAgIHAubnVtID8/ICcnLAogICAgICBwLm5hbWUgPz8gJycsCiAgICAgIHAucHRzfHwwLAogICAgICBwLmZmfHwwLAogICAgICBmb3JtYXRUaW1lKHAubWlufHwwKSwKICAgICAgc3RhdHNQTShwKSwKICAgICAgYCR7KHBbJzJwdCddPy5tYWRlfHwwKX0vJHsocFsnMnB0J10/LmF0dHx8MCl9YCwKICAgICAgYCR7KHBbJzNwdCddPy5tYWRlfHwwKX0vJHsocFsnM3B0J10/LmF0dHx8MCl9YCwKICAgICAgYCR7KHAudGw/Lm1hZGV8fDApfS8keyhwLnRsPy5hdHR8fDApfWAsCiAgICAgIHAuZnN8fDAsIHAucmF8fDAsIHAucmR8fDAsIHAuYXx8MCwgcC5wcHx8MCwgcC5wcnx8MCwgcC5zdGZ8fDAsIHAuc3RzfHwwLAogICAgICBjYWxjUElSKHApLAogICAgICBOdW1iZXIoY2FsY09FUihwKXx8MCksCiAgICAgIHAucG18fDAsCiAgICBdKSk7CgogICAgY29uc3QgdG90YWxzID0gdGVhbVRvdGFscyhhcnIpOwogICAgY29uc3QgcGlyVG90ID0gYXJyLnJlZHVjZSgoc3VtLHApPT4gc3VtICsgY2FsY1BJUihwKSwgMCk7CiAgICByb3dzLnB1c2goWwogICAgICAnJywgJ1RPVCcsCiAgICAgIHRvdGFscy5wdHMsIHRvdGFscy5mZiwKICAgICAgZm9ybWF0VGltZSh0b3RhbHMubWluKSwKICAgICAgc3RhdHNQTSh0b3RhbHMpLAogICAgICBgJHt0b3RhbHNbJzJwdCddLm1hZGV9LyR7dG90YWxzWycycHQnXS5hdHR9YCwKICAgICAgYCR7dG90YWxzWyczcHQnXS5tYWRlfS8ke3RvdGFsc1snM3B0J10uYXR0fWAsCiAgICAgIGAke3RvdGFscy50bC5tYWRlfS8ke3RvdGFscy50bC5hdHR9YCwKICAgICAgdG90YWxzLmZzLCB0b3RhbHMucmEsIHRvdGFscy5yZCwgdG90YWxzLmEsIHRvdGFscy5wcCwgdG90YWxzLnByLCB0b3RhbHMuc3RmLCB0b3RhbHMuc3RzLAogICAgICBwaXJUb3QsCiAgICAgIE51bWJlcihjYWxjT0VSKHRvdGFscyl8fDApLAogICAgICB0b3RhbHMucG18fDAKICAgIF0pOwogICAgcmV0dXJuIHJvd3M7CiAgfQoKICAvLyBTaGVldCAiU1RBVElTVElDSEUiCiAgY29uc3QgYW9hID0gW107CiAgYW9hLnB1c2goW2BTdGF0aXN0aWNoZSBwYXJ0aXRhIChQSVIgLyBPRVIgLyArLy0pYF0pOwoKICAvLyBNRVRBIFRVVFRBIFNVIFVOQSBSSUdBCiAgYW9hLnB1c2goWwogICAgYCR7YU5hbWV9IHZzICR7Yk5hbWV9YCwKICAgIGBSaXN1bHRhdG8gJHtzY29yZUF9LSR7c2NvcmVCfWAsCiAgICBgUGVyaW9kbyBRJHtwZXJpb2RvfWAsCiAgICBgQ2F0ZWdvcmlhICR7Y2FtcH1gLAogICAgYEdpcm9uZSAke2dpcn1gLAogICAgYERhdGEgJHtkYXRlfWAsCiAgICBgR2lvcm5hdGEgJHtnaW9yfWAsCiAgICBgQS9SICR7YXJ9YCwKICAgIGBDYXNhL0Z1b3JpICR7Y2Z9YCwKICAgIGBBcmJpdHJpICR7YXJiMX0ke2FyYjIgPyAnIC8gJyArIGFyYjIgOiAnJ31gLAogICAgYFBhcnppYWxpICR7cUxpbmV9YAogIF0pOwoKICBhb2EucHVzaChbXSk7CiAgYW9hLnB1c2goW2FOYW1lXSk7CgogIGFvYS5wdXNoKGhlYWRlcik7CiAgcm93c0ZvclhMU1gocGxheWVyc0EpLmZvckVhY2gocj0+IGFvYS5wdXNoKHIpKTsKICBhb2EucHVzaChbXSk7CiAgYW9hLnB1c2goW2JOYW1lXSk7CiAgYW9hLnB1c2goaGVhZGVyKTsKICByb3dzRm9yWExTWChwbGF5ZXJzQikuZm9yRWFjaChyPT4gYW9hLnB1c2gocikpOwoKICBjb25zdCB3cyA9IFhMU1gudXRpbHMuYW9hX3RvX3NoZWV0KGFvYSk7CgogIC8vIExhcmdoZXp6ZSBjb2xvbm5lIChwacO5IOKAnHB1bGl0b+KAnSkKICB3c1snIWNvbHMnXSA9IFsKICAgIHt3Y2g6NH0sICAgLy8gIwogICAge3djaDoyMn0sICAvLyBBdGxldGEKICAgIHt3Y2g6NX0sIHt3Y2g6NH0sIHt3Y2g6N30sIHt3Y2g6Nn0sCiAgICB7d2NoOjd9LCB7d2NoOjd9LCB7d2NoOjd9LAogICAge3djaDo0fSwge3djaDo0fSwge3djaDo0fSwge3djaDo0fSwKICAgIHt3Y2g6NH0sIHt3Y2g6NH0sIHt3Y2g6NX0sIHt3Y2g6NX0sCiAgICB7d2NoOjV9LCB7d2NoOjZ9LCB7d2NoOjV9CiAgXTsKCiAgLy8gRnJlZXplIHBhbmU6IGJsb2NjYSBmaW5vIGFsbGEgcmlnYSBkZWxsJ2hlYWRlciBkZWxsYSBwcmltYSB0YWJlbGxhIChzZSBzdXBwb3J0YXRvIGRhbCB2aWV3ZXIpCiAgLy8gKGFsY3VuaSBFeGNlbCBsbyByaXNwZXR0YW5vLCBhbHRyaSBubzsgbm9uIHJvbXBlIG51bGxhKQogIHdzWychZnJlZXplJ10gPSB7IHhTcGxpdDogMCwgeVNwbGl0OiAwIH07CgogIGNvbnN0IHdiID0gWExTWC51dGlscy5ib29rX25ldygpOwogIFhMU1gudXRpbHMuYm9va19hcHBlbmRfc2hlZXQod2IsIHdzLCAnU1RBVElTVElDSEUnKTsKCiAgY29uc3QgaXNvID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNsaWNlKDAsMTkpLnJlcGxhY2VBbGwoJzonLCctJyk7CiAgY29uc3Qgc2FmZUEgPSBhTmFtZS5yZXBsYWNlQWxsKCcgJywnXycpIHx8ICdTcXVhZHJhQSc7CiAgY29uc3Qgc2FmZUIgPSBiTmFtZS5yZXBsYWNlQWxsKCcgJywnXycpIHx8ICdTcXVhZHJhQic7CiAgY29uc3Qgc2FmZUQgPSBkYXRlID8gZGF0ZS5yZXBsYWNlQWxsKCcvJywnLScpLnJlcGxhY2VBbGwoJyAnLCdfJykgOiAnJzsKICBjb25zdCBmaWxlbmFtZSA9IFsnc3RhdGlzdGljaGUnLCBzYWZlRCwgYCR7c2FmZUF9X3ZzXyR7c2FmZUJ9YCwgaXNvXS5maWx0ZXIoQm9vbGVhbikuam9pbignXycpICsgJy54bHN4JzsKCiAgWExTWC53cml0ZUZpbGUod2IsIGZpbGVuYW1lKTsKfQoKLyogPT09PT0gRVhQT1JUIFBERiA9PT09PSAqLwpmdW5jdGlvbiBleHBvcnRTdGF0c1BERigpewogIGNvbnN0IHsganNQREYgfSA9IHdpbmRvdy5qc3BkZiB8fCB7fTsKICBpZighanNQREYpeyBhbGVydCgnTGlicmVyaWEgUERGIG5vbiBjYXJpY2F0YSAoanNQREYpLicpOyByZXR1cm47IH0KICBpZighZG9jSGFzQXV0b1RhYmxlKCkpeyBhbGVydCgnUGx1Z2luIGF1dG9UYWJsZSBub24gY2FyaWNhdG8uJyk7IHJldHVybjsgfQoKICBjb25zdCBhTmFtZSA9IChuYW1lQS52YWx1ZSB8fCAnU3F1YWRyYSBBJykudHJpbSgpOwogIGNvbnN0IGJOYW1lID0gKG5hbWVCLnZhbHVlIHx8ICdTcXVhZHJhIEInKS50cmltKCk7CgogIGNvbnN0IHNjb3JlQSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY29yZUEnKT8udGV4dENvbnRlbnQgPz8gJzAnOwogIGNvbnN0IHNjb3JlQiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY29yZUInKT8udGV4dENvbnRlbnQgPz8gJzAnOwogIGNvbnN0IHBlcmlvZG8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncU51bScpPy50ZXh0Q29udGVudCA/PyBTdHJpbmcoY3VycmVudFF1YXJ0ZXJ8fDEpOwoKICBjb25zdCBjYW1wID0gKGNhbXBpb25hdG8udmFsdWUgfHwgJycpLnRyaW0oKSB8fCAn4oCUJzsKICBjb25zdCBnaXIgID0gKGdpcm9uZS52YWx1ZSB8fCAnJykudHJpbSgpIHx8ICfigJQnOwogIGNvbnN0IGRhdGEgPSAoZGF0YUdhcmEudmFsdWUgfHwgJycpLnRyaW0oKSB8fCAn4oCUJzsKICBjb25zdCBnaW9yID0gKGdpb3JuYXRhLnZhbHVlIHx8ICcnKS50cmltKCkgfHwgJ+KAlCc7CiAgY29uc3QgYXIgICA9ICgoYW5kYXRhUml0b3Juby52YWx1ZSB8fCAnJykudHJpbSgpLnRvVXBwZXJDYXNlKCkpIHx8ICfigJQnOwogIGNvbnN0IGNmICAgPSAoKGNhc2FGdW9yaS52YWx1ZSB8fCAnJykudHJpbSgpLnRvVXBwZXJDYXNlKCkpIHx8ICfigJQnOwogIGNvbnN0IGFyYjEgPSAoYXJiaXRybzEudmFsdWUgfHwgJycpLnRyaW0oKSB8fCAn4oCUJzsKICBjb25zdCBhcmIyID0gKGFyYml0cm8yLnZhbHVlIHx8ICcnKS50cmltKCkgfHwgJ+KAlCc7CgogIC8vIFBhcnppYWxpIFEvT1QgaW4gdW5hIHJpZ2EgY29tcGF0dGEKICBjb25zdCBxTGluZUJhc2UgPSBgJHtxMWEudGV4dENvbnRlbnR9LSR7cTFiLnRleHRDb250ZW50fSAvICR7cTJhLnRleHRDb250ZW50fS0ke3EyYi50ZXh0Q29udGVudH0gLyAke3EzYS50ZXh0Q29udGVudH0tJHtxM2IudGV4dENvbnRlbnR9IC8gJHtxNGEudGV4dENvbnRlbnR9LSR7cTRiLnRleHRDb250ZW50fWA7CiAgY29uc3Qgb3RIb3N0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ290Um93cycpOwogIGNvbnN0IG90UGFydHMgPSBbXTsKICBpZihvdEhvc3QpewogICAgY29uc3Qgcm93cyA9IG90SG9zdC5xdWVyeVNlbGVjdG9yQWxsKCcucXJvdycpOwogICAgcm93cy5mb3JFYWNoKChyKT0+ewogICAgICBjb25zdCBzdHJvbmcgPSByLnF1ZXJ5U2VsZWN0b3IoJ3N0cm9uZycpPy50ZXh0Q29udGVudCB8fCAnJzsKICAgICAgY29uc3Qgc3BhbnMgPSByLnF1ZXJ5U2VsZWN0b3JBbGwoJ3NwYW4nKTsKICAgICAgY29uc3QgYSA9IHNwYW5zWzBdPy50ZXh0Q29udGVudCA/PyAn4oCUJzsKICAgICAgY29uc3QgYiA9IHNwYW5zWzFdPy50ZXh0Q29udGVudCA/PyAn4oCUJzsKICAgICAgaWYoc3Ryb25nKSBvdFBhcnRzLnB1c2goYCR7YX0tJHtifWApOwogICAgfSk7CiAgfQogIGNvbnN0IHFMaW5lID0gcUxpbmVCYXNlICsgKG90UGFydHMubGVuZ3RoID8gKCcgLyAnICsgb3RQYXJ0cy5qb2luKCcgLyAnKSkgOiAnJyk7CgogIC8vIE1FVEEgKHByaW1hIHJpZ2EgUERGKQogIGNvbnN0IGluZm9UZXh0ID0gWwogICAgY2FtcCAhPT0gJ+KAlCcgPyBgQ2F0OiAke2NhbXB9YCA6IG51bGwsCiAgICBnaXIgICE9PSAn4oCUJyA/IGBHaXI6ICR7Z2lyfWAgOiBudWxsLAogICAgZGF0YSAhPT0gJ+KAlCcgPyBgRGF0YTogJHtkYXRhfWA6IG51bGwsCiAgICBnaW9yICE9PSAn4oCUJyA/IGBHaW9ybmF0YTogJHtnaW9yfWAgOiBudWxsLAogICAgYXIgICAhPT0gJ+KAlCcgPyBgQS9SOiAke2FyfWAgICA6IG51bGwsCiAgICBjZiAgICE9PSAn4oCUJyA/IGBDL0Y6ICR7Y2Z9YCAgIDogbnVsbCwKICAgIGFyYjEgIT09ICfigJQnID8gYEFyYjE6ICR7YXJiMX1gOiBudWxsLAogICAgYXJiMiAhPT0gJ+KAlCcgPyBgQXJiMjogJHthcmIyfWA6IG51bGwsCiAgXS5maWx0ZXIoQm9vbGVhbikuam9pbignICAg4oCiICAgJykgfHwgJ+KAlCc7CiAgY29uc3QgbWV0YUxpbmUxID0gaW5mb1RleHQ7CiAgY29uc3QgbWV0YUxpbmUyID0gYFBhcnppYWxpOiAke3FMaW5lfWA7CgoKICBjb25zdCBkb2MgPSBuZXcganNQREYoeyBvcmllbnRhdGlvbjonbGFuZHNjYXBlJywgdW5pdDonbW0nLCBmb3JtYXQ6J2E0JyB9KTsKCiAgY29uc3QgcGFnZVcgPSBkb2MuaW50ZXJuYWwucGFnZVNpemUuZ2V0V2lkdGgoKTsKICBjb25zdCBwYWdlSCA9IGRvYy5pbnRlcm5hbC5wYWdlU2l6ZS5nZXRIZWlnaHQoKTsKICBjb25zdCBtYXJnaW5YID0gNjsKICBjb25zdCBtYXJnaW5Ub3AgPSA2OwogIGNvbnN0IHVzYWJsZVcgPSBwYWdlVyAtIG1hcmdpblgqMjsKCiAgLy8gSW50ZXN0YXppb25lID0gTUVUQSBwYXJ0aXRhIChwcmltYSByaWdhKQogIGRvYy5zZXRGb250KCdoZWx2ZXRpY2EnLCAnYm9sZCcpOwogIGRvYy5zZXRGb250U2l6ZSgxMCk7CiAgZG9jLnRleHQobWV0YUxpbmUxLCBtYXJnaW5YLCBtYXJnaW5Ub3AgKyA2KTsKCiAgLy8gU2Vjb25kYSByaWdhOiBzcXVhZHJlIC8gcmlzdWx0YXRvIC8gcGVyaW9kbwogIGRvYy5zZXRGb250U2l6ZSgxMSk7CiAgZG9jLnRleHQoYCR7YU5hbWV9IHZzICR7Yk5hbWV9ICAg4oCiICAgUmlzdWx0YXRvOiAke3Njb3JlQX0tJHtzY29yZUJ9YCwgbWFyZ2luWCwgbWFyZ2luVG9wICsgMTEpOwoKICAvLyBQYXJ6aWFsaSAodGVyemEgcmlnYSkKICBkb2Muc2V0Rm9udCgnaGVsdmV0aWNhJywgJ25vcm1hbCcpOwogIGRvYy5zZXRGb250U2l6ZSg5KTsKICBkb2MudGV4dChtZXRhTGluZTIsIG1hcmdpblgsIG1hcmdpblRvcCArIDE2KTsKCgogIGNvbnN0IHN0YXJ0WSA9IG1hcmdpblRvcCArIDIwOwoKICBjb25zdCBjb2x1bW5zID0gWycjJywnQXRsZXRhJywnUFRTJywnRkYnLCdNSU4nLCdQL00nLCcyUFQnLCczUFQnLCdUTCcsJ0ZTJywnUkEnLCdSRCcsJ0EnLCdQUCcsJ1BSJywnU1RmJywnU1RzJywnUElSJywnT0VSJywnKy8tJ107CgogIGZ1bmN0aW9uIHJvd3NGb3JQREYoYXJyKXsKICAgIGNvbnN0IHNvcnRlZCA9IFsuLi5hcnJdLnNvcnQoKGEsYik9PiAoTnVtYmVyKGEubnVtfHwwKSAtIE51bWJlcihiLm51bXx8MCkpKTsKICAgIHJldHVybiBzb3J0ZWQubWFwKHAgPT4gKFsKICAgICAgU3RyaW5nKHAubnVtID8/ICcnKSwKICAgICAgU3RyaW5nKHAubmFtZSA/PyAnJyksCiAgICAgIFN0cmluZyhwLnB0c3x8MCksCiAgICAgIFN0cmluZyhwLmZmfHwwKSwKICAgICAgZm9ybWF0VGltZShwLm1pbnx8MCksCiAgICAgIHN0YXRzUE0ocCksCiAgICAgIGAkeyhwWycycHQnXT8ubWFkZXx8MCl9LyR7KHBbJzJwdCddPy5hdHR8fDApfWAsCiAgICAgIGAkeyhwWyczcHQnXT8ubWFkZXx8MCl9LyR7KHBbJzNwdCddPy5hdHR8fDApfWAsCiAgICAgIGAkeyhwLnRsPy5tYWRlfHwwKX0vJHsocC50bD8uYXR0fHwwKX1gLAogICAgICBTdHJpbmcocC5mc3x8MCksCiAgICAgIFN0cmluZyhwLnJhfHwwKSwKICAgICAgU3RyaW5nKHAucmR8fDApLAogICAgICBTdHJpbmcocC5hfHwwKSwKICAgICAgU3RyaW5nKHAucHB8fDApLAogICAgICBTdHJpbmcocC5wcnx8MCksCiAgICAgIFN0cmluZyhwLnN0Znx8MCksCiAgICAgIFN0cmluZyhwLnN0c3x8MCksCiAgICAgIFN0cmluZyhjYWxjUElSKHApKSwKICAgICAgZm10T0VSKGNhbGNPRVIocCkpLAogICAgICBmbXRQTShwLnBtfHwwKSwKICAgIF0pKTsKICB9CgogIGZ1bmN0aW9uIHRvdGFsc1JvdyhhcnIpewogICAgY29uc3QgdG90YWxzID0gdGVhbVRvdGFscyhhcnIpOwogICAgY29uc3Qgb2VyVG90ID0gZm10T0VSKGNhbGNPRVIodG90YWxzKSk7CiAgICBjb25zdCBwaXJUb3QgPSBhcnIucmVkdWNlKChzdW0scCk9PiBzdW0gKyBjYWxjUElSKHApLCAwKTsKICAgIHJldHVybiBbCiAgICAgICcnLCAnVE9UJywKICAgICAgU3RyaW5nKHRvdGFscy5wdHMpLAogICAgICBTdHJpbmcodG90YWxzLmZmKSwKICAgICAgZm9ybWF0VGltZSh0b3RhbHMubWluKSwKICAgICAgc3RhdHNQTSh0b3RhbHMpLAogICAgICBgJHt0b3RhbHNbJzJwdCddLm1hZGV9LyR7dG90YWxzWycycHQnXS5hdHR9YCwKICAgICAgYCR7dG90YWxzWyczcHQnXS5tYWRlfS8ke3RvdGFsc1snM3B0J10uYXR0fWAsCiAgICAgIGAke3RvdGFscy50bC5tYWRlfS8ke3RvdGFscy50bC5hdHR9YCwKICAgICAgU3RyaW5nKHRvdGFscy5mcyksCiAgICAgIFN0cmluZyh0b3RhbHMucmEpLAogICAgICBTdHJpbmcodG90YWxzLnJkKSwKICAgICAgU3RyaW5nKHRvdGFscy5hKSwKICAgICAgU3RyaW5nKHRvdGFscy5wcCksCiAgICAgIFN0cmluZyh0b3RhbHMucHIpLAogICAgICBTdHJpbmcodG90YWxzLnN0ZiksCiAgICAgIFN0cmluZyh0b3RhbHMuc3RzKSwKICAgICAgU3RyaW5nKHBpclRvdCksCiAgICAgIFN0cmluZyhvZXJUb3QpLAogICAgICBmbXRQTSh0b3RhbHMucG18fDApLAogICAgXTsKICB9CgogICAgLy8gPT09IFRBQkVMTEEgU1FVQURSQSBBIChwYWdpbmEgMSkgPT09CiAgLy8gVGl0b2xvIFNxdWFkcmEgQQogIGRvYy5zZXRGb250KCdoZWx2ZXRpY2EnLCdib2xkJyk7CiAgZG9jLnNldEZvbnRTaXplKDEyKTsKICBkb2MudGV4dChhTmFtZSwgbWFyZ2luWCwgc3RhcnRZICsgMik7CgogIGNvbnN0IGJvZHlBID0gW107CiAgcm93c0ZvclBERihwbGF5ZXJzQSkuZm9yRWFjaChyID0+IGJvZHlBLnB1c2gocikpOwogIGJvZHlBLnB1c2godG90YWxzUm93KHBsYXllcnNBKSk7CgogIGRvYy5hdXRvVGFibGUoewpzdGFydFk6IHN0YXJ0WSArIDYsCiAgICBtYXJnaW46IHsgbGVmdDogbWFyZ2luWCwgcmlnaHQ6IG1hcmdpblggfSwKICAgIGhlYWQ6IFtjb2x1bW5zXSwKICAgIGJvZHk6IGJvZHlBLAogICAgdGhlbWU6ICdncmlkJywKICAgIHN0eWxlczogeyBmb250U2l6ZTogNi4yLCBjZWxsUGFkZGluZzogMC44NSwgb3ZlcmZsb3c6ICdsaW5lYnJlYWsnLCB2YWxpZ246ICdtaWRkbGUnIH0sCiAgICBhbHRlcm5hdGVSb3dTdHlsZXM6IHsgZmlsbENvbG9yOiBbMjMwLDIzMCwyMzBdIH0sCiAgICBoZWFkU3R5bGVzOiB7IGZpbGxDb2xvcjogWzAsMCwwXSwgdGV4dENvbG9yOiBbMjU1LDI1NSwyNTVdLCBmb250U2l6ZTogNi42LCBjZWxsUGFkZGluZzogMC44NTUgfSwKICAgIGNvbHVtblN0eWxlczogeyAwOntjZWxsV2lkdGg6Nn0sIDE6e2NlbGxXaWR0aDozOH0gfSwKICAgIHBhZ2VCcmVhazogJ2F1dG8nLAogICAgZGlkUGFyc2VDZWxsOiAoZGF0YSk9PnsKICAgICAgY29uc3QgciA9IGRhdGEucm93Py5yYXc7CiAgICAgIC8vIEV2aWRlbnppYSByaWdhIFRPVAogICAgICBpZihBcnJheS5pc0FycmF5KHIpICYmIHJbMV0gPT09ICdUT1QnKXsKICAgICAgICBkYXRhLmNlbGwuc3R5bGVzLmZvbnRTdHlsZSA9ICdib2xkJzsKICAgICAgICBkYXRhLmNlbGwuc3R5bGVzLmZpbGxDb2xvciA9IFsyMTAsMjMwLDI1NV07CiAgICAgICAgZGF0YS5jZWxsLnN0eWxlcy50ZXh0Q29sb3IgPSBbMCwwLDBdOwogICAgICB9CiAgICAgIC8vIE5vbWUgYXRsZXRhIGluIGdyYXNzZXR0byAoY29sb25uYSBBdGxldGEpCiAgICAgIGlmKGRhdGEuc2VjdGlvbiA9PT0gJ2JvZHknICYmIGRhdGEuY29sdW1uPy5pbmRleCA9PT0gMSAmJiBBcnJheS5pc0FycmF5KHIpICYmIHJbMV0gIT09ICdUT1QnKXsKICAgICAgICBkYXRhLmNlbGwuc3R5bGVzLmZvbnRTdHlsZSA9ICdib2xkJzsKICAgICAgfQogICAgfSxkaWREcmF3UGFnZTogKGRhdGEpPT57CiAgICAgIHRyeXsKICAgICAgICBjb25zdCB0ZWFtTGFiZWwgPSBhTmFtZTsKICAgICAgICBjb25zdCBkYXRlTGFiZWwgPSAoZGF0YUdhcmE/LnZhbHVlIHx8ICcnKS50cmltKCkgfHwgJ+KAlCc7CiAgICAgICAgY29uc3QgZm9vdGVyTGVmdCA9IGAke3RlYW1MYWJlbH0g4oCiICR7ZGF0ZUxhYmVsfWA7CiAgICAgICAgY29uc3QgZm9vdGVyUmlnaHQgPSBgUGFnLiAke2RhdGEucGFnZU51bWJlcn1gOwogICAgICAgIGRvYy5zZXRGb250KCdoZWx2ZXRpY2EnLCdub3JtYWwnKTsKICAgICAgICBkb2Muc2V0Rm9udFNpemUoOCk7CiAgICAgICAgZG9jLnRleHQoZm9vdGVyTGVmdCwgbWFyZ2luWCwgcGFnZUggLSA1KTsKICAgICAgICBkb2MudGV4dChmb290ZXJSaWdodCwgcGFnZVcgLSBtYXJnaW5YLCBwYWdlSCAtIDUsIHsgYWxpZ246ICdyaWdodCcKfSk7Cn1jYXRjaChlKXt9CiAgICB9CiAgfSk7CgogIC8vID09PSBOVU9WQSBQQUdJTkEgKyBJTlRFU1RBWklPTkUgKHBhZ2luYSAyKSA9PT0KICBkb2MuYWRkUGFnZSgpOwogIGRvYy5zZXRGb250KCdoZWx2ZXRpY2EnLCAnYm9sZCcpOwogIGRvYy5zZXRGb250U2l6ZSgxMCk7CiAgZG9jLnRleHQobWV0YUxpbmUxLCBtYXJnaW5YLCBtYXJnaW5Ub3AgKyA2KTsKICBkb2Muc2V0Rm9udFNpemUoMTEpOwogIGRvYy50ZXh0KGAke2FOYW1lfSB2cyAke2JOYW1lfSAgIOKAoiAgIFJpc3VsdGF0bzogJHtzY29yZUF9LSR7c2NvcmVCfWAsIG1hcmdpblgsIG1hcmdpblRvcCArIDExKTsKICBkb2Muc2V0Rm9udCgnaGVsdmV0aWNhJywgJ25vcm1hbCcpOwogIGRvYy5zZXRGb250U2l6ZSg5KTsKICBkb2MudGV4dChtZXRhTGluZTIsIG1hcmdpblgsIG1hcmdpblRvcCArIDE2KTsKICBjb25zdCBzdGFydFkyID0gbWFyZ2luVG9wICsgMjA7CgogIC8vID09PSBUQUJFTExBIFNRVUFEUkEgQiAocGFnaW5hIDIpID09PQogIC8vIFRpdG9sbyBTcXVhZHJhIEIKICBkb2Muc2V0Rm9udCgnaGVsdmV0aWNhJywnYm9sZCcpOwogIGRvYy5zZXRGb250U2l6ZSgxMik7CiAgZG9jLnRleHQoYk5hbWUsIG1hcmdpblgsIHN0YXJ0WTIgKyAyKTsKCiAgY29uc3QgYm9keUIgPSBbXTsKICByb3dzRm9yUERGKHBsYXllcnNCKS5mb3JFYWNoKHIgPT4gYm9keUIucHVzaChyKSk7CiAgYm9keUIucHVzaCh0b3RhbHNSb3cocGxheWVyc0IpKTsKCiAgZG9jLmF1dG9UYWJsZSh7CnN0YXJ0WTogc3RhcnRZMiArIDYsCiAgICBtYXJnaW46IHsgbGVmdDogbWFyZ2luWCwgcmlnaHQ6IG1hcmdpblggfSwKICAgIGhlYWQ6IFtjb2x1bW5zXSwKICAgIGJvZHk6IGJvZHlCLAogICAgdGhlbWU6ICdncmlkJywKICAgIHN0eWxlczogeyBmb250U2l6ZTogNi4yLCBjZWxsUGFkZGluZzogMC44NSwgb3ZlcmZsb3c6ICdsaW5lYnJlYWsnLCB2YWxpZ246ICdtaWRkbGUnIH0sCiAgICBhbHRlcm5hdGVSb3dTdHlsZXM6IHsgZmlsbENvbG9yOiBbMjMwLDIzMCwyMzBdIH0sCiAgICBoZWFkU3R5bGVzOiB7IGZpbGxDb2xvcjogWzAsMCwwXSwgdGV4dENvbG9yOiBbMjU1LDI1NSwyNTVdLCBmb250U2l6ZTogNi42LCBjZWxsUGFkZGluZzogMC44NTUgfSwKICAgIGNvbHVtblN0eWxlczogeyAwOntjZWxsV2lkdGg6Nn0sIDE6e2NlbGxXaWR0aDozOH0gfSwKICAgIHBhZ2VCcmVhazogJ2F1dG8nLAogICAgZGlkUGFyc2VDZWxsOiAoZGF0YSk9PnsKICAgICAgY29uc3QgciA9IGRhdGEucm93Py5yYXc7CiAgICAgIC8vIEV2aWRlbnppYSByaWdhIFRPVAogICAgICBpZihBcnJheS5pc0FycmF5KHIpICYmIHJbMV0gPT09ICdUT1QnKXsKICAgICAgICBkYXRhLmNlbGwuc3R5bGVzLmZvbnRTdHlsZSA9ICdib2xkJzsKICAgICAgICBkYXRhLmNlbGwuc3R5bGVzLmZpbGxDb2xvciA9IFsyMTAsMjMwLDI1NV07CiAgICAgICAgZGF0YS5jZWxsLnN0eWxlcy50ZXh0Q29sb3IgPSBbMCwwLDBdOwogICAgICB9CiAgICAgIC8vIE5vbWUgYXRsZXRhIGluIGdyYXNzZXR0byAoY29sb25uYSBBdGxldGEpCiAgICAgIGlmKGRhdGEuc2VjdGlvbiA9PT0gJ2JvZHknICYmIGRhdGEuY29sdW1uPy5pbmRleCA9PT0gMSAmJiBBcnJheS5pc0FycmF5KHIpICYmIHJbMV0gIT09ICdUT1QnKXsKICAgICAgICBkYXRhLmNlbGwuc3R5bGVzLmZvbnRTdHlsZSA9ICdib2xkJzsKICAgICAgfQogICAgfSxkaWREcmF3UGFnZTogKGRhdGEpPT57CiAgICAgIHRyeXsKICAgICAgICBjb25zdCB0ZWFtTGFiZWwgPSBiTmFtZTsKICAgICAgICBjb25zdCBkYXRlTGFiZWwgPSAoZGF0YUdhcmE/LnZhbHVlIHx8ICcnKS50cmltKCkgfHwgJ+KAlCc7CiAgICAgICAgY29uc3QgZm9vdGVyTGVmdCA9IGAke3RlYW1MYWJlbH0g4oCiICR7ZGF0ZUxhYmVsfWA7CiAgICAgICAgY29uc3QgZm9vdGVyUmlnaHQgPSBgUGFnLiAke2RhdGEucGFnZU51bWJlcn1gOwogICAgICAgIGRvYy5zZXRGb250KCdoZWx2ZXRpY2EnLCdub3JtYWwnKTsKICAgICAgICBkb2Muc2V0Rm9udFNpemUoOCk7CiAgICAgICAgZG9jLnRleHQoZm9vdGVyTGVmdCwgbWFyZ2luWCwgcGFnZUggLSA1KTsKICAgICAgICBkb2MudGV4dChmb290ZXJSaWdodCwgcGFnZVcgLSBtYXJnaW5YLCBwYWdlSCAtIDUsIHsgYWxpZ246ICdyaWdodCcKfSk7Cn1jYXRjaChlKXt9CiAgICB9CiAgfSk7CgogIGNvbnN0IHNhZmVBID0gYU5hbWUucmVwbGFjZUFsbCgnICcsJ18nKSB8fCAnU3F1YWRyYUEnOwogIGNvbnN0IHNhZmVCID0gYk5hbWUucmVwbGFjZUFsbCgnICcsJ18nKSB8fCAnU3F1YWRyYUInOwogIGNvbnN0IGlzbyA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zbGljZSgwLDE5KS5yZXBsYWNlQWxsKCc6JywnLScpOwogIGRvYy5zYXZlKGBzdGF0aXN0aWNoZV8ke3NhZmVBfV92c18ke3NhZmVCfV8ke2lzb30ucGRmYCk7Cn0KCmZ1bmN0aW9uIGRvY0hhc0F1dG9UYWJsZSgpewogIHRyeXsKICAgIC8vIGpzUERGIGF1dG9UYWJsZSBwbHVnaW4gYXR0YWNoZXMgaXRzZWxmIGFzIGRvYy5hdXRvVGFibGUKICAgIGNvbnN0IHsganNQREYgfSA9IHdpbmRvdy5qc3BkZiB8fCB7fTsKICAgIGNvbnN0IHQgPSBuZXcganNQREYoKTsKICAgIHJldHVybiB0eXBlb2YgdC5hdXRvVGFibGUgPT09ICdmdW5jdGlvbic7CiAgfWNhdGNoKGUpeyByZXR1cm4gZmFsc2U7IH0KfQoKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PQogICBJTlBVVCBFVkVOVFMKPT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCm5hbWVBLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKCk9Pnsgc2F2ZVN0YXRlKCk7IHJlbmRlcigpOyB9KTsKbmFtZUIuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoKT0+eyBzYXZlU3RhdGUoKTsgcmVuZGVyKCk7IH0pOwoKY2FtcGlvbmF0by5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpPT4gc2F2ZVN0YXRlKCkpOwpnaXJvbmUuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoKT0+IHNhdmVTdGF0ZSgpKTsKZGF0YUdhcmEuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoKT0+IHNhdmVTdGF0ZSgpKTsKZ2lvcm5hdGEuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoKT0+IHNhdmVTdGF0ZSgpKTsKYXJiaXRybzEuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoKT0+IHNhdmVTdGF0ZSgpKTsKYXJiaXRybzIuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoKT0+IHNhdmVTdGF0ZSgpKTsKCmFuZGF0YVJpdG9ybm8uYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoKT0+ewogIGxldCB2ID0gKGFuZGF0YVJpdG9ybm8udmFsdWUgfHwgJycpLnRvVXBwZXJDYXNlKCkucmVwbGFjZUFsbCgvW15BUl0vZywnJyk7CiAgYW5kYXRhUml0b3Juby52YWx1ZSA9IHYuc2xpY2UoMCwxKTsKICBzYXZlU3RhdGUoKTsKfSk7CmNhc2FGdW9yaS5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpPT57CiAgbGV0IHYgPSAoY2FzYUZ1b3JpLnZhbHVlIHx8ICcnKS50b1VwcGVyQ2FzZSgpLnJlcGxhY2VBbGwoL1teQ0ZdL2csJycpOwogIGNhc2FGdW9yaS52YWx1ZSA9IHYuc2xpY2UoMCwxKTsKICBzYXZlU3RhdGUoKTsKfSk7CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgSU1QT1JUIERBIEZJTEUgKHNpbmdvbGEgcGFydGl0YSkKPT09PT09PT09PT09PT09PT09PT09PT09PT09ICovCmZ1bmN0aW9uIGFwcGx5U3RhdGVPYmplY3Qocyl7CiAgc3RvcENsb2NrKCk7CiAgZ2FtZUNsb3NlZCA9IGZhbHNlOwptaW51c01vZGUgPSBmYWxzZTsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWludXNCdG4nKT8uY2xhc3NMaXN0LnJlbW92ZSgnYWN0aXZlJyk7CiAgdW5kb1N0YWNrID0gW107CiAgdW5kb0luZm8udGV4dENvbnRlbnQgPSAn4oCUJzsKCiAgaWYocz8udGVhbUEpIHRlYW1BID0gcy50ZWFtQTsKICBpZihzPy50ZWFtQikgdGVhbUIgPSBzLnRlYW1COwogIGlmKEFycmF5LmlzQXJyYXkocz8ucGxheWVyc0EpKSBwbGF5ZXJzQSA9IHMucGxheWVyc0E7CiAgaWYoQXJyYXkuaXNBcnJheShzPy5wbGF5ZXJzQikpIHBsYXllcnNCID0gcy5wbGF5ZXJzQjsKCiAgaWYodHlwZW9mIHM/LmN1cnJlbnRRdWFydGVyID09PSAnbnVtYmVyJykgY3VycmVudFF1YXJ0ZXIgPSBzLmN1cnJlbnRRdWFydGVyOwogIGlmKHR5cGVvZiBzPy5sYXN0U2NvcmVBID09PSAnbnVtYmVyJykgbGFzdFNjb3JlQSA9IHMubGFzdFNjb3JlQTsKICBpZih0eXBlb2Ygcz8ubGFzdFNjb3JlQiA9PT0gJ251bWJlcicpIGxhc3RTY29yZUIgPSBzLmxhc3RTY29yZUI7CiAgaWYodHlwZW9mIHM/LnNlYyA9PT0gJ251bWJlcicpIHNlYyA9IHMuc2VjOwoKICBpZihzPy51aSl7CiAgICBpZih0eXBlb2Ygcy51aS5uYW1lQSA9PT0gJ3N0cmluZycpIG5hbWVBLnZhbHVlID0gcy51aS5uYW1lQTsKICAgIGlmKHR5cGVvZiBzLnVpLm5hbWVCID09PSAnc3RyaW5nJykgbmFtZUIudmFsdWUgPSBzLnVpLm5hbWVCOwoKICAgIGlmKHR5cGVvZiBzLnVpLmNhbXBpb25hdG8gPT09ICdzdHJpbmcnKSBjYW1waW9uYXRvLnZhbHVlID0gcy51aS5jYW1waW9uYXRvOwogICAgaWYodHlwZW9mIHMudWkuZ2lyb25lID09PSAnc3RyaW5nJykgZ2lyb25lLnZhbHVlID0gcy51aS5naXJvbmU7CiAgICBpZih0eXBlb2Ygcy51aS5kYXRhR2FyYSA9PT0gJ3N0cmluZycpIGRhdGFHYXJhLnZhbHVlID0gcy51aS5kYXRhR2FyYTsKICAgIGlmKHR5cGVvZiBzLnVpLmdpb3JuYXRhID09PSAnc3RyaW5nJykgZ2lvcm5hdGEudmFsdWUgPSBzLnVpLmdpb3JuYXRhOwogICAgaWYodHlwZW9mIHMudWkuYW5kYXRhUml0b3JubyA9PT0gJ3N0cmluZycpIGFuZGF0YVJpdG9ybm8udmFsdWUgPSBzLnVpLmFuZGF0YVJpdG9ybm87CiAgICBpZih0eXBlb2Ygcy51aS5jYXNhRnVvcmkgPT09ICdzdHJpbmcnKSBjYXNhRnVvcmkudmFsdWUgPSBzLnVpLmNhc2FGdW9yaTsKICAgIGlmKHR5cGVvZiBzLnVpLmFyYml0cm8xID09PSAnc3RyaW5nJykgYXJiaXRybzEudmFsdWUgPSBzLnVpLmFyYml0cm8xOwogICAgaWYodHlwZW9mIHMudWkuYXJiaXRybzIgPT09ICdzdHJpbmcnKSBhcmJpdHJvMi52YWx1ZSA9IHMudWkuYXJiaXRybzI7CiAgfQoKICBpZihzPy5xdWFydGVycyl7CiAgICBmb3IoY29uc3QgayBvZiBbJ3ExYScsJ3ExYicsJ3EyYScsJ3EyYicsJ3EzYScsJ3EzYicsJ3E0YScsJ3E0YiddKXsKICAgICAgY29uc3QgZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChrKTsKICAgICAgCiAgLy8gTnVvdmEgcGFnaW5hIHBlciBTcXVhZHJhIEIKICBkb2MuYWRkUGFnZSgpOwppZihlbCAmJiB0eXBlb2Ygcy5xdWFydGVyc1trXSA9PT0gJ3N0cmluZycpIGVsLnRleHRDb250ZW50ID0gcy5xdWFydGVyc1trXTsKICAgIH0KICAgIHJlYnVpbGRPdFJvd3NGcm9tU3RhdGUocy5xdWFydGVycyk7CiAgfQoKICBwbGF5ZXJzQSA9IG5vcm1hbGl6ZVBsYXllcnMocGxheWVyc0EsIDEyLCAnQScpOwogIHBsYXllcnNCID0gbm9ybWFsaXplUGxheWVycyhwbGF5ZXJzQiwgMTIsICdCJyk7CgogIGNvbnN0IGZpeE1pbiA9IChhcnIpPT57CiAgICBhcnIuZm9yRWFjaChwPT57CiAgICAgIGNvbnN0IHYgPSBOdW1iZXIocC5taW4pOwogICAgICBpZiAoIU51bWJlci5pc0Zpbml0ZSh2KSkgeyBwLm1pbiA9IDA7IHJldHVybjsgfQogICAgICBpZiAoIU51bWJlci5pc0ludGVnZXIodikpIHAubWluID0gTWF0aC5yb3VuZCh2ICogNjApOwogICAgICBlbHNlIHAubWluID0gdjsKICAgIH0pOwogIH07CiAgZml4TWluKHBsYXllcnNBKTsgZml4TWluKHBsYXllcnNCKTsKCiAgdGVhbUEudG8gPSBOdW1iZXIodGVhbUEudG98fDApOyB0ZWFtQi50byA9IE51bWJlcih0ZWFtQi50b3x8MCk7CiAgdGVhbUEuZnRzID0gTnVtYmVyKHRlYW1BLmZ0c3x8MCk7IHRlYW1CLmZ0cyA9IE51bWJlcih0ZWFtQi5mdHN8fDApOwoKICBwbGF5ZXJzQS5mb3JFYWNoKHA9PnsKICAgIGlmKHR5cGVvZiBwLnBtICE9PSAnbnVtYmVyJykgcC5wbSA9IDA7CiAgICBpZih0eXBlb2YgcC5leHBlbGxlZCAhPT0gJ2Jvb2xlYW4nKSBwLmV4cGVsbGVkID0gZmFsc2U7CiAgICBpZih0eXBlb2YgcC5pbiAhPT0gJ2Jvb2xlYW4nKSBwLmluID0gZmFsc2U7CiAgfSk7CiAgcGxheWVyc0IuZm9yRWFjaChwPT57CiAgICBpZih0eXBlb2YgcC5wbSAhPT0gJ251bWJlcicpIHAucG0gPSAwOwogICAgaWYodHlwZW9mIHAuZXhwZWxsZWQgIT09ICdib29sZWFuJykgcC5leHBlbGxlZCA9IGZhbHNlOwogICAgaWYodHlwZW9mIHAuaW4gIT09ICdib29sZWFuJykgcC5pbiA9IGZhbHNlOwogIH0pOwoKICB0cnl7IGxvY2FsU3RvcmFnZS5zZXRJdGVtKFNUT1JBR0VfS0VZLCBKU09OLnN0cmluZ2lmeShzKSk7IH1jYXRjaChlKXt9CgogIHVuZG9JbmZvLnRleHRDb250ZW50ID0gJ0NhcmljYXRvJzsKICByZW5kZXIoKTsKfQoKZnVuY3Rpb24gbG9hZEdhbWVGcm9tRmlsZSgpewogIGNvbnN0IGlucHV0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICBpbnB1dC50eXBlID0gJ2ZpbGUnOwogIGlucHV0LmFjY2VwdCA9ICdhcHBsaWNhdGlvbi9qc29uLC5qc29uJzsKICBpbnB1dC5vbmNoYW5nZSA9IGFzeW5jICgpID0+IHsKICAgIGNvbnN0IGZpbGUgPSBpbnB1dC5maWxlcz8uWzBdOwogICAgaWYoIWZpbGUpIHJldHVybjsKICAgIHRyeXsKICAgICAgbGV0IHRleHQgPSBhd2FpdCBmaWxlLnRleHQoKTsKICAgICAgaWYodGV4dC5jaGFyQ29kZUF0KDApID09PSAweEZFRkYpIHRleHQgPSB0ZXh0LnNsaWNlKDEpOwogICAgICBjb25zdCBwYXlsb2FkID0gSlNPTi5wYXJzZSh0ZXh0KTsKCiAgICAgIGlmKHBheWxvYWQ/Ll9fdHlwZSA9PT0gJ2Jhc2tldF9zdGF0c19tYXRjaCcgJiYgcGF5bG9hZC5zbmFwc2hvdHMpewogICAgICAgIENVUlJFTlRfR0FNRV9JRCA9IFN0cmluZyhwYXlsb2FkPy5tZXRhPy5nYW1lSWR8fCcnKS50cmltKCkgfHwgY29tcHV0ZUdhbWVJZCgpOwogICAgICAgIFNOQVBTSE9UX1NUT1JFID0geyBnYW1lSWQ6IENVUlJFTlRfR0FNRV9JRCwgYmFzZU1ldGE6IHBheWxvYWQubWV0YSB8fCB7fSwgc25hcHM6IHBheWxvYWQuc25hcHNob3RzIHx8IHt9IH07CgogICAgICAgIGNvbnN0IG9yZGVyID0gKGspPT57CiAgICAgICAgICBrID0gU3RyaW5nKGt8fCcnKS50b1VwcGVyQ2FzZSgpOwogICAgICAgICAgaWYoaz09PSdGSU5BTCcpIHJldHVybiA5OTk5OwogICAgICAgICAgY29uc3QgcSA9IGsubWF0Y2goL15RKFxkKykkLyk7IGlmKHEpIHJldHVybiBwYXJzZUludChxWzFdLDEwKTsKICAgICAgICAgIGNvbnN0IG90ID0gay5tYXRjaCgvXk9UKFxkKykkLyk7IGlmKG90KSByZXR1cm4gMTAwK3BhcnNlSW50KG90WzFdLDEwKTsKICAgICAgICAgIHJldHVybiA1MDAwOwogICAgICAgIH07CiAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKFNOQVBTSE9UX1NUT1JFLnNuYXBzIHx8IHt9KTsKICAgICAgICBjb25zdCBwaWNrID0ga2V5cy5pbmNsdWRlcygnRklOQUwnKSA/ICdGSU5BTCcgOiBrZXlzLnNvcnQoKGEsYik9Pm9yZGVyKGEpLW9yZGVyKGIpKS5wb3AoKTsKICAgICAgICBjb25zdCBjaG9zZW4gPSBTTkFQU0hPVF9TVE9SRS5zbmFwc1twaWNrXTsKICAgICAgICBpZihjaG9zZW4gJiYgY2hvc2VuLnN0YXRlKXsKICAgICAgICAgIGFwcGx5U3RhdGVPYmplY3QoY2hvc2VuLnN0YXRlKTsKICAgICAgICAgIHNob3dUb2FzdD8uKCdDYXJpY2F0byBmaWxlIHVuaWNvIChtYXRjaCkuJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFsZXJ0KCdGaWxlIG1hdGNoIGNhcmljYXRvIG1hIHNuYXBzaG90IHZ1b3RpL25vbiB2YWxpZGkuJyk7CiAgICAgICAgfQogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYocGF5bG9hZD8uX190eXBlID09PSAnYmFza2V0X3N0YXRzX2dhbWUnICYmIHBheWxvYWQuc3RhdGUpewogICAgICAgIGFwcGx5U3RhdGVPYmplY3QocGF5bG9hZC5zdGF0ZSk7CiAgICAgICAgbWVyZ2VJbXBvcnRlZEdhbWVzKFt7CiAgICAgICAgICBpZDogcGF5bG9hZC5tZXRhPy5pZCwKICAgICAgICAgIG5hbWU6IHBheWxvYWQubWV0YT8ubmFtZSB8fCAoJ0ltcG9ydCAnICsgZmlsZS5uYW1lKSwKICAgICAgICAgIGRhdGU6IHBheWxvYWQubWV0YT8uZGF0ZSB8fCBwYXlsb2FkLnN0YXRlPy51aT8uZGF0YUdhcmEgfHwgJycsCiAgICAgICAgICBhTmFtZTogcGF5bG9hZC5tZXRhPy5hTmFtZSB8fCBwYXlsb2FkLnN0YXRlPy51aT8ubmFtZUEgfHwgJ1NxdWFkcmEgQScsCiAgICAgICAgICBiTmFtZTogcGF5bG9hZC5tZXRhPy5iTmFtZSB8fCBwYXlsb2FkLnN0YXRlPy51aT8ubmFtZUIgfHwgJ1NxdWFkcmEgQicsCiAgICAgICAgICBvcHBvbmVudDogcGF5bG9hZC5tZXRhPy5vcHBvbmVudCB8fCBwYXlsb2FkLm1ldGE/LmJOYW1lIHx8IHBheWxvYWQuc3RhdGU/LnVpPy5uYW1lQiB8fCAnJywKICAgICAgICAgIHNhdmVkQXQ6IHBheWxvYWQubWV0YT8uc2F2ZWRBdCB8fCBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICBzdGF0ZTogcGF5bG9hZC5zdGF0ZQogICAgICAgIH1dKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmKHBheWxvYWQ/LnRlYW1BICYmIHBheWxvYWQ/LnBsYXllcnNBKXsKICAgICAgICBhcHBseVN0YXRlT2JqZWN0KHBheWxvYWQpOwogICAgICAgIG1lcmdlSW1wb3J0ZWRHYW1lcyhbewogICAgICAgICAgaWQ6IG1ha2VHYW1lSWQoKSwKICAgICAgICAgIG5hbWU6ICdJbXBvcnQgJyArIGZpbGUubmFtZS5yZXBsYWNlQWxsKCcuanNvbicsJycpLAogICAgICAgICAgZGF0ZTogcGF5bG9hZD8udWk/LmRhdGFHYXJhIHx8ICcnLAogICAgICAgICAgYU5hbWU6IHBheWxvYWQ/LnVpPy5uYW1lQSB8fCAnU3F1YWRyYSBBJywKICAgICAgICAgIGJOYW1lOiBwYXlsb2FkPy51aT8ubmFtZUIgfHwgJ1NxdWFkcmEgQicsCiAgICAgICAgICBvcHBvbmVudDogcGF5bG9hZD8udWk/Lm5hbWVCIHx8ICcnLAogICAgICAgICAgc2F2ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLAogICAgICAgICAgc3RhdGU6IHBheWxvYWQKICAgICAgICB9XSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBhbGVydCgnRmlsZSBub24gcmljb25vc2NpdXRvLicpOwogICAgfWNhdGNoKGUpewogICAgICBjb25zb2xlLmVycm9yKGUpOwogICAgICBhbGVydCgnRmlsZSBub24gdmFsaWRvIG8gY29ycm90dG8uJyk7CiAgICB9CiAgfTsKICBpbnB1dC5jbGljaygpOwp9CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgTElCUkVSSUEgUEFSVElURQo9PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KY29uc3QgTElCX0tFWSA9ICdiYXNrZXRfc3RhdHNfZ2FtZXNfbGlicmFyeV9maWxlX3VuaWNvX3YxJzsKCmZ1bmN0aW9uIGxpYkxvYWQoKXsKICB0cnl7CiAgICBjb25zdCByYXcgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShMSUJfS0VZKTsKICAgIGNvbnN0IGFyciA9IHJhdyA/IEpTT04ucGFyc2UocmF3KSA6IFtdOwogICAgcmV0dXJuIEFycmF5LmlzQXJyYXkoYXJyKSA/IGFyciA6IFtdOwogIH1jYXRjaChlKXsgcmV0dXJuIFtdOyB9Cn0KZnVuY3Rpb24gbGliU2F2ZShhcnIpewogIHRyeXsgbG9jYWxTdG9yYWdlLnNldEl0ZW0oTElCX0tFWSwgSlNPTi5zdHJpbmdpZnkoYXJyKSk7IH1jYXRjaChlKXt9Cn0KZnVuY3Rpb24gbWFrZUdhbWVJZCgpewogIHJldHVybiAnZ18nICsgRGF0ZS5ub3coKS50b1N0cmluZygzNikgKyAnXycgKyBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zbGljZSgyLDgpOwp9CgpmdW5jdGlvbiBzYXZlR2FtZVRvTGlicmFyeShmb3JjZWROYW1lKXsKICBjb25zdCBzdGF0ZSA9IHNuYXBzaG90U3RhdGUoKTsKICBjb25zdCBtZXRhID0gZ2V0TWV0YUZyb21VSSgpOwogIGNvbnN0IG5hbWUgPSBTdHJpbmcoZm9yY2VkTmFtZSB8fCBtZXRhLmRlZmF1bHROYW1lKS50cmltKCkgfHwgbWV0YS5kZWZhdWx0TmFtZTsKCiAgY29uc3QgZW50cnkgPSB7CiAgICBpZDogbWFrZUdhbWVJZCgpLAogICAgbmFtZSwKICAgIGRhdGU6IG1ldGEuZGF0ZSB8fCAnJywKICAgIGFOYW1lOiBtZXRhLmFOYW1lLAogICAgYk5hbWU6IG1ldGEuYk5hbWUsCiAgICBvcHBvbmVudDogbWV0YS5vcHBvbmVudCB8fCAnJywKICAgIHNhdmVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgIHN0YXRlCiAgfTsKCiAgY29uc3QgbGliID0gbGliTG9hZCgpOwogIGxpYi51bnNoaWZ0KGVudHJ5KTsKICBsaWJTYXZlKGxpYik7Cn0KCmZ1bmN0aW9uIG9wZW5HYW1lc0xpYnJhcnkoKXsKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZ2FtZXNPdmVybGF5Jykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgcmVuZGVyTGlicmFyeSgpOwp9CmZ1bmN0aW9uIGNsb3NlR2FtZXNMaWJyYXJ5KCl7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dhbWVzT3ZlcmxheScpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7Cn0KCmZ1bmN0aW9uIHJlbmRlckxpYnJhcnkoKXsKICBjb25zdCB0YiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdnYW1lc1Rib2R5Jyk7CiAgY29uc3QgaW5mbyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdsaWJJbmZvJyk7CiAgY29uc3QgbGliID0gbGliTG9hZCgpOwoKICBpbmZvLnRleHRDb250ZW50ID0gYFRvdGFsZTogJHtsaWIubGVuZ3RofWA7CiAgdGIuaW5uZXJIVE1MID0gJyc7CgogIGlmKCFsaWIubGVuZ3RoKXsKICAgIHRiLmlubmVySFRNTCA9IGA8dHI+CiAgICAgIDx0ZCBjb2xzcGFuPSI0IiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7IGNvbG9yOiM3ZjhjOGQ7IHBhZGRpbmc6MTBweDsiPk5lc3N1bmEgcGFydGl0YSBzYWx2YXRhLjwvdGQ+CiAgICA8L3RyPmA7CiAgICByZXR1cm47CiAgfQoKICBsaWIuZm9yRWFjaChnPT57CiAgICBjb25zdCBubSA9IGVzY0h0bWwoZy5uYW1lIHx8ICfigJQnKTsKICAgIGNvbnN0IGR0ID0gZXNjSHRtbChnLmRhdGUgfHwgJ+KAlCcpOwogICAgY29uc3Qgb3BwID0gZXNjSHRtbChnLm9wcG9uZW50IHx8IGcuYk5hbWUgfHwgJ+KAlCcpOwoKICAgIHRiLmlubmVySFRNTCArPSBgCiAgICAgIDx0cj4KICAgICAgICA8dGQgY2xhc3M9ImxpYi1lbGxpcHNpcyIgdGl0bGU9IiR7bm19Ij4ke25tfTwvdGQ+CiAgICAgICAgPHRkIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjsiPiR7ZHR9PC90ZD4KICAgICAgICA8dGQgY2xhc3M9ImxpYi1lbGxpcHNpcyIgdGl0bGU9IiR7b3BwfSI+JHtvcHB9PC90ZD4KICAgICAgICA8dGQgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyOyI+CiAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJibHVlIiBvbmNsaWNrPSJvcGVuR2FtZUJ5SWQoJyR7Zy5pZH0nKSI+QXByaTwvYnV0dG9uPgogICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iZ3JheSIgb25jbGljaz0iZXhwb3J0R2FtZUJ5SWQoJyR7Zy5pZH0nKSI+RXNwb3J0YTwvYnV0dG9uPgogICAgICAgICAgPGJ1dHRvbiBjbGFzcz0icmVkIiBvbmNsaWNrPSJkZWxldGVHYW1lQnlJZCgnJHtnLmlkfScpIj5FbGltaW5hPC9idXR0b24+CiAgICAgICAgPC90ZD4KICAgICAgPC90cj4KICAgIGA7CiAgfSk7Cn0KCmZ1bmN0aW9uIG9wZW5HYW1lQnlJZChpZCl7CiAgY29uc3QgbGliID0gbGliTG9hZCgpOwogIGNvbnN0IGcgPSBsaWIuZmluZCh4ID0+IHguaWQgPT09IGlkKTsKICBpZighZz8uc3RhdGUpIHJldHVybjsKICBhcHBseVN0YXRlT2JqZWN0KGcuc3RhdGUpOwogIHVuZG9JbmZvLnRleHRDb250ZW50ID0gJ0FwZXJ0bzogJyArIChnLm5hbWUgfHwgJ1BhcnRpdGEnKTsKICBjbG9zZUdhbWVzTGlicmFyeSgpOwp9CgpmdW5jdGlvbiBkZWxldGVHYW1lQnlJZChpZCl7CiAgY29uc3QgbGliID0gbGliTG9hZCgpOwogIGNvbnN0IGcgPSBsaWIuZmluZCh4ID0+IHguaWQgPT09IGlkKTsKICBjb25zdCBsYWJlbCA9IGc/Lm5hbWUgfHwgJ3F1ZXN0YSBwYXJ0aXRhJzsKICBpZighY29uZmlybShgRWxpbWluYXJlICIke2xhYmVsfSIgZGFsbGEgbGlicmVyaWE/YCkpIHJldHVybjsKICBsaWJTYXZlKGxpYi5maWx0ZXIoeCA9PiB4LmlkICE9PSBpZCkpOwogIHJlbmRlckxpYnJhcnkoKTsKfQoKZnVuY3Rpb24gY2xlYXJMaWJyYXJ5Q29uZmlybSgpewogIGNvbnN0IGxpYiA9IGxpYkxvYWQoKTsKICBpZighbGliLmxlbmd0aCkgcmV0dXJuOwogIGlmKCFjb25maXJtKCdTdnVvdGFyZSBjb21wbGV0YW1lbnRlIGxhIGxpYnJlcmlhIHBhcnRpdGU/JykpIHJldHVybjsKICBsaWJTYXZlKFtdKTsKICByZW5kZXJMaWJyYXJ5KCk7Cn0KCmZ1bmN0aW9uIGV4cG9ydEdhbWVCeUlkKGlkKXsKICBjb25zdCBsaWIgPSBsaWJMb2FkKCk7CiAgY29uc3QgZyA9IGxpYi5maW5kKHggPT4geC5pZCA9PT0gaWQpOwogIGlmKCFnKSByZXR1cm47CgogIGNvbnN0IHBheWxvYWQgPSB7CiAgICBfX3R5cGU6ICdiYXNrZXRfc3RhdHNfZ2FtZScsCiAgICBfX3ZlcnNpb246IDEsCiAgICBtZXRhOiB7CiAgICAgIGlkOiBnLmlkLAogICAgICBuYW1lOiBnLm5hbWUsCiAgICAgIGRhdGU6IGcuZGF0ZSwKICAgICAgYU5hbWU6IGcuYU5hbWUsCiAgICAgIGJOYW1lOiBnLmJOYW1lLAogICAgICBvcHBvbmVudDogZy5vcHBvbmVudCwKICAgICAgc2F2ZWRBdDogZy5zYXZlZEF0CiAgICB9LAogICAgc3RhdGU6IGcuc3RhdGUKICB9OwoKICBjb25zdCBqc29uID0gSlNPTi5zdHJpbmdpZnkocGF5bG9hZCwgbnVsbCwgMik7CiAgY29uc3Qgc3RhbXAgPSAoZy5zYXZlZEF0IHx8IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSkuc2xpY2UoMCwxOSkucmVwbGFjZUFsbCgnOicsJy0nKTsKICBjb25zdCBmaWxlbmFtZSA9IGBwYXJ0aXRhXyR7c2FmZUZpbGVuYW1lQmFzZShnLm5hbWUpfV8ke3N0YW1wfS5qc29uYDsKICBkb3dubG9hZEJsb2IoZmlsZW5hbWUsIG5ldyBCbG9iKFtqc29uXSwgeyB0eXBlOidhcHBsaWNhdGlvbi9qc29uO2NoYXJzZXQ9dXRmLTgnIH0pKTsKfQoKZnVuY3Rpb24gZXhwb3J0TGlicmFyeUJ1bmRsZSgpewogIGNvbnN0IGxpYiA9IGxpYkxvYWQoKTsKICBjb25zdCBwYXlsb2FkID0gewogICAgX190eXBlOiAnYmFza2V0X3N0YXRzX2xpYnJhcnknLAogICAgX192ZXJzaW9uOiAxLAogICAgZXhwb3J0ZWRBdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLAogICAgZ2FtZXM6IGxpYi5tYXAoZyA9PiAoewogICAgICBpZDogZy5pZCwKICAgICAgbmFtZTogZy5uYW1lLAogICAgICBkYXRlOiBnLmRhdGUsCiAgICAgIGFOYW1lOiBnLmFOYW1lLAogICAgICBiTmFtZTogZy5iTmFtZSwKICAgICAgb3Bwb25lbnQ6IGcub3Bwb25lbnQsCiAgICAgIHNhdmVkQXQ6IGcuc2F2ZWRBdCwKICAgICAgc3RhdGU6IGcuc3RhdGUKICAgIH0pKQogIH07CiAgY29uc3QganNvbiA9IEpTT04uc3RyaW5naWZ5KHBheWxvYWQsIG51bGwsIDIpOwogIGNvbnN0IHN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnNsaWNlKDAsMTkpLnJlcGxhY2VBbGwoJzonLCctJyk7CiAgZG93bmxvYWRCbG9iKGBsaWJyZXJpYV9wYXJ0aXRlXyR7c3RhbXB9Lmpzb25gLCBuZXcgQmxvYihbanNvbl0sIHsgdHlwZTonYXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04JyB9KSk7Cn0KCmZ1bmN0aW9uIGltcG9ydExpYnJhcnlCdW5kbGUoKXsKICBjb25zdCBpbnB1dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2lucHV0Jyk7CiAgaW5wdXQudHlwZSA9ICdmaWxlJzsKICBpbnB1dC5hY2NlcHQgPSAnYXBwbGljYXRpb24vanNvbiwuanNvbic7CiAgaW5wdXQub25jaGFuZ2UgPSBhc3luYyAoKSA9PiB7CiAgICBjb25zdCBmaWxlID0gaW5wdXQuZmlsZXM/LlswXTsKICAgIGlmKCFmaWxlKSByZXR1cm47CiAgICB0cnl7CiAgICAgIGxldCB0ZXh0ID0gYXdhaXQgZmlsZS50ZXh0KCk7CiAgICAgIGlmKHRleHQuY2hhckNvZGVBdCgwKSA9PT0gMHhGRUZGKSB0ZXh0ID0gdGV4dC5zbGljZSgxKTsKICAgICAgY29uc3QgcGF5bG9hZCA9IEpTT04ucGFyc2UodGV4dCk7CgogICAgICBpZihwYXlsb2FkPy5fX3R5cGUgPT09ICdiYXNrZXRfc3RhdHNfbGlicmFyeScgJiYgQXJyYXkuaXNBcnJheShwYXlsb2FkLmdhbWVzKSl7CiAgICAgICAgbWVyZ2VJbXBvcnRlZEdhbWVzKHBheWxvYWQuZ2FtZXMpOwogICAgICAgIHJlbmRlckxpYnJhcnkoKTsKICAgICAgICBhbGVydChgSW1wb3J0YXRlICR7cGF5bG9hZC5nYW1lcy5sZW5ndGh9IHBhcnRpdGUgKGJ1bmRsZSkuYCk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZihwYXlsb2FkPy5fX3R5cGUgPT09ICdiYXNrZXRfc3RhdHNfZ2FtZScgJiYgcGF5bG9hZC5zdGF0ZSl7CiAgICAgICAgbWVyZ2VJbXBvcnRlZEdhbWVzKFt7CiAgICAgICAgICBpZDogcGF5bG9hZC5tZXRhPy5pZCwKICAgICAgICAgIG5hbWU6IHBheWxvYWQubWV0YT8ubmFtZSwKICAgICAgICAgIGRhdGU6IHBheWxvYWQubWV0YT8uZGF0ZSwKICAgICAgICAgIGFOYW1lOiBwYXlsb2FkLm1ldGE/LmFOYW1lLAogICAgICAgICAgYk5hbWU6IHBheWxvYWQubWV0YT8uYk5hbWUsCiAgICAgICAgICBvcHBvbmVudDogcGF5bG9hZC5tZXRhPy5vcHBvbmVudCwKICAgICAgICAgIHNhdmVkQXQ6IHBheWxvYWQubWV0YT8uc2F2ZWRBdCwKICAgICAgICAgIHN0YXRlOiBwYXlsb2FkLnN0YXRlCiAgICAgICAgfV0pOwogICAgICAgIHJlbmRlckxpYnJhcnkoKTsKICAgICAgICBhbGVydCgnSW1wb3J0YXRhIDEgcGFydGl0YS4nKTsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGFsZXJ0KCdGaWxlIG5vbiByaWNvbm9zY2l1dG8uJyk7CiAgICB9Y2F0Y2goZSl7CiAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgIGFsZXJ0KCdJbXBvcnQgZmFsbGl0bzogZmlsZSBub24gdmFsaWRvLicpOwogICAgfQogIH07CiAgaW5wdXQuY2xpY2soKTsKfQoKZnVuY3Rpb24gaW1wb3J0TWFueUdhbWVzKCl7CiAgY29uc3QgaW5wdXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwogIGlucHV0LnR5cGUgPSAnZmlsZSc7CiAgaW5wdXQuYWNjZXB0ID0gJ2FwcGxpY2F0aW9uL2pzb24sLmpzb24nOwogIGlucHV0Lm11bHRpcGxlID0gdHJ1ZTsKCiAgaW5wdXQub25jaGFuZ2UgPSBhc3luYyAoKSA9PiB7CiAgICBjb25zdCBmaWxlcyA9IEFycmF5LmZyb20oaW5wdXQuZmlsZXMgfHwgW10pOwogICAgaWYoIWZpbGVzLmxlbmd0aCkgcmV0dXJuOwoKICAgIGxldCBjb3VudCA9IDA7CiAgICBmb3IoY29uc3QgZmlsZSBvZiBmaWxlcyl7CiAgICAgIHRyeXsKICAgICAgICBsZXQgdGV4dCA9IGF3YWl0IGZpbGUudGV4dCgpOwogICAgICAgIGlmKHRleHQuY2hhckNvZGVBdCgwKSA9PT0gMHhGRUZGKSB0ZXh0ID0gdGV4dC5zbGljZSgxKTsKICAgICAgICBjb25zdCBwYXlsb2FkID0gSlNPTi5wYXJzZSh0ZXh0KTsKCiAgICAgICAgaWYocGF5bG9hZD8uX190eXBlID09PSAnYmFza2V0X3N0YXRzX2dhbWUnICYmIHBheWxvYWQuc3RhdGUpewogICAgICAgICAgbWVyZ2VJbXBvcnRlZEdhbWVzKFt7CiAgICAgICAgICAgIGlkOiBwYXlsb2FkLm1ldGE/LmlkLAogICAgICAgICAgICBuYW1lOiBwYXlsb2FkLm1ldGE/Lm5hbWUgfHwgKCdJbXBvcnQgJyArIGZpbGUubmFtZSksCiAgICAgICAgICAgIGRhdGU6IHBheWxvYWQubWV0YT8uZGF0ZSB8fCBwYXlsb2FkLnN0YXRlPy51aT8uZGF0YUdhcmEgfHwgJycsCiAgICAgICAgICAgIGFOYW1lOiBwYXlsb2FkLm1ldGE/LmFOYW1lIHx8IHBheWxvYWQuc3RhdGU/LnVpPy5uYW1lQSB8fCAnU3F1YWRyYSBBJywKICAgICAgICAgICAgYk5hbWU6IHBheWxvYWQubWV0YT8uYk5hbWUgfHwgcGF5bG9hZC5zdGF0ZT8udWk/Lm5hbWVCIHx8ICdTcXVhZHJhIEInLAogICAgICAgICAgICBvcHBvbmVudDogcGF5bG9hZC5tZXRhPy5vcHBvbmVudCB8fCBwYXlsb2FkLm1ldGE/LmJOYW1lIHx8IHBheWxvYWQuc3RhdGU/LnVpPy5uYW1lQiB8fCAnJywKICAgICAgICAgICAgc2F2ZWRBdDogcGF5bG9hZC5tZXRhPy5zYXZlZEF0IHx8IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAgICAgc3RhdGU6IHBheWxvYWQuc3RhdGUKICAgICAgICAgIH1dKTsKICAgICAgICAgIGNvdW50Kys7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9CgogICAgICAgIGlmKHBheWxvYWQ/LnRlYW1BICYmIHBheWxvYWQ/LnBsYXllcnNBKXsKICAgICAgICAgIG1lcmdlSW1wb3J0ZWRHYW1lcyhbewogICAgICAgICAgICBpZDogbWFrZUdhbWVJZCgpLAogICAgICAgICAgICBuYW1lOiAnSW1wb3J0ICcgKyBmaWxlLm5hbWUucmVwbGFjZUFsbCgnLmpzb24nLCcnKSwKICAgICAgICAgICAgZGF0ZTogcGF5bG9hZD8udWk/LmRhdGFHYXJhIHx8ICcnLAogICAgICAgICAgICBhTmFtZTogcGF5bG9hZD8udWk/Lm5hbWVBIHx8ICdTcXVhZHJhIEEnLAogICAgICAgICAgICBiTmFtZTogcGF5bG9hZD8udWk/Lm5hbWVCIHx8ICdTcXVhZHJhIEInLAogICAgICAgICAgICBvcHBvbmVudDogcGF5bG9hZD8udWk/Lm5hbWVCIHx8ICcnLAogICAgICAgICAgICBzYXZlZEF0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksCiAgICAgICAgICAgIHN0YXRlOiBwYXlsb2FkCiAgICAgICAgICB9XSk7CiAgICAgICAgICBjb3VudCsrOwogICAgICAgICAgY29udGludWU7CiAgICAgICAgfQogICAgICB9Y2F0Y2goZSl7CiAgICAgICAgLy8gaWdub3JhIGZpbGUgbm9uIHZhbGlkaQogICAgICB9CiAgICB9CgogICAgcmVuZGVyTGlicmFyeSgpOwogICAgYWxlcnQoYEltcG9ydGF0ZSAke2NvdW50fSBwYXJ0aXRlLmApOwogIH07CgogIGlucHV0LmNsaWNrKCk7Cn0KCmZ1bmN0aW9uIG1lcmdlSW1wb3J0ZWRHYW1lcyhpdGVtcyl7CiAgY29uc3QgbGliID0gbGliTG9hZCgpOwogIGNvbnN0IGJ5SWQgPSBuZXcgTWFwKGxpYi5tYXAoZyA9PiBbZy5pZCwgZ10pKTsKCiAgaXRlbXMuZm9yRWFjaCh4PT57CiAgICBjb25zdCBpZCA9ICh4LmlkICYmIFN0cmluZyh4LmlkKSkgfHwgbWFrZUdhbWVJZCgpOwogICAgY29uc3QgZW50cnkgPSB7CiAgICAgIGlkLAogICAgICBuYW1lOiBTdHJpbmcoeC5uYW1lIHx8ICdQYXJ0aXRhIGltcG9ydGF0YScpLAogICAgICBkYXRlOiBTdHJpbmcoeC5kYXRlIHx8ICcnKSwKICAgICAgYU5hbWU6IFN0cmluZyh4LmFOYW1lIHx8IHguc3RhdGU/LnVpPy5uYW1lQSB8fCAnU3F1YWRyYSBBJyksCiAgICAgIGJOYW1lOiBTdHJpbmcoeC5iTmFtZSB8fCB4LnN0YXRlPy51aT8ubmFtZUIgfHwgJ1NxdWFkcmEgQicpLAogICAgICBvcHBvbmVudDogU3RyaW5nKHgub3Bwb25lbnQgfHwgeC5iTmFtZSB8fCB4LnN0YXRlPy51aT8ubmFtZUIgfHwgJycpLAogICAgICBzYXZlZEF0OiBTdHJpbmcoeC5zYXZlZEF0IHx8IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSksCiAgICAgIHN0YXRlOiB4LnN0YXRlCiAgICB9OwogICAgYnlJZC5zZXQoaWQsIGVudHJ5KTsKICB9KTsKCiAgY29uc3QgbmV4dCA9IEFycmF5LmZyb20oYnlJZC52YWx1ZXMoKSkuc29ydCgoYSxiKT0+IChiLnNhdmVkQXR8fCcnKS5sb2NhbGVDb21wYXJlKGEuc2F2ZWRBdHx8JycpKTsKICBsaWJTYXZlKG5leHQpOwp9CgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgQk9PVAo9PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KbG9hZFN0YXRlKCk7CndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdwYWdlc2hvdycsICgpID0+IHsgbG9hZFN0YXRlKCk7IHJlbmRlcigpOyB9KTsKd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3BhZ2VoaWRlJywgKCkgPT4geyByZWxlYXNlV2FrZUxvY2soKTsgfSk7CnJlbmRlcigpOwoKLyogPT09IFNPUlQgUEVSIENPTE9OTkEgIyAobnVtZXJvIG1hZ2xpYSkgPT09ICovCmZ1bmN0aW9uIHNvcnRCeU51bWJlcihzaWRlKXsKICBjb25zdCBhcnIgPSAoc2lkZSA9PT0gJ0EnKSA/IHBsYXllcnNBIDogcGxheWVyc0I7CiAgY29uc3QgdGggPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGAjdGFibGUke3NpZGV9IHRoZWFkIHRoLnNvcnRhYmxlLW51bWApOwogIGNvbnN0IGRpciA9IHRoLmdldEF0dHJpYnV0ZSgnZGF0YS1kaXInKSA9PT0gJ2FzYycgPyAxIDogLTE7CgogIGNvbnN0IGhhc0luID0gYXJyLnNvbWUocCA9PiAhIXAuaW4pOwoKICBhcnIuc29ydCgoYSxiKT0+ewogICAgLy8gc2UgZXNpc3Rvbm8gZ2lvY2F0b3JpIElOLCBwb3J0YWxpIGluIGFsdG8KICAgIGlmKGhhc0luICYmIGEuaW4gIT09IGIuaW4pewogICAgICByZXR1cm4gYS5pbiA/IC0xIDogMTsKICAgIH0KICAgIC8vIHBvaSBvcmRpbmEgc2VtcHJlIHBlciBudW1lcm8gbWFnbGlhCiAgICByZXR1cm4gKE51bWJlcihhLm51bXx8MCkgLSBOdW1iZXIoYi5udW18fDApKSAqIGRpcjsKICB9KTsKCiAgdGguc2V0QXR0cmlidXRlKCdkYXRhLWRpcicsIGRpciA9PT0gMSA/ICdkZXNjJyA6ICdhc2MnKTsKICByZW5kZXIoKTsKfQoKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSk9PnsKICBjb25zdCB0aCA9IGUudGFyZ2V0LmNsb3Nlc3QoJ3RoLnNvcnRhYmxlLW51bScpOwogIGlmKCF0aCkgcmV0dXJuOwogIGNvbnN0IHRhYmxlID0gdGguY2xvc2VzdCgndGFibGUnKTsKICBpZih0YWJsZT8uaWQgPT09ICd0YWJsZUEnKSBzb3J0QnlOdW1iZXIoJ0EnKTsKICBpZih0YWJsZT8uaWQgPT09ICd0YWJsZUInKSBzb3J0QnlOdW1iZXIoJ0InKTsKfSk7Cgo8L3NjcmlwdD4KCjxzY3JpcHQ+CmZ1bmN0aW9uIGdvSG9tZSgpeyBwYXJlbnQucG9zdE1lc3NhZ2Uoe3R5cGU6J25hdicsdGFyZ2V0Oidob21lJ30sICcqJyk7IH0KPC9zY3JpcHQ+CjxzY3JpcHQgc3JjPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2h0bWwyY2FudmFzQDEuNC4xL2Rpc3QvaHRtbDJjYW52YXMubWluLmpzIj48L3NjcmlwdD4KPHNjcmlwdD4KCi8qID09PT09IENPTkRJVklESSBQQVJUSVRBIChTQ1JFRU5TSE9UKSA9PT09PSAqLwpmdW5jdGlvbiBpc0xpa2VseU1vYmlsZSgpewogIGNvbnN0IHVhID0gbmF2aWdhdG9yLnVzZXJBZ2VudCB8fCAnJzsKICBjb25zdCBpc1RvdWNoID0gKG5hdmlnYXRvci5tYXhUb3VjaFBvaW50cyB8fCAwKSA+IDE7CiAgY29uc3Qgc21hbGxTY3JlZW4gPSBNYXRoLm1pbih3aW5kb3cuaW5uZXJXaWR0aCB8fCA5OTk5LCB3aW5kb3cuaW5uZXJIZWlnaHQgfHwgOTk5OSkgPD0gODIwOwogIC8vIGlPUyAvIEFuZHJvaWQgKGluY2x1c2kgdGFibGV0KQogIGNvbnN0IHVhTW9iaWxlID0gL0FuZHJvaWR8aVBob25lfGlQYWR8aVBvZC9pLnRlc3QodWEpOwogIC8vIEFsY3VuaSBsYXB0b3AgdG91Y2ggbm9uIGRldm9ubyBhcHJpcmUgbGEgc2hhcmUgc2hlZXQ6IHJpY2hpZWRpYW1vIGFuY2hlIHNjaGVybW8gcGljY29sbyBvIFVBIG1vYmlsZS4KICByZXR1cm4gdWFNb2JpbGUgfHwgKGlzVG91Y2ggJiYgc21hbGxTY3JlZW4pOwp9Cgphc3luYyBmdW5jdGlvbiBzaGFyZUdhbWUoKXsKICB0cnl7CiAgICBjb25zdCBwYW5lbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdGF0c1BhbmVsJyk7CiAgICBpZighcGFuZWwpewogICAgICBhbGVydCgnU3RhdGlzdGljaGUgbm9uIGRpc3BvbmliaWxpLicpOwogICAgICByZXR1cm47CiAgICB9CgogICAgaWYodHlwZW9mIGh0bWwyY2FudmFzID09PSAndW5kZWZpbmVkJyl7CiAgICAgIGFsZXJ0KCdGdW56aW9uZSBkaSBjb25kaXZpc2lvbmUgbm9uIGRpc3BvbmliaWxlIGluIHF1ZXN0YSBidWlsZC4nKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIFNjcmVlbnNob3QgZGVsIHNvbG8gcGFubmVsbG8gU3RhdHMgKG92ZXJsYXkpCiAgICBjb25zdCBjYW52YXMgPSBhd2FpdCBodG1sMmNhbnZhcyhwYW5lbCwgewogICAgICBiYWNrZ3JvdW5kQ29sb3I6ICcjZmZmZmZmJywKICAgICAgc2NhbGU6IDIsCiAgICAgIHVzZUNPUlM6IHRydWUKICAgIH0pOwoKICAgIGNvbnN0IGJsb2IgPSBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IGNhbnZhcy50b0Jsb2IocmVzb2x2ZSwgJ2ltYWdlL2pwZWcnLCAwLjk1KSk7CiAgICBpZighYmxvYil7CiAgICAgIGFsZXJ0KCdJbXBvc3NpYmlsZSBjcmVhcmUgbOKAmWltbWFnaW5lLicpOwogICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgYU4gPSAobmFtZUE/LnZhbHVlIHx8ICdTcXVhZHJhQScpLnRyaW0oKS5yZXBsYWNlQWxsKCcgJywnXycpOwogICAgY29uc3QgYk4gPSAobmFtZUI/LnZhbHVlIHx8ICdTcXVhZHJhQicpLnRyaW0oKS5yZXBsYWNlQWxsKCcgJywnXycpOwogICAgY29uc3QgZCAgPSAoZGF0YUdhcmE/LnZhbHVlIHx8ICcnKS50cmltKCkucmVwbGFjZUFsbCgnLycsJy0nKTsKICAgIGNvbnN0IGNhbXBTID0gKGNhbXBpb25hdG8/LnZhbHVlIHx8ICcnKS50cmltKCkucmVwbGFjZUFsbCgnICcsJ18nKTsKICAgIGNvbnN0IGZuYW1lID0gWydzdGF0aXN0aWNoZScsIGNhbXBTLCBkLCBgJHthTn1fdnNfJHtiTn1gXS5maWx0ZXIoQm9vbGVhbikuam9pbignXycpICsgJy5qcGcnOwogICAgY29uc3QgZmlsZSA9IG5ldyBGaWxlKFtibG9iXSwgZm5hbWUsIHsgdHlwZTogJ2ltYWdlL2pwZWcnIH0pOwoKICAgIC8vIOKchSBTdSBtb2JpbGU6IHVzYSBsYSBjb25kaXZpc2lvbmUgbmF0aXZhCiAgICBpZihpc0xpa2VseU1vYmlsZSgpICYmIG5hdmlnYXRvci5zaGFyZSAmJiAoIW5hdmlnYXRvci5jYW5TaGFyZSB8fCBuYXZpZ2F0b3IuY2FuU2hhcmUoeyBmaWxlczpbZmlsZV0gfSkpKXsKICAgICAgYXdhaXQgbmF2aWdhdG9yLnNoYXJlKHsKICAgICAgICBmaWxlczogW2ZpbGVdLAogICAgICAgIHRpdGxlOiAnU3RhdGlzdGljaGUgcGFydGl0YScsCiAgICAgICAgdGV4dDogYCR7YU59IHZzICR7Yk59JHtkID8gJyDigKIgJyArIGQgOiAnJ31gCiAgICAgIH0pOwogICAgICByZXR1cm47CiAgICB9CgogICAgLy8g8J+SuyBTdSBkZXNrdG9wOiBldml0YSBsYSBzaGFyZSBzaGVldCBkaSBXaW5kb3dzIOKGkiBzY2FyaWNhIGRpcmV0dGFtZW50ZQogICAgY29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKICAgIGNvbnN0IHVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7CiAgICBhLmhyZWYgPSB1cmw7CiAgICBhLmRvd25sb2FkID0gZm5hbWU7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGEpOwogICAgYS5jbGljaygpOwogICAgYS5yZW1vdmUoKTsKICAgIFVSTC5yZXZva2VPYmplY3RVUkwodXJsKTsKCiAgICAvLyBTdWdnZXJpbWVudG8gVVggKG5vbiBibG9jY2FudGUpCiAgICAvLyBhbGVydCgnSW1tYWdpbmUgc2FsdmF0YS4gT3JhIHB1b2kgaW52aWFybGEgc3UgV2hhdHNBcHAvVGVsZWdyYW0vc29jaWFsIGRhbCBQQy4nKTsKICB9Y2F0Y2goZSl7CiAgICBhbGVydCgnRXJyb3JlIGR1cmFudGUgbGEgY29uZGl2aXNpb25lLicpOwogIH0KfQoKYXN5bmMgZnVuY3Rpb24gc2hhcmVSZXN1bHRDYXJkKCl7CiAgdHJ5ewogICAgaWYodHlwZW9mIGh0bWwyY2FudmFzID09PSAndW5kZWZpbmVkJyl7CiAgICAgIGFsZXJ0KCdGdW56aW9uZSBkaSBjb25kaXZpc2lvbmUgbm9uIGRpc3BvbmliaWxlIGluIHF1ZXN0YSBidWlsZC4nKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IGFOYW1lID0gKG5hbWVBPy52YWx1ZSB8fCAnU3F1YWRyYSBBJykudHJpbSgpOwogICAgY29uc3QgYk5hbWUgPSAobmFtZUI/LnZhbHVlIHx8ICdTcXVhZHJhIEInKS50cmltKCk7CiAgICBjb25zdCBzY29yZUEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NvcmVBJyk/LnRleHRDb250ZW50ID8/ICcwJzsKICAgIGNvbnN0IHNjb3JlQiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzY29yZUInKT8udGV4dENvbnRlbnQgPz8gJzAnOwoKICAgIGNvbnN0IGNhbXAgPSAoY2FtcGlvbmF0bz8udmFsdWUgfHwgJycpLnRyaW0oKTsKICAgIGNvbnN0IGdpciAgPSAoZ2lyb25lPy52YWx1ZSB8fCAnJykudHJpbSgpOwogICAgY29uc3QgZGF0YSA9IChkYXRhR2FyYT8udmFsdWUgfHwgJycpLnRyaW0oKTsKICAgIGNvbnN0IGdpb3IgPSAoZ2lvcm5hdGE/LnZhbHVlIHx8ICcnKS50cmltKCk7CiAgICBjb25zdCBhciAgID0gKChhbmRhdGFSaXRvcm5vPy52YWx1ZSB8fCAnJykudHJpbSgpLnRvVXBwZXJDYXNlKCkpOwogICAgY29uc3QgY2YgICA9ICgoY2FzYUZ1b3JpPy52YWx1ZSB8fCAnJykudHJpbSgpLnRvVXBwZXJDYXNlKCkpOwoKICAgIC8vIExvZ2hpIG9mZmxpbmUgKERhdGFVUkwgaW4gbG9jYWxTdG9yYWdlKQogICAgY29uc3QgbG9nb0FEYXRhID0gKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdic19sb2dvQV9kYXRhdXJsJykgfHwgJycpLnRyaW0oKTsKICAgIGNvbnN0IGxvZ29CRGF0YSA9IChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnYnNfbG9nb0JfZGF0YXVybCcpIHx8ICcnKS50cmltKCk7CgogICAgLy8gUGFyemlhbGkgUS9PVCAoc3Rlc3NvIGZvcm1hdG8gZGVsIFBERikKICAgIGNvbnN0IHFMaW5lQmFzZSA9IGAke3ExYS50ZXh0Q29udGVudH0tJHtxMWIudGV4dENvbnRlbnR9IC8gJHtxMmEudGV4dENvbnRlbnR9LSR7cTJiLnRleHRDb250ZW50fSAvICR7cTNhLnRleHRDb250ZW50fS0ke3EzYi50ZXh0Q29udGVudH0gLyAke3E0YS50ZXh0Q29udGVudH0tJHtxNGIudGV4dENvbnRlbnR9YDsKICAgIGNvbnN0IG90SG9zdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvdFJvd3MnKTsKICAgIGNvbnN0IG90UGFydHMgPSBbXTsKICAgIGlmKG90SG9zdCl7CiAgICAgIGNvbnN0IHJvd3MgPSBvdEhvc3QucXVlcnlTZWxlY3RvckFsbCgnLnFyb3cnKTsKICAgICAgcm93cy5mb3JFYWNoKChyKT0+ewogICAgICAgIGNvbnN0IHN0cm9uZyA9IHIucXVlcnlTZWxlY3Rvcignc3Ryb25nJyk/LnRleHRDb250ZW50IHx8ICcnOwogICAgICAgIGNvbnN0IHNwYW5zID0gci5xdWVyeVNlbGVjdG9yQWxsKCdzcGFuJyk7CiAgICAgICAgY29uc3QgYSA9IHNwYW5zWzBdPy50ZXh0Q29udGVudCA/PyAn4oCUJzsKICAgICAgICBjb25zdCBiID0gc3BhbnNbMV0/LnRleHRDb250ZW50ID8/ICfigJQnOwogICAgICAgIGlmKHN0cm9uZykgb3RQYXJ0cy5wdXNoKGAke2F9LSR7Yn1gKTsKICAgICAgfSk7CiAgICB9CiAgICBjb25zdCBxTGluZSA9IHFMaW5lQmFzZSArIChvdFBhcnRzLmxlbmd0aCA/ICgnIC8gJyArIG90UGFydHMuam9pbignIC8gJykpIDogJycpOwoKICAgIC8vIENhcmQgdGVtcG9yYW5lYSAoZnVvcmkgc2NoZXJtbykgcGVyIHNjcmVlbnNob3QgcHVsaXRvCiAgICBjb25zdCBob3N0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBob3N0LnN0eWxlLnBvc2l0aW9uID0gJ2ZpeGVkJzsKICAgIGhvc3Quc3R5bGUubGVmdCA9ICctOTk5OXB4JzsKICAgIGhvc3Quc3R5bGUudG9wID0gJzAnOwogICAgaG9zdC5zdHlsZS53aWR0aCA9ICcxMjAwcHgnOyAvLyBhYmJhc3RhbnphIGxhcmdhIHBlciBzb2NpYWwKICAgIGhvc3Quc3R5bGUucGFkZGluZyA9ICcyNHB4JzsKICAgIGhvc3Quc3R5bGUuYmFja2dyb3VuZCA9ICcjZmZmZmZmJzsKICAgIGhvc3Quc3R5bGUuZm9udEZhbWlseSA9ICdzeXN0ZW0tdWksIC1hcHBsZS1zeXN0ZW0sIFNlZ29lIFVJLCBSb2JvdG8sIEhlbHZldGljYSwgQXJpYWwnOwogICAgaG9zdC5zdHlsZS5ib3JkZXJSYWRpdXMgPSAnMThweCc7CiAgICBob3N0LnN0eWxlLmJveFNoYWRvdyA9ICcwIDEwcHggMjhweCByZ2JhKDAsMCwwLDAuMTUpJzsKCiAgICAvLyBXYXRlcm1hcmsgbGVnZ2VybyArIGVtYWlsICh0ZXN0byBub24gY2xpY2NhYmlsZSkKICAgIGNvbnN0IHdtQm94ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICB3bUJveC5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7CiAgICB3bUJveC5zdHlsZS5yaWdodCA9ICcyMnB4JzsKICAgIHdtQm94LnN0eWxlLnRyYW5zZm9ybSA9ICd0cmFuc2xhdGVYKDApJzsKICAgIHdtQm94LnN0eWxlLmJvdHRvbSA9ICcxNHB4JzsKICAgIHdtQm94LnN0eWxlLnRleHRBbGlnbiA9ICdjZW50ZXInOwogICAgd21Cb3guc3R5bGUucG9pbnRlckV2ZW50cyA9ICdub25lJzsKCiAgICBjb25zdCB3bSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgd20udGV4dENvbnRlbnQgPSAnQkFTS0VUIFNUQVRTJzsKICAgIHdtLnN0eWxlLmZvbnRXZWlnaHQgPSAnOTAwJzsKICAgIHdtLnN0eWxlLmZvbnRTaXplID0gJzI4cHgnOwogICAgd20uc3R5bGUubGV0dGVyU3BhY2luZyA9ICcycHgnOwogICAgd20uc3R5bGUuY29sb3IgPSAncmdiYSgwLDAsMCwwLjA4KSc7CgogICAgY29uc3Qgd21FbWFpbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgd21FbWFpbC50ZXh0Q29udGVudCA9ICdzYW5kcm9Ac3lzdGVtZGF0YS5pdCc7CiAgICB3bUVtYWlsLnN0eWxlLm1hcmdpblRvcCA9ICcycHgnOwogICAgd21FbWFpbC5zdHlsZS50ZXh0QWxpZ24gPSAnY2VudGVyJzsKICAgIHdtRW1haWwuc3R5bGUuZm9udFdlaWdodCA9ICc3MDAnOwogICAgd21FbWFpbC5zdHlsZS5mb250U2l6ZSA9ICcxMnB4JzsKICAgIHdtRW1haWwuc3R5bGUubGV0dGVyU3BhY2luZyA9ICcwLjNweCc7CiAgICB3bUVtYWlsLnN0eWxlLmNvbG9yID0gJ3JnYmEoMCwwLDAsMC4xOCknOwoKICAgIHdtQm94LmFwcGVuZENoaWxkKHdtKTsKICAgIHdtQm94LmFwcGVuZENoaWxkKHdtRW1haWwpOwoKICAgIGhvc3Quc3R5bGUucG9zaXRpb24gPSAnZml4ZWQnOwogICAgaG9zdC5zdHlsZS5vdmVyZmxvdyA9ICdoaWRkZW4nOwoKCiAgICAvLyBDcmVhIHVuIDxpbWc+IGxvZ28gZGEgRGF0YVVSTCAob2ZmbGluZSkgY29uIGZhbGxiYWNrIGF1dG9tYXRpY28KICAgIGZ1bmN0aW9uIG1rTG9nb0RhdGEoZGF0YVVybCl7CiAgICAgIGNvbnN0IHUgPSBTdHJpbmcoZGF0YVVybHx8JycpLnRyaW0oKTsKICAgICAgaWYoIXUgfHwgIXUuc3RhcnRzV2l0aCgnZGF0YTppbWFnZS8nKSkgcmV0dXJuIG51bGw7CiAgICAgIGNvbnN0IGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpOwogICAgICBpbWcuc3JjID0gdTsKICAgICAgaW1nLmFsdCA9ICdsb2dvJzsKICAgICAgaW1nLnN0eWxlLndpZHRoID0gJzc2cHgnOwogICAgICBpbWcuc3R5bGUuaGVpZ2h0ID0gJzc2cHgnOwogICAgICBpbWcuc3R5bGUub2JqZWN0Rml0ID0gJ2NvbnRhaW4nOwogICAgICBpbWcuc3R5bGUuYm9yZGVyUmFkaXVzID0gJzE0cHgnOwogICAgICBpbWcuc3R5bGUuYmFja2dyb3VuZCA9ICcjZmZmZmZmJzsKICAgICAgaW1nLnN0eWxlLmJveFNoYWRvdyA9ICcwIDNweCAxMHB4IHJnYmEoMCwwLDAsMC4xMiknOwogICAgICByZXR1cm4gaW1nOwogICAgfQoKICAgIAogICAgY29uc3QgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIHRpdGxlLnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICB0aXRsZS5zdHlsZS5hbGlnbkl0ZW1zID0gJ2NlbnRlcic7CiAgICB0aXRsZS5zdHlsZS5qdXN0aWZ5Q29udGVudCA9ICdjZW50ZXInOwogICAgdGl0bGUuc3R5bGUuZ2FwID0gJzE4cHgnOwogICAgdGl0bGUuc3R5bGUubWFyZ2luVG9wID0gJzJweCc7CgogICAgY29uc3Qgc0EgPSBOdW1iZXIoU3RyaW5nKHNjb3JlQSkucmVwbGFjZSgvW14wLTldL2csJycpIHx8IDApOwogICAgY29uc3Qgc0IgPSBOdW1iZXIoU3RyaW5nKHNjb3JlQikucmVwbGFjZSgvW14wLTldL2csJycpIHx8IDApOwoKICAgIGNvbnN0IHdpbkNvbG9yID0gJyMxZTg4ZTUnOyAvLyBibHUKICAgIGNvbnN0IGxvc2VDb2xvciA9ICcjZTUzOTM1JzsgLy8gcm9zc28KICAgIGNvbnN0IHRpZUNvbG9yICA9ICcjNTU1JzsKCiAgICBjb25zdCBjb2xBID0gKHNBID09PSBzQikgPyB0aWVDb2xvciA6IChzQSA+IHNCID8gd2luQ29sb3IgOiBsb3NlQ29sb3IpOwogICAgY29uc3QgY29sQiA9IChzQSA9PT0gc0IpID8gdGllQ29sb3IgOiAoc0IgPiBzQSA/IHdpbkNvbG9yIDogbG9zZUNvbG9yKTsKCiAgICAvLyBCbG9jY28gc3F1YWRyYSBBOiBOT01FICsgUFVOVEVHR0lPIGNvbG9yYXRvCiAgICBjb25zdCBsZWZ0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBsZWZ0LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICBsZWZ0LnN0eWxlLmFsaWduSXRlbXMgPSAnY2VudGVyJzsKICAgIGxlZnQuc3R5bGUuZ2FwID0gJzEwcHgnOwoKICAgIGNvbnN0IG5hbWVMZWZ0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBuYW1lTGVmdC50ZXh0Q29udGVudCA9IGFOYW1lOwogICAgbmFtZUxlZnQuc3R5bGUuZm9udFNpemUgPSAnMzRweCc7CiAgICBuYW1lTGVmdC5zdHlsZS5mb250V2VpZ2h0ID0gJzkwMCc7CiAgICBuYW1lTGVmdC5zdHlsZS5saW5lSGVpZ2h0ID0gJzEuMSc7CiAgICBuYW1lTGVmdC5zdHlsZS53aGl0ZVNwYWNlID0gJ25vd3JhcCc7CgogICAgY29uc3Qgc2NvcmVMZWZ0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBzY29yZUxlZnQudGV4dENvbnRlbnQgPSBgJHtzY29yZUF9YDsKICAgIHNjb3JlTGVmdC5zdHlsZS5mb250U2l6ZSA9ICc0MHB4JzsKICAgIHNjb3JlTGVmdC5zdHlsZS5mb250V2VpZ2h0ID0gJzkwMCc7CiAgICBzY29yZUxlZnQuc3R5bGUuY29sb3IgPSBjb2xBOwoKICAgIGNvbnN0IGxvZ29BSW1nID0gbWtMb2dvRGF0YShsb2dvQURhdGEpOwoKICAgIGlmKGxvZ29BSW1nKSBsZWZ0LmFwcGVuZENoaWxkKGxvZ29BSW1nKTsKICAgIGxlZnQuYXBwZW5kQ2hpbGQobmFtZUxlZnQpOwogICAgbGVmdC5hcHBlbmRDaGlsZChzY29yZUxlZnQpOwoKICAgIC8vIFNlcGFyYXRvcmUgdmlzaWJpbGUKICAgIGNvbnN0IHNlcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgc2VwLnRleHRDb250ZW50ID0gJ+KAlCc7CiAgICBzZXAuc3R5bGUuZm9udFNpemUgPSAnNDZweCc7CiAgICBzZXAuc3R5bGUuZm9udFdlaWdodCA9ICc5MDAnOwogICAgc2VwLnN0eWxlLmNvbG9yID0gJyMxMTEnOwogICAgc2VwLnN0eWxlLmxpbmVIZWlnaHQgPSAnMSc7CgogICAgLy8gQmxvY2NvIHNxdWFkcmEgQjogTk9NRSArIFBVTlRFR0dJTyBjb2xvcmF0bwogICAgY29uc3QgcmlnaHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIHJpZ2h0LnN0eWxlLmRpc3BsYXkgPSAnZmxleCc7CiAgICByaWdodC5zdHlsZS5hbGlnbkl0ZW1zID0gJ2NlbnRlcic7CiAgICByaWdodC5zdHlsZS5nYXAgPSAnMTBweCc7CgogICAgY29uc3QgbmFtZVJpZ2h0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBuYW1lUmlnaHQudGV4dENvbnRlbnQgPSBiTmFtZTsKICAgIG5hbWVSaWdodC5zdHlsZS5mb250U2l6ZSA9ICczNHB4JzsKICAgIG5hbWVSaWdodC5zdHlsZS5mb250V2VpZ2h0ID0gJzkwMCc7CiAgICBuYW1lUmlnaHQuc3R5bGUubGluZUhlaWdodCA9ICcxLjEnOwogICAgbmFtZVJpZ2h0LnN0eWxlLndoaXRlU3BhY2UgPSAnbm93cmFwJzsKCiAgICBjb25zdCBzY29yZVJpZ2h0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBzY29yZVJpZ2h0LnRleHRDb250ZW50ID0gYCR7c2NvcmVCfWA7CiAgICBzY29yZVJpZ2h0LnN0eWxlLmZvbnRTaXplID0gJzQwcHgnOwogICAgc2NvcmVSaWdodC5zdHlsZS5mb250V2VpZ2h0ID0gJzkwMCc7CiAgICBzY29yZVJpZ2h0LnN0eWxlLmNvbG9yID0gY29sQjsKCiAgICBjb25zdCBsb2dvQkltZyA9IG1rTG9nb0RhdGEobG9nb0JEYXRhKTsKCiAgICAvLyBPcmRpbmUgcmljaGllc3RvOiBkb3BvIGlsIHRyYXR0aW5vIOKGkiBSSVNVTFRBVE8gQiwgcG9pIE5PTUUgQiwgcG9pIExPR08gQgogICAgcmlnaHQuYXBwZW5kQ2hpbGQoc2NvcmVSaWdodCk7CiAgICByaWdodC5hcHBlbmRDaGlsZChuYW1lUmlnaHQpOwogICAgaWYobG9nb0JJbWcpIHJpZ2h0LmFwcGVuZENoaWxkKGxvZ29CSW1nKTsKCiAgICB0aXRsZS5hcHBlbmRDaGlsZChsZWZ0KTsKICAgIHRpdGxlLmFwcGVuZENoaWxkKHNlcCk7CiAgICB0aXRsZS5hcHBlbmRDaGlsZChyaWdodCk7CgogICAgY29uc3QgbWV0YSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgbWV0YS5zdHlsZS5tYXJnaW5Ub3AgPSAnMTJweCc7CiAgICBtZXRhLnN0eWxlLmZvbnRTaXplID0gJzE4cHgnOwogICAgbWV0YS5zdHlsZS5mb250V2VpZ2h0ID0gJzcwMCc7CiAgICBtZXRhLnN0eWxlLmNvbG9yID0gJyMyMjInOwogICAgbWV0YS5zdHlsZS5kaXNwbGF5ID0gJ2ZsZXgnOwogICAgbWV0YS5zdHlsZS5mbGV4V3JhcCA9ICd3cmFwJzsKICAgIG1ldGEuc3R5bGUuZ2FwID0gJzEwcHgnOwogICAgbWV0YS5zdHlsZS5qdXN0aWZ5Q29udGVudCA9ICdjZW50ZXInOwoKICAgIGNvbnN0IGNoaXBzID0gW107CiAgICBpZihjYW1wKSBjaGlwcy5wdXNoKGBDYXQ6ICR7Y2FtcH1gKTsKICAgIGlmKGdpcikgIGNoaXBzLnB1c2goYEdpcjogJHtnaXJ9YCk7CiAgICBpZihkYXRhKSBjaGlwcy5wdXNoKGBEYXRhOiAke2RhdGF9YCk7CiAgICBpZihnaW9yKSBjaGlwcy5wdXNoKGBHaW9ybmF0YTogJHtnaW9yfWApOwogICAgaWYoYXIpICAgY2hpcHMucHVzaChgQS9SOiAke2FyfWApOwogICAgaWYoY2YpICAgY2hpcHMucHVzaChgQy9GOiAke2NmfWApOwogICAgaWYoIWNoaXBzLmxlbmd0aCkgY2hpcHMucHVzaCgn4oCUJyk7CgogICAgY2hpcHMuZm9yRWFjaCgocyk9PnsKICAgICAgY29uc3QgY2hpcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NwYW4nKTsKICAgICAgY2hpcC50ZXh0Q29udGVudCA9IHM7CiAgICAgIGNoaXAuc3R5bGUucGFkZGluZyA9ICc2cHggMTBweCc7CiAgICAgIGNoaXAuc3R5bGUuYm9yZGVyUmFkaXVzID0gJzk5OXB4JzsKICAgICAgY2hpcC5zdHlsZS5iYWNrZ3JvdW5kID0gJyNmMWYzZjUnOwogICAgICBjaGlwLnN0eWxlLmJvcmRlciA9ICcxcHggc29saWQgI2U2ZTllZSc7CiAgICAgIG1ldGEuYXBwZW5kQ2hpbGQoY2hpcCk7CiAgICB9KTsKCiAgICAKICAgIC8vIFByb2dyZXNzaXZpIChjdW11bGF0aSkgZGEgcGFyemlhbGkKICAgIGNvbnN0IHRvTnVtID0gKHYpPT57CiAgICAgIGNvbnN0IHMgPSBTdHJpbmcodiA/PyAnJykudHJpbSgpOwogICAgICBpZihzID09PSAn4oCUJyB8fCBzID09PSAnJykgcmV0dXJuIG51bGw7CiAgICAgIGNvbnN0IG4gPSBwYXJzZUludChzLCAxMCk7CiAgICAgIHJldHVybiBOdW1iZXIuaXNGaW5pdGUobikgPyBuIDogbnVsbDsKICAgIH07CgogICAgY29uc3Qgc3BsaXRSb3dzID0gW107CiAgICAvLyBRMS4uUTQKICAgIGZvcihsZXQgcT0xO3E8PTQ7cSsrKXsKICAgICAgY29uc3QgYVJhdyA9IFN0cmluZyhkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgcSR7cX1hYCk/LnRleHRDb250ZW50ID8/ICfigJQnKS50cmltKCk7CiAgICAgIGNvbnN0IGJSYXcgPSBTdHJpbmcoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHEke3F9YmApPy50ZXh0Q29udGVudCA/PyAn4oCUJykudHJpbSgpOwogICAgICBjb25zdCBhID0gdG9OdW0oYVJhdyk7CiAgICAgIGNvbnN0IGIgPSB0b051bShiUmF3KTsKICAgICAgY29uc3QgcGxheWVkID0gKGEgIT09IG51bGwpIHx8IChiICE9PSBudWxsKTsKICAgICAgc3BsaXRSb3dzLnB1c2goeyBsYWJlbDpgUSR7cX1gLCBhOiBhID8/IDAsIGI6IGIgPz8gMCwgcGxheWVkIH0pOwogICAgfQogICAgLy8gT1QgZGluYW1pY2kKICAgIGlmKG90SG9zdCl7CiAgICAgIGNvbnN0IHJvd3MgPSBbLi4ub3RIb3N0LnF1ZXJ5U2VsZWN0b3JBbGwoJy5xcm93JyldOwogICAgICByb3dzLmZvckVhY2gocj0+ewogICAgICAgIGNvbnN0IGxhYmVsID0gKHIucXVlcnlTZWxlY3Rvcignc3Ryb25nJyk/LnRleHRDb250ZW50IHx8ICcnKS50cmltKCk7IC8vIE9UMQogICAgICAgIGlmKCFsYWJlbCkgcmV0dXJuOwogICAgICAgIGNvbnN0IHNwYW5zID0gci5xdWVyeVNlbGVjdG9yQWxsKCdzcGFuJyk7CiAgICAgICAgY29uc3QgYVJhdyA9IFN0cmluZyhzcGFuc1swXT8udGV4dENvbnRlbnQgPz8gJ+KAlCcpLnRyaW0oKTsKICAgICAgICBjb25zdCBiUmF3ID0gU3RyaW5nKHNwYW5zWzFdPy50ZXh0Q29udGVudCA/PyAn4oCUJykudHJpbSgpOwogICAgICAgIGNvbnN0IGEgPSB0b051bShhUmF3KTsKICAgICAgICBjb25zdCBiID0gdG9OdW0oYlJhdyk7CiAgICAgICAgY29uc3QgcGxheWVkID0gKGEgIT09IG51bGwpIHx8IChiICE9PSBudWxsKTsKICAgICAgICBpZihwbGF5ZWQpIHNwbGl0Um93cy5wdXNoKHsgbGFiZWwsIGE6IGEgPz8gMCwgYjogYiA/PyAwLCBwbGF5ZWQgfSk7CiAgICAgIH0pOwogICAgfQoKICAgIC8vIENvc3RydWlzY2kgcHJvZ3Jlc3Npdmk6IHNlIG1hbmNhIHVuIHF1YXJ0byBpbnRlcm1lZGlvLCBtb3N0cmEgJ+KAlCcgZGEgbMOsIGluIHBvaQogICAgbGV0IGN1bUEgPSAwLCBjdW1CID0gMDsKICAgIGxldCBicm9rZW4gPSBmYWxzZTsKICAgIGNvbnN0IHByb2dQYXJ0cyA9IFtdOwogICAgc3BsaXRSb3dzLmZvckVhY2gocz0+ewogICAgICBpZighcy5wbGF5ZWQgfHwgYnJva2VuKXsKICAgICAgICBwcm9nUGFydHMucHVzaCgn4oCUJyk7CiAgICAgICAgYnJva2VuID0gdHJ1ZTsKICAgICAgICByZXR1cm47CiAgICAgIH0KICAgICAgY3VtQSArPSBzLmE7CiAgICAgIGN1bUIgKz0gcy5iOwogICAgICBwcm9nUGFydHMucHVzaChgJHtjdW1BfS0ke2N1bUJ9YCk7CiAgICB9KTsKCiAgICBjb25zdCBzcGxpdHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIHNwbGl0cy5zdHlsZS5tYXJnaW5Ub3AgPSAnMTJweCc7CiAgICBzcGxpdHMuc3R5bGUuZm9udFNpemUgPSAnMThweCc7CiAgICBzcGxpdHMuc3R5bGUuY29sb3IgPSAnIzMzMyc7CiAgICBzcGxpdHMuc3R5bGUuZm9udFdlaWdodCA9ICc3MDAnOwogICAgc3BsaXRzLnN0eWxlLnRleHRBbGlnbiA9ICdjZW50ZXInOwoKICAgIGNvbnN0IHAxID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBwMS50ZXh0Q29udGVudCA9IGBQYXJ6aWFsaTogJHtxTGluZX1gOwogICAgY29uc3QgcDIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIHAyLnN0eWxlLm1hcmdpblRvcCA9ICc2cHgnOwogICAgcDIudGV4dENvbnRlbnQgPSBgUHJvZ3Jlc3Npdmk6ICR7cHJvZ1BhcnRzLmpvaW4oJyAvICcpfWA7CgogICAgc3BsaXRzLmFwcGVuZENoaWxkKHAxKTsKICAgIHNwbGl0cy5hcHBlbmRDaGlsZChwMik7CgogICAgaG9zdC5hcHBlbmRDaGlsZCh0aXRsZSk7CiAgICBob3N0LmFwcGVuZENoaWxkKG1ldGEpOwogICAgaG9zdC5hcHBlbmRDaGlsZChzcGxpdHMpOwogICAgaG9zdC5hcHBlbmRDaGlsZCh3bUJveCk7CgogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChob3N0KTsKCiAgICBjb25zdCBjYW52YXMgPSBhd2FpdCBodG1sMmNhbnZhcyhob3N0LCB7IGJhY2tncm91bmRDb2xvcjonI2ZmZmZmZicsIHNjYWxlOiAyLCB1c2VDT1JTOnRydWUgfSk7CiAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGhvc3QpOwoKICAgIGNvbnN0IGJsb2IgPSBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IGNhbnZhcy50b0Jsb2IocmVzb2x2ZSwgJ2ltYWdlL2pwZWcnLCAwLjk1KSk7CiAgICBpZighYmxvYil7CiAgICAgIGFsZXJ0KCdJbXBvc3NpYmlsZSBjcmVhcmUgbOKAmWltbWFnaW5lLicpOwogICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgYU4gPSBhTmFtZS5yZXBsYWNlQWxsKCcgJywnXycpOwogICAgY29uc3QgYk4gPSBiTmFtZS5yZXBsYWNlQWxsKCcgJywnXycpOwogICAgY29uc3QgZCAgPSAoZGF0YSB8fCAnJykucmVwbGFjZUFsbCgnLycsJy0nKTsKICAgIGNvbnN0IGNhbXBTID0gKGNhbXAgfHwgJycpLnJlcGxhY2VBbGwoJyAnLCdfJyk7CiAgICBjb25zdCBmbmFtZSA9IFsncmlzdWx0YXRvJywgY2FtcFMsIGQsIGAke2FOfV92c18ke2JOfWAsIGAke3Njb3JlQX0tJHtzY29yZUJ9YF0uZmlsdGVyKEJvb2xlYW4pLmpvaW4oJ18nKSArICcuanBnJzsKICAgIGNvbnN0IGZpbGUgPSBuZXcgRmlsZShbYmxvYl0sIGZuYW1lLCB7IHR5cGU6ICdpbWFnZS9qcGVnJyB9KTsKCiAgICAvLyBTdSBtb2JpbGU6IHNoYXJlOyBzdSBkZXNrdG9wOiBkb3dubG9hZAogICAgaWYoaXNMaWtlbHlNb2JpbGUoKSAmJiBuYXZpZ2F0b3Iuc2hhcmUgJiYgKCFuYXZpZ2F0b3IuY2FuU2hhcmUgfHwgbmF2aWdhdG9yLmNhblNoYXJlKHsgZmlsZXM6W2ZpbGVdIH0pKSl7CiAgICAgIGF3YWl0IG5hdmlnYXRvci5zaGFyZSh7CiAgICAgICAgZmlsZXM6IFtmaWxlXSwKICAgICAgICB0aXRsZTogJ1Jpc3VsdGF0byBwYXJ0aXRhJywKICAgICAgICB0ZXh0OiBgJHthTmFtZX0gdnMgJHtiTmFtZX0ke2RhdGEgPyAnIOKAoiAnICsgZGF0YSA6ICcnfSDigKIgJHtzY29yZUF9LSR7c2NvcmVCfWAKICAgICAgfSk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsKICAgIGEuaHJlZiA9IHVybDsKICAgIGEuZG93bmxvYWQgPSBmbmFtZTsKICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYSk7CiAgICBhLmNsaWNrKCk7CiAgICBhLnJlbW92ZSgpOwogICAgVVJMLnJldm9rZU9iamVjdFVSTCh1cmwpOwoKICB9Y2F0Y2goZSl7CiAgICBhbGVydCgnRXJyb3JlIGR1cmFudGUgbGEgY29uZGl2aXNpb25lLicpOwogIH0KfQoKCjwvc2NyaXB0PgoKPCEtLSBNb2RhbGUgc2VsZXppb25lIHBlcmlvZG8gU3RhdHMgKHNlbnphIHByb21wdCkgLS0+CjxkaXYgaWQ9InBlcmlvZFBpY2tPdmVybGF5Ij4KICA8ZGl2IGNsYXNzPSJib3giIHJvbGU9ImRpYWxvZyIgYXJpYS1tb2RhbD0idHJ1ZSIgYXJpYS1sYWJlbGxlZGJ5PSJwZXJpb2RQaWNrVGl0bGUiPgogICAgPGRpdiBjbGFzcz0iaGRyIiBpZD0icGVyaW9kUGlja1RpdGxlIj5TdGF0aXN0aWNoZSDigJMgU2VsZXppb25hIHBlcmlvZG88L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImJvZHkiPgogICAgICA8bGFiZWwgZm9yPSJwZXJpb2RQaWNrU2VsZWN0Ij5QZXJpb2RvIGRpc3BvbmliaWxlOjwvbGFiZWw+CiAgICAgIDxzZWxlY3QgaWQ9InBlcmlvZFBpY2tTZWxlY3QiPjwvc2VsZWN0PgogICAgICA8ZGl2IGNsYXNzPSJoaW50Ij4KICAgICAgICBNb3N0cmEgbGUgc3RhdGlzdGljaGUgZGVsIHBlcmlvZG8gc2NlbHRvIChRMS4uUTQgb3BwdXJlIE9UKS48YnIvPgogICAgICAgIE5vdGE6IGkgZGF0aSBzb25vIGRpc3BvbmliaWxpIHNvbG8gcGVyIGkgcGVyaW9kaSBnacOgIOKAnGNoaXVzaeKAnSBlIHNhbHZhdGkgYXV0b21hdGljYW1lbnRlLgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0iYWN0aW9ucyI+CiAgICAgIDxidXR0b24gaWQ9InBlcmlvZFBpY2tDYW5jZWwiIGNsYXNzPSJidG4gZ3JheSI+QW5udWxsYTwvYnV0dG9uPgogICAgICA8YnV0dG9uIGlkPSJwZXJpb2RQaWNrT2siIGNsYXNzPSJidG4gYmx1ZSI+QXByaTwvYnV0dG9uPgogICAgPC9kaXY+CiAgPC9kaXY+CjwvZGl2PgoKPC9ib2R5Pgo8L2h0bWw+Cg==",
  viewer: "PCFkb2N0eXBlIGh0bWw+CjxodG1sIGxhbmc9Iml0Ij4KPGhlYWQ+CjxtZXRhIGNoYXJzZXQ9InV0Zi04Ii8+CjxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MSIvPgo8dGl0bGU+QmFza2V0IFN0YXRzIOKAkyBWaWV3ZXIgKHNvbG8gc3RhdGlzdGljaGUpPC90aXRsZT4KPHN0eWxlPgogICp7Ym94LXNpemluZzpib3JkZXItYm94fQogIGJvZHl7bWFyZ2luOjA7Zm9udC1mYW1pbHk6QXJpYWwsc3lzdGVtLXVpLC1hcHBsZS1zeXN0ZW0sU2Vnb2UgVUksUm9ib3RvLHNhbnMtc2VyaWY7YmFja2dyb3VuZDojZjJmMmYyO2NvbG9yOiMxMTF9CiAgaGVhZGVye21pbi1oZWlnaHQ6NTRweDtwb3NpdGlvbjpzdGlja3k7dG9wOjA7ei1pbmRleDoxMDtiYWNrZ3JvdW5kOiMxMTE7Y29sb3I6I2ZmZjtwYWRkaW5nOjEwcHggMTJweDtkaXNwbGF5OmZsZXg7Z2FwOjEwcHg7YWxpZ24taXRlbXM6Y2VudGVyO2ZsZXgtd3JhcDp3cmFwfQogIGhlYWRlciAudGl0bGV7Zm9udC13ZWlnaHQ6ODAwO2xldHRlci1zcGFjaW5nOi4ycHh9CiAgaGVhZGVyIC5zcGFjZXJ7bWFyZ2luLWxlZnQ6YXV0b30KICAud3JhcHtwYWRkaW5nOjEycHg7bWF4LXdpZHRoOjEyMDBweDttYXJnaW46MCBhdXRvfQogIC5jYXJke2JhY2tncm91bmQ6I2ZmZjtib3JkZXI6MXB4IHNvbGlkICNkZGQ7Ym9yZGVyLXJhZGl1czoxMnB4O3BhZGRpbmc6MTJweDttYXJnaW46MTJweCAwO2JveC1zaGFkb3c6MCAycHggMTBweCByZ2JhKDAsMCwwLC4wNSl9CiAgLnJvd3tkaXNwbGF5OmZsZXg7Z2FwOjEwcHg7ZmxleC13cmFwOndyYXA7YWxpZ24taXRlbXM6Y2VudGVyfQogIC5idG57Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czo4cHg7cGFkZGluZzo4cHggMTJweDtmb250LXdlaWdodDo3MDA7Y3Vyc29yOnBvaW50ZXJ9CiAgLmJ0bjpkaXNhYmxlZHtvcGFjaXR5Oi41NTtjdXJzb3I6bm90LWFsbG93ZWR9CiAgLmJsdWV7YmFja2dyb3VuZDojMzQ5OGRiO2NvbG9yOiNmZmZ9CiAgLmdyYXl7YmFja2dyb3VuZDojN2Y4YzhkO2NvbG9yOiNmZmZ9CiAgLnJlZHtiYWNrZ3JvdW5kOiNlNzRjM2M7Y29sb3I6I2ZmZn0KICBpbnB1dFt0eXBlPWZpbGVde21heC13aWR0aDoxMDAlfQogIC5tZXRhe2Rpc3BsYXk6Z3JpZDtncmlkLXRlbXBsYXRlLWNvbHVtbnM6MWZyO2dhcDo2cHg7Zm9udC1zaXplOjEzcHh9CiAgLm1ldGEtbGluZXtjb2xvcjojMzMzO3doaXRlLXNwYWNlOm5vd3JhcDtvdmVyZmxvdzpoaWRkZW47dGV4dC1vdmVyZmxvdzplbGxpcHNpc30KICAubWV0YS1saW5lIHN0cm9uZ3tjb2xvcjojMDAwfQogIC50YWJze2Rpc3BsYXk6ZmxleDtnYXA6NnB4O2ZsZXgtd3JhcDp3cmFwfQogIC50YWJ7cGFkZGluZzo2cHggMTBweDtib3JkZXItcmFkaXVzOjk5OXB4O2JvcmRlcjoxcHggc29saWQgI2JiYjtiYWNrZ3JvdW5kOiNmZmY7Y3Vyc29yOnBvaW50ZXI7Zm9udC13ZWlnaHQ6NzAwfQogIC50YWIuYWN0aXZle2JhY2tncm91bmQ6IzExMTtjb2xvcjojZmZmO2JvcmRlci1jb2xvcjojMTExfQogIC5oMntmb250LXNpemU6MTVweDttYXJnaW46MCAwIDhweDtmb250LXdlaWdodDo5MDB9CiAgdGFibGV7d2lkdGg6MTAwJTtib3JkZXItY29sbGFwc2U6Y29sbGFwc2V9CiAgdGgsdGR7Ym9yZGVyOjFweCBzb2xpZCAjZGRkO3BhZGRpbmc6NnB4IDZweDtmb250LXNpemU6MTJweDt0ZXh0LWFsaWduOmNlbnRlcjt3aGl0ZS1zcGFjZTpub3dyYXB9CiAgdGhlYWQgdGh7YmFja2dyb3VuZDojMTExO2NvbG9yOiNmZmY7cG9zaXRpb246c3RpY2t5O3RvcDowO3otaW5kZXg6Mn0KICB0ZC5uYW1le3RleHQtYWxpZ246bGVmdDtmb250LXdlaWdodDo3MDB9CiAgdGguc29ydGFibGV7Y3Vyc29yOnBvaW50ZXI7dXNlci1zZWxlY3Q6bm9uZX0KICB0aC5zb3J0YWJsZTpob3ZlcntmaWx0ZXI6YnJpZ2h0bmVzcygxLjEpfQogIHRmb290IHRke2JhY2tncm91bmQ6I2Y2ZjZmNjtmb250LXdlaWdodDo5MDB9CiAgLm11dGVke2NvbG9yOiM2NjY7Zm9udC1zaXplOjEycHh9CiAgLm9re2NvbG9yOiMyZWNjNzE7Zm9udC13ZWlnaHQ6ODAwfQogIC5iYWR7Y29sb3I6I2U3NGMzYztmb250LXdlaWdodDo4MDB9Ci5zY29yZS1saW5le2ZvbnQtc2l6ZToxOHB4O2ZvbnQtd2VpZ2h0OjkwMDtjb2xvcjojMDAwO21hcmdpbi1ib3R0b206NHB4fQoKLyogPT09IEhPTUUgKHRvcm5hIGFsIGNydXNjb3R0bykgPT09ICovCi5idG4taG9tZXsKICBwYWRkaW5nOjhweCAxMHB4OwogIGJvcmRlci1yYWRpdXM6MTBweDsKfQoKCi8qID09PSBIT01FICh0b3JuYSBhbCBjcnVzY290dG8pIOKAkyByb3NzbyBlIGFsbGluZWF0byBhIGRlc3RyYSA9PT0gKi8KLmJ0bi1ob21lewogIHBhZGRpbmc6OHB4IDEwcHg7CiAgYm9yZGVyLXJhZGl1czoxMHB4Owp9CgoKLyogPT09PT09PT09PT09PT09PT09PT09PT09PQogICBaRUJSQSBKU09OIChWaWV3ZXIpCj09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KI3N0YXRzVGFibGUgdGJvZHkgdHI6bnRoLWNoaWxkKGV2ZW4pIHRkewogIGJhY2tncm91bmQ6I2UwZTBlMDsKfQoKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT0KICAgUklHQSBSSUVQSUxPR08gKFRPVCkgQVpaVVJSQQo9PT09PT09PT09PT09PT09PT09PT09PT09ICovCiNzdGF0c1RhYmxlIHRmb290IHRkewogIGJhY2tncm91bmQ6I2RiZWVmZjsKICBmb250LXdlaWdodDo5MDA7Cn0KCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09CiAgIE1FVEEgREFUSSBQQVJUSVRBIFNVIFVOQSBSSUdBCj09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KLm1ldGEuc2luZ2xlLWxpbmV7CiAgZGlzcGxheTpibG9jazsKICB3aGl0ZS1zcGFjZTpub3dyYXA7CiAgb3ZlcmZsb3c6aGlkZGVuOwogIHRleHQtb3ZlcmZsb3c6ZWxsaXBzaXM7CiAgZm9udC1zaXplOjEzcHg7Cn0KLm1ldGEuc2luZ2xlLWxpbmUgLm1ldGEtaXRlbXsKICBtYXJnaW4tcmlnaHQ6MTRweDsKfQoKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT0KICAgQUxMSU5FQU1FTlRPIFBBUlpJQUxJIC8gUFJPR1JFU1NJVkkKPT09PT09PT09PT09PT09PT09PT09PT09PSAqLwoubWV0YS1saW5lLnBhcnppYWxpLAoubWV0YS1saW5lLnByb2dyZXNzaXZpewogIGRpc3BsYXk6Z3JpZDsKICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IDEyMHB4IDFmcjsKICBjb2x1bW4tZ2FwOjhweDsKfQoubWV0YS1saW5lLnBhcnppYWxpIHN0cm9uZywKLm1ldGEtbGluZS5wcm9ncmVzc2l2aSBzdHJvbmd7CiAgdGV4dC1hbGlnbjpyaWdodDsKICB3aGl0ZS1zcGFjZTpub3dyYXA7Cn0KCgovKiA9PT09PT09PT09PT09PT09PT09PT09PT09CiAgIE1FVEEgU09QUkEgQUwgUklTVUxUQVRPCj09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KLm1ldGEuc2luZ2xlLWxpbmV7CiAgb3JkZXI6LTE7CiAgbWFyZ2luLWJvdHRvbTo2cHg7CiAgZm9udC1zaXplOjEycHg7CiAgY29sb3I6IzMzMzsKfQouc2NvcmUtbGluZXsKICBtYXJnaW4tdG9wOjA7Cn0KCgouc2VsZWN0ewogIGhlaWdodDozNHB4OwogIHBhZGRpbmc6MCAxMHB4OwogIGJvcmRlcjoxcHggc29saWQgI2RkZDsKICBib3JkZXItcmFkaXVzOjEwcHg7CiAgYmFja2dyb3VuZDojZmZmOwogIGZvbnQtd2VpZ2h0OjcwMDsKICBmb250LXNpemU6MTNweDsKfQoKLnNuYXBidG57CiAgcGFkZGluZzo2cHggMTJweDsKICBib3JkZXItcmFkaXVzOjE2cHg7CiAgYm9yZGVyOjFweCBzb2xpZCAjMjIyOwogIGJhY2tncm91bmQ6I2ZmZjsKICBjdXJzb3I6cG9pbnRlcjsKICBmb250LXdlaWdodDo5MDA7CiAgZm9udC1zaXplOjEycHg7Cn0KLnNuYXBidG5bZGlzYWJsZWRdewogIG9wYWNpdHk6LjM1OwogIGN1cnNvcjpub3QtYWxsb3dlZDsKfQouc25hcGJ0bi5hY3RpdmV7CiAgYmFja2dyb3VuZDojMTExOwogIGNvbG9yOiNmZmY7CiAgYm9yZGVyLWNvbG9yOiMxMTE7Cn0KCi5mYWRlewogIGFuaW1hdGlvbjogZmFkZUluIC4xNXMgZWFzZS1pbjsKfQpAa2V5ZnJhbWVzIGZhZGVJbnsKICBmcm9te29wYWNpdHk6LjR9CiAgdG97b3BhY2l0eToxfQp9CgoKLyogQ2VudGVyZWQgbWF0Y2ggc2NvcmUgaW4gdG9wIGJhciAqLwpoZWFkZXJ7IHBvc2l0aW9uOnJlbGF0aXZlOyB9CiNzY29yZUxpbmVIZWFkZXJ7CiAgcG9zaXRpb246YWJzb2x1dGU7CiAgbGVmdDo1MCU7CiAgdG9wOjUwJTsKICB0cmFuc2Zvcm06dHJhbnNsYXRlKC01MCUsLTUwJSk7CiAgbWFyZ2luOjAgIWltcG9ydGFudDsKICBmb250LXdlaWdodDo5MDA7CiAgZm9udC1zaXplOjE4cHg7CiAgd2hpdGUtc3BhY2U6bm93cmFwOwogIHRleHQtYWxpZ246Y2VudGVyOwp9CgoKICAjYnRuQ2xlYXJ7ZGlzcGxheTpub25lICFpbXBvcnRhbnQ7fQoKCi8qID09PT09PT09PT09PT09PT09PT09PT09PT0KICAgTU9EQUxFIElOUFVUIChubyBwcm9tcHQpCj09PT09PT09PT09PT09PT09PT09PT09PT0gKi8KI3NlYXNvbk5hbWVPdmVybGF5ewogIGRpc3BsYXk6bm9uZTsKICBwb3NpdGlvbjpmaXhlZDsKICBpbnNldDowOwogIGJhY2tncm91bmQ6cmdiYSgwLDAsMCwuNDUpOwogIHotaW5kZXg6MTAwMDA7CiAgYWxpZ24taXRlbXM6Y2VudGVyOwogIGp1c3RpZnktY29udGVudDpjZW50ZXI7CiAgcGFkZGluZzoxNnB4Owp9CiNzZWFzb25OYW1lT3ZlcmxheSAuYm94ewogIHdpZHRoOm1pbig1MjBweCwgMTAwJSk7CiAgYmFja2dyb3VuZDojZmZmOwogIGJvcmRlci1yYWRpdXM6MTRweDsKICBib3gtc2hhZG93OjAgMTBweCA0MHB4IHJnYmEoMCwwLDAsLjI1KTsKICBvdmVyZmxvdzpoaWRkZW47CiAgYm9yZGVyOjFweCBzb2xpZCAjZWVlOwp9CiNzZWFzb25OYW1lT3ZlcmxheSAuaGRyewogIHBhZGRpbmc6MTJweCAxNHB4OwogIGZvbnQtd2VpZ2h0OjkwMDsKICBib3JkZXItYm90dG9tOjFweCBzb2xpZCAjZWVlOwp9CiNzZWFzb25OYW1lT3ZlcmxheSAuYm9keXsKICBwYWRkaW5nOjE0cHg7CiAgZGlzcGxheTpmbGV4OwogIGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsKICBnYXA6MTBweDsKfQojc2Vhc29uTmFtZU92ZXJsYXkgbGFiZWx7CiAgZm9udC1zaXplOjEzcHg7CiAgZm9udC13ZWlnaHQ6ODAwOwp9CiNzZWFzb25OYW1lT3ZlcmxheSBpbnB1dHsKICBoZWlnaHQ6NDBweDsKICBwYWRkaW5nOjAgMTJweDsKICBib3JkZXI6MXB4IHNvbGlkICNkZGQ7CiAgYm9yZGVyLXJhZGl1czoxMHB4OwogIGZvbnQtc2l6ZToxNHB4OwogIGZvbnQtd2VpZ2h0OjcwMDsKfQojc2Vhc29uTmFtZU92ZXJsYXkgLmFjdGlvbnN7CiAgZGlzcGxheTpmbGV4OwogIGp1c3RpZnktY29udGVudDpmbGV4LWVuZDsKICBnYXA6OHB4OwogIHBhZGRpbmc6MTJweCAxNHB4OwogIGJvcmRlci10b3A6MXB4IHNvbGlkICNlZWU7CiAgYmFja2dyb3VuZDojZmFmYWZhOwp9Cgo8L3N0eWxlPgoKCjwvaGVhZD4KPGJvZHk+CgoKPGhlYWRlcj4KICA8ZGl2IGNsYXNzPSJ0aXRsZSI+QmFza2V0IFN0YXRzIOKAkyBWaWV3ZXI8L2Rpdj4KICA8ZGl2IGlkPSJzY29yZUxpbmVIZWFkZXIiPjwvZGl2Pgo8ZGl2IGNsYXNzPSJzcGFjZXIiPjwvZGl2PgogIDxsYWJlbCBjbGFzcz0iYnRuIGJsdWUiPgogICAg8J+TgiBBcHJpIEpTT04KICAgIDxpbnB1dCBpZD0iZmlsZUlucHV0IiB0eXBlPSJmaWxlIiBtdWx0aXBsZSBhY2NlcHQ9Ii5qc29uLGFwcGxpY2F0aW9uL2pzb24iIHN0eWxlPSJkaXNwbGF5Om5vbmUiLz4KICA8L2xhYmVsPgoKCiAgPGJ1dHRvbiBpZD0iYnRuTGlicmFyeSIgY2xhc3M9ImJ0biBncmF5IiBzdHlsZT0ibWFyZ2luLWxlZnQ6MTBweDsiPvCfk5ogTGlicmVyaWEgcGFydGl0ZTwvYnV0dG9uPgoKICA8ZGl2IGlkPSJtdWx0aUNvbnRyb2xzIiBzdHlsZT0iZGlzcGxheTpub25lOyBnYXA6OHB4OyBhbGlnbi1pdGVtczpjZW50ZXI7IG1hcmdpbi1sZWZ0OjEwcHg7Ij4KICAgIDxzZWxlY3QgaWQ9InNlbEdhbWUiIGNsYXNzPSJzZWxlY3QiPjwvc2VsZWN0PgogICAgPHNlbGVjdCBpZD0ic2VsU25hcCIgY2xhc3M9InNlbGVjdCI+PC9zZWxlY3Q+CiAgPC9kaXY+CgogIDxidXR0b24gaWQ9ImJ0bkNsZWFyIiBjbGFzcz0iYnRuIGdyYXkiIGRpc2FibGVkPuKcliBTdnVvdGE8L2J1dHRvbj4KICA8YnV0dG9uIGNsYXNzPSJidG4gcmVkIGJ0bi1ob21lIiBvbmNsaWNrPSJnb0hvbWUoKSIgdGl0bGU9IlRvcm5hIGFsIGNydXNjb3R0byI+8J+PoDwvYnV0dG9uPgo8L2hlYWRlcj4KCjxkaXYgaWQ9InNuYXBCYXIiIHN0eWxlPSJkaXNwbGF5Om5vbmU7IGJhY2tncm91bmQ6I2Y2ZjZmNjsgYm9yZGVyLWJvdHRvbToxcHggc29saWQgI2RkZDsgcGFkZGluZzoxMHB4IDE2cHg7Ij4KICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7IGFsaWduLWl0ZW1zOmNlbnRlcjsgZ2FwOjEwcHg7IGZsZXgtd3JhcDp3cmFwOyBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOyI+CiAgICA8ZGl2IGlkPSJzbmFwQnV0dG9ucyIgc3R5bGU9ImRpc3BsYXk6ZmxleDsgZ2FwOjhweDsgZmxleC13cmFwOndyYXA7IGp1c3RpZnktY29udGVudDpjZW50ZXI7IHdpZHRoOjEwMCU7Ij48L2Rpdj4KICAgIDxkaXYgaWQ9InNuYXBJbmZvIiBzdHlsZT0iZm9udC1zaXplOjEycHg7IGNvbG9yOiM1NTU7IGZvbnQtd2VpZ2h0OjcwMDsiPjwvZGl2PgogIDwvZGl2Pgo8L2Rpdj4KCgo8ZGl2IGNsYXNzPSJ3cmFwIj4KICA8ZGl2IGlkPSJlbXB0eSIgY2xhc3M9ImNhcmQiPgogICAgPGRpdiBjbGFzcz0iaDIiPkNvbWUgdXNhcmxvPC9kaXY+CiAgICA8b2w+CiAgICAgIDxsaT5OZWwgZm9nbGlvIHBhcnRpdGEsIGNsaWNjYSA8c3Ryb25nPvCfkr4gU2FsdmE8L3N0cm9uZz4gKHB1b2kgZmFybG8gYW5jaGUgYSBmaW5lIFExL1EyL1EzL1E0IChlIE9UMS9PVDIuLi4pIGNoaWFtYW5kbyBpIGZpbGUg4oCcLi4uIFEx4oCdLCDigJwuLi4gUTLigJ0sIGVjYy4pLjwvbGk+CiAgICAgIDxsaT5RdWkgY2xpY2NhIDxzdHJvbmc+8J+TgiBBcHJpIEpTT048L3N0cm9uZz4gZSBzZWxlemlvbmEgaWwgZmlsZSBzYWx2YXRvLjwvbGk+CiAgICAgIDxsaT5WZWRyYWkgc3RhdGlzdGljaGUgZSB0b3RhbGk7IHB1b2kgb3JkaW5hcmUgY2xpY2NhbmRvIHN1bGxlIGludGVzdGF6aW9uaS48L2xpPgogICAgPC9vbD4KICAgIDxkaXYgY2xhc3M9Im11dGVkIj5TdWdnZXJpbWVudG86IHBlciBzYWx2YXJlIGzigJlpc3RhbnphIGRlbCBzaW5nb2xvIHF1YXJ0byBzZW56YSBtb2RpZmljaGUgYWwgZm9nbGlvIHBhcnRpdGEsIGJhc3RhIHNhbHZhcmUgYSBmaW5lIHBlcmlvZG8gY29uIHVuIG5vbWUgZGl2ZXJzby48L2Rpdj4KICA8L2Rpdj4KCiAgPGRpdiBpZD0iY29udGVudCIgc3R5bGU9ImRpc3BsYXk6bm9uZSI+CiAgICA8ZGl2IGNsYXNzPSJjYXJkIj4KICAgICAgPGRpdiBjbGFzcz0icm93IiBzdHlsZT0ianVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW4iPgogICAgICAgIDxkaXY+CiAgICAgICAgICAKICAgICAgICAgIDxkaXYgY2xhc3M9Im1ldGEiIGlkPSJtZXRhQm94Ij48L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJ0YWJzIiBpZD0ic2lkZVRhYnMiIGFyaWEtbGFiZWw9IlNlbGV6aW9uYSBzcXVhZHJhIj48L2Rpdj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJjYXJkIj4KICAgICAgPGRpdiBjbGFzcz0icm93IiBzdHlsZT0ianVzdGlmeS1jb250ZW50OnNwYWNlLWJldHdlZW4iPgogICAgICAgIDxkaXYgY2xhc3M9ImgyIiBpZD0idGFibGVUaXRsZSI+U3RhdGlzdGljaGU8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzPSJtdXRlZCI+Q2xpY2NhIHN1bGxlIGludGVzdGF6aW9uaSBwZXIgb3JkaW5hcmUuPC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IHN0eWxlPSJvdmVyZmxvdzphdXRvO21heC1oZWlnaHQ6NzB2aDtib3JkZXI6MXB4IHNvbGlkICNlZWU7Ym9yZGVyLXJhZGl1czoxMHB4Ij4KICAgICAgICA8dGFibGUgaWQ9InN0YXRzVGFibGUiIGFyaWEtbGFiZWw9IlRhYmVsbGEgc3RhdGlzdGljaGUiPgogICAgICAgICAgPHRoZWFkPjwvdGhlYWQ+CiAgICAgICAgICA8dGJvZHk+PC90Ym9keT4KICAgICAgICAgIDx0Zm9vdD48L3Rmb290PgogICAgICAgIDwvdGFibGU+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgPC9kaXY+CjwvZGl2PgoKPHNjcmlwdD4KLyogPT09PT0gVXRpbGl0aWVzID09PT09ICovCmZ1bmN0aW9uIGZvcm1hdFRpbWUoc2VjKXsKICBzZWMgPSBNYXRoLm1heCgwLCBNYXRoLmZsb29yKE51bWJlcihzZWMpIHx8IDApKTsKICBjb25zdCBtID0gTWF0aC5mbG9vcihzZWMgLyA2MCk7CiAgY29uc3QgcyA9IHNlYyAlIDYwOwogIHJldHVybiBTdHJpbmcobSkucGFkU3RhcnQoMiwnMCcpICsgJzonICsgU3RyaW5nKHMpLnBhZFN0YXJ0KDIsJzAnKTsKfQpmdW5jdGlvbiBzdGF0c1BNKHApewogIGNvbnN0IHNlY1BsYXllZCA9IE1hdGgubWF4KDAsIE51bWJlcihwPy5taW4pIHx8IDApOwogIGNvbnN0IG1pblBsYXllZCA9IHNlY1BsYXllZCAvIDYwOwogIGNvbnN0IHB0cyA9IE51bWJlcihwPy5wdHMpIHx8IDA7CiAgaWYobWluUGxheWVkIDw9IDApIHJldHVybiAn4oCUJzsKICByZXR1cm4gKHB0cyAvIG1pblBsYXllZCkudG9GaXhlZCgyKTsKfQpmdW5jdGlvbiBwY3QobWFkZSwgYXR0KXsKICBhdHQgPSBOdW1iZXIoYXR0fHwwKTsgbWFkZSA9IE51bWJlcihtYWRlfHwwKTsKICBpZihhdHQgPD0gMCkgcmV0dXJuICfigJQnOwogIGNvbnN0IHYgPSAobWFkZS9hdHQpKjEwMDsKICByZXR1cm4gdi50b0ZpeGVkKDEpLnJlcGxhY2UoJy4nLCAnLCcpICsgJyUnOwp9CmZ1bmN0aW9uIGZtdE9FUih2KXsKICBjb25zdCBuID0gTnVtYmVyKHZ8fDApOwogIGlmKCFOdW1iZXIuaXNGaW5pdGUobikgfHwgbjw9MCkgcmV0dXJuICcwJzsKICByZXR1cm4gbi50b0ZpeGVkKDEpLnJlcGxhY2UoJy4nLCAnLCcpOwp9CgoKZnVuY3Rpb24gYnVpbGRQcm9ncmVzc2l2ZVBhcnRpYWxzKGdhbWUpewogIGNvbnN0IHEgPSBnYW1lPy5zdGF0ZT8ucXVhcnRlcnMgfHwge307CiAgbGV0IHNhID0gMCwgc2IgPSAwOwogIGNvbnN0IG91dCA9IFtdOwogIGZvcihsZXQgaT0xO2k8PTQ7aSsrKXsKICAgIHNhICs9IE51bWJlcihxW2BxJHtpfWFgXSA/PyAwKTsKICAgIHNiICs9IE51bWJlcihxW2BxJHtpfWJgXSA/PyAwKTsKICAgIG91dC5wdXNoKGAke3NhfS0ke3NifWApOwogIH0KICByZXR1cm4gb3V0LmpvaW4oJyAvICcpOwp9CgpmdW5jdGlvbiBidWlsZENvbXBhY3RQYXJ0aWFscyhnYW1lKXsKICBjb25zdCBxID0gZ2FtZT8uc3RhdGU/LnF1YXJ0ZXJzIHx8IHt9OwogIGNvbnN0IG91dCA9IFtdOwogIGZvcihsZXQgaT0xO2k8PTQ7aSsrKXsKICAgIGNvbnN0IGEgPSBxW2BxJHtpfWFgXSA/PyAwOwogICAgY29uc3QgYiA9IHFbYHEke2l9YmBdID8/IDA7CiAgICBvdXQucHVzaChgJHthfS0ke2J9YCk7CiAgfQogIHJldHVybiBvdXQuam9pbignIC8gJyk7Cn0KCmZ1bmN0aW9uIGZtdFBNKHYpewogIGNvbnN0IG4gPSBOdW1iZXIodnx8MCk7CiAgY29uc3QgcyA9IChuPjA/JysnOicnKSArIFN0cmluZyhuKTsKICByZXR1cm4gczsKfQoKLyogPT09PT0gUElSIC8gT0VSIChhbGxpbmVhdGkgYWxsYSB0dWEgdWx0aW1hIHZlcnNpb25lKSA9PT09PSAqLwpmdW5jdGlvbiBjYWxjUElSKHApewogIGNvbnN0IGZnbSA9IChwWycycHQnXT8ubWFkZXx8MCkgKyAocFsnM3B0J10/Lm1hZGV8fDApOwogIGNvbnN0IGZnYSA9IChwWycycHQnXT8uYXR0fHwwKSAgKyAocFsnM3B0J10/LmF0dHx8MCk7CiAgY29uc3QgZnRtID0gKHAudGw/Lm1hZGV8fDApOwogIGNvbnN0IGZ0YSA9IChwLnRsPy5hdHR8fDApOwoKICBjb25zdCBtaXNzZWRGRyA9IE1hdGgubWF4KDAsIGZnYSAtIGZnbSk7CiAgY29uc3QgbWlzc2VkRlQgPSBNYXRoLm1heCgwLCBmdGEgLSBmdG0pOwoKICBjb25zdCByZWIgPSAocC5yYXx8MCkgKyAocC5yZHx8MCk7CgogIHJldHVybiAocC5wdHN8fDApCiAgICArIHJlYgogICAgKyAocC5hfHwwKQogICAgKyAocC5wcnx8MCkKICAgICsgKHAuc3RmfHwwKQogICAgKyAocC5mc3x8MCkKICAgIC0gbWlzc2VkRkcKICAgIC0gbWlzc2VkRlQKICAgIC0gKHAucHB8fDApCiAgICAtIChwLmZmfHwwKQogICAgLSAocC5zdHN8fDApOwp9CmZ1bmN0aW9uIGNhbGNPRVIocCl7CiAgY29uc3QgZmdhID0gKHBbJzJwdCddPy5hdHR8fDApICsgKHBbJzNwdCddPy5hdHR8fDApOwogIGNvbnN0IGZ0YSA9IChwLnRsPy5hdHR8fDApOwogIGNvbnN0IHRvICA9IChwLnBwfHwwKTsKICBjb25zdCBvcmIgPSAocC5yYXx8MCk7CiAgY29uc3QgZGVub20gPSBmZ2EgLSBvcmIgKyAwLjQ0KmZ0YSArIHRvOwogIGlmKGRlbm9tIDwgMykgcmV0dXJuIDA7CiAgcmV0dXJuICgxMDAgKiAocC5wdHN8fDApIC8gZGVub20pOwp9CgovKiA9PT09PSBUb3RhbGkgc3F1YWRyYSA9PT09PSAqLwpmdW5jdGlvbiB0ZWFtVG90YWxzKGFycil7CiAgY29uc3QgdCA9IHsKICAgIG51bTonJywgbmFtZTonVE9UJywKICAgIHB0czowLCBmZjowLCBtaW46MCwgcG06MCwKICAgICcycHQnOnttYWRlOjAsYXR0OjB9LAogICAgJzNwdCc6e21hZGU6MCxhdHQ6MH0sCiAgICB0bDp7bWFkZTowLGF0dDowfSwKICAgIGZzOjAsIHJhOjAsIHJkOjAsIGE6MCwgcHA6MCwgcHI6MCwgc3RmOjAsIHN0czowCiAgfTsKICAoYXJyfHxbXSkuZm9yRWFjaChwPT57CiAgICB0LnB0cyArPSBOdW1iZXIocC5wdHN8fDApOwogICAgdC5mZiAgKz0gTnVtYmVyKHAuZmZ8fDApOwogICAgdC5taW4gKz0gTnVtYmVyKHAubWlufHwwKTsKICAgIHQucG0gICs9IE51bWJlcihwLnBtfHwwKTsKICAgIHRbJzJwdCddLm1hZGUgKz0gTnVtYmVyKHBbJzJwdCddPy5tYWRlfHwwKTsKICAgIHRbJzJwdCddLmF0dCAgKz0gTnVtYmVyKHBbJzJwdCddPy5hdHR8fDApOwogICAgdFsnM3B0J10ubWFkZSArPSBOdW1iZXIocFsnM3B0J10/Lm1hZGV8fDApOwogICAgdFsnM3B0J10uYXR0ICArPSBOdW1iZXIocFsnM3B0J10/LmF0dHx8MCk7CiAgICB0LnRsLm1hZGUgKz0gTnVtYmVyKHAudGw/Lm1hZGV8fDApOwogICAgdC50bC5hdHQgICs9IE51bWJlcihwLnRsPy5hdHR8fDApOwogICAgdC5mcyArPSBOdW1iZXIocC5mc3x8MCk7CiAgICB0LnJhICs9IE51bWJlcihwLnJhfHwwKTsKICAgIHQucmQgKz0gTnVtYmVyKHAucmR8fDApOwogICAgdC5hICArPSBOdW1iZXIocC5hfHwwKTsKICAgIHQucHAgKz0gTnVtYmVyKHAucHB8fDApOwogICAgdC5wciArPSBOdW1iZXIocC5wcnx8MCk7CiAgICB0LnN0ZiArPSBOdW1iZXIocC5zdGZ8fDApOwogICAgdC5zdHMgKz0gTnVtYmVyKHAuc3RzfHwwKTsKICB9KTsKICByZXR1cm4gdDsKfQoKLyogPT09PT0gVmlld2VyIHN0YXRlID09PT09ICovCmxldCBHQU1FID0gbnVsbDsKbGV0IFNJREUgPSAnQSc7CmxldCBzb3J0ID0geyBrZXk6ICdudW0nLCBkaXI6IDEgfTsKCmNvbnN0IENPTFMgPSBbCiAge2s6J251bScsICB0OicjJywgY2xzOidzb3J0YWJsZSd9LAogIHtrOiduYW1lJywgdDonQXRsZXRhJywgY2xzOidzb3J0YWJsZSd9LAogIHtrOidwdHMnLCAgdDonUFRTJywgY2xzOidzb3J0YWJsZSd9LAogIHtrOidmZicsICAgdDonRkYnLCBjbHM6J3NvcnRhYmxlJ30sCiAge2s6J21pbicsICB0OidNSU4nLCBjbHM6J3NvcnRhYmxlJ30sCiAge2s6J3BtcicsICB0OidQL00nLCBjbHM6J3NvcnRhYmxlJ30sCiAge2s6J3QyJywgICB0OicyUFQnLCBjbHM6J3NvcnRhYmxlJ30sCiAge2s6J3QycCcsICB0OidUMiAlJywgY2xzOidzb3J0YWJsZSd9LAogIHtrOid0MycsICAgdDonM1BUJywgY2xzOidzb3J0YWJsZSd9LAogIHtrOid0M3AnLCAgdDonVDMgJScsIGNsczonc29ydGFibGUnfSwKICB7azondGwnLCAgIHQ6J1RMJywgY2xzOidzb3J0YWJsZSd9LAogIHtrOid0bHAnLCAgdDonVEwgJScsIGNsczonc29ydGFibGUnfSwKICB7azonZnMnLCAgIHQ6J0ZTJywgY2xzOidzb3J0YWJsZSd9LAogIHtrOidyYScsICAgdDonUkEnLCBjbHM6J3NvcnRhYmxlJ30sCiAge2s6J3JkJywgICB0OidSRCcsIGNsczonc29ydGFibGUnfSwKICB7azonYScsICAgIHQ6J0EnLCBjbHM6J3NvcnRhYmxlJ30sCiAge2s6J3BwJywgICB0OidQUCcsIGNsczonc29ydGFibGUnfSwKICB7azoncHInLCAgIHQ6J1BSJywgY2xzOidzb3J0YWJsZSd9LAogIHtrOidzdGYnLCAgdDonU1RmJywgY2xzOidzb3J0YWJsZSd9LAogIHtrOidzdHMnLCAgdDonU1RzJywgY2xzOidzb3J0YWJsZSd9LAogIHtrOidwaXInLCAgdDonUElSJywgY2xzOidzb3J0YWJsZSd9LAogIHtrOidvZXInLCAgdDonT0VSJywgY2xzOidzb3J0YWJsZSd9LAogIHtrOidwbScsICAgdDonKy8tJywgY2xzOidzb3J0YWJsZSd9Cl07CgpmdW5jdGlvbiBnZXRTdGF0VmFsdWUocCwga2V5LCB0ZWFtVG90KXsKICBzd2l0Y2goa2V5KXsKICAgIGNhc2UgJ251bSc6IHJldHVybiBOdW1iZXIocD8ubnVtfHwwKTsKICAgIGNhc2UgJ25hbWUnOiByZXR1cm4gU3RyaW5nKHA/Lm5hbWV8fCcnKS50b0xvd2VyQ2FzZSgpOwogICAgY2FzZSAncHRzJzogcmV0dXJuIE51bWJlcihwPy5wdHN8fDApOwogICAgY2FzZSAnZmYnOiByZXR1cm4gTnVtYmVyKHA/LmZmfHwwKTsKICAgIGNhc2UgJ21pbic6IHJldHVybiBOdW1iZXIocD8ubWlufHwwKTsKICAgIGNhc2UgJ3Btcic6IHsKICAgICAgY29uc3QgbSA9IChOdW1iZXIocD8ubWluKXx8MCkvNjA7CiAgICAgIHJldHVybiBtPjAgPyAoTnVtYmVyKHA/LnB0cyl8fDApL20gOiAtSW5maW5pdHk7CiAgICB9CiAgICBjYXNlICd0Mic6IHJldHVybiAoTnVtYmVyKHA/LlsnMnB0J10/Lm1hZGV8fDApIC8gTWF0aC5tYXgoMSwgTnVtYmVyKHA/LlsnMnB0J10/LmF0dHx8MCkpKTsKICAgIGNhc2UgJ3QzJzogcmV0dXJuIChOdW1iZXIocD8uWyczcHQnXT8ubWFkZXx8MCkgLyBNYXRoLm1heCgxLCBOdW1iZXIocD8uWyczcHQnXT8uYXR0fHwwKSkpOwogICAgY2FzZSAndGwnOiByZXR1cm4gKE51bWJlcihwPy50bD8ubWFkZXx8MCkgLyBNYXRoLm1heCgxLCBOdW1iZXIocD8udGw/LmF0dHx8MCkpKTsKICAgIGNhc2UgJ3QycCc6IHJldHVybiAoTnVtYmVyKHA/LlsnMnB0J10/LmF0dHx8MCkgPyAoTnVtYmVyKHA/LlsnMnB0J10/Lm1hZGV8fDApIC8gTnVtYmVyKHA/LlsnMnB0J10/LmF0dHx8MCkpKjEwMCA6IC1JbmZpbml0eSk7CiAgICBjYXNlICd0M3AnOiByZXR1cm4gKE51bWJlcihwPy5bJzNwdCddPy5hdHR8fDApID8gKE51bWJlcihwPy5bJzNwdCddPy5tYWRlfHwwKSAvIE51bWJlcihwPy5bJzNwdCddPy5hdHR8fDApKSoxMDAgOiAtSW5maW5pdHkpOwogICAgY2FzZSAndGxwJzogcmV0dXJuIChOdW1iZXIocD8udGw/LmF0dHx8MCkgPyAoTnVtYmVyKHA/LnRsPy5tYWRlfHwwKSAvIE51bWJlcihwPy50bD8uYXR0fHwwKSkqMTAwIDogLUluZmluaXR5KTsKICAgIGNhc2UgJ2ZzJzogcmV0dXJuIE51bWJlcihwPy5mc3x8MCk7CiAgICBjYXNlICdyYSc6IHJldHVybiBOdW1iZXIocD8ucmF8fDApOwogICAgY2FzZSAncmQnOiByZXR1cm4gTnVtYmVyKHA/LnJkfHwwKTsKICAgIGNhc2UgJ2EnOiByZXR1cm4gTnVtYmVyKHA/LmF8fDApOwogICAgY2FzZSAncHAnOiByZXR1cm4gTnVtYmVyKHA/LnBwfHwwKTsKICAgIGNhc2UgJ3ByJzogcmV0dXJuIE51bWJlcihwPy5wcnx8MCk7CiAgICBjYXNlICdzdGYnOiByZXR1cm4gTnVtYmVyKHA/LnN0Znx8MCk7CiAgICBjYXNlICdzdHMnOiByZXR1cm4gTnVtYmVyKHA/LnN0c3x8MCk7CiAgICBjYXNlICdwaXInOiByZXR1cm4gTnVtYmVyKGNhbGNQSVIocCl8fDApOwogICAgY2FzZSAnb2VyJzogcmV0dXJuIE51bWJlcihjYWxjT0VSKHApfHwwKTsKICAgIGNhc2UgJ3BtJzogcmV0dXJuIE51bWJlcihwPy5wbXx8MCk7CiAgICBkZWZhdWx0OiByZXR1cm4gMDsKICB9Cn0KCmZ1bmN0aW9uIHJlbmRlcigpewogIGNvbnN0IGVtcHR5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2VtcHR5Jyk7CiAgY29uc3QgY29udGVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb250ZW50Jyk7CiAgaWYoIUdBTUUpewogICAgZW1wdHkuc3R5bGUuZGlzcGxheT0nYmxvY2snOwogICAgY29udGVudC5zdHlsZS5kaXNwbGF5PSdub25lJzsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG5DbGVhcicpLmRpc2FibGVkID0gdHJ1ZTsKICAgIHJldHVybjsKICB9CiAgZW1wdHkuc3R5bGUuZGlzcGxheT0nbm9uZSc7CiAgY29udGVudC5zdHlsZS5kaXNwbGF5PSdibG9jayc7CiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bkNsZWFyJykuZGlzYWJsZWQgPSBmYWxzZTsKCiAgY29uc3QgYU5hbWUgPSAoR0FNRT8uc3RhdGU/LnVpPy5uYW1lQSB8fCBHQU1FPy5tZXRhPy5hTmFtZSB8fCAnU3F1YWRyYSBBJykudHJpbSgpOwogIGNvbnN0IGJOYW1lID0gKEdBTUU/LnN0YXRlPy51aT8ubmFtZUIgfHwgR0FNRT8ubWV0YT8uYk5hbWUgfHwgJ1NxdWFkcmEgQicpLnRyaW0oKTsKICAvLyB0aXRvbG8gY29tcGF0dG8gcmltb3NzbwoKCiAgLy8gUmlzdWx0YXRvIGZpbmFsZSAoc2UgcHJlc2VudGUgbmVsIEpTT04pCiAgY29uc3QgbWV0YTAgPSBHQU1FPy5tZXRhIHx8IHt9Owpjb25zdCBzY29yZUxpbmUgPSAoKCkgPT4gewogICAgY29uc3QgQSA9IChtZXRhMC5zY29yZUFOYW1lIHx8IG1ldGEwLmFOYW1lIHx8IGFOYW1lIHx8ICdTcXVhZHJhIEEnKS50b1N0cmluZygpLnRyaW0oKTsKICAgIGNvbnN0IEIgPSAobWV0YTAuc2NvcmVCTmFtZSB8fCBtZXRhMC5iTmFtZSB8fCBiTmFtZSB8fCAnU3F1YWRyYSBCJykudG9TdHJpbmcoKS50cmltKCk7CgogICAgLy8gcHVudGVnZ2k6IHByaW1hIHNjb3JlQS9zY29yZUIsIHBvaSBmaW5hbFNjb3JlQS9maW5hbFNjb3JlQgogICAgY29uc3Qgc0EgPSAobWV0YTAuc2NvcmVBIT1udWxsID8gbWV0YTAuc2NvcmVBIDogbWV0YTAuZmluYWxTY29yZUEpOwogICAgY29uc3Qgc0IgPSAobWV0YTAuc2NvcmVCIT1udWxsID8gbWV0YTAuc2NvcmVCIDogbWV0YTAuZmluYWxTY29yZUIpOwoKICAgIGlmKHNBPT1udWxsIHx8IHNCPT1udWxsKSByZXR1cm4gJyc7CgogICAgLy8gZm9ybWF0byByaWNoaWVzdG86IE5PTUVBIFBVTlRJQSAtIFBVTlRJQiBOT01FIEIKICAgIHJldHVybiBgJHtBfSAke3NBfSAtICR7c0J9ICR7Qn1gOwogIH0pKCk7CgogIC8vIE1ldGEgYm94CiAgY29uc3QgdWkgPSBHQU1FPy5zdGF0ZT8udWkgfHwge307CiAgY29uc3QgbWV0YSA9IFsKICAgIFsnQ2F0ZWdvcmlhJywgdWkuY2FtcGlvbmF0b10sCiAgICBbJ0dpcm9uZScsIHVpLmdpcm9uZV0sCiAgICBbJ0RhdGEnLCB1aS5kYXRhR2FyYV0sCiAgICBbJ0dpb3JuYXRhJywgdWkuZ2lvcm5hdGFdLAogICAgWydBL1InLCB1aS5hbmRhdGFSaXRvcm5vXSwKICAgIFsnQ2FzYS9GdW9yaScsIHVpLmNhc2FGdW9yaV0sCiAgICBbJ0FyYml0cm8gMScsIHVpLmFyYml0cm8xXSwKICAgIFsnQXJiaXRybyAyJywgdWkuYXJiaXRybzJdLAogIF0uZmlsdGVyKHggPT4gKHhbMV18fCcnKS50b1N0cmluZygpLnRyaW0oKS5sZW5ndGgpOwoKICBjb25zdCBxdWFydGVycyA9IEdBTUU/LnN0YXRlPy5xdWFydGVycyB8fCB7fTsKICBjb25zdCBwYXJ6QSA9IE9iamVjdC5rZXlzKHF1YXJ0ZXJzKS5maWx0ZXIoaz0+ay5tYXRjaCgvXnFcZCthJHxeb3RcZCthJC8pKS5zb3J0KCkubWFwKGs9PnsKICAgIGNvbnN0IGxhYiA9IGsuc3RhcnRzV2l0aCgncScpID8gKCdRJytrWzFdKSA6ICgnT1QnK2subWF0Y2goL290KFxkKykvKVsxXSk7CiAgICByZXR1cm4gbGFiKyc6JytxdWFydGVyc1trXTsKICB9KS5qb2luKCcg4oCiICcpOwogIGNvbnN0IHBhcnpCID0gT2JqZWN0LmtleXMocXVhcnRlcnMpLmZpbHRlcihrPT5rLm1hdGNoKC9ecVxkK2IkfF5vdFxkK2IkLykpLnNvcnQoKS5tYXAoaz0+ewogICAgY29uc3QgbGFiID0gay5zdGFydHNXaXRoKCdxJykgPyAoJ1EnK2tbMV0pIDogKCdPVCcray5tYXRjaCgvb3QoXGQrKS8pWzFdKTsKICAgIHJldHVybiBsYWIrJzonK3F1YXJ0ZXJzW2tdOwogIH0pLmpvaW4oJyDigKIgJyk7CgogIGNvbnN0IG1ldGFCb3ggPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWV0YUJveCcpOwoKICAvLyBNZXRhIGJveCAoMSByaWdhKSArIHJpc3VsdGF0byBzb3R0byArIHBhcnppYWxpL3Byb2dyZXNzaXZpIGFsbGluZWF0aQogIG1ldGFCb3guaW5uZXJIVE1MID0gJyc7CiAgbWV0YUJveC5jbGFzc05hbWUgPSAnbWV0YSBzaW5nbGUtbGluZSc7CgogIC8vIHJpZ2EgbWV0YSBjb21wYXR0YSAoc29wcmEpCiAgY29uc3QgbWV0YUxpbmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICBtZXRhLmZvckVhY2goKFtrLHZdKT0+ewogICAgY29uc3Qgcz1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJyk7CiAgICBzLmNsYXNzTmFtZT0nbWV0YS1pdGVtJzsKICAgIHMuaW5uZXJIVE1MID0gYDxzdHJvbmc+JHtrfTo8L3N0cm9uZz4gJHsodnx8JycpLnRvU3RyaW5nKCl9YDsKICAgIG1ldGFMaW5lLmFwcGVuZENoaWxkKHMpOwogIH0pOwogIGlmKG1ldGFMaW5lLmNoaWxkTm9kZXMubGVuZ3RoKSBtZXRhQm94LmFwcGVuZENoaWxkKG1ldGFMaW5lKTsKCiAgLy8gcmlzdWx0YXRvIChzb3R0bykKICBpZihzY29yZUxpbmUpewogICAgY29uc3QgZD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGQuY2xhc3NOYW1lPSdzY29yZS1saW5lJzsKICAgIGQuaW5uZXJIVE1MID0gYCR7c2NvcmVMaW5lfWA7CiAgICBtZXRhQm94LmFwcGVuZENoaWxkKGQpOwogIH0KCiAgLy8gUGFyemlhbGkgY29tcGF0dGkKICBjb25zdCBjb21wYWN0ID0gYnVpbGRDb21wYWN0UGFydGlhbHMoR0FNRSk7CiAgaWYoY29tcGFjdCl7CiAgICBjb25zdCBkPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpOwogICAgZC5jbGFzc05hbWU9J21ldGEtbGluZSBwYXJ6aWFsaSc7CiAgICBkLmlubmVySFRNTCA9IGA8c3Ryb25nPlBhcnppYWxpOjwvc3Ryb25nPjxzcGFuPiR7Y29tcGFjdH08L3NwYW4+YDsKICAgIG1ldGFCb3guYXBwZW5kQ2hpbGQoZCk7CiAgfQoKICAvLyBQcm9ncmVzc2l2aQogIGNvbnN0IHByb2cgPSBidWlsZFByb2dyZXNzaXZlUGFydGlhbHMoR0FNRSk7CiAgaWYocHJvZyl7CiAgICBjb25zdCBkMj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGQyLmNsYXNzTmFtZT0nbWV0YS1saW5lIHByb2dyZXNzaXZpJzsKICAgIGQyLmlubmVySFRNTCA9IGA8c3Ryb25nPlByb2dyZXNzaXZpOjwvc3Ryb25nPjxzcGFuPiR7cHJvZ308L3NwYW4+YDsKICAgIG1ldGFCb3guYXBwZW5kQ2hpbGQoZDIpOwogIH0KCiAgLy8gVGFicwogIGNvbnN0IHRhYnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2lkZVRhYnMnKTsKICB0YWJzLmlubmVySFRNTCA9ICcnOwogIFtbJ0EnLGFOYW1lXSxbJ0InLGJOYW1lXV0uZm9yRWFjaCgoW3MsbGFiXSk9PnsKICAgIGNvbnN0IGI9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgICBiLmNsYXNzTmFtZSA9ICd0YWInICsgKFNJREU9PT1zPycgYWN0aXZlJzonJyk7CiAgICBiLnRleHRDb250ZW50ID0gbGFiOwogICAgYi5vbmNsaWNrID0gKCk9PnsgU0lERT1zOyByZW5kZXIoKTsgfTsKICAgIHRhYnMuYXBwZW5kQ2hpbGQoYik7CiAgfSk7CgogIC8vIFRhYmxlIHRpdGxlCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3RhYmxlVGl0bGUnKS50ZXh0Q29udGVudCA9IGBTdGF0aXN0aWNoZSDigJMgJHtTSURFPT09J0EnP2FOYW1lOmJOYW1lfWA7CgogIGNvbnN0IGFyciA9IFNJREU9PT0nQScgPyAoR0FNRT8uc3RhdGU/LnBsYXllcnNBfHxbXSkgOiAoR0FNRT8uc3RhdGU/LnBsYXllcnNCfHxbXSk7CiAgY29uc3QgdGVhbVRvdCA9IHRlYW1Ub3RhbHMoYXJyKTsKCiAgY29uc3Qgc29ydGVkID0gWy4uLmFycl0uc29ydCgoYSxiKT0+ewogICAgY29uc3QgdmEgPSBnZXRTdGF0VmFsdWUoYSwgc29ydC5rZXksIHRlYW1Ub3QpOwogICAgY29uc3QgdmIgPSBnZXRTdGF0VmFsdWUoYiwgc29ydC5rZXksIHRlYW1Ub3QpOwogICAgaWYodHlwZW9mIHZhID09PSAnc3RyaW5nJyB8fCB0eXBlb2YgdmIgPT09ICdzdHJpbmcnKSByZXR1cm4gU3RyaW5nKHZhKS5sb2NhbGVDb21wYXJlKFN0cmluZyh2YikpICogc29ydC5kaXI7CiAgICByZXR1cm4gKHZhIC0gdmIpICogc29ydC5kaXI7CiAgfSk7CgogIC8vIEhlYWQKICBjb25zdCB0aGVhZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzdGF0c1RhYmxlIHRoZWFkJyk7CiAgY29uc3QgdHJoID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsKICBDT0xTLmZvckVhY2goYz0+ewogICAgY29uc3QgdGg9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGgnKTsKICAgIHRoLnRleHRDb250ZW50PWMudDsKICAgIHRoLmNsYXNzTmFtZSA9IChjLmNsc3x8JycpICsgJyBzb3J0YWJsZSc7CiAgICB0aC5vbmNsaWNrID0gKCk9PnsKICAgICAgaWYoc29ydC5rZXkgPT09IGMuaykgc29ydC5kaXIgKj0gLTE7CiAgICAgIGVsc2UgeyBzb3J0LmtleSA9IGMuazsgc29ydC5kaXIgPSAxOyB9CiAgICAgIHJlbmRlcigpOwogIHRyeXsgYnVpbGRTbmFwQmFyKGdhbWVJZCwgc25hcCk7IH1jYXRjaChlKXt9CiAgICB9OwogICAgdGgudGl0bGUgPSAnT3JkaW5hJzsKICAgIHRyaC5hcHBlbmRDaGlsZCh0aCk7CiAgfSk7CiAgdGhlYWQuaW5uZXJIVE1MPScnOwogIHRoZWFkLmFwcGVuZENoaWxkKHRyaCk7CgogIC8vIEJvZHkKICBjb25zdCB0Ym9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzdGF0c1RhYmxlIHRib2R5Jyk7CiAgdGJvZHkuaW5uZXJIVE1MPScnOwogIHNvcnRlZC5mb3JFYWNoKHA9PnsKICAgIGNvbnN0IHRyPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7CiAgICBjb25zdCBtMj0ocFsnMnB0J10/Lm1hZGV8fDApLCBhMj0ocFsnMnB0J10/LmF0dHx8MCk7CiAgICBjb25zdCBtMz0ocFsnM3B0J10/Lm1hZGV8fDApLCBhMz0ocFsnM3B0J10/LmF0dHx8MCk7CiAgICBjb25zdCBtdD0ocC50bD8ubWFkZXx8MCksICBhdD0ocC50bD8uYXR0fHwwKTsKCiAgICBjb25zdCBjZWxscyA9IHsKICAgICAgbnVtOiBwLm51bSA/PyAnJywKICAgICAgbmFtZTogcC5uYW1lID8/ICcnLAogICAgICBwdHM6IHAucHRzfHwwLAogICAgICBmZjogcC5mZnx8MCwKICAgICAgbWluOiBmb3JtYXRUaW1lKHAubWlufHwwKSwKICAgICAgcG1yOiBzdGF0c1BNKHApLAogICAgICB0MjogYCR7bTJ9LyR7YTJ9YCwKICAgICAgdDJwOiBwY3QobTIsYTIpLAogICAgICB0MzogYCR7bTN9LyR7YTN9YCwKICAgICAgdDNwOiBwY3QobTMsYTMpLAogICAgICB0bDogYCR7bXR9LyR7YXR9YCwKICAgICAgdGxwOiBwY3QobXQsYXQpLAogICAgICBmczogcC5mc3x8MCwKICAgICAgcmE6IHAucmF8fDAsCiAgICAgIHJkOiBwLnJkfHwwLAogICAgICBhOiBwLmF8fDAsCiAgICAgIHBwOiBwLnBwfHwwLAogICAgICBwcjogcC5wcnx8MCwKICAgICAgc3RmOiBwLnN0Znx8MCwKICAgICAgc3RzOiBwLnN0c3x8MCwKICAgICAgcGlyOiBjYWxjUElSKHApLAogICAgICBvZXI6IGZtdE9FUihjYWxjT0VSKHApKSwKICAgICAgcG06IGZtdFBNKHAucG18fDApCiAgICB9OwoKICAgIENPTFMuZm9yRWFjaChjPT57CiAgICAgIGNvbnN0IHRkPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICAgIGlmKGMuaz09PSduYW1lJykgdGQuY2xhc3NOYW1lPSduYW1lJzsKICAgICAgdGQudGV4dENvbnRlbnQgPSBTdHJpbmcoY2VsbHNbYy5rXSA/PyAnJyk7CiAgICAgIHRyLmFwcGVuZENoaWxkKHRkKTsKICAgIH0pOwogICAgdGJvZHkuYXBwZW5kQ2hpbGQodHIpOwogIH0pOwoKICAvLyBGb290IChUT1QpCiAgY29uc3QgdGZvb3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc3RhdHNUYWJsZSB0Zm9vdCcpOwogIHRmb290LmlubmVySFRNTD0nJzsKICBjb25zdCB0cnQ9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsKCiAgY29uc3QgdG90UGlyID0gKGFycnx8W10pLnJlZHVjZSgocyxwKT0+IHMgKyBjYWxjUElSKHApLCAwKTsKICBjb25zdCB0b3RDZWxscyA9IHsKICAgIG51bTonJywKICAgIG5hbWU6J1RPVCcsCiAgICBwdHM6IHRlYW1Ub3QucHRzLAogICAgZmY6IHRlYW1Ub3QuZmYsCiAgICBtaW46IGZvcm1hdFRpbWUodGVhbVRvdC5taW4pLAogICAgcG1yOiBzdGF0c1BNKHRlYW1Ub3QpLAogICAgdDI6IGAke3RlYW1Ub3RbJzJwdCddLm1hZGV9LyR7dGVhbVRvdFsnMnB0J10uYXR0fWAsCiAgICB0MnA6IHBjdCh0ZWFtVG90WycycHQnXS5tYWRlLCB0ZWFtVG90WycycHQnXS5hdHQpLAogICAgdDM6IGAke3RlYW1Ub3RbJzNwdCddLm1hZGV9LyR7dGVhbVRvdFsnM3B0J10uYXR0fWAsCiAgICB0M3A6IHBjdCh0ZWFtVG90WyczcHQnXS5tYWRlLCB0ZWFtVG90WyczcHQnXS5hdHQpLAogICAgdGw6IGAke3RlYW1Ub3QudGwubWFkZX0vJHt0ZWFtVG90LnRsLmF0dH1gLAogICAgdGxwOiBwY3QodGVhbVRvdC50bC5tYWRlLCB0ZWFtVG90LnRsLmF0dCksCiAgICBmczogdGVhbVRvdC5mcywKICAgIHJhOiB0ZWFtVG90LnJhLAogICAgcmQ6IHRlYW1Ub3QucmQsCiAgICBhOiB0ZWFtVG90LmEsCiAgICBwcDogdGVhbVRvdC5wcCwKICAgIHByOiB0ZWFtVG90LnByLAogICAgc3RmOiB0ZWFtVG90LnN0ZiwKICAgIHN0czogdGVhbVRvdC5zdHMsCiAgICBwaXI6IHRvdFBpciwKICAgIG9lcjogZm10T0VSKGNhbGNPRVIodGVhbVRvdCkpLAogICAgcG06IGZtdFBNKHRlYW1Ub3QucG18fDApCiAgfTsKCiAgQ09MUy5mb3JFYWNoKGM9PnsKICAgIGNvbnN0IHRkPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7CiAgICBpZihjLms9PT0nbmFtZScpIHRkLmNsYXNzTmFtZT0nbmFtZSc7CiAgICB0ZC50ZXh0Q29udGVudCA9IFN0cmluZyh0b3RDZWxsc1tjLmtdID8/ICcnKTsKICAgIHRydC5hcHBlbmRDaGlsZCh0ZCk7CiAgfSk7CiAgdGZvb3QuYXBwZW5kQ2hpbGQodHJ0KTsKfQoKLyogPT09PT0gRmlsZSBsb2FkaW5nIChtdWx0aSkgPT09PT0gKi8KY29uc3QgRklMRVNfQllfR0FNRSA9IG5ldyBNYXAoKTsgLy8gZ2FtZUlkIC0+IHsgdGl0bGUsIHNuYXBzOiBNYXAoc25hcHNob3QgLT4gR0FNRU9CSiksIG5hbWVzOiBTZXQoKSB9CmNvbnN0IFNOQVBfT1JERVIgPSAoc25hcCk9PnsKICBjb25zdCBzID0gU3RyaW5nKHNuYXB8fCcnKS50b1VwcGVyQ2FzZSgpLnRyaW0oKTsKICBpZihzID09PSAnRklOQUwnIHx8IHMgPT09ICdGSU5FJyB8fCBzID09PSAnRlVMTCcpIHJldHVybiA5OTk5OwogIGNvbnN0IHEgPSBzLm1hdGNoKC9eUShcZCspJC8pOwogIGlmKHEpIHJldHVybiBwYXJzZUludChxWzFdLDEwKTsKICBjb25zdCBvdCA9IHMubWF0Y2goL15PVChcZCspJC8pOwogIGlmKG90KSByZXR1cm4gMTAwICsgcGFyc2VJbnQob3RbMV0sMTApOwogIHJldHVybiA1MDAwOwp9OwoKZnVuY3Rpb24gZ2V0Q3VycmVudEdhbWVJZCgpewogIGNvbnN0IGdhbWVJZHMgPSBBcnJheS5mcm9tKEZJTEVTX0JZX0dBTUUua2V5cygpKTsKICBpZihnYW1lSWRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuIG51bGw7CiAgaWYoZ2FtZUlkcy5sZW5ndGggPT09IDEpIHJldHVybiBnYW1lSWRzWzBdOwogIC8vIHNlIGNpIHNvbm8gcGnDuSBwYXJ0aXRlIHVzaWFtbyBsYSB0ZW5kaW5hIHNlIGVzaXN0ZSwgYWx0cmltZW50aSBsYSBwcmltYQogIGNvbnN0IHNlbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWxHYW1lJyk7CiAgcmV0dXJuIHNlbCAmJiBzZWwudmFsdWUgPyBzZWwudmFsdWUgOiBnYW1lSWRzWzBdOwp9CgpmdW5jdGlvbiBjb21wdXRlUGVyaW9kT25seShnYW1lT2JqKXsKICBpZighZ2FtZU9iaiB8fCAhZ2FtZU9iai5zdGF0ZSB8fCAhZ2FtZU9iai5zdGF0ZS5wbGF5ZXJzQSkgcmV0dXJuIGdhbWVPYmo7CiAgaWYoIWdhbWVPYmoubWV0YSB8fCAhZ2FtZU9iai5tZXRhLnNuYXBzaG90KSByZXR1cm4gZ2FtZU9iajsKICBjb25zdCBzbmFwID0gZ2FtZU9iai5tZXRhLnNuYXBzaG90OwogIGlmKHNuYXAgPT09ICdGSU5BTCcgfHwgc25hcCA9PT0gJ1ExJykgcmV0dXJuIGdhbWVPYmo7CgogIC8vIHRyb3ZhIHNuYXBzaG90IHByZWNlZGVudGUKICBjb25zdCBnYW1lSWQgPSBnYW1lT2JqLm1ldGEuZ2FtZUlkOwogIGNvbnN0IGVudHJ5ID0gRklMRVNfQllfR0FNRS5nZXQoZ2FtZUlkKTsKICBpZighZW50cnkpIHJldHVybiBnYW1lT2JqOwoKICBjb25zdCBzbmFwcyA9IEFycmF5LmZyb20oZW50cnkuc25hcHMua2V5cygpKS5zb3J0KChhLGIpPT5TTkFQX09SREVSKGEpLVNOQVBfT1JERVIoYikpOwogIGNvbnN0IGlkeCA9IHNuYXBzLmluZGV4T2Yoc25hcCk7CiAgaWYoaWR4IDw9IDApIHJldHVybiBnYW1lT2JqOwoKICBjb25zdCBwcmV2ID0gZW50cnkuc25hcHMuZ2V0KHNuYXBzW2lkeC0xXSk7CiAgaWYoIXByZXYpIHJldHVybiBnYW1lT2JqOwoKICAvLyBjbG9uYSBzdGF0byBlIHNvdHRyYWUgY3VtdWxhdG8gcHJlY2VkZW50ZQogIGNvbnN0IGNsb25lID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShnYW1lT2JqKSk7CiAgWydwbGF5ZXJzQScsJ3BsYXllcnNCJ10uZm9yRWFjaCh0ZWFtPT57CiAgICBjbG9uZS5zdGF0ZVt0ZWFtXS5mb3JFYWNoKChwLGkpPT57CiAgICAgIGNvbnN0IHBwID0gcHJldi5zdGF0ZVt0ZWFtXVtpXTsKICAgICAgaWYoIXBwKSByZXR1cm47CiAgICAgIE9iamVjdC5rZXlzKHApLmZvckVhY2goaz0+ewogICAgICAgIGlmKHR5cGVvZiBwW2tdPT09J251bWJlcicgJiYgdHlwZW9mIHBwW2tdPT09J251bWJlcicpewogICAgICAgICAgcFtrXSA9IHBba10gLSBwcFtrXTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSk7CiAgfSk7CiAgcmV0dXJuIGNsb25lOwp9CgoKCmZ1bmN0aW9uIGZvcm1hdFNjb3JlTGluZUZyb21HYW1lT2JqKGdhbWVPYmopewogIGlmKCFnYW1lT2JqKSByZXR1cm4gJyc7CiAgY29uc3QgbWV0YSA9IGdhbWVPYmoubWV0YSB8fCB7fTsKICBjb25zdCBhTmFtZSA9IG1ldGEuYU5hbWUgfHwgbWV0YS50ZWFtQSB8fCAnU3F1YWRyYSBBJzsKICBjb25zdCBiTmFtZSA9IG1ldGEuYk5hbWUgfHwgbWV0YS50ZWFtQiB8fCAnU3F1YWRyYSBCJzsKICByZXR1cm4gYCR7U3RyaW5nKGFOYW1lKS50b1VwcGVyQ2FzZSgpfSBWUyAke1N0cmluZyhiTmFtZSkudG9VcHBlckNhc2UoKX1gOwp9CgpmdW5jdGlvbiBnZXRGaW5hbFNuYXBzaG90Rm9yR2FtZShnYW1lSWQpewogIGNvbnN0IGVudHJ5ID0gRklMRVNfQllfR0FNRS5nZXQoZ2FtZUlkKTsKICBpZighZW50cnkpIHJldHVybiBudWxsOwogIGlmKGVudHJ5LnNuYXBzLmhhcygnRklOQUwnKSkgcmV0dXJuIGVudHJ5LnNuYXBzLmdldCgnRklOQUwnKTsKICAvLyBmYWxsYmFjazogaGlnaGVzdCBvcmRlcmVkIHNuYXBzaG90CiAgY29uc3Qgc25hcHMgPSBBcnJheS5mcm9tKGVudHJ5LnNuYXBzLmtleXMoKSkuc29ydCgoYSxiKT0+U05BUF9PUkRFUihhKS1TTkFQX09SREVSKGIpKTsKICByZXR1cm4gZW50cnkuc25hcHMuZ2V0KHNuYXBzW3NuYXBzLmxlbmd0aC0xXSk7Cn0KCgpmdW5jdGlvbiBidWlsZFNuYXBCYXIoZ2FtZUlkLCBhY3RpdmVTbmFwKXsKICBjb25zdCBiYXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc25hcEJhcicpOwogIGNvbnN0IGJveCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzbmFwQnV0dG9ucycpOwogIGNvbnN0IGluZm8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc25hcEluZm8nKTsKICBpZighYmFyIHx8ICFib3gpIHJldHVybjsKCiAgY29uc3QgZW50cnkgPSBGSUxFU19CWV9HQU1FLmdldChnYW1lSWQpOwogIGlmKCFlbnRyeSl7CiAgICBiYXIuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIHJldHVybjsKICB9CiAgYmFyLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOwoKICBjb25zdCBzbmFwcyA9IEFycmF5LmZyb20oZW50cnkuc25hcHMua2V5cygpKS5zb3J0KChhLGIpPT5TTkFQX09SREVSKGEpLVNOQVBfT1JERVIoYikpOwogIGlmKHNuYXBzLmxlbmd0aCA8PSAxKXsKICAgIC8vIE1vc3RyaWFtbyBjb211bnF1ZSBsYSBiYXJyYSAoY29zw6wgY2FwaXNjaSBjb3NhIHN0YWkgdmVkZW5kbyksIG1hIGNvbiB1biBzb2xvIHB1bHNhbnRlCiAgICBiYXIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgfSBlbHNlIHsKICAgIGJhci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICB9CgogIGJveC5pbm5lckhUTUwgPSAnJzsKICBzbmFwcy5mb3JFYWNoKHM9PnsKICAgIGNvbnN0IGIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgIGIuY2xhc3NOYW1lID0gJ3NuYXBidG4nICsgKFN0cmluZyhhY3RpdmVTbmFwfHwnJyk9PT1TdHJpbmcocykgPyAnIGFjdGl2ZScgOiAnJyk7CiAgICBiLnRleHRDb250ZW50ID0gczsKICAgIGIub25jbGljayA9ICgpPT57CiAgICAgIGNvbnN0IHNlbFNuYXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VsU25hcCcpOwogICAgICBpZihzZWxTbmFwKXsKICAgICAgICBzZWxTbmFwLnZhbHVlID0gczsKICAgICAgfQogICAgICBhcHBseVNlbGVjdGlvbigpOwogICAgfTsKICAgIGJveC5hcHBlbmRDaGlsZChiKTsKICB9KTsKCiAgY29uc3Qgc2hvd25OYW1lID0gKEdBTUUgJiYgR0FNRS5tZXRhICYmIEdBTUUubWV0YS5uYW1lKSA/IEdBTUUubWV0YS5uYW1lIDogJyc7CiAgaW5mby50ZXh0Q29udGVudCA9IHNob3duTmFtZSA/ICgnRmlsZTogJyArIHNob3duTmFtZSkgOiAnJzsKfQoKCgpmdW5jdGlvbiBpbmZlckZyb21GaWxlbmFtZShmaWxlbmFtZSl7CiAgY29uc3QgYmFzZSA9IGZpbGVuYW1lLnJlcGxhY2UoL1wuanNvbiQvaSwnJykudHJpbSgpOwoKICAvLyBQcmVmZXI6IDxnYW1lSWQ+X188c25hcHNob3Q+CiAgaWYoYmFzZS5pbmNsdWRlcygnX18nKSl7CiAgICBjb25zdCBwYXJ0cyA9IGJhc2Uuc3BsaXQoJ19fJyk7CiAgICBjb25zdCBzbmFwID0gKHBhcnRzLnBvcCgpfHwnJykudHJpbSgpOwogICAgY29uc3QgZ2lkID0gcGFydHMuam9pbignX18nKS50cmltKCk7CiAgICByZXR1cm4geyBnYW1lSWQ6IGdpZCB8fCBiYXNlLCBzbmFwc2hvdDogc25hcCB8fCAnRklOQUwnLCB0aXRsZTogbnVsbCB9OwogIH0KCiAgLy8gRmFsbGJhY2s6IHRyeSB0byBkZXRlY3Qgc25hcHNob3QgdG9rZW4gYXQgZW5kIChRMSwgT1QxLCBGSU5BTCkKICBjb25zdCBtID0gYmFzZS5tYXRjaCgvKC4qPylbIF8tXSsoUVxkK3xPVFxkK3xGSU5BTHxGSU5FfEZVTEwpXHMqJC9pKTsKICBpZihtKXsKICAgIHJldHVybiB7IGdhbWVJZDogbVsxXS50cmltKCkgfHwgYmFzZSwgc25hcHNob3Q6IG1bMl0udG9VcHBlckNhc2UoKSwgdGl0bGU6IG51bGwgfTsKICB9CgogIHJldHVybiB7IGdhbWVJZDogYmFzZSwgc25hcHNob3Q6ICdGSU5BTCcsIHRpdGxlOiBudWxsIH07Cn0KCmZ1bmN0aW9uIG5vcm1hbGl6ZUxvYWRlZEpzb24ob2JqLCBmaWxlbmFtZSl7CiAgLy8gU3VwcG9ydDogcGF5bG9hZCBjb24ge19fdHlwZSwgbWV0YSwgc3RhdGV9IG9wcHVyZSBzb2xvIHN0YXRlCiAgaWYob2JqICYmIG9iai5zdGF0ZSAmJiAob2JqLl9fdHlwZSA9PT0gJ2Jhc2tldF9zdGF0c19nYW1lJyB8fCBvYmouX190eXBlID09PSAnYmFza2V0X3N0YXRzX3NuYXBzaG90JykpewogICAgaWYoIW9iai5tZXRhKSBvYmoubWV0YSA9IHt9OwogICAgaWYoIW9iai5tZXRhLm5hbWUpIG9iai5tZXRhLm5hbWUgPSBmaWxlbmFtZTsKICAgIC8vIGxlZ2FjeSBzbmFwc2hvdCBzdXBwb3J0OiBzZSBtYW5jYSBtZXRhLnNuYXBzaG90IG1hIGMnw6ggbWV0YS5wZXJpb2QKICAgIGlmKCFvYmoubWV0YS5zbmFwc2hvdCAmJiBvYmoubWV0YS5wZXJpb2QpIG9iai5tZXRhLnNuYXBzaG90ID0gb2JqLm1ldGEucGVyaW9kOwogICAgLy8gbGVnYWN5IGdhbWUgc3VwcG9ydDogc2UgbWFuY2EgbWV0YS5nYW1lSWQgbWEgYyfDqCBtZXRhLmlkCiAgICBpZighb2JqLm1ldGEuZ2FtZUlkICYmIG9iai5tZXRhLmlkKSBvYmoubWV0YS5nYW1lSWQgPSBvYmoubWV0YS5pZDsKICAgIHJldHVybiBvYmo7CiAgfSBlbHNlIGlmKG9iaiAmJiBvYmoucGxheWVyc0EgJiYgb2JqLnBsYXllcnNCKXsKICAgIHJldHVybiB7IF9fdHlwZTonYmFza2V0X3N0YXRzX3NuYXBzaG90JywgbWV0YTp7bmFtZTpmaWxlbmFtZX0sIHN0YXRlOiBvYmogfTsKICB9IGVsc2UgaWYob2JqICYmIG9iai5zdGF0ZSAmJiBvYmouc3RhdGUucGxheWVyc0EgJiYgb2JqLnN0YXRlLnBsYXllcnNCKXsKICAgIHJldHVybiB7IF9fdHlwZTonYmFza2V0X3N0YXRzX2dhbWUnLCBtZXRhOntuYW1lOmZpbGVuYW1lfSwgc3RhdGU6IG9iai5zdGF0ZSB9OwogIH0KICByZXR1cm4gbnVsbDsKfQoKZnVuY3Rpb24gYWRkVG9JbmRleChnYW1lT2JqLCBmaWxlbmFtZSl7CiAgY29uc3QgbWV0YSA9IGdhbWVPYmoubWV0YSB8fCB7fTsKICBjb25zdCBpbmZlcnJlZCA9IGluZmVyRnJvbUZpbGVuYW1lKGZpbGVuYW1lKTsKCiAgY29uc3QgZ2FtZUlkID0gU3RyaW5nKG1ldGEuZ2FtZUlkIHx8IG1ldGEuaWQgfHwgaW5mZXJyZWQuZ2FtZUlkIHx8IG1ldGEubmFtZSB8fCBmaWxlbmFtZSkudHJpbSgpOwogIGNvbnN0IHNuYXBzaG90ID0gU3RyaW5nKG1ldGEuc25hcHNob3QgfHwgbWV0YS5wZXJpb2QgfHwgaW5mZXJyZWQuc25hcHNob3QgfHwgJ0ZJTkFMJykudG9VcHBlckNhc2UoKS50cmltKCk7CiAgY29uc3QgdGl0bGUgPSBtZXRhLnRpdGxlIHx8IGluZmVycmVkLnRpdGxlIHx8IG1ldGEubWF0Y2ggfHwgbnVsbDsKCiAgaWYoIUZJTEVTX0JZX0dBTUUuaGFzKGdhbWVJZCkpewogICAgRklMRVNfQllfR0FNRS5zZXQoZ2FtZUlkLCB7IHRpdGxlOiB0aXRsZSB8fCBnYW1lSWQsIHNuYXBzOiBuZXcgTWFwKCksIG5hbWVzOiBuZXcgU2V0KCkgfSk7CiAgfQogIGNvbnN0IGVudHJ5ID0gRklMRVNfQllfR0FNRS5nZXQoZ2FtZUlkKTsKICBpZih0aXRsZSkgZW50cnkudGl0bGUgPSB0aXRsZTsKICBlbnRyeS5uYW1lcy5hZGQoZmlsZW5hbWUpOwoKICAvLyBsYXN0LXdyaXRlLXdpbnMgcGVyIHNuYXBzaG90CiAgZW50cnkuc25hcHMuc2V0KHNuYXBzaG90LCBnYW1lT2JqKTsKfQoKZnVuY3Rpb24gcmVmcmVzaFNlbGVjdG9ycygpewogIGNvbnN0IG1jID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ211bHRpQ29udHJvbHMnKTsKICBjb25zdCBzZWxHYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbEdhbWUnKTsKICBjb25zdCBzZWxTbmFwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbFNuYXAnKTsKCiAgY29uc3QgZ2FtZUlkcyA9IEFycmF5LmZyb20oRklMRVNfQllfR0FNRS5rZXlzKCkpOwogIGlmKGdhbWVJZHMubGVuZ3RoIDw9IDEpewogICAgbWMuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgIHJldHVybjsKICB9CiAgbWMuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKCiAgc2VsR2FtZS5pbm5lckhUTUwgPSAnJzsKICBnYW1lSWRzLmZvckVhY2goZ2lkPT57CiAgICBjb25zdCBvcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTsKICAgIG9wdC52YWx1ZSA9IGdpZDsKICAgIG9wdC50ZXh0Q29udGVudCA9IEZJTEVTX0JZX0dBTUUuZ2V0KGdpZCkudGl0bGUgfHwgZ2lkOwogICAgc2VsR2FtZS5hcHBlbmRDaGlsZChvcHQpOwogIH0pOwoKICBjb25zdCBjdXJyZW50ID0gc2VsR2FtZS52YWx1ZSB8fCBnYW1lSWRzWzBdOwogIHNlbEdhbWUudmFsdWUgPSBjdXJyZW50OwogIHBvcHVsYXRlU25hcHNob3RzKGN1cnJlbnQpOwp9CgpmdW5jdGlvbiBwb3B1bGF0ZVNuYXBzaG90cyhnYW1lSWQpewogIGNvbnN0IHNlbFNuYXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VsU25hcCcpOwogIGNvbnN0IGVudHJ5ID0gRklMRVNfQllfR0FNRS5nZXQoZ2FtZUlkKTsKICBpZighZW50cnkpIHJldHVybjsKCiAgY29uc3Qgc25hcHMgPSBBcnJheS5mcm9tKGVudHJ5LnNuYXBzLmtleXMoKSkuc29ydCgoYSxiKT0+U05BUF9PUkRFUihhKS1TTkFQX09SREVSKGIpKTsKCiAgc2VsU25hcC5pbm5lckhUTUwgPSAnJzsKICBzbmFwcy5mb3JFYWNoKHM9PnsKICAgIGNvbnN0IG9wdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpOwogICAgb3B0LnZhbHVlID0gczsKICAgIG9wdC50ZXh0Q29udGVudCA9IHM7CiAgICBzZWxTbmFwLmFwcGVuZENoaWxkKG9wdCk7CiAgfSk7CgogIGNvbnN0IGRlZiA9IHNuYXBzLmluY2x1ZGVzKCdGSU5BTCcpID8gJ0ZJTkFMJyA6IHNuYXBzW3NuYXBzLmxlbmd0aC0xXTsKICBzZWxTbmFwLnZhbHVlID0gZGVmOwp9CgpmdW5jdGlvbiBhcHBseVNlbGVjdGlvbigpewogIGNvbnN0IGdhbWVJZHMgPSBBcnJheS5mcm9tKEZJTEVTX0JZX0dBTUUua2V5cygpKTsKICBpZihnYW1lSWRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuOwoKICBjb25zdCBzZWxHYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbEdhbWUnKTsKICBjb25zdCBzZWxTbmFwID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbFNuYXAnKTsKCiAgY29uc3QgZ2FtZUlkID0gKGdhbWVJZHMubGVuZ3RoID09PSAxKSA/IGdhbWVJZHNbMF0gOiBzZWxHYW1lLnZhbHVlOwogIGNvbnN0IGVudHJ5ID0gRklMRVNfQllfR0FNRS5nZXQoZ2FtZUlkKTsKICBpZighZW50cnkpIHJldHVybjsKCiAgbGV0IHNuYXAgPSAoc2VsU25hcCAmJiBzZWxTbmFwLnZhbHVlKSA/IHNlbFNuYXAudmFsdWUgOiBudWxsOwogIGlmKCFzbmFwKXsKICAgIGNvbnN0IHNuYXBzID0gQXJyYXkuZnJvbShlbnRyeS5zbmFwcy5rZXlzKCkpLnNvcnQoKGEsYik9PlNOQVBfT1JERVIoYSktU05BUF9PUkRFUihiKSk7CiAgICBzbmFwID0gc25hcHMuaW5jbHVkZXMoJ0ZJTkFMJykgPyAnRklOQUwnIDogc25hcHNbc25hcHMubGVuZ3RoLTFdOwogIH0KCiAgbGV0IG9iaiA9IGVudHJ5LnNuYXBzLmdldChzbmFwKSB8fCBlbnRyeS5zbmFwcy52YWx1ZXMoKS5uZXh0KCkudmFsdWU7CiAgY29uc3QgcmF3T2JqID0gb2JqOwogIGNvbnN0IHRvZ2dsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0b2dnbGVQYXJ0aWFsJyk7CiAgaWYodG9nZ2xlICYmIHRvZ2dsZS5jaGVja2VkKXsgb2JqID0gY29tcHV0ZVBlcmlvZE9ubHkob2JqKTsgfQoKICBHQU1FID0gb2JqOwogIFNJREUgPSAnQSc7CiAgc29ydCA9IHsga2V5OidudW0nLCBkaXI6MSB9OwogIHJlbmRlcigpOwogIGRvY3VtZW50LmJvZHkuY2xhc3NMaXN0LnJlbW92ZSgnZmFkZScpOwogIHZvaWQgZG9jdW1lbnQuYm9keS5vZmZzZXRXaWR0aDsKICBkb2N1bWVudC5ib2R5LmNsYXNzTGlzdC5hZGQoJ2ZhZGUnKTsKICBjb25zdCBiYWRnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwZXJpb2RCYWRnZScpOwogIGlmKGJhZGdlKSBiYWRnZS50ZXh0Q29udGVudCA9IHNuYXA7CiAgY29uc3Qgc2wgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2NvcmVMaW5lSGVhZGVyJyk7CiAgaWYoc2wpewogICAgY29uc3QgZmluYWxPYmogPSBnZXRGaW5hbFNuYXBzaG90Rm9yR2FtZShnYW1lSWQpOwogICAgc2wudGV4dENvbnRlbnQgPSBmb3JtYXRTY29yZUxpbmVGcm9tR2FtZU9iaihmaW5hbE9iaik7CiAgfQogIHRyeXsgYnVpbGRTbmFwQmFyKGdhbWVJZCwgc25hcCk7IH1jYXRjaChlKXt9CmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidG5DbGVhcicpLmRpc2FibGVkID0gZmFsc2U7Cn0KCmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWxHYW1lJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIChlKT0+ewogIGNvbnN0IGdpZCA9IGUudGFyZ2V0LnZhbHVlOwogIHBvcHVsYXRlU25hcHNob3RzKGdpZCk7CiAgYXBwbHlTZWxlY3Rpb24oKTsKfSk7CmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWxTbmFwJyk/LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpPT57CiAgYXBwbHlTZWxlY3Rpb24oKTsKfSk7Cgpkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZUlucHV0JykuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgYXN5bmMgKGUpPT57CiAgY29uc3QgZmlsZXMgPSBBcnJheS5mcm9tKGUudGFyZ2V0LmZpbGVzIHx8IFtdKTsKICBpZighZmlsZXMubGVuZ3RoKSByZXR1cm47CgogIEZJTEVTX0JZX0dBTUUuY2xlYXIoKTsKCiAgdHJ5ewogICAgZm9yKGNvbnN0IGYgb2YgZmlsZXMpewogICAgICBjb25zdCB0eHQgPSBhd2FpdCBmLnRleHQoKTsKICAgICAgY29uc3Qgb2JqUmF3ID0gSlNPTi5wYXJzZSh0eHQpOwoKICAgICAgLy8gRmlsZSB1bmljbyBtYXRjaDogZXNwYW5kZSBpbiBRMS9RMi8uLi4vRklOQUwKICAgICAgaWYob2JqUmF3ICYmIG9ialJhdy5fX3R5cGUgPT09ICdiYXNrZXRfc3RhdHNfbWF0Y2gnICYmIG9ialJhdy5zbmFwc2hvdHMpewogICAgICAgIGNvbnN0IGdpZCA9IFN0cmluZyhvYmpSYXc/Lm1ldGE/LmdhbWVJZCB8fCBpbmZlckZyb21GaWxlbmFtZShmLm5hbWUpLmdhbWVJZCB8fCAnJykudHJpbSgpIHx8IGYubmFtZTsKICAgICAgICBjb25zdCBzbmFwcyA9IG9ialJhdy5zbmFwc2hvdHMgfHwge307CiAgICAgICAgZm9yKGNvbnN0IGsgb2YgT2JqZWN0LmtleXMoc25hcHMpKXsKICAgICAgICAgIGNvbnN0IHNuYXBPYmpSYXcgPSBzbmFwc1trXTsKICAgICAgICAgIGNvbnN0IHNuYXBPYmogPSBub3JtYWxpemVMb2FkZWRKc29uKHNuYXBPYmpSYXcsIGAke2YubmFtZX06OiR7a31gKTsKICAgICAgICAgIGlmKCFzbmFwT2JqKSBjb250aW51ZTsKICAgICAgICAgIGlmKCFzbmFwT2JqLm1ldGEpIHNuYXBPYmoubWV0YSA9IHt9OwogICAgICAgICAgc25hcE9iai5tZXRhLmdhbWVJZCA9IHNuYXBPYmoubWV0YS5nYW1lSWQgfHwgZ2lkOwogICAgICAgICAgc25hcE9iai5tZXRhLnNuYXBzaG90ID0gc25hcE9iai5tZXRhLnNuYXBzaG90IHx8IHNuYXBPYmoubWV0YS5wZXJpb2QgfHwgU3RyaW5nKGspLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgICBhZGRUb0luZGV4KHNuYXBPYmosIGAke2YubmFtZX06OiR7a31gKTsKICAgICAgICB9CiAgICAgICAgY29udGludWU7CiAgICAgIH0KICAgICAgY29uc3QgZ2FtZU9iaiA9IG5vcm1hbGl6ZUxvYWRlZEpzb24ob2JqUmF3LCBmLm5hbWUpOwogICAgICBpZighZ2FtZU9iail7CiAgICAgICAgYWxlcnQoJ0Zvcm1hdG8gbm9uIHJpY29ub3NjaXV0byBpbjogJyArIGYubmFtZSArICdcblVzYSBpIC5qc29uIHNhbHZhdGkgZGFsIGZvZ2xpbyBwYXJ0aXRhICjwn5K+IFNhbHZhKS4nKTsKICAgICAgICBjb250aW51ZTsKICAgICAgfQogICAgICBhZGRUb0luZGV4KGdhbWVPYmosIGYubmFtZSk7CiAgICB9CgogICAgaWYoRklMRVNfQllfR0FNRS5zaXplID09PSAwKSByZXR1cm47CgogICAgcmVmcmVzaFNlbGVjdG9ycygpOwoKICAgIC8vIGZvcnppYW1vIHNlbGVjdGlvbiBjb2VyZW50ZSBhbmNoZSBzZSBpIGNvbnRyb2xsaSBzb25vIG5hc2Nvc3RpCiAgICBpZihGSUxFU19CWV9HQU1FLnNpemUgPT09IDEpewogICAgICBjb25zdCBvbmx5SWQgPSBBcnJheS5mcm9tKEZJTEVTX0JZX0dBTUUua2V5cygpKVswXTsKICAgICAgY29uc3QgZW50cnkgPSBGSUxFU19CWV9HQU1FLmdldChvbmx5SWQpOwogICAgICBjb25zdCBzbmFwcyA9IEFycmF5LmZyb20oZW50cnkuc25hcHMua2V5cygpKS5zb3J0KChhLGIpPT5TTkFQX09SREVSKGEpLVNOQVBfT1JERVIoYikpOwogICAgICBjb25zdCBwaWNrID0gc25hcHMuaW5jbHVkZXMoJ0ZJTkFMJykgPyAnRklOQUwnIDogc25hcHNbc25hcHMubGVuZ3RoLTFdOwoKICAgICAgY29uc3Qgc2VsU25hcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWxTbmFwJyk7CiAgICAgIHNlbFNuYXAuaW5uZXJIVE1MID0gJyc7CiAgICAgIHNuYXBzLmZvckVhY2gocz0+ewogICAgICAgIGNvbnN0IG9wdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpOwogICAgICAgIG9wdC52YWx1ZSA9IHM7IG9wdC50ZXh0Q29udGVudCA9IHM7CiAgICAgICAgc2VsU25hcC5hcHBlbmRDaGlsZChvcHQpOwogICAgICB9KTsKICAgICAgc2VsU25hcC52YWx1ZSA9IHBpY2s7CiAgICAgIGFwcGx5U2VsZWN0aW9uKCk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25zdCBmaXJzdElkID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlbEdhbWUnKS52YWx1ZTsKICAgIHBvcHVsYXRlU25hcHNob3RzKGZpcnN0SWQpOwogICAgYXBwbHlTZWxlY3Rpb24oKTsKCiAgfWNhdGNoKGVycil7CiAgICBjb25zb2xlLmVycm9yKGVycik7CiAgICBhbGVydCgnRXJyb3JlIG5lbCBjYXJpY2FtZW50byBkZWkgZmlsZSBKU09OLicpOwogIH0KfSk7CgoKZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J0bkNsZWFyJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKT0+ewogIEdBTUUgPSBudWxsOwogIHJlbmRlcigpOwp9KTsKCnJlbmRlcigpOwo8L3NjcmlwdD4KCjxzY3JpcHQ+CmZ1bmN0aW9uIGdvSG9tZSgpeyBwYXJlbnQucG9zdE1lc3NhZ2Uoe3R5cGU6J25hdicsdGFyZ2V0Oidob21lJ30sICcqJyk7IH0KPC9zY3JpcHQ+Cgo8IS0tIExpYnJlcmlhIFBhcnRpdGUgKHNhbHZhdGFnZ2lvIGluIGxvY2FsU3RvcmFnZSkgLS0+CjxkaXYgaWQ9ImxpYk92ZXJsYXkiIHN0eWxlPSJkaXNwbGF5Om5vbmU7IHBvc2l0aW9uOmZpeGVkOyBpbnNldDowOyBiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsLjQ1KTsgei1pbmRleDo5OTk5OyBhbGlnbi1pdGVtczpjZW50ZXI7IGp1c3RpZnktY29udGVudDpjZW50ZXI7IHBhZGRpbmc6MTZweDsiPgogIDxkaXYgc3R5bGU9IndpZHRoOm1pbig5ODBweCwgMTAwJSk7IG1heC1oZWlnaHQ6OTB2aDsgYmFja2dyb3VuZDojZmZmOyBib3JkZXItcmFkaXVzOjE0cHg7IGJveC1zaGFkb3c6MCAxMHB4IDQwcHggcmdiYSgwLDAsMCwuMjUpOyBvdmVyZmxvdzpoaWRkZW47IGRpc3BsYXk6ZmxleDsgZmxleC1kaXJlY3Rpb246Y29sdW1uOyI+CiAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7IGFsaWduLWl0ZW1zOmNlbnRlcjsgZ2FwOjEwcHg7IHBhZGRpbmc6MTJweCAxNHB4OyBib3JkZXItYm90dG9tOjFweCBzb2xpZCAjZWVlOyI+CiAgICAgIDxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjkwMDsiPvCfk5ogTGlicmVyaWEgcGFydGl0ZTwvZGl2PgogICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tbGVmdDphdXRvOyBkaXNwbGF5OmZsZXg7IGdhcDo4cHg7IGFsaWduLWl0ZW1zOmNlbnRlcjsiPgogICAgICAgIDxidXR0b24gaWQ9ImJ0blNlYXNvbk5ldyIgY2xhc3M9ImJ0biBibHVlIj7inpUgTnVvdmEgc3RhZ2lvbmU8L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGlkPSJidG5MaWJFeHBvcnQiIGNsYXNzPSJidG4gZ3JheSI+4qyH77iPIEVzcG9ydGE8L2J1dHRvbj4KICAgICAgICA8bGFiZWwgY2xhc3M9ImJ0biBncmF5IiBzdHlsZT0ibWFyZ2luOjA7Ij4KICAgICAgICAgIOKshu+4jyBJbXBvcnRhCiAgICAgICAgICA8aW5wdXQgaWQ9ImJ0bkxpYkltcG9ydCIgdHlwZT0iZmlsZSIgYWNjZXB0PSJhcHBsaWNhdGlvbi9qc29uLC5qc29uIiBzdHlsZT0iZGlzcGxheTpub25lIi8+CiAgICAgICAgPC9sYWJlbD4KICAgICAgICA8YnV0dG9uIGlkPSJidG5MaWJDbG9zZSIgY2xhc3M9ImJ0biBncmF5Ij5DaGl1ZGk8L2J1dHRvbj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmdyaWQ7IGdyaWQtdGVtcGxhdGUtY29sdW1uczogMjYwcHggMWZyOyBnYXA6MDsgbWluLWhlaWdodDozNjBweDsgbWF4LWhlaWdodDpjYWxjKDkwdmggLSA1NHB4KTsiPgogICAgICA8ZGl2IHN0eWxlPSJib3JkZXItcmlnaHQ6MXB4IHNvbGlkICNlZWU7IHBhZGRpbmc6MTJweDsgb3ZlcmZsb3c6YXV0bzsiPgogICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OjgwMDsgbWFyZ2luLWJvdHRvbTo4cHg7Ij5TdGFnaW9uaTwvZGl2PgogICAgICAgIDxkaXYgaWQ9InNlYXNvbkxpc3QiIHN0eWxlPSJkaXNwbGF5OmZsZXg7IGZsZXgtZGlyZWN0aW9uOmNvbHVtbjsgZ2FwOjZweDsiPjwvZGl2PgogICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZToxMnB4OyBvcGFjaXR5Oi43OyBtYXJnaW4tdG9wOjEwcHg7Ij5TdWdnZXJpbWVudG86IGNsaWNjYSBpbCBub21lIHBlciByaW5vbWluYXJlLjwvZGl2PgogICAgICA8L2Rpdj4KCiAgICAgIDxkaXYgc3R5bGU9InBhZGRpbmc6MTJweDsgb3ZlcmZsb3c6YXV0bzsgZGlzcGxheTpmbGV4OyBmbGV4LWRpcmVjdGlvbjpjb2x1bW47IGdhcDoxMHB4OyI+CiAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTpmbGV4OyBhbGlnbi1pdGVtczpjZW50ZXI7IGdhcDoxMHB4OyBmbGV4LXdyYXA6d3JhcDsiPgogICAgICAgICAgPGRpdiBpZD0ic2Vhc29uVGl0bGUiIHN0eWxlPSJmb250LXdlaWdodDo4MDA7Ij5TZWxlemlvbmEgdW5hIHN0YWdpb25lPC9kaXY+CiAgICAgICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tbGVmdDphdXRvOyBkaXNwbGF5OmZsZXg7IGdhcDo4cHg7IGFsaWduLWl0ZW1zOmNlbnRlcjsgZmxleC13cmFwOndyYXA7Ij4KICAgICAgICAgICAgPGxhYmVsIGNsYXNzPSJidG4gYmx1ZSIgaWQ9ImxibFVwbG9hZE1hdGNoIiBzdHlsZT0iZGlzcGxheTpub25lOyI+CiAgICAgICAgICAgICAg4qyG77iPIENhcmljYSBwYXJ0aXRhCiAgICAgICAgICAgICAgPGlucHV0IGlkPSJsaWJGaWxlSW5wdXQiIHR5cGU9ImZpbGUiIG11bHRpcGxlIGFjY2VwdD0iLmpzb24sYXBwbGljYXRpb24vanNvbiIgc3R5bGU9ImRpc3BsYXk6bm9uZSIvPgogICAgICAgICAgICA8L2xhYmVsPgogICAgICAgICAgICA8YnV0dG9uIGlkPSJidG5NYXRjaE9wZW4iIGNsYXNzPSJidG4gZ3JlZW4iIGRpc2FibGVkPvCfk4IgQXByaTwvYnV0dG9uPgogICAgICAgICAgICA8YnV0dG9uIGlkPSJidG5NYXRjaERlbGV0ZSIgY2xhc3M9ImJ0biByZWQiIGRpc2FibGVkPvCfl5HvuI8gQ2FuY2VsbGE8L2J1dHRvbj4KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgoKICAgICAgICA8ZGl2IGlkPSJtYXRjaExpc3QiIHN0eWxlPSJib3JkZXI6MXB4IHNvbGlkICNlZWU7IGJvcmRlci1yYWRpdXM6MTBweDsgb3ZlcmZsb3c6aGlkZGVuOyI+CiAgICAgICAgICA8ZGl2IHN0eWxlPSJwYWRkaW5nOjEwcHg7IGZvbnQtc2l6ZToxM3B4OyBvcGFjaXR5Oi43OyI+TmVzc3VuYSBwYXJ0aXRhIChvIG5lc3N1bmEgc3RhZ2lvbmUgc2VsZXppb25hdGEpLjwvZGl2PgogICAgICAgIDwvZGl2PgoKICAgICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MTJweDsgb3BhY2l0eTouNzU7IGxpbmUtaGVpZ2h0OjEuMzU7Ij4KICAgICAgICAgIExhIGxpYnJlcmlhIHNhbHZhIGkgSlNPTiBuZWwgYnJvd3NlciAobG9jYWxTdG9yYWdlKS4gU2UgY2FtYmkgYnJvd3Nlci9kaXNwb3NpdGl2byBvIGNhbmNlbGxpIGkgZGF0aSBkZWwgc2l0bywgbGEgbGlicmVyaWEgc2kgc3Z1b3RhLgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgogIDwvZGl2Pgo8L2Rpdj4KCgo8c2NyaXB0PgooZnVuY3Rpb24oKXsKICBjb25zdCBTVE9SRV9LRVkgPSAnQlNfTElCUkFSWV9WMSc7CiAgY29uc3QgJCA9IChpZCk9PmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKCiAgCiAgLyogPT09PT0gTW9kYWxlIGlucHV0IChubyB3aW5kb3cucHJvbXB0KSA9PT09PSAqLwogIGZ1bmN0aW9uIGFza1NlYXNvbk5hbWUoZGVmYXVsdFZhbHVlKXsKICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSk9PnsKICAgICAgY29uc3Qgb3YgPSAkKCdzZWFzb25OYW1lT3ZlcmxheScpOwogICAgICBjb25zdCBpbnAgPSAkKCdzZWFzb25OYW1lSW5wdXQnKTsKICAgICAgY29uc3Qgb2sgID0gJCgnc2Vhc29uTmFtZU9rJyk7CiAgICAgIGNvbnN0IGNjICA9ICQoJ3NlYXNvbk5hbWVDYW5jZWwnKTsKCiAgICAgIC8vIEZhbGxiYWNrIGRpIGVtZXJnZW56YTogc2UgbWFuY2FubyBpIG5vZGksIG5vbiBibG9jY2hpYW1vCiAgICAgIGlmKCFvdiB8fCAhaW5wIHx8ICFvayB8fCAhY2MpewogICAgICAgIHJlc29sdmUoU3RyaW5nKGRlZmF1bHRWYWx1ZXx8JycpLnRyaW0oKSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBsZXQgZmluaXNoZWQgPSBmYWxzZTsKCiAgICAgIGNvbnN0IGNsZWFudXAgPSAoKT0+ewogICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBvbktleSk7CiAgICAgICAgb2sucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbk9rKTsKICAgICAgICBjYy5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQ2FuY2VsKTsKICAgICAgICBvdi5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIG9uQmFja2Ryb3ApOwogICAgICB9OwoKICAgICAgY29uc3QgY2xvc2UgPSAodmFsKT0+ewogICAgICAgIGlmKGZpbmlzaGVkKSByZXR1cm47CiAgICAgICAgZmluaXNoZWQgPSB0cnVlOwogICAgICAgIGNsZWFudXAoKTsKICAgICAgICBvdi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAgIHJlc29sdmUodmFsKTsKICAgICAgfTsKCiAgICAgIGNvbnN0IG9uT2sgPSAoKT0+ewogICAgICAgIGNvbnN0IHYgPSBTdHJpbmcoaW5wLnZhbHVlfHwnJykudHJpbSgpOwogICAgICAgIGNsb3NlKHYpOwogICAgICB9OwogICAgICBjb25zdCBvbkNhbmNlbCA9ICgpPT4gY2xvc2UobnVsbCk7CiAgICAgIGNvbnN0IG9uQmFja2Ryb3AgPSAoZSk9PnsgaWYoZS50YXJnZXQgPT09IG92KSBjbG9zZShudWxsKTsgfTsKICAgICAgY29uc3Qgb25LZXkgPSAoZSk9PnsKICAgICAgICBpZihlLmtleSA9PT0gJ0VzY2FwZScpIGNsb3NlKG51bGwpOwogICAgICAgIGlmKGUua2V5ID09PSAnRW50ZXInKXsgZS5wcmV2ZW50RGVmYXVsdCgpOyBvbk9rKCk7IH0KICAgICAgfTsKCiAgICAgIGlucC52YWx1ZSA9IFN0cmluZyhkZWZhdWx0VmFsdWV8fCcnKTsKICAgICAgb3Yuc3R5bGUuZGlzcGxheSA9ICdmbGV4JzsKICAgICAgc2V0VGltZW91dCgoKT0+eyB0cnl7IGlucC5mb2N1cygpOyBpbnAuc2VsZWN0KCk7IH1jYXRjaChlKXt9IH0sIDApOwoKICAgICAgb2suYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbk9rKTsKICAgICAgY2MuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBvbkNhbmNlbCk7CiAgICAgIG92LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgb25CYWNrZHJvcCk7CiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBvbktleSk7CiAgICB9KTsKICB9CmZ1bmN0aW9uIHVpZCgpewogICAgcmV0dXJuIFN0cmluZyhEYXRlLm5vdygpKSArICdfJyArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpLnNsaWNlKDIpOwogIH0KICBmdW5jdGlvbiBsb2FkU3RvcmUoKXsKICAgIHRyeXsKICAgICAgY29uc3QgcmF3ID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oU1RPUkVfS0VZKTsKICAgICAgaWYoIXJhdykgcmV0dXJuIHsgc2Vhc29uczogW10gfTsKICAgICAgY29uc3Qgb2JqID0gSlNPTi5wYXJzZShyYXcpOwogICAgICBpZighb2JqIHx8ICFBcnJheS5pc0FycmF5KG9iai5zZWFzb25zKSkgcmV0dXJuIHsgc2Vhc29uczogW10gfTsKICAgICAgLy8gbm9ybWFsaXplCiAgICAgIG9iai5zZWFzb25zLmZvckVhY2gocz0+ewogICAgICAgIGlmKCFBcnJheS5pc0FycmF5KHMubWF0Y2hlcykpIHMubWF0Y2hlcyA9IFtdOwogICAgICB9KTsKICAgICAgcmV0dXJuIG9iajsKICAgIH1jYXRjaChlKXsKICAgICAgY29uc29sZS5lcnJvcihlKTsKICAgICAgcmV0dXJuIHsgc2Vhc29uczogW10gfTsKICAgIH0KICB9CiAgZnVuY3Rpb24gc2F2ZVN0b3JlKHN0b3JlKXsKICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFNUT1JFX0tFWSwgSlNPTi5zdHJpbmdpZnkoc3RvcmUpKTsKICB9CgoKICBmdW5jdGlvbiBkb3dubG9hZEpzb24oZmlsZW5hbWUsIG9iail7CiAgICB0cnl7CiAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbSlNPTi5zdHJpbmdpZnkob2JqLCBudWxsLCAyKV0sIHt0eXBlOidhcHBsaWNhdGlvbi9qc29uJ30pOwogICAgICBjb25zdCB1cmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOwogICAgICBjb25zdCBhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICBhLmhyZWYgPSB1cmw7CiAgICAgIGEuZG93bmxvYWQgPSBmaWxlbmFtZTsKICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsKICAgICAgYS5jbGljaygpOwogICAgICBhLnJlbW92ZSgpOwogICAgICBzZXRUaW1lb3V0KCgpPT5VUkwucmV2b2tlT2JqZWN0VVJMKHVybCksIDUwMCk7CiAgICB9Y2F0Y2goZSl7CiAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgIGFsZXJ0KCdFcnJvcmUgZHVyYW50ZSBs4oCZZXNwb3J0YXppb25lLicpOwogICAgfQogIH0KCiAgZnVuY3Rpb24gbm9ybWFsaXplSW1wb3J0ZWRTdG9yZShvYmopewogICAgaWYoIW9iaiB8fCB0eXBlb2Ygb2JqICE9PSAnb2JqZWN0JyB8fCAhQXJyYXkuaXNBcnJheShvYmouc2Vhc29ucykpIHJldHVybiBudWxsOwogICAgb2JqLnNlYXNvbnMuZm9yRWFjaChzPT57CiAgICAgIGlmKCFzLmlkKSBzLmlkID0gdWlkKCk7CiAgICAgIGlmKCFBcnJheS5pc0FycmF5KHMubWF0Y2hlcykpIHMubWF0Y2hlcyA9IFtdOwogICAgICBzLm1hdGNoZXMuZm9yRWFjaChtPT57CiAgICAgICAgaWYoIW0uaWQpIG0uaWQgPSB1aWQoKTsKICAgICAgICBpZighbS5hZGRlZEF0KSBtLmFkZGVkQXQgPSBEYXRlLm5vdygpOwogICAgICAgIC8vIG1hdGNoRGF0ZVRzIG9wdGlvbmFsCiAgICAgICAgaWYobS5tYXRjaERhdGVUcyAhPSBudWxsKSBtLm1hdGNoRGF0ZVRzID0gTnVtYmVyKG0ubWF0Y2hEYXRlVHMpIHx8IG51bGw7CiAgICAgIH0pOwogICAgfSk7CiAgICByZXR1cm4gb2JqOwogIH0KCiAgZnVuY3Rpb24gbWVyZ2VTdG9yZXMoYmFzZSwgaW5jb21pbmcpewogICAgY29uc3Qgb3V0ID0gYmFzZSAmJiBiYXNlLnNlYXNvbnMgPyBiYXNlIDoge3NlYXNvbnM6W119OwogICAgY29uc3QgaW5jID0gaW5jb21pbmcgJiYgaW5jb21pbmcuc2Vhc29ucyA/IGluY29taW5nIDoge3NlYXNvbnM6W119OwoKICAgIGNvbnN0IHNlYXNvbkJ5SWQgPSBuZXcgTWFwKG91dC5zZWFzb25zLm1hcChzPT5bcy5pZCwgc10pKTsKICAgIGluYy5zZWFzb25zLmZvckVhY2goc0luPT57CiAgICAgIGxldCBzID0gc2Vhc29uQnlJZC5nZXQoc0luLmlkKTsKICAgICAgaWYoIXMpewogICAgICAgIC8vIGNsb25lIHNlYXNvbgogICAgICAgIHMgPSB7IGlkOiBzSW4uaWQsIG5hbWU6IHNJbi5uYW1lIHx8ICdTdGFnaW9uZScsIGNyZWF0ZWRBdDogc0luLmNyZWF0ZWRBdCB8fCBEYXRlLm5vdygpLCBtYXRjaGVzOiBbXSB9OwogICAgICAgIG91dC5zZWFzb25zLnB1c2gocyk7CiAgICAgICAgc2Vhc29uQnlJZC5zZXQocy5pZCwgcyk7CiAgICAgIH1lbHNlewogICAgICAgIC8vIGtlZXAgZXhpc3RpbmcgbmFtZSB1bmxlc3MgZW1wdHkKICAgICAgICBpZighcy5uYW1lICYmIHNJbi5uYW1lKSBzLm5hbWUgPSBzSW4ubmFtZTsKICAgICAgfQoKICAgICAgY29uc3QgbWF0Y2hJZHMgPSBuZXcgU2V0KChzLm1hdGNoZXN8fFtdKS5tYXAobT0+bS5pZCkpOwogICAgICAoc0luLm1hdGNoZXN8fFtdKS5mb3JFYWNoKG1Jbj0+ewogICAgICAgIGxldCBtaWQgPSBtSW4uaWQgfHwgdWlkKCk7CiAgICAgICAgLy8gYXZvaWQgaWQgY29sbGlzaW9uCiAgICAgICAgaWYobWF0Y2hJZHMuaGFzKG1pZCkpIG1pZCA9IHVpZCgpOwogICAgICAgIG1hdGNoSWRzLmFkZChtaWQpOwogICAgICAgIHMubWF0Y2hlcyA9IHMubWF0Y2hlcyB8fCBbXTsKICAgICAgICBzLm1hdGNoZXMucHVzaCh7CiAgICAgICAgICBpZDogbWlkLAogICAgICAgICAgbmFtZTogbUluLm5hbWUgfHwgbUluLmZpbGVuYW1lIHx8ICdNYXRjaCcsCiAgICAgICAgICBmaWxlbmFtZTogbUluLmZpbGVuYW1lIHx8ICcnLAogICAgICAgICAgYWRkZWRBdDogTnVtYmVyKG1Jbi5hZGRlZEF0fHxEYXRlLm5vdygpKSwKICAgICAgICAgIG1hdGNoRGF0ZVRzOiAobUluLm1hdGNoRGF0ZVRzIT1udWxsID8gTnVtYmVyKG1Jbi5tYXRjaERhdGVUcyl8fG51bGwgOiBudWxsKSwKICAgICAgICAgIGpzb25UZXh0OiBtSW4uanNvblRleHQgfHwgJycKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9KTsKCiAgICAvLyBTb3J0IHNlYXNvbnMgYnkgY3JlYXRlZEF0IGRlc2MgKGxpa2Ugb3JpZ2luYWwgdW5zaGlmdCBiZWhhdmlvcikKICAgIG91dC5zZWFzb25zLnNvcnQoKGEsYik9PihOdW1iZXIoYi5jcmVhdGVkQXR8fDApLU51bWJlcihhLmNyZWF0ZWRBdHx8MCkpKTsKICAgIHJldHVybiBvdXQ7CiAgfQogIGxldCBzdG9yZSA9IGxvYWRTdG9yZSgpOwogIC8vID09PT09IFJpY2VyY2EgJiBPcmRpbmFtZW50byBwYXJ0aXRlID09PT09CiAgbGV0IG1hdGNoU2VhcmNoUXVlcnkgPSAnJzsKICBsZXQgbWF0Y2hTb3J0S2V5ID0gJ21hdGNoRGF0ZSc7IC8vIG1hdGNoRGF0ZSB8IGFkZGVkQXQgfCBuYW1lCiAgbGV0IG1hdGNoU29ydERpciA9IC0xOyAvLyAtMSBkZXNjLCAxIGFzYwoKICBmdW5jdGlvbiBwYXJzZURhdGVUb1RzKHZhbCl7CiAgICBpZighdmFsKSByZXR1cm4gbnVsbDsKICAgIGNvbnN0IHMgPSBTdHJpbmcodmFsKS50cmltKCk7CiAgICBpZighcykgcmV0dXJuIG51bGw7CgogICAgLy8gSVNPIC8gWVlZWS1NTS1ERAogICAgbGV0IG0gPSBzLm1hdGNoKC9eKFxkezR9KVstXC8uXShcZHsxLDJ9KVstXC8uXShcZHsxLDJ9KS8pOwogICAgaWYobSl7CiAgICAgIGNvbnN0IHkgPSBwYXJzZUludChtWzFdLDEwKSwgbW89cGFyc2VJbnQobVsyXSwxMCktMSwgZD1wYXJzZUludChtWzNdLDEwKTsKICAgICAgY29uc3QgZHQgPSBuZXcgRGF0ZSh5LCBtbywgZCk7CiAgICAgIHJldHVybiBpc05hTihkdC5nZXRUaW1lKCkpID8gbnVsbCA6IGR0LmdldFRpbWUoKTsKICAgIH0KCiAgICAvLyBJVCBkZC9tbS95eXl5IG9yIGRkLW1tLXl5eXkKICAgIG0gPSBzLm1hdGNoKC9eKFxkezEsMn0pWy1cLy5dKFxkezEsMn0pWy1cLy5dKFxkezIsNH0pLyk7CiAgICBpZihtKXsKICAgICAgY29uc3QgZCA9IHBhcnNlSW50KG1bMV0sMTApLCBtbz1wYXJzZUludChtWzJdLDEwKS0xOwogICAgICBsZXQgeSA9IHBhcnNlSW50KG1bM10sMTApOwogICAgICBpZih5IDwgMTAwKSB5ID0gMjAwMCArIHk7IC8vIDI0IC0+IDIwMjQKICAgICAgY29uc3QgZHQgPSBuZXcgRGF0ZSh5LCBtbywgZCk7CiAgICAgIHJldHVybiBpc05hTihkdC5nZXRUaW1lKCkpID8gbnVsbCA6IGR0LmdldFRpbWUoKTsKICAgIH0KCiAgICAvLyBmYWxsYmFjazogRGF0ZS5wYXJzZQogICAgY29uc3QgdCA9IERhdGUucGFyc2Uocyk7CiAgICByZXR1cm4gaXNOYU4odCkgPyBudWxsIDogdDsKICB9CgogIGZ1bmN0aW9uIGZvcm1hdERhdGVTaG9ydCh0cyl7CiAgICBpZighdHMpIHJldHVybiAnJzsKICAgIGNvbnN0IGQgPSBuZXcgRGF0ZSh0cyk7CiAgICBpZihpc05hTihkLmdldFRpbWUoKSkpIHJldHVybiAnJzsKICAgIGNvbnN0IGRkID0gU3RyaW5nKGQuZ2V0RGF0ZSgpKS5wYWRTdGFydCgyLCcwJyk7CiAgICBjb25zdCBtbSA9IFN0cmluZyhkLmdldE1vbnRoKCkrMSkucGFkU3RhcnQoMiwnMCcpOwogICAgY29uc3QgeXkgPSBkLmdldEZ1bGxZZWFyKCk7CiAgICByZXR1cm4gYCR7ZGR9LyR7bW19LyR7eXl9YDsKICB9CgogIGxldCBjdXJyZW50U2Vhc29uSWQgPSBudWxsOwogIGxldCBjdXJyZW50TWF0Y2hJZCA9IG51bGw7CgogIGZ1bmN0aW9uIHJlbmRlclNlYXNvbnMoKXsKICAgIGNvbnN0IGxpc3QgPSAkKCdzZWFzb25MaXN0Jyk7CiAgICBsaXN0LmlubmVySFRNTCA9ICcnOwogICAgaWYoc3RvcmUuc2Vhc29ucy5sZW5ndGggPT09IDApewogICAgICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgZGl2LnN0eWxlLm9wYWNpdHkgPSAnLjcnOwogICAgICBkaXYuc3R5bGUuZm9udFNpemUgPSAnMTNweCc7CiAgICAgIGRpdi50ZXh0Q29udGVudCA9ICdOZXNzdW5hIHN0YWdpb25lLiBDbGljY2Eg4oCcTnVvdmEgc3RhZ2lvbmXigJ0uJzsKICAgICAgbGlzdC5hcHBlbmRDaGlsZChkaXYpOwogICAgICByZXR1cm47CiAgICB9CgogICAgc3RvcmUuc2Vhc29ucy5mb3JFYWNoKHNlYXNvbj0+ewogICAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgcm93LnN0eWxlLmRpc3BsYXk9J2ZsZXgnOwogICAgICByb3cuc3R5bGUuZ2FwPSc2cHgnOwogICAgICByb3cuc3R5bGUuYWxpZ25JdGVtcz0nY2VudGVyJzsKCiAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogICAgICBidG4uY2xhc3NOYW1lID0gJ2J0biAnICsgKHNlYXNvbi5pZD09PWN1cnJlbnRTZWFzb25JZCA/ICdibHVlJyA6ICdncmF5Jyk7CiAgICAgIGJ0bi5zdHlsZS5mbGV4PScxJzsKICAgICAgYnRuLnN0eWxlLnRleHRBbGlnbj0nbGVmdCc7CiAgICAgIGJ0bi50ZXh0Q29udGVudCA9IHNlYXNvbi5uYW1lIHx8ICdTdGFnaW9uZSc7CiAgICAgIGJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpPT57CiAgICAgICAgY3VycmVudFNlYXNvbklkID0gc2Vhc29uLmlkOwogICAgICAgIGN1cnJlbnRNYXRjaElkID0gbnVsbDsKICAgICAgICByZW5kZXJTZWFzb25zKCk7CiAgICAgICAgcmVuZGVyTWF0Y2hlcygpOwogICAgICB9KTsKCiAgICAgIGNvbnN0IHJlbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpOwogICAgICByZW5hbWUuY2xhc3NOYW1lPSdidG4gZ3JheSc7CiAgICAgIHJlbmFtZS50ZXh0Q29udGVudD0n4pyP77iPJzsKICAgICAgcmVuYW1lLnRpdGxlPSdSaW5vbWluYSBzdGFnaW9uZSc7CiAgICAgIHJlbmFtZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldik9PnsKICAgICAgICBldi5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICBjb25zdCBubiA9IHByb21wdCgnTm9tZSBzdGFnaW9uZTonLCBzZWFzb24ubmFtZSB8fCAnJyk7CiAgICAgICAgaWYobm4gPT09IG51bGwpIHJldHVybjsKICAgICAgICBzZWFzb24ubmFtZSA9IG5uLnRyaW0oKSB8fCBzZWFzb24ubmFtZSB8fCAnU3RhZ2lvbmUnOwogICAgICAgIHNhdmVTdG9yZShzdG9yZSk7CiAgICAgICAgcmVuZGVyU2Vhc29ucygpOwogICAgICAgIHJlbmRlck1hdGNoZXMoKTsKICAgICAgfSk7CgogICAgICBjb25zdCBkZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgICAgZGVsLmNsYXNzTmFtZT0nYnRuIHJlZCc7CiAgICAgIGRlbC50ZXh0Q29udGVudD0n8J+Xke+4jyc7CiAgICAgIGRlbC50aXRsZT0nQ2FuY2VsbGEgc3RhZ2lvbmUnOwogICAgICBkZWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXYpPT57CiAgICAgICAgZXYuc3RvcFByb3BhZ2F0aW9uKCk7CiAgICAgICAgaWYoIWNvbmZpcm0oJ0NhbmNlbGxhcmUgbGEgc3RhZ2lvbmUgIicrKHNlYXNvbi5uYW1lfHwnJykrJyIgZSB0dXR0ZSBsZSBzdWUgcGFydGl0ZT8nKSkgcmV0dXJuOwogICAgICAgIHN0b3JlLnNlYXNvbnMgPSBzdG9yZS5zZWFzb25zLmZpbHRlcihzPT5zLmlkIT09c2Vhc29uLmlkKTsKICAgICAgICBpZihjdXJyZW50U2Vhc29uSWQ9PT1zZWFzb24uaWQpeyBjdXJyZW50U2Vhc29uSWQ9bnVsbDsgY3VycmVudE1hdGNoSWQ9bnVsbDsgfQogICAgICAgIHNhdmVTdG9yZShzdG9yZSk7CiAgICAgICAgcmVuZGVyU2Vhc29ucygpOwogICAgICAgIHJlbmRlck1hdGNoZXMoKTsKICAgICAgfSk7CgogICAgICByb3cuYXBwZW5kQ2hpbGQoYnRuKTsKICAgICAgcm93LmFwcGVuZENoaWxkKHJlbmFtZSk7CiAgICAgIHJvdy5hcHBlbmRDaGlsZChkZWwpOwogICAgICBsaXN0LmFwcGVuZENoaWxkKHJvdyk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIHJlbmRlck1hdGNoZXMoKXsKICAgIGNvbnN0IHRpdGxlID0gJCgnc2Vhc29uVGl0bGUnKTsKICAgIGNvbnN0IG1hdGNoTGlzdCA9ICQoJ21hdGNoTGlzdCcpOwogICAgY29uc3QgdXBsb2FkTGJsID0gJCgnbGJsVXBsb2FkTWF0Y2gnKTsKICAgIGNvbnN0IGJ0bk9wZW4gPSAkKCdidG5NYXRjaE9wZW4nKTsKICAgIGNvbnN0IGJ0bkRlbCAgPSAkKCdidG5NYXRjaERlbGV0ZScpOwoKICAgIGJ0bk9wZW4uZGlzYWJsZWQgPSB0cnVlOwogICAgYnRuRGVsLmRpc2FibGVkID0gdHJ1ZTsKCiAgICBjb25zdCBzZWFzb24gPSBzdG9yZS5zZWFzb25zLmZpbmQocz0+cy5pZD09PWN1cnJlbnRTZWFzb25JZCk7CiAgICBpZighc2Vhc29uKXsKICAgICAgdGl0bGUudGV4dENvbnRlbnQgPSAnU2VsZXppb25hIHVuYSBzdGFnaW9uZSc7CiAgICAgIHVwbG9hZExibC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICBtYXRjaExpc3QuaW5uZXJIVE1MID0gJzxkaXYgc3R5bGU9InBhZGRpbmc6MTBweDsgZm9udC1zaXplOjEzcHg7IG9wYWNpdHk6Ljc7Ij5OZXNzdW5hIHBhcnRpdGEgKG8gbmVzc3VuYSBzdGFnaW9uZSBzZWxlemlvbmF0YSkuPC9kaXY+JzsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHRpdGxlLnRleHRDb250ZW50ID0gc2Vhc29uLm5hbWUgfHwgJ1N0YWdpb25lJzsKICAgIHVwbG9hZExibC5zdHlsZS5kaXNwbGF5ID0gJ2lubGluZS1mbGV4JzsKCiAgICBjb25zdCBtYXRjaGVzID0gc2Vhc29uLm1hdGNoZXMgfHwgW107CiAgICBpZihtYXRjaGVzLmxlbmd0aCA9PT0gMCl7CiAgICAgIG1hdGNoTGlzdC5pbm5lckhUTUwgPSAnPGRpdiBzdHlsZT0icGFkZGluZzoxMHB4OyBmb250LXNpemU6MTNweDsgb3BhY2l0eTouNzsiPk5lc3N1bmEgcGFydGl0YSBpbiBxdWVzdGEgc3RhZ2lvbmUuIFVzYSDigJxDYXJpY2EgcGFydGl0YeKAnS48L2Rpdj4nOwogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gLS0tIENvbnRyb2xsaTogcmljZXJjYSArIG9yZGluYW1lbnRvIC0tLQogICAgY29uc3QgY29udHJvbHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgIGNvbnRyb2xzLnN0eWxlLmRpc3BsYXk9J2ZsZXgnOwogICAgY29udHJvbHMuc3R5bGUuZ2FwPSc4cHgnOwogICAgY29udHJvbHMuc3R5bGUuZmxleFdyYXA9J3dyYXAnOwogICAgY29udHJvbHMuc3R5bGUuYWxpZ25JdGVtcz0nY2VudGVyJzsKICAgIGNvbnRyb2xzLnN0eWxlLnBhZGRpbmc9JzEwcHgnOwogICAgY29udHJvbHMuc3R5bGUuYm9yZGVyPScxcHggc29saWQgI2VlZSc7CiAgICBjb250cm9scy5zdHlsZS5ib3JkZXJSYWRpdXM9JzEwcHgnOwogICAgY29udHJvbHMuc3R5bGUuYmFja2dyb3VuZD0nI2ZhZmFmYSc7CgogICAgY29uc3QgaW5wID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTsKICAgIGlucC50eXBlPSd0ZXh0JzsKICAgIGlucC5wbGFjZWhvbGRlcj0n8J+UjiBDZXJjYSAobm9tZSBmaWxlIG8gbm9tZSBsZWdnaWJpbGUpJzsKICAgIGlucC52YWx1ZSA9IG1hdGNoU2VhcmNoUXVlcnk7CiAgICBpbnAuc3R5bGUuaGVpZ2h0PSczNHB4JzsKICAgIGlucC5zdHlsZS5wYWRkaW5nPScwIDEwcHgnOwogICAgaW5wLnN0eWxlLmJvcmRlcj0nMXB4IHNvbGlkICNkZGQnOwogICAgaW5wLnN0eWxlLmJvcmRlclJhZGl1cz0nMTBweCc7CiAgICBpbnAuc3R5bGUuZm9udFdlaWdodD0nNzAwJzsKICAgIGlucC5zdHlsZS5mbGV4PScxJzsKICAgIGlucC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsICgpPT57CiAgICAgIG1hdGNoU2VhcmNoUXVlcnkgPSBpbnAudmFsdWUgfHwgJyc7CiAgICAgIHJlbmRlck1hdGNoZXMoKTsKICAgIH0pOwoKICAgIGNvbnN0IHNlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3NlbGVjdCcpOwogICAgc2VsLmNsYXNzTmFtZT0nc2VsZWN0JzsKICAgIHNlbC5zdHlsZS5oZWlnaHQ9JzM0cHgnOwogICAgc2VsLmlubmVySFRNTCA9IGAKICAgICAgPG9wdGlvbiB2YWx1ZT0ibWF0Y2hEYXRlIj7wn5OFIERhdGEgcGFydGl0YTwvb3B0aW9uPgogICAgICA8b3B0aW9uIHZhbHVlPSJhZGRlZEF0Ij7irIbvuI8gRGF0YSBpbXBvcnRhemlvbmU8L29wdGlvbj4KICAgICAgPG9wdGlvbiB2YWx1ZT0ibmFtZSI+8J+UpCBOb21lPC9vcHRpb24+CiAgICBgOwogICAgc2VsLnZhbHVlID0gbWF0Y2hTb3J0S2V5OwogICAgc2VsLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsICgpPT57CiAgICAgIG1hdGNoU29ydEtleSA9IHNlbC52YWx1ZTsKICAgICAgcmVuZGVyTWF0Y2hlcygpOwogICAgfSk7CgogICAgY29uc3QgZGlyQnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJyk7CiAgICBkaXJCdG4uY2xhc3NOYW1lPSdidG4gZ3JheSc7CiAgICBkaXJCdG4udGV4dENvbnRlbnQgPSAobWF0Y2hTb3J0RGlyID09PSAtMSkgPyAn4qyH77iPJyA6ICfirIbvuI8nOwogICAgZGlyQnRuLnRpdGxlID0gJ0NhbWJpYSB2ZXJzbyBvcmRpbmFtZW50byc7CiAgICBkaXJCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKT0+ewogICAgICBtYXRjaFNvcnREaXIgPSAobWF0Y2hTb3J0RGlyID09PSAtMSkgPyAxIDogLTE7CiAgICAgIHJlbmRlck1hdGNoZXMoKTsKICAgIH0pOwoKICAgIGNvbnN0IGNvdW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICBjb3VudC5zdHlsZS5mb250U2l6ZT0nMTJweCc7CiAgICBjb3VudC5zdHlsZS5vcGFjaXR5PScuNzUnOwogICAgY291bnQuc3R5bGUuZm9udFdlaWdodD0nODAwJzsKCiAgICBjb250cm9scy5hcHBlbmRDaGlsZChpbnApOwogICAgY29udHJvbHMuYXBwZW5kQ2hpbGQoc2VsKTsKICAgIGNvbnRyb2xzLmFwcGVuZENoaWxkKGRpckJ0bik7CiAgICBjb250cm9scy5hcHBlbmRDaGlsZChjb3VudCk7CgogICAgLy8gRmlsdHJhCiAgICBjb25zdCBxID0gU3RyaW5nKG1hdGNoU2VhcmNoUXVlcnl8fCcnKS50cmltKCkudG9Mb3dlckNhc2UoKTsKICAgIGxldCBsaXN0ID0gbWF0Y2hlcy5zbGljZSgpOwogICAgaWYocSl7CiAgICAgIGxpc3QgPSBsaXN0LmZpbHRlcihtPT57CiAgICAgICAgY29uc3QgYSA9IFN0cmluZyhtLm5hbWV8fCcnKS50b0xvd2VyQ2FzZSgpOwogICAgICAgIGNvbnN0IGIgPSBTdHJpbmcobS5maWxlbmFtZXx8JycpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgcmV0dXJuIGEuaW5jbHVkZXMocSkgfHwgYi5pbmNsdWRlcyhxKTsKICAgICAgfSk7CiAgICB9CgogICAgLy8gT3JkaW5hCiAgICBjb25zdCBrZXkgPSBtYXRjaFNvcnRLZXk7CiAgICBjb25zdCBkaXIgPSBtYXRjaFNvcnREaXI7CiAgICBsaXN0LnNvcnQoKHgseSk9PnsKICAgICAgY29uc3QgbnggPSB4IHx8IHt9LCBueSA9IHkgfHwge307CiAgICAgIGlmKGtleSA9PT0gJ25hbWUnKXsKICAgICAgICBjb25zdCBheCA9IFN0cmluZyhueC5uYW1lIHx8IG54LmZpbGVuYW1lIHx8ICcnKS50b0xvd2VyQ2FzZSgpOwogICAgICAgIGNvbnN0IGF5ID0gU3RyaW5nKG55Lm5hbWUgfHwgbnkuZmlsZW5hbWUgfHwgJycpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgcmV0dXJuIGF4LmxvY2FsZUNvbXBhcmUoYXkpICogZGlyOwogICAgICB9CiAgICAgIGlmKGtleSA9PT0gJ2FkZGVkQXQnKXsKICAgICAgICBjb25zdCBheCA9IE51bWJlcihueC5hZGRlZEF0fHwwKTsKICAgICAgICBjb25zdCBheSA9IE51bWJlcihueS5hZGRlZEF0fHwwKTsKICAgICAgICByZXR1cm4gKGF4IC0gYXkpICogZGlyOwogICAgICB9CiAgICAgIC8vIG1hdGNoRGF0ZSAoZmFsbGJhY2sgc3UgYWRkZWRBdCkKICAgICAgY29uc3QgYXggPSBOdW1iZXIobngubWF0Y2hEYXRlVHN8fDApIHx8IE51bWJlcihueC5hZGRlZEF0fHwwKTsKICAgICAgY29uc3QgYXkgPSBOdW1iZXIobnkubWF0Y2hEYXRlVHN8fDApIHx8IE51bWJlcihueS5hZGRlZEF0fHwwKTsKICAgICAgcmV0dXJuIChheCAtIGF5KSAqIGRpcjsKICAgIH0pOwoKICAgIGNvdW50LnRleHRDb250ZW50ID0gYE1vc3RyYXRlOiAke2xpc3QubGVuZ3RofSAvICR7bWF0Y2hlcy5sZW5ndGh9YDsKCiAgICBjb25zdCB3cmFwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICB3cmFwLnN0eWxlLmRpc3BsYXk9J2ZsZXgnOwogICAgd3JhcC5zdHlsZS5mbGV4RGlyZWN0aW9uPSdjb2x1bW4nOwoKICAgIGxpc3QuZm9yRWFjaChtPT57CiAgICAgIGNvbnN0IGl0ZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgaXRlbS5zdHlsZS5kaXNwbGF5PSdmbGV4JzsKICAgICAgaXRlbS5zdHlsZS5hbGlnbkl0ZW1zPSdjZW50ZXInOwogICAgICBpdGVtLnN0eWxlLmdhcD0nOHB4JzsKICAgICAgaXRlbS5zdHlsZS5wYWRkaW5nPScxMHB4JzsKICAgICAgaXRlbS5zdHlsZS5ib3JkZXJCb3R0b209JzFweCBzb2xpZCAjZWVlJzsKICAgICAgaXRlbS5zdHlsZS5jdXJzb3I9J3BvaW50ZXInOwogICAgICBpdGVtLnN0eWxlLmJhY2tncm91bmQgPSAobS5pZD09PWN1cnJlbnRNYXRjaElkKSA/ICdyZ2JhKDAsMCwwLC4wNSknIDogJ3RyYW5zcGFyZW50JzsKCiAgICAgIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgbmFtZS5zdHlsZS5mb250V2VpZ2h0PSc3MDAnOwogICAgICBuYW1lLnN0eWxlLmZsZXg9JzEnOwogICAgICBuYW1lLnRleHRDb250ZW50ID0gbS5uYW1lIHx8IG0uZmlsZW5hbWUgfHwgJ01hdGNoJzsKCgogICAgICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgIGRhdGUuc3R5bGUuZm9udFNpemU9JzExcHgnOwogICAgICBkYXRlLnN0eWxlLm9wYWNpdHk9Jy43JzsKICAgICAgZGF0ZS5zdHlsZS5mb250V2VpZ2h0PSc4MDAnOwogICAgICBjb25zdCB0cyA9IChtLm1hdGNoRGF0ZVRzIHx8IG0uYWRkZWRBdCB8fCBudWxsKTsKICAgICAgZGF0ZS50ZXh0Q29udGVudCA9IHRzID8gKCfwn5OFICcgKyBmb3JtYXREYXRlU2hvcnQodHMpKSA6ICcnOwogICAgICBjb25zdCByZW5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgICAgcmVuYW1lLmNsYXNzTmFtZT0nYnRuIGdyYXknOwogICAgICByZW5hbWUudGV4dENvbnRlbnQ9J+Kcj++4jyc7CiAgICAgIHJlbmFtZS50aXRsZT0nUmlub21pbmEgcGFydGl0YSc7CiAgICAgIHJlbmFtZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jIChldik9PnsKICAgICAgICBldi5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICBjb25zdCBubiA9IGF3YWl0IGFza1NlYXNvbk5hbWUobS5uYW1lIHx8IG0uZmlsZW5hbWUgfHwgJycpOwogICAgICAgIGlmKG5uID09PSBudWxsKSByZXR1cm47CiAgICAgICAgbS5uYW1lID0gbm4udHJpbSgpIHx8IG0ubmFtZSB8fCBtLmZpbGVuYW1lOwogICAgICAgIHNhdmVTdG9yZShzdG9yZSk7CiAgICAgICAgcmVuZGVyTWF0Y2hlcygpOwogICAgICB9KTsKCiAgICAgIGl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKT0+ewogICAgICAgIGN1cnJlbnRNYXRjaElkID0gbS5pZDsKICAgICAgICByZW5kZXJNYXRjaGVzKCk7CiAgICAgIH0pOwoKICAgICAgaXRlbS5hcHBlbmRDaGlsZChuYW1lKTsKICAgICAgaWYoZGF0ZS50ZXh0Q29udGVudCkgaXRlbS5hcHBlbmRDaGlsZChkYXRlKTsKICAgICAgaXRlbS5hcHBlbmRDaGlsZChyZW5hbWUpOwogICAgICB3cmFwLmFwcGVuZENoaWxkKGl0ZW0pOwogICAgfSk7Cm1hdGNoTGlzdC5pbm5lckhUTUw9Jyc7CiAgICBtYXRjaExpc3QuYXBwZW5kQ2hpbGQoY29udHJvbHMpOwogICAgbWF0Y2hMaXN0LmFwcGVuZENoaWxkKHdyYXApOwoKICAgIC8vIGVuYWJsZSBidXR0b25zIGlmIHNlbGVjdGlvbiBleGlzdHMKICAgIGlmKGN1cnJlbnRNYXRjaElkKXsKICAgICAgYnRuT3Blbi5kaXNhYmxlZCA9IGZhbHNlOwogICAgICBidG5EZWwuZGlzYWJsZWQgPSBmYWxzZTsKICAgIH0KICB9CgogIGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NGaWxlVGV4dChmaWxlbmFtZSwgdHh0KXsKICAgIC8vIENvcGlhIGlkZW50aWNhIGRlbGxhIGxvZ2ljYSBkaSAiQXByaSBKU09OIiBvcmlnaW5hbGUsIG1hIHN1IChmaWxlbmFtZSwgdHh0KS4KICAgIGNvbnN0IG9ialJhdyA9IEpTT04ucGFyc2UodHh0KTsKCiAgICAvLyBGaWxlIHVuaWNvIG1hdGNoOiBlc3BhbmRlIGluIFExL1EyLy4uLi9GSU5BTAogICAgaWYob2JqUmF3ICYmIG9ialJhdy5fX3R5cGUgPT09ICdiYXNrZXRfc3RhdHNfbWF0Y2gnICYmIG9ialJhdy5zbmFwc2hvdHMpewogICAgICBjb25zdCBnaWQgPSBTdHJpbmcob2JqUmF3Py5tZXRhPy5nYW1lSWQgfHwgaW5mZXJGcm9tRmlsZW5hbWUoZmlsZW5hbWUpLmdhbWVJZCB8fCAnJykudHJpbSgpIHx8IGZpbGVuYW1lOwogICAgICBjb25zdCBzbmFwcyA9IG9ialJhdy5zbmFwc2hvdHMgfHwge307CiAgICAgIGZvcihjb25zdCBrIG9mIE9iamVjdC5rZXlzKHNuYXBzKSl7CiAgICAgICAgY29uc3Qgc25hcE9ialJhdyA9IHNuYXBzW2tdOwogICAgICAgIGNvbnN0IHNuYXBPYmogPSBub3JtYWxpemVMb2FkZWRKc29uKHNuYXBPYmpSYXcsIGAke2ZpbGVuYW1lfTo6JHtrfWApOwogICAgICAgIGlmKCFzbmFwT2JqKSBjb250aW51ZTsKICAgICAgICBpZighc25hcE9iai5tZXRhKSBzbmFwT2JqLm1ldGEgPSB7fTsKICAgICAgICBzbmFwT2JqLm1ldGEuZ2FtZUlkID0gc25hcE9iai5tZXRhLmdhbWVJZCB8fCBnaWQ7CiAgICAgICAgc25hcE9iai5tZXRhLnNuYXBzaG90ID0gc25hcE9iai5tZXRhLnNuYXBzaG90IHx8IHNuYXBPYmoubWV0YS5wZXJpb2QgfHwgU3RyaW5nKGspLnRvVXBwZXJDYXNlKCk7CiAgICAgICAgYWRkVG9JbmRleChzbmFwT2JqLCBgJHtmaWxlbmFtZX06OiR7a31gKTsKICAgICAgfQogICAgICByZXR1cm47CiAgICB9CgogICAgY29uc3QgZ2FtZU9iaiA9IG5vcm1hbGl6ZUxvYWRlZEpzb24ob2JqUmF3LCBmaWxlbmFtZSk7CiAgICBpZighZ2FtZU9iail7CiAgICAgIGFsZXJ0KCdGb3JtYXRvIG5vbiByaWNvbm9zY2l1dG8gaW46ICcgKyBmaWxlbmFtZSArICdcXG5Vc2EgaSAuanNvbiBzYWx2YXRpIGRhbCBmb2dsaW8gcGFydGl0YSAo8J+SviBTYWx2YSkuJyk7CiAgICAgIHJldHVybjsKICAgIH0KICAgIGFkZFRvSW5kZXgoZ2FtZU9iaiwgZmlsZW5hbWUpOwogIH0KCiAgYXN5bmMgZnVuY3Rpb24gb3Blbk1hdGNoRnJvbUxpYnJhcnkobWF0Y2gpewogICAgaWYoIW1hdGNoKSByZXR1cm47CiAgICB0cnl7CiAgICAgIEZJTEVTX0JZX0dBTUUuY2xlYXIoKTsKICAgICAgYXdhaXQgcHJvY2Vzc0ZpbGVUZXh0KG1hdGNoLmZpbGVuYW1lIHx8IG1hdGNoLm5hbWUgfHwgJ21hdGNoLmpzb24nLCBtYXRjaC5qc29uVGV4dCk7CiAgICAgIGlmKEZJTEVTX0JZX0dBTUUuc2l6ZSA9PT0gMCkgcmV0dXJuOwogICAgICByZWZyZXNoU2VsZWN0b3JzKCk7CgogICAgICAvLyBmb3J6aWFtbyBzZWxlY3Rpb24gY29lcmVudGUgYW5jaGUgc2UgaSBjb250cm9sbGkgc29ubyBuYXNjb3N0aQogICAgICBpZihGSUxFU19CWV9HQU1FLnNpemUgPT09IDEpewogICAgICAgIGNvbnN0IG9ubHlJZCA9IEFycmF5LmZyb20oRklMRVNfQllfR0FNRS5rZXlzKCkpWzBdOwogICAgICAgIGNvbnN0IGVudHJ5ID0gRklMRVNfQllfR0FNRS5nZXQob25seUlkKTsKICAgICAgICBjb25zdCBzbmFwcyA9IEFycmF5LmZyb20oZW50cnkuc25hcHMua2V5cygpKS5zb3J0KChhLGIpPT5TTkFQX09SREVSKGEpLVNOQVBfT1JERVIoYikpOwogICAgICAgIGNvbnN0IHBpY2sgPSBzbmFwcy5pbmNsdWRlcygnRklOQUwnKSA/ICdGSU5BTCcgOiBzbmFwc1tzbmFwcy5sZW5ndGgtMV07CgogICAgICAgIGNvbnN0IHNlbFNuYXAgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VsU25hcCcpOwogICAgICAgIHNlbFNuYXAuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgc25hcHMuZm9yRWFjaChzPT57CiAgICAgICAgICBjb25zdCBvcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTsKICAgICAgICAgIG9wdC52YWx1ZSA9IHM7IG9wdC50ZXh0Q29udGVudCA9IHM7CiAgICAgICAgICBzZWxTbmFwLmFwcGVuZENoaWxkKG9wdCk7CiAgICAgICAgfSk7CiAgICAgICAgc2VsU25hcC52YWx1ZSA9IHBpY2s7CiAgICAgICAgYXBwbHlTZWxlY3Rpb24oKTsKICAgICAgfWVsc2V7CiAgICAgICAgY29uc3QgZmlyc3RJZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWxHYW1lJykudmFsdWU7CiAgICAgICAgcG9wdWxhdGVTbmFwc2hvdHMoZmlyc3RJZCk7CiAgICAgICAgYXBwbHlTZWxlY3Rpb24oKTsKICAgICAgfQogICAgICAvLyBjaGl1ZGkgbGlicmVyaWEKICAgICAgJCgnbGliT3ZlcmxheScpLnN0eWxlLmRpc3BsYXk9J25vbmUnOwogICAgfWNhdGNoKGVycil7CiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgYWxlcnQoJ0Vycm9yZSBuZWwgY2FyaWNhbWVudG8gZGVsIGZpbGUgSlNPTi4nKTsKICAgIH0KICB9CgogIGZ1bmN0aW9uIHdpcmUoKXsKICAgIGNvbnN0IG92ZXJsYXkgPSAkKCdsaWJPdmVybGF5Jyk7CiAgICBjb25zdCBidG5MaWIgPSAkKCdidG5MaWJyYXJ5Jyk7CiAgICBjb25zdCBidG5DbG9zZSA9ICQoJ2J0bkxpYkNsb3NlJyk7CiAgICBjb25zdCBidG5OZXdTZWFzb24gPSAkKCdidG5TZWFzb25OZXcnKTsKICAgIGNvbnN0IGJ0bkV4cG9ydCA9ICQoJ2J0bkxpYkV4cG9ydCcpOwogICAgY29uc3QgaW5wSW1wb3J0ID0gJCgnYnRuTGliSW1wb3J0Jyk7CiAgICBjb25zdCBmaWxlSW5wID0gJCgnbGliRmlsZUlucHV0Jyk7CiAgICBjb25zdCBidG5PcGVuID0gJCgnYnRuTWF0Y2hPcGVuJyk7CiAgICBjb25zdCBidG5EZWwgID0gJCgnYnRuTWF0Y2hEZWxldGUnKTsKCiAgICBpZihidG5MaWIgJiYgb3ZlcmxheSl7CiAgICAgIGJ0bkxpYi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpPT57CiAgICAgICAgc3RvcmUgPSBsb2FkU3RvcmUoKTsKICAgICAgICBvdmVybGF5LnN0eWxlLmRpc3BsYXk9J2ZsZXgnOwogICAgICAgIHJlbmRlclNlYXNvbnMoKTsKICAgICAgICByZW5kZXJNYXRjaGVzKCk7CiAgICAgIH0pOwogICAgfQogICAgaWYoYnRuQ2xvc2UgJiYgb3ZlcmxheSl7CiAgICAgIGJ0bkNsb3NlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCk9PiBvdmVybGF5LnN0eWxlLmRpc3BsYXk9J25vbmUnKTsKICAgIH0KCiAgICAvLyBFeHBvcnQgbGlicmVyaWEKICAgIGlmKGJ0bkV4cG9ydCl7CiAgICAgIGJ0bkV4cG9ydC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpPT57CiAgICAgICAgdHJ5ewogICAgICAgICAgY29uc3QgY3VycmVudCA9IGxvYWRTdG9yZSgpOwogICAgICAgICAgZG93bmxvYWRKc29uKCdiYXNrZXRfc3RhdHNfbGlicmVyaWEuanNvbicsIGN1cnJlbnQpOwogICAgICAgIH1jYXRjaChlKXsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7CiAgICAgICAgICBhbGVydCgnRXJyb3JlIGR1cmFudGUgbOKAmWVzcG9ydGF6aW9uZS4nKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIC8vIEltcG9ydCBsaWJyZXJpYSAobWVyZ2UgbyByZXBsYWNlKQogICAgaWYoaW5wSW1wb3J0KXsKICAgICAgaW5wSW1wb3J0LmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGFzeW5jIChlKT0+ewogICAgICAgIGNvbnN0IGYgPSAoZS50YXJnZXQuZmlsZXMgJiYgZS50YXJnZXQuZmlsZXNbMF0pID8gZS50YXJnZXQuZmlsZXNbMF0gOiBudWxsOwogICAgICAgIGlmKCFmKSByZXR1cm47CiAgICAgICAgdHJ5ewogICAgICAgICAgY29uc3QgdHh0ID0gYXdhaXQgZi50ZXh0KCk7CiAgICAgICAgICBjb25zdCBvYmogPSBub3JtYWxpemVJbXBvcnRlZFN0b3JlKEpTT04ucGFyc2UodHh0KSk7CiAgICAgICAgICBpZighb2JqKXsKICAgICAgICAgICAgYWxlcnQoJ0ZpbGUgbm9uIHZhbGlkbzogc2VydmUgdW4gSlNPTiBlc3BvcnRhdG8gZGFsbGEgbGlicmVyaWEuJyk7CiAgICAgICAgICAgIGlucEltcG9ydC52YWx1ZSA9ICcnOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgbW9kZSA9IGNvbmZpcm0oJ1Z1b2kgVU5JUkUgKE9LKSBvIFNPU1RJVFVJUkUgKEFubnVsbGEpIGxhIGxpYnJlcmlhIGF0dHVhbGU/XG5cbk9LID0gVW5pc2NpIChjb25zaWdsaWF0bylcbkFubnVsbGEgPSBTb3N0aXR1aXNjaScpOwogICAgICAgICAgaWYobW9kZSl7CiAgICAgICAgICAgIGNvbnN0IG1lcmdlZCA9IG1lcmdlU3RvcmVzKGxvYWRTdG9yZSgpLCBvYmopOwogICAgICAgICAgICBzYXZlU3RvcmUobWVyZ2VkKTsKICAgICAgICAgIH1lbHNlewogICAgICAgICAgICBzYXZlU3RvcmUob2JqKTsKICAgICAgICAgIH0KCiAgICAgICAgICAvLyByZWZyZXNoIFVJCiAgICAgICAgICBzdG9yZSA9IGxvYWRTdG9yZSgpOwogICAgICAgICAgY3VycmVudFNlYXNvbklkID0gbnVsbDsKICAgICAgICAgIGN1cnJlbnRNYXRjaElkID0gbnVsbDsKICAgICAgICAgIHJlbmRlclNlYXNvbnMoKTsKICAgICAgICAgIHJlbmRlck1hdGNoZXMoKTsKICAgICAgICB9Y2F0Y2goZXJyKXsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgICAgICAgIGFsZXJ0KCdFcnJvcmUgZHVyYW50ZSBs4oCZaW1wb3J0YXppb25lLiBDb250cm9sbGEgY2hlIHNpYSB1biBmaWxlIEpTT04gdmFsaWRvLicpOwogICAgICAgIH1maW5hbGx5ewogICAgICAgICAgaW5wSW1wb3J0LnZhbHVlID0gJyc7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICAgIGlmKG92ZXJsYXkpewogICAgICBvdmVybGF5LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKGUpPT57CiAgICAgICAgaWYoZS50YXJnZXQgPT09IG92ZXJsYXkpIG92ZXJsYXkuc3R5bGUuZGlzcGxheT0nbm9uZSc7CiAgICAgIH0pOwogICAgfQoKICAgIGlmKGJ0bk5ld1NlYXNvbil7CiAgICAgIGJ0bk5ld1NlYXNvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGFzeW5jICgpPT57CiAgICAgICAgY29uc3QgbmFtZSA9IGF3YWl0IGFza1NlYXNvbk5hbWUoJycpOwogICAgICAgIGlmKG5hbWUgPT09IG51bGwpIHJldHVybjsKICAgICAgICBjb25zdCBzZWFzb24gPSB7IGlkOiB1aWQoKSwgbmFtZTogKFN0cmluZyhuYW1lKS50cmltKCl8fCdTdGFnaW9uZScpLCBjcmVhdGVkQXQ6IERhdGUubm93KCksIG1hdGNoZXM6IFtdIH07CiAgICAgICAgc3RvcmUuc2Vhc29ucy51bnNoaWZ0KHNlYXNvbik7CiAgICAgICAgY3VycmVudFNlYXNvbklkID0gc2Vhc29uLmlkOwogICAgICAgIGN1cnJlbnRNYXRjaElkID0gbnVsbDsKICAgICAgICBzYXZlU3RvcmUoc3RvcmUpOwogICAgICAgIHJlbmRlclNlYXNvbnMoKTsKICAgICAgICByZW5kZXJNYXRjaGVzKCk7CiAgICAgIH0pOwogICAgfQoKICAgIGlmKGZpbGVJbnApewogICAgICBmaWxlSW5wLmFkZEV2ZW50TGlzdGVuZXIoJ2NoYW5nZScsIGFzeW5jIChlKT0+ewogICAgICAgIGNvbnN0IGZpbGVzID0gQXJyYXkuZnJvbShlLnRhcmdldC5maWxlcyB8fCBbXSk7CiAgICAgICAgaWYoIWZpbGVzLmxlbmd0aCkgcmV0dXJuOwogICAgICAgIGNvbnN0IHNlYXNvbiA9IHN0b3JlLnNlYXNvbnMuZmluZChzPT5zLmlkPT09Y3VycmVudFNlYXNvbklkKTsKICAgICAgICBpZighc2Vhc29uKXsKICAgICAgICAgIGFsZXJ0KCdTZWxlemlvbmEgcHJpbWEgdW5hIHN0YWdpb25lLicpOwogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KICAgICAgICBmb3IoY29uc3QgZiBvZiBmaWxlcyl7CiAgICAgICAgICB0cnl7CiAgICAgICAgICAgIGNvbnN0IHR4dCA9IGF3YWl0IGYudGV4dCgpOwogICAgICAgICAgICAvLyB2YWxpZGF0ZSBKU09OIGVhcmx5ICsgZXN0cmFpIGRhdGEgcGFydGl0YSAoc2UgcHJlc2VudGUpCiAgICAgICAgICAgIGxldCBwYXJzZWQgPSBudWxsOwogICAgICAgICAgICB0cnl7IHBhcnNlZCA9IEpTT04ucGFyc2UodHh0KTsgfWNhdGNoKGUpeyBwYXJzZWQgPSBudWxsOyB9CiAgICAgICAgICAgIGxldCBtYXRjaERhdGVUcyA9IG51bGw7CiAgICAgICAgICAgIHRyeXsKICAgICAgICAgICAgICAvLyBQcm92aWFtbyB2YXJpZSBwb3NpemlvbmkgdGlwaWNoZQogICAgICAgICAgICAgIGNvbnN0IHVpID0gcGFyc2VkPy5zdGF0ZT8udWkgfHwgcGFyc2VkPy51aSB8fCBwYXJzZWQ/Lm1ldGE/LnVpIHx8IHt9OwogICAgICAgICAgICAgIGNvbnN0IGQxID0gdWk/LmRhdGFHYXJhIHx8IHBhcnNlZD8ubWV0YT8uZGF0YUdhcmEgfHwgcGFyc2VkPy5tZXRhPy5kYXRlIHx8IHBhcnNlZD8uZGF0ZTsKICAgICAgICAgICAgICBtYXRjaERhdGVUcyA9IHBhcnNlRGF0ZVRvVHMoZDEpOwogICAgICAgICAgICB9Y2F0Y2goZSl7fQogICAgICAgICAgICBjb25zdCBtID0geyBpZDogdWlkKCksIG5hbWU6IGYubmFtZSwgZmlsZW5hbWU6IGYubmFtZSwgYWRkZWRBdDogRGF0ZS5ub3coKSwgbWF0Y2hEYXRlVHM6IG1hdGNoRGF0ZVRzLCBqc29uVGV4dDogdHh0IH07CiAgICAgICAgICAgIHNlYXNvbi5tYXRjaGVzLnVuc2hpZnQobSk7CiAgICAgICAgICB9Y2F0Y2goZXJyKXsKICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpOwogICAgICAgICAgICBhbGVydCgnRmlsZSBub24gdmFsaWRvOiAnK2YubmFtZSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIHNhdmVTdG9yZShzdG9yZSk7CiAgICAgICAgY3VycmVudE1hdGNoSWQgPSBudWxsOwogICAgICAgIC8vIHJlc2V0IGlucHV0IHNvIHNhbWUgZmlsZSBjYW4gYmUgcmUtdXBsb2FkZWQKICAgICAgICBmaWxlSW5wLnZhbHVlID0gJyc7CiAgICAgICAgcmVuZGVyTWF0Y2hlcygpOwogICAgICB9KTsKICAgIH0KCiAgICBpZihidG5PcGVuKXsKICAgICAgYnRuT3Blbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpPT57CiAgICAgICAgY29uc3Qgc2Vhc29uID0gc3RvcmUuc2Vhc29ucy5maW5kKHM9PnMuaWQ9PT1jdXJyZW50U2Vhc29uSWQpOwogICAgICAgIGNvbnN0IG1hdGNoID0gc2Vhc29uPy5tYXRjaGVzPy5maW5kKG09Pm0uaWQ9PT1jdXJyZW50TWF0Y2hJZCk7CiAgICAgICAgaWYoIW1hdGNoKSByZXR1cm47CiAgICAgICAgb3Blbk1hdGNoRnJvbUxpYnJhcnkobWF0Y2gpOwogICAgICB9KTsKICAgIH0KCiAgICBpZihidG5EZWwpewogICAgICBidG5EZWwuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKT0+ewogICAgICAgIGNvbnN0IHNlYXNvbiA9IHN0b3JlLnNlYXNvbnMuZmluZChzPT5zLmlkPT09Y3VycmVudFNlYXNvbklkKTsKICAgICAgICBpZighc2Vhc29uKSByZXR1cm47CiAgICAgICAgY29uc3QgbWF0Y2ggPSBzZWFzb24ubWF0Y2hlcy5maW5kKG09Pm0uaWQ9PT1jdXJyZW50TWF0Y2hJZCk7CiAgICAgICAgaWYoIW1hdGNoKSByZXR1cm47CiAgICAgICAgaWYoIWNvbmZpcm0oJ0NhbmNlbGxhcmUgIicrKG1hdGNoLm5hbWV8fG1hdGNoLmZpbGVuYW1lfHwnJykrJyI/JykpIHJldHVybjsKICAgICAgICBzZWFzb24ubWF0Y2hlcyA9IHNlYXNvbi5tYXRjaGVzLmZpbHRlcihtPT5tLmlkIT09Y3VycmVudE1hdGNoSWQpOwogICAgICAgIGN1cnJlbnRNYXRjaElkID0gbnVsbDsKICAgICAgICBzYXZlU3RvcmUoc3RvcmUpOwogICAgICAgIHJlbmRlck1hdGNoZXMoKTsKICAgICAgfSk7CiAgICB9CiAgfQoKICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgd2lyZSk7Cn0pKCk7Cjwvc2NyaXB0PgoKCjwhLS0gTW9kYWxlIE5vbWUgU3RhZ2lvbmUgKHNlbnphIHByb21wdCkgLS0+CjxkaXYgaWQ9InNlYXNvbk5hbWVPdmVybGF5Ij4KICA8ZGl2IGNsYXNzPSJib3giIHJvbGU9ImRpYWxvZyIgYXJpYS1tb2RhbD0idHJ1ZSIgYXJpYS1sYWJlbGxlZGJ5PSJzZWFzb25OYW1lVGl0bGUiPgogICAgPGRpdiBjbGFzcz0iaGRyIiBpZD0ic2Vhc29uTmFtZVRpdGxlIj5OdW92YSBzdGFnaW9uZTwvZGl2PgogICAgPGRpdiBjbGFzcz0iYm9keSI+CiAgICAgIDxsYWJlbCBmb3I9InNlYXNvbk5hbWVJbnB1dCI+Tm9tZSBzdGFnaW9uZSAoZXMuIDIwMjUvMjYpOjwvbGFiZWw+CiAgICAgIDxpbnB1dCBpZD0ic2Vhc29uTmFtZUlucHV0IiB0eXBlPSJ0ZXh0IiBhdXRvY29tcGxldGU9Im9mZiIgc3BlbGxjaGVjaz0iZmFsc2UiIHBsYWNlaG9sZGVyPSJFcy4gMjAyNS8yNiIvPgogICAgICA8ZGl2IHN0eWxlPSJmb250LXNpemU6MTJweDsgb3BhY2l0eTouNzU7IGxpbmUtaGVpZ2h0OjEuMzU7Ij4KICAgICAgICBTdWdnZXJpbWVudG86IHB1b2kgdXNhcmUgdW4gZm9ybWF0byB0aXBvIDxzdHJvbmc+MjAyNS8yNjwvc3Ryb25nPiBvcHB1cmUgdW4gbm9tZSBsaWJlcm8uCiAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJhY3Rpb25zIj4KICAgICAgPGJ1dHRvbiBpZD0ic2Vhc29uTmFtZUNhbmNlbCIgY2xhc3M9ImJ0biBncmF5Ij5Bbm51bGxhPC9idXR0b24+CiAgICAgIDxidXR0b24gaWQ9InNlYXNvbk5hbWVPayIgY2xhc3M9ImJ0biBibHVlIj5PazwvYnV0dG9uPgogICAgPC9kaXY+CiAgPC9kaXY+CjwvZGl2PgoKPC9ib2R5Pgo8L2h0bWw+Cg=="
};

function b64ToUtf8(b64){
  const bin = atob(b64);
  const bytes = new Uint8Array(bin.length);
  for(let i=0;i<bin.length;i++) bytes[i] = bin.charCodeAt(i);
  return new TextDecoder('utf-8').decode(bytes);
}

function loadOnce(id, key){
  const fr = document.getElementById(id);
  if(fr.dataset.loaded === "1") return;
  fr.srcdoc = b64ToUtf8(B64[key]);
  fr.dataset.loaded = "1";
}

function nav(target){
  if(target === 'home') loadOnce('frame-home','home');
  if(target === 'live') loadOnce('frame-live','live');
  if(target === 'viewer') loadOnce('frame-viewer','viewer');

  document.getElementById('frame-home').style.display = (target==='home') ? 'block' : 'none';
  document.getElementById('frame-live').style.display = (target==='live') ? 'block' : 'none';
  document.getElementById('frame-viewer').style.display = (target==='viewer') ? 'block' : 'none';
}

window.addEventListener('message', (ev)=>{
  const msg = ev.data || {};
  if(msg.type === 'nav' && (msg.target==='home' || msg.target==='live' || msg.target==='viewer')){
    nav(msg.target);
  }
});

// avvio
nav('home');
</script>
</body>
</html>
